[{"id":0,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-recommendations/","title":"Create Recommendations","parent":"Creating Content","content":"\rAdding New Recommendation Recommendation Structure Recommendation Categories Writing a Meaningful Recommendation Examples This section provides guidance on how to create new recommendations. The following requirements should be followed:\nAdding New Recommendation\rTo contribute a new recommendation for an Azure resource, follow these steps:\nLocate the recommendations.yaml file within the directory corresponding to the Azure resource, Azure WAF design principle, or specialized workload you want to add a recommendation for.\nOpen the recommendations.yaml file and copy the following YAML template:\n- description: Your Recommendation Title Here (less than 100 characters) aprlGuid: Generate a Unique GUID using https://guidgenerator.com/online-guid-generator.aspx recommendationTypeId: null recommendationControl: High Availability/Business Continuity/Disaster Recovery/Scalability/Monitoring and Alerting/Service Upgrade and Retirement/Other Best Practices/Personalized/Governance recommendationImpact: Low/Medium/High recommendationResourceType: Friendly name to identity resource type recommendationMetadataState: Active longDescription: | Your Long Description Here (less than 300 characters) potentialBenefits: Potential Benefits of Implementing the Recommendation (less than 60 characters) pgVerified: false publishedToLearn: false publishedToAdvisor: false automationAvailable: no/arg tags: null learnMoreLink: - name: Learn More url: \u0026#34;Link URL\u0026#34; Customize the placeholders with your recommendation\u0026rsquo;s specific details. See the Recommendation Structure section for more information on each key-value pair.\nOnce you\u0026rsquo;ve added your recommendation, save the file.\nTo test your changes, spin up your local hugo server by running the following command within your terminal:\nhugo server --disableFastRender Submit your changes by creating a pull request in the repository.\nThat\u0026rsquo;s all! Your suggestion will be reviewed for potential inclusion in the Azure Proactive Resiliency Library.\nQuestions or need assistance? Don\u0026rsquo;t hesitate to create a GitHub Issue for support.\nIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, or errors unrelated to your changes, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository. Recommendation Structure\rThe YAML structure for adding new recommendations consists of several key-value pairs, each providing specific information about the recommendation. Below is a table that describes each key-value pair:\nKey Example Value Data Type Allowed Values Description description Monitor Batch Account quota String Less than 100 characters Summarization of your recommendation aprlGuid 3464854d-6f75-4922-95e4-a2a308b53ce6 String 32-character hexadecimal string The unique identifier for the recommendation in the context of APRL and CXObserve. Generate a GUID for each new recommendation recommendationTypeId 3464854d-6f75-4922-95e4-a2a308b53ce6 String null until updated by the Azure Advisor team The unique identifier for the recommendation in the context of Advisor. recommendationControl Monitoring and Alerting String High Availability, Business Continuity, Disaster Recovery, Scalability, Monitoring and Alerting, Service Upgrade and Retirement, Other Best Practices, Personalized, Governance, Security Resiliency category associated with the recommendation recommendationImpact Medium String Low, Medium, High Importance of adopting the recommendation and/or the risk of choosing not to adopt recommendationResourceType Storage Account String Align with the resource type Friendly name to identity resource type recommendationMetadataState Active String Active, Disabled Indicates whether the recommendation is visible longDescription To enable Cross-region disaster recovery and business continuity, ensure that the appropriate quotas are set for all user subscription Batch accounts. String The length should be less than 300 characters Detailed description of the recommendation and its implications potentialBenefits Enhanced data redundancy and boosts availability String The length should be less than 60 characters The potential benefits of implementing the recommendation pgVerified false Boolean true, false Indicates whether the recommendation is verified by the relevant product group publishedToLearn false Boolean true, false Indicates whether the recommendation is published to Microsoft Learn publishedToAdvisor false Boolean true, false Indicates whether the recommendation is published to Azure Advisor automationAvailable false Boolean no, arg Indicates whether automation is available for validating the recommendation tags null String null Generalized tags used for incorporating fields to automate learnMoreLink - name: Learn More url: \u0026ldquo;https://learn.microsoft.com/en-us/azure/reliability/reliability-batch#cross-region-disaster-recovery-and-business-continuity\u0026rdquo; Object Only 1 link per recommendation Links related to the recommendation, such as announcements or documentation Recommendation Categories\rEach recommendation should have one and only one associated recommendationCategory from this list below.\nRecommendation Category Summary High Availability Focuses on ensuring services remain accessible and operational with minimal downtime. Business Continuity Involves strategies to maintain essential functions during and after a disaster, ensuring business operations continue. Disaster Recovery Focuses on restoring systems and data after catastrophic failures, ensuring quick recovery post-disaster. Scalability Involves techniques to handle changes in load and maintain system performance under varying conditions. Monitoring and Alerting Constant surveillance of system health, performance, and security, aiding in quick issue identification and resolution. Service Upgrade and Retirement Addresses the planning and execution of system upgrades and the retirement of outdated services. Other Best Practices Encompasses miscellaneous best practices that improve system resilience, efficiency, and security. Personalized Customized recommendations tailored to specific system requirements, configurations, or preferences. Governance Involves policies, procedures, and oversight for IT resource utilization. Ensures adherence to legal, regulatory, and compatibility requirements, while guiding overall system management. (Includes Compliance and Compatibility) Writing a Meaningful Recommendation\rWhen writing a recommendation, consider the following:\nAPRL recommendations are intended to enable and accelerate the delivery of Well Architected Reliability Assessments. The purpose of APRL is not to replace existing Azure public documentation and guidance on best practices.\nEach recommendation should be actionable for the customer. The customer should be able to place the recommendation in their backlog and the engineer that picks it up should have complete clarity on the change that needs to be made and the specific resources that the change should be made to.\nEach recommendation should include a descriptive title, a short guidance section that contains additional detail on the recommendation, links to public documentation that provide additional information related to the recommendation, and a query to identify resources that are not compliant with the recommendation. The title and guidance sections alone should provide sufficient information for a CSA to evaluate a resource.\nRecommendations should not require the CSA to spend a lot of time on background reading, they should not be open to interpretation, and they should not be vague. Remember that the CSA delivering the WARA is reviewing a large number of Azure resources in a limited amount of time and is not an expert in every Azure resource.\nExamples\rGood recommendation: Use a /24 subnet for the resource Bad recommendation: Size your subnet appropriately Not all best practices make good APRL recommendations. If the best practice relates to a particular resource configuration and can be checked with an ARG query, it probably makes for a good APRL recommendation. If the best practice is more aligned to general architectural concepts that are true for many Azure resources or workload types, we very likely already have a recommendation in the APRL WAF section that addresses the topic. If not, consider adding a WAF recommendation to APRL. If neither is the case, APRL may not be the best location for this content.\n","description":"Adding New Recommendation Recommendation Structure Recommendation Categories Writing a Meaningful Recommendation Examples This section provides guidance on how to create new recommendations. The following requirements should be followed:\nAdding New Recommendation\rTo contribute a new recommendation for an Azure resource, follow these steps:\nLocate the recommendations.yaml file within the directory corresponding to the Azure resource, Azure WAF design principle, or specialized workload you want to add a recommendation for."},{"id":1,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/define/","title":"Define","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “1 - Define (Requirements)” and associated resources and their settings.\nIn this initial stage, the objectives and requirements for system reliability are established. This often involves specifying availability and recovery targets, latency tolerances, criticality classifications, and disaster recovery objectives.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rDefine and share Availability Targets with all teams for workload consistency\rHigh\rHigh Availability\rVerified\rEnsure the Recovery Targets are well defined and communicated across teams working on the Workload\rHigh\rDisaster Recovery\rVerified\rDetails\rDefine and share Availability Targets with all teams for workload consistency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure the Availability Targets (SLA, SLO, SLI) are well defined, tested, monitored and communicated across teams working on the Workload. A Service Level Agreement (SLA) is an availability target that represents a commitment around performance and availability of the application. Understanding the SLA of individual components within the system is essential to define reliability targets. Knowing the SLA of dependencies will also provide a justification for additional spend when making the dependencies highly available and with proper support contracts. Availability targets for any dependencies leveraged by the application should be understood and ideally align with application targets should also be considered. Understanding your availability expectations is vital to reviewing overall operations for the application. For example, if you are striving to achieve an application Service Level Objective (SLO) of 99.999%, the level of inherent operational action required by the application is going to be far greater than if an SLO of 99.9% was the goal. Potential Benefits:\rEnhances reliability and communication\rLearn More:\rUse business metrics to design resilient Azure applications\rTarget functional and nonfunctional requirements\rEnsure the Recovery Targets are well defined and communicated across teams working on the Workload\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure the Recovery Targets are well defined and communicated across teams working on the Workload. Two important metrics to consider are the recovery time objective and recovery point objective, as they pertain to disaster recovery. - Recovery time objective (RTO) is the maximum acceptable time that an application can be unavailable after an incident. If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster. If you have a very low RTO, you might keep a second regional deployment continually running an active/passive configuration on standby, to protect against a regional outage. In some cases, you might deploy an active/active configuration to achieve even lower RTO. - Recovery point objective (RPO) is the maximum duration of data loss that is acceptable during a disaster. For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data. RTO and RPO are non-functional requirements of a system and should be dictated by business requirements. To derive these values, it\u0026#39;s a good idea to conduct a risk assessment, and clearly understanding the cost of downtime or data loss. Monitoring and measuring application availability is vital to qualifying overall application health and progress towards defined targets. Make sure you measure and monitor key targets such as: - Mean Time Between Failures (MTBF) — The average time between failures of a particular component. - Mean Time to Recover (MTTR) — The average time it takes to restore a component after a failure. Potential Benefits:\rImproved recovery times and data loss prevention\rLearn More:\rTarget functional and nonfunctional requirements\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “1 - Define (Requirements)” and associated resources and their settings.\nIn this initial stage, the objectives and requirements for system reliability are established. This often involves specifying availability and recovery targets, latency tolerances, criticality classifications, and disaster recovery objectives.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rDefine and share Availability Targets with all teams for workload consistency\rHigh\rHigh Availability\rVerified\rEnsure the Recovery Targets are well defined and communicated across teams working on the Workload\rHigh\rDisaster Recovery\rVerified\rDetails\rDefine and share Availability Targets with all teams for workload consistency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure the Availability Targets (SLA, SLO, SLI) are well defined, tested, monitored and communicated across teams working on the Workload."},{"id":2,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/getting-started/","title":"Getting Started","parent":"Contributor Guide","content":"This section provides guidance on how to get started with contributing. The following should be considered and/or addressed before you start contributing:\nContext/Background I\u0026rsquo;m not familiar with Hugo. Is that okay? Prerequisites Required Software/Applications Installation with winget Additional Requirements Running and Accessing a Local Copy of APRL During Development Creating a pull request Context/Background\rBefore diving in, please take a moment to acquaint yourself with the context and background of how this library is built, which will help you contribute effectively moving forward.\nWebsite: The site is built using Hugo, a static site generator. Source Code: Stored in the APRL GitHub repository, this is also linked in the website\u0026rsquo;s header. Hosting: The site is hosted on GitHub Pages. We\u0026rsquo;ve chosen Hugo and GitHub Pages to present an easily navigable and consumable library. This combination ensures a user-friendly experience, especially across different devices, including mobile platforms.\nI\u0026rsquo;m not familiar with Hugo. Is that okay?\rAbsolutely! You don\u0026rsquo;t need to be. Hugo simply requires you to know how to write markdown (.md) files, and it handles the rest when generating the site. 👍\nPrerequisites\rTo prepare for contributing to APRL, follow the steps below to ensure you\u0026rsquo;re in a \u0026ldquo;ready state.\u0026rdquo;\nA \u0026ldquo;ready state\u0026rdquo; means you have forked the Azure/Azure-Proactive-Resiliency-Library-v2 repository, cloned it to your local machine, and opened it in VS Code.\nRequired Software/Applications\rTo contribute to this project/repository/library, you will need the following installed:\nYou can use winget to easily install all the prerequisites. Refer to the section below for installation commands.\rGit Visual Studio Code (VS Code) Extensions: editorconfig.editorconfig, streetsidesoftware.code-spell-checker, medo64.render-crlf, github.copilot-chat, esbenp.prettier-vscode VS Code will automatically recommend installing these when you open this repository, or a fork of it, in VS Code. Hugo Extended Installation with winget\rTo install the required software using winget, follow the instructions here.\nwinget install --id \u0026#39;Git.Git\u0026#39; winget install --id \u0026#39;Microsoft.VisualStudioCode\u0026#39; winget install --id \u0026#39;Hugo.Hugo.Extended\u0026#39; Additional Requirements\rEnsure you meet the following prerequisites:\nCreate a GitHub profile/account Fork the Azure/Azure-Proactive-Resiliency-Library-v2 repository to your GitHub organization/account and clone it locally to your machine. Instructions for forking a repository and cloning it can be found here. Running and Accessing a Local Copy of APRL During Development\rWhile in VS Code, you can open a terminal and execute the commands below to access a local copy of the APRL website from a web server provided by Hugo. Access it using the following address: http://localhost:1313/Azure-Proactive-Resiliency-Library-v2/:\nhugo server --disableFastRender Creating a pull request\rOnce you have committed changes to your fork of the APRL repo, you create a pull request to merge your changes into the APRL repo.\nGitHub - Creating a pull request from a fork ","description":"This section provides guidance on how to get started with contributing. The following should be considered and/or addressed before you start contributing:\nContext/Background I\u0026rsquo;m not familiar with Hugo. Is that okay? Prerequisites Required Software/Applications Installation with winget Additional Requirements Running and Accessing a Local Copy of APRL During Development Creating a pull request Context/Background\rBefore diving in, please take a moment to acquaint yourself with the context and background of how this library is built, which will help you contribute effectively moving forward."},{"id":3,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/script-overviews/","title":"Overview and Usage of APRL Scripts","parent":"Tools","content":"This section provides an overview of the Azure Proactive Resiliency Library v2 (APRL) scripts and how to use them. The following scenarios are covered:\n1 - Collector Script 1.1 - Cloud Shell 1.2 Local Machine 2 - Data Analyzer Script Local Machine - Script Execution Local Machine - Action Plan Analysis 3 - Reports Generator Script Local Machine - Report Generation 1 - Collector Script\rGitHub Link to Download GitHub Link to Sample Output The Collector PowerShell script is the first script to be run in the Azure Proactive Resiliency Library (APRL) tooling suite. It is designed to collect data from the Azure environment to help identify potential issues and areas for improvement using the Azure Resource Graph queries within this repository. The script leverages the Az.ResourceGraph module to query Azure Resource Graph for relevant data.\nYou have two options for running the collector script:\nCloud Shell - Requires Cloud Shell be configured with write access to a fileshare within the same tenant\nLocal Machine - Requires current modules leveraged in the script be installed\n1.1 - Cloud Shell\rFrom the Azure Portal open Cloud Shell, select PowerShell instead of BASH\nIf this is your first time using Cloud Shell, refer to the getting started guide from Microsoft Learn - Azure Cloud Shell. Upload the WARA Collector Script to Cloud Shell Execute script leveraging optional parameters\nParameters include: TenantID: Optional ; tenant to be used. SubscriptionIds: Optional (or SubscriptionsFile) ; Specifies Subscription(s) to be included in the analysis: Subscription1,Subscription2. SubscriptionsFile: Optional (or SubscriptionIds) ; specifies the file with the subscription list to be analysed (one subscription per line). RunbookFile: Optional ; specifies the file with the runbook (selectors \u0026amp; checks) to be used. ResourceGroups: Optional ; specifies Resource Group(s) to be included in the analysis: ResourceGroup1,ResourceGroup2. Debug: Optional ; Writes Debugging information of the script during the execution. Select \u0026ldquo;A\u0026rdquo; to allow modules to install After Script completes, download the results 1.2 Local Machine\rTo run the script there are 5 prerequisites that must be completed first:\nThe script must be executed from PowerShell 7, not Windows PowerShell or PowerShell ISE. Git must be installed on the local machine - Git Install required PowerShell Modules: Install-Module -Name ImportExcel -Force -SkipPublisherCheck Install-Module -Name Az.ResourceGraph -SkipPublisherCheck Install-Module -Name Az.Accounts -SkipPublisherCheck Unblock the Script The script is digitally signed, but the PowerShell module ImportExcel is not. So at this moment, you need to allow the execution of scripts not signed locally: Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope LocalMachine Reader permissions to target subscription(s) Open a new PowerShell 7 session after completeing prerequisites\nChange your directory to the same location that you have downloaded the WARA collector script to.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Execute script leveraging optional parameters\nParameters include: TenantID: Optional; tenant to be used. SubscriptionIds: Optional (or SubscriptionsFile); Specifies Subscription(s) to be included in the analysis: Subscription1,Subscription2. SubscriptionsFile: Optional (or SubscriptionIds); specifies the file with the subscription list to be analysed (one subscription per line). RunbookFile: Optional; specifies the file with the runbook (selectors \u0026amp; checks) to be used. ResourceGroups: Optional; specifies Resource Group(s) to be included in the analysis: ResourceGroup1,ResourceGroup2. Debug: Writes Debugging information of the script during the execution. Authenticate with the account that has Reader permissions to the target subscription(s) After script completes, the results will be saved to the same folder location.\n2 - Data Analyzer Script\rGitHub Link to Download GitHub Link to Sample Output The Data Analyzer PowerShell script is the second script in the Azure Proactive Resiliency Library (APRL) tooling suite. It compares the output collected by the Collector script with the Azure Proactive Resiliency Guidelines (APRL) and generates an ActionPlan Excel spreadsheet. The goal of this tool is to summarize the collected data and provide actionable insights into the health and resiliency of the Azure environment.\nLocal Machine - Script Execution\rThe Data Analyzer script must be run from a Windows Machine with Excel installed.\nChange your directory to the same location that you have downloaded the WARA Data Analyzer script to.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Execute script pointing the -JSONFile parameter to file created by the WARA Collector script. Select \u0026ldquo;R\u0026rdquo; to allow script to run After the script completes it will save a WARA Action Plan.xlsx file to the same file path.\nLocal Machine - Action Plan Analysis\rOnce the script has completed, open the Excel Action Plan and familiarize yourself with the structure of the file, generated data, resources collected, pivot tables, and charts created.\nThese are the worksheets: Recommendations: you will find all Recommendations, their category, impact, description, learn more links, and much more. Note that Columns A and B are counting the number of Azure Resources associated with the RecommendationID. ImpactedResources: you will find a list of Azure Resources associated with a RecommendationID. These are the Azure Resources NOT following Microsoft best practices for Reliability. PivotTable: you will find a couple of pivot tables used to automatically create the charts Charts: you will find 3 charts that will be used in the Executive Summary PPTx ResourceTypes: you will find a list of all ResourceTypes the customer is using, number of Resources deployed for each one, and if there are Recommendations for the ResourceType in APRL. At this point, all Azure Resources with recommendations and Azure Resource Graph queries available in APRL, were automatically validated. Follow the next steps to validate the remaining services without automation or that does not exist in APRL yet. Go to the \u0026ldquo;ImpactedResources\u0026rdquo; worksheet, filter Column \u0026ldquo;B\u0026rdquo; by \u0026ldquo;IMPORTANT\u0026rdquo;, and validate manually the remaining resource configurations for reliabilty patterns.\n\u0026ldquo;IMPORTANT - Query under development\u0026rdquo; \u0026ldquo;IMPORTANT - Recommendation cannot be validated with ARGs - Validate Resources manually\u0026rdquo; \u0026ldquo;IMPORTANT - ServiceType Not Available in APRL - Validate Resources manually if Applicable, if not delete this line\u0026rdquo; Remove/add any recommendations based on your analysis prior to generating reports\n3 - Reports Generator Script\rGitHub Link to Download GitHub Link to Sample Output - Executive Summary Presentation GitHub Link to Sample Output - Assessment Report The Reports Generator PowerShell script serves as the final step in the Azure Proactive Resiliency Library (APRL) tooling suite. It takes the Excel spreadsheet generated by the Data Analyzer script and converts it into Microsoft Word and PowerPoint formats. The Reports Generator automates the process of creating comprehensive reports from the analyzed data, making it easier to share insights and recommendations.\nLocal Machine - Report Generation\rYou will need to have both the Word and PowerPoint templates downloaded to the same file location. Change your directory to the same location that you have downloaded the WARA Reports Generator script to.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Execute script leveraging needed parameters\nParameters include: ExcelFile: Mandatory; WARA Excel file generated by \u0026lsquo;2_wara_data_analyzer.ps1\u0026rsquo; script and customized. CustomerName: Optional; specifies the Name of the Customer to be added to the PPTx and DOCx files. Heavy: Optional; runs the script at a lower pace to handle heavy environments. WorkloadName: Optional; specifies the Name of the Workload of the analyses to be added to the PPTx and DOCx files. PPTTemplateFile: Optional; specifies the PPTx template file to be used as source. If not specified the script will look for the file in the same path as the script. WordTemplateFile: Optional; specifies the DOCx template file to be used as source. If not specified the script will look for the file in the same path as the script. Debugging: Optional; Writes a Debugging information to a log file. Select \u0026ldquo;R\u0026rdquo; to allow script to run After the script successfully runs, you will find two new files saved in your folder. Some of the information will be automatically populated based on the Action Plan. Updates will need to be made prior to presenting to any audience.\r","description":"This section provides an overview of the Azure Proactive Resiliency Library v2 (APRL) scripts and how to use them. The following scenarios are covered:\n1 - Collector Script 1.1 - Cloud Shell 1.2 Local Machine 2 - Data Analyzer Script Local Machine - Script Execution Local Machine - Action Plan Analysis 3 - Reports Generator Script Local Machine - Report Generation 1 - Collector Script\rGitHub Link to Download GitHub Link to Sample Output The Collector PowerShell script is the first script to be run in the Azure Proactive Resiliency Library (APRL) tooling suite."},{"id":4,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/add-dependent-azure-resources/","title":"Add Dependent Azure Resources for Specialized Workloads","parent":"Creating Content","content":"\rAdd Dependent Azure Resources for Specialized Workloads Example of a Dependent Azure Resource Recommendation Table This section provides information about referecing dependent Azure resources for specialized workloads. The following scenarios are covered:\nAdd Dependent Azure Resources for Specialized Workloads\rGo to the relevant specialized workload directory within the azure-specialized-workloads directory.\nOpen the _index.md file within the specialized workload directory.\nAdd the dependent Azure resources to the Dependent Azure Resource Recommendations table where the following columns are required:\nRecommendation: This will be a markdown URL built using recommendation key that links to the description key within the dependent Azure Resource YAML file and the path to the directory\nProvider Namespace: The provider namespace of the Azure resource. Utilize the recommendationResourceType key within the dependent Azure Resource YAML file. So if the recommendationResourceType key is Microsoft.Compute/virtualMachines, the provider namespace would be Compute.\nResource Type: The resource type of the Azure resource. Utilize the recommendationResourceType key within the dependent Azure Resource YAML file. So if the recommendationResourceType key is Microsoft.Compute/virtualMachines, the resource type would be virtualMachines.\nYou only need to update this table for dependent Azure resource recommendations that are located in the azure-resources directory.\nIf you add a new specialized workload recommendation, you will NOT need to update the dependent Azure resource recommendations table in the azure-specialized-workload directory.\nExample of a Dependent Azure Resource Recommendation Table\rSee the markdown example below for a dependent Azure resource recommendation table:\n| Recommendation | Provider Namespace | Resource Type | |:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------:|:-------------:| | [(Personal) Create a validation pool for testing of planned updates](../../../Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/#personal-create-a-validation-pool-for-testing-of-planned-updates) | DesktopVirtualization | hostPools | | [(Pooled) Configure scheduled agent updates](../../../Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/#pooled-configure-scheduled-agent-updates) | DesktopVirtualization | hostPools | ","description":"Add Dependent Azure Resources for Specialized Workloads Example of a Dependent Azure Resource Recommendation Table This section provides information about referecing dependent Azure resources for specialized workloads. The following scenarios are covered:\nAdd Dependent Azure Resources for Specialized Workloads\rGo to the relevant specialized workload directory within the azure-specialized-workloads directory.\nOpen the _index.md file within the specialized workload directory.\nAdd the dependent Azure resources to the Dependent Azure Resource Recommendations table where the following columns are required:"},{"id":5,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/","title":"Azure Resources","parent":"Azure Proactive Resiliency Library v2","content":"\rApiManagement\rservice\rAutomation\rautomationAccounts\rAVS\rprivateClouds\rBatch\rbatchAccounts\rCache\rRedis\rCdn\rprofiles\rCompute\rgalleries\rvirtualMachines\rvirtualMachineScaleSets\rContainerRegistry\rregistries\rContainerService\rmanagedClusters\rDatabricks\rworkspaces\rDBforMySQL\rflexibleServers\rDBforPostgreSQL\rflexibleServers\rDesktopVirtualization\rhostPools\rscalingPlans\rDevices\riotHubs\rDocumentDB\rdatabaseAccounts\rEventGrid\rtopics\rEventHub\rnamespaces\rInsights\ractivityLogAlerts\rcomponents\rKeyVault\rvaults\rNetApp\rnetAppAccounts\rNetwork\rapplicationGateways\razureFirewalls\rconnections\rddosProtectionPlans\rexpressRouteCircuits\rexpressRoutePorts\rfrontDoorWebApplicationFirewallPolicies\rloadBalancers\rnetworkSecurityGroups\rnetworkWatchers\rprivateDnsZones\rprivateEndpoints\rpublicIPAddresses\rrouteTables\rtrafficManagerProfiles\rvirtualNetworkGateways\rvirtualNetworks\rNetworkFunction\razureTrafficCollectors\rOperationalInsights\rworkspaces\rRecoveryServices\rvaults\rResources\rresourceGroups\rServiceBus\rnamespaces\rSignalRService\rsignalR\rSql\rservers\rStorage\rstorageAccounts\rSubscription\rsubscriptions\rVirtualMachineImages\rimageTemplates\rWeb\rserverFarms\rsites\r","description":"\rApiManagement\rservice\rAutomation\rautomationAccounts\rAVS\rprivateClouds\rBatch\rbatchAccounts\rCache\rRedis\rCdn\rprofiles\rCompute\rgalleries\rvirtualMachines\rvirtualMachineScaleSets\rContainerRegistry\rregistries\rContainerService\rmanagedClusters\rDatabricks\rworkspaces\rDBforMySQL\rflexibleServers\rDBforPostgreSQL\rflexibleServers\rDesktopVirtualization\rhostPools\rscalingPlans\rDevices\riotHubs\rDocumentDB\rdatabaseAccounts\rEventGrid\rtopics\rEventHub\rnamespaces\rInsights\ractivityLogAlerts\rcomponents\rKeyVault\rvaults\rNetApp\rnetAppAccounts\rNetwork\rapplicationGateways\razureFirewalls\rconnections\rddosProtectionPlans\rexpressRouteCircuits\rexpressRoutePorts\rfrontDoorWebApplicationFirewallPolicies\rloadBalancers\rnetworkSecurityGroups\rnetworkWatchers\rprivateDnsZones\rprivateEndpoints\rpublicIPAddresses\rrouteTables\rtrafficManagerProfiles\rvirtualNetworkGateways\rvirtualNetworks\rNetworkFunction\razureTrafficCollectors\rOperationalInsights\rworkspaces\rRecoveryServices\rvaults\rResources\rresourceGroups\rServiceBus\rnamespaces\rSignalRService\rsignalR\rSql\rservers\rStorage\rstorageAccounts\rSubscription\rsubscriptions\rVirtualMachineImages\rimageTemplates\rWeb\rserverFarms\rsites\r"},{"id":6,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/","title":"Creating Content","parent":"Contributor Guide","content":"This section provides information about creating new content for the Azure Proactive Resiliency Library. The following scenarios are covered:\nCreate Recommendations Create Content from Templates Create ARG Queries Ensure you have completed the prerequisites before you attempt to follow the guidance for any of the scenarios below.\r","description":"This section provides information about creating new content for the Azure Proactive Resiliency Library. The following scenarios are covered:\nCreate Recommendations Create Content from Templates Create ARG Queries Ensure you have completed the prerequisites before you attempt to follow the guidance for any of the scenarios below.\r"},{"id":7,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/design/","title":"Design","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “2 - Design (Workload Design)” and associated resources and their settings.\nIn this Stage, the architecture and design decisions are made to meet the requirements defined earlier. Best practices for resilient and scalable systems are implemented, often including redundancy, failover strategies, and load balancing. In this phase failure mode and point analysis are coordinated in order to identify and mitigate possible failures, and single points of failures.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rConsider deploying your application across multiple zones\rHigh\rHigh Availability\rVerified\rConsider deploying your application across multiple regions\rHigh\rDisaster Recovery\rVerified\rEnsure that all fault-points and fault-modes are understood and operationalized\rHigh\rHigh Availability\rVerified\rUse PaaS Azure services instead of IaaS\rMedium\rScalability\rVerified\rDesign the application to scale out\rHigh\rScalability\rVerified\rCreate a landing zone for the workload following the Microsoft Cloud Adoption Framework\rLow\rGovernance\rVerified\rDesign a BCDR strategy that will help to meet the business requirements\rHigh\rDisaster Recovery\rVerified\rProvide security assurance through identity management\rMedium\rSecurity\rVerified\rAddressing security risks minimizes downtime and data loss from exposures\rHigh\rSecurity\rVerified\rDetails\rConsider deploying your application across multiple zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDesign your application architecture to use availability zones within a region. Availability zones can be used to optimize application availability within a region by providing datacenter-level fault tolerance. However, the application architecture must not share dependencies between zones to use them effectively. Consider if component proximity is required for application performance reasons. If all or part of the application is highly sensitive to latency, components might need to be co-located which can limit the applicability of multi-region and multi-zone strategies. Potential Benefits:\rEnhanced app availability and fault tolerance\rLearn More:\rUse Availability Zones\rConsider deploying your application across multiple regions\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIf your application is deployed to a single region, and the region becomes unavailable, your application will also be unavailable. This might be unacceptable under the terms of your application\u0026#39;s SLA. If so, consider deploying your application and its services across multiple regions. A multiregional deployment can use an active-active or active-passive configuration. An active-active configuration distributes requests across multiple active regions. An active-passive configuration keeps warm instances in the secondary region, but doesn\u0026#39;t send traffic there unless the primary region fails. Potential Benefits:\rEnhances app availability and SLA compliance\rLearn More:\rDesign reliable Azure applications\rCross-region replication in Azure Business continuity and disaster recovery\rEnsure that all fault-points and fault-modes are understood and operationalized\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure that all fault-points and fault-modes are understood and operationalized. Failure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system. The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning. Identify all fault-points and fault-modes. Fault-points describe the elements within an application architecture which can fail, while fault-modes capture the various ways by which a fault-point may fail. To ensure an application is resilient to end-to-end failures, it is essential that all fault-points and fault-modes are understood and operationalized. Potential Benefits:\rEnhanced system resiliency\rLearn More:\rFailure mode analysis for Azure applications\rUse PaaS Azure services instead of IaaS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPaaS provides a framework for developing and running apps. As with IaaS, the PaaS provider hosts and maintains the platform\u0026#39;s servers, networks, storage, and other computing resources. But PaaS also includes tools, services, and systems that support the web application lifecycle. Developers use the platform to build apps without having to manage backups, security solutions, upgrades, and other administrative tasks. Potential Benefits:\rSaves time, enhances security, simplifies app lifecycle\rLearn More:\rUse platform as a service (PaaS) options\rDesign the application to scale out\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure provides elastic scalability and you should design to scale out. However, applications must leverage a scale-unit approach to navigate service and subscription limits to ensure that individual components and the application as a whole can scale horizontally. Don\u0026#39;t forget about scale in, which is important to reduce cost. For example, scale in and out for App Service is done via rules. Often customers write scale out rules and never write scale in rules, which leaves the App Service more expensive. Potential Benefits:\rEnhances scalability and cost efficiency\rLearn More:\rDesign to scale out\rCreate a landing zone for the workload following the Microsoft Cloud Adoption Framework\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFrom a workload perspective, a landing zone refers to a prepared platform into which the application gets deployed. A landing zone implementation can have compute, data sources, access controls, and networking components already provisioned. With the required plumbing ready in place; the workload needs to plug into it. When considering the overall security, a landing zone offers centralized security capabilities that adds a threat mitigation layer for the workload. Implementations can vary but here are some common strategies that enhance the security posture. - Isolation through segmentation. You can isolate assets at several layers from Azure enrollment down to a subscription that has the resources for the workload. - Consistent adoption of organizational policies, enforce creation and deletion of services and their configuration through Azure Policy. - Configurations that align with principles of Zero Trust. For instance an implementation might have network connectivity to on-premises data centers. Potential Benefits:\rEnhances security and speeds deployment\rLearn More:\rAzure landing zone integration\rDesign a BCDR strategy that will help to meet the business requirements\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDisaster recovery is the process of restoring application functionality after a catastrophic loss. In cloud environments, we acknowledge up front that failures happen. Instead of trying to prevent failures altogether, the goal is to minimize the effects of a single failing component. Testing is one way to minimize these effects. You should automate testing of your applications where possible, but you also need to be prepared for when they fail. When a failure happens, having backup and recovery strategies becomes important. Your tolerance for reduced functionality during a disaster is a business decision that varies from one application to the next. It might be acceptable for some applications to be temporarily unavailable, or partially available with reduced functionality or delayed processing. For other applications, any reduced functionality is unacceptable. Key points: - Create and test a disaster recovery plan regularly using key failure scenarios. - Design a disaster recovery strategy to run most applications with reduced functionality. - Design a backup strategy that\u0026#39;s tailored for the business requirements and circumstances of the application. - Automate failover and failback steps and processes. - Test and validate the failover and failback approach successfully at least once. Potential Benefits:\rMinimizes disaster impact, ensures operational continuity\rLearn More:\rBackup and disaster recovery for Azure applications\rProvide security assurance through identity management\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProvide security assurance through identity management: the process of authenticating and authorizing security principals. Use identity management services to authenticate and grant permission to users, partners, customers, applications, services, and other entities. Identity management is typically a centralized function not controlled by the workload team as a part of the workload\u0026#39;s architecture. - Define clear lines of responsibility and separation of duties for each function. Restrict access based on a need-to-know basis and least privilege security principles. - Assign permissions to users, groups, and applications at a certain scope through Azure RBAC. Use built-in roles when possible. - Prevent deletion or modification of a resource, resource group, or subscription through management locks. - Use managed identities to access resources in Azure. Potential Benefits:\rEnhanced access control and security\rLearn More:\rAzure identity and access management considerations\rAddressing security risks minimizes downtime and data loss from exposures\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSecurity is one of the most important aspects of any architecture. It provides the following assurances against deliberate attacks and abuse of your valuable data and systems: Confidentiality ,Integrity, and Availability. The security of complex systems depends on understanding the business context, social context, and technical context. As you design your system, cover these areas: - Ensure that the identity provider (AAD/ADFS/AD/Other) is highly available and aligns with application availability and recovery targets. - All external application endpoints are secured. - Communication to Azure PaaS services secured using Virtual Network Service Endpoints or Private Link. - Keys and secrets are backed-up to geo-redundant storage, and are still available in a failover case. - Ensure that the process for key rotation is automated and tested. - Emergency access break glass accounts have been tested and secured for recovering from Identity provider failure scenarios. Potential Benefits:\rMinimizes downtime and data loss\rLearn More:\rSecurity design principles\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “2 - Design (Workload Design)” and associated resources and their settings.\nIn this Stage, the architecture and design decisions are made to meet the requirements defined earlier. Best practices for resilient and scalable systems are implemented, often including redundancy, failover strategies, and load balancing. In this phase failure mode and point analysis are coordinated in order to identify and mitigate possible failures, and single points of failures."},{"id":8,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-archetypes/","title":"Create Content from Templates","parent":"Creating Content","content":"This section provides information about creating new content from Hugo archetypes/templates. The following scenarios are covered:\nCreate a New Azure Resource Provider Namespace Create a New Azure Resource Type within an Existing Provider Namespace Create a New Azure Specialized Workload Create a New WAF Reliability Stage Create a New Azure Resource Provider Namespace\rEnsure you are in the root directory of the repository within your terminal.\nRun the following hugo command within your terminal.\nhugo new --kind azure-provider-namespace \u0026#39;azure-resources/Storage\u0026#39; Replace Storage with the name of the Azure provider namespace you want to create. Ensure that the name aligns to the available resource providers found in the documentation here.\nAlso, ensure that it is formatted with no spaces and is using pascal case. For example, MachineLearningServices or VirtualMachineImages.\nYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-resources\\\\Storage\u0026#34; created Create a New Azure Resource Type within an Existing Provider Namespace\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal\nhugo new --kind azure-resource-type \u0026#39;azure-resources/Storage/locations\u0026#39; Replace storageAccounts with the name of the Azure resource type you want to create. Ensure that the name aligns to the available resource types found in the documentation here. At this time, we are only allowing the creation of resource types one level deep, so you cannot create a resource type that is nested within another resource type such as Storage/storageAccounts/blobServices.\nAlso, ensure that it is formatted with no spaces and is using camel casing. For example, automationAccounts or databaseAccounts.\nYou should see similar output within your terminal as shown below: Content dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-resources\\\\Storage\\\\locations\u0026#34; created You should now see a new directory created within the azure-resources/Storage directory, named after the Azure resource type you specified and containing the relevant folders and files to build out the resource type. You can also verify the creation by inspecting the resource type within your local Hugo site, which should have been rebuilt automatically with the change. Create a New Azure Specialized Workload\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal\nhugo new --kind azure-specialized-workload \u0026#39;azure-specialized-workloads/oracle\u0026#39; Replace oracle with the name of the specialized workload you want to create.\nAlso, ensure that it is formatted with no spaces and is using camel case. For example, hpcOnAzure.\nYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-specialized-workloads\\\\oracle\u0026#34; created You should now see a new directory created within the azure-specialized directory, named after the Azure specialized workload you specified. You can verify the creation by inspecting the directory in your local Hugo site, which should have been rebuilt automatically with the change.\nCreate a New WAF Reliability Stage\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal:\nhugo new --kind azure-waf \u0026#39;azure-waf/develop\u0026#39; Replace develop with the name of the WAF reliability stage you want to create.\rYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-waf\\\\develop\u0026#34; created ","description":"This section provides information about creating new content from Hugo archetypes/templates. The following scenarios are covered:\nCreate a New Azure Resource Provider Namespace Create a New Azure Resource Type within an Existing Provider Namespace Create a New Azure Specialized Workload Create a New WAF Reliability Stage Create a New Azure Resource Provider Namespace\rEnsure you are in the root directory of the repository within your terminal.\nRun the following hugo command within your terminal."},{"id":9,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/","title":"Specialized Workloads","parent":"Azure Proactive Resiliency Library v2","content":"\rAzure High Performance Computing\rAzure Virtual Desktop\rAzure VMware Solution\rSAP on Azure\r","description":"\rAzure High Performance Computing\rAzure Virtual Desktop\rAzure VMware Solution\rSAP on Azure\r"},{"id":10,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/test/","title":"Test","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “3 - Test (Workload Testing)” and associated resources and their settings.\nBefore deploying the system, comprehensive tests are conducted to validate the design and implementation. This stage is crucial for identifying any weaknesses that could compromise reliability.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rTest your applications for availability and resiliency\rHigh\rHigh Availability\rVerified\rConsider building logic into your workload to handle errors\rHigh\rHigh Availability\rVerified\rPerform disaster recovery tests regularly\rHigh\rDisaster Recovery\rVerified\rUse chaos engineering to test Azure applications\rMedium\rHigh Availability\rVerified\rTest application fault resiliency\rHigh\rHigh Availability\rVerified\rDetails\rTest your applications for availability and resiliency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApplications should be tested to ensure availability and resiliency. Availability describes the amount of time that an application runs in a healthy state without significant downtime. Resiliency describes how quickly an application recovers from failure. Being able to measure availability and resiliency can answer questions like: - How much downtime is acceptable? How much does potential downtime cost your business? - What are your availability requirements? - How much do you invest in making your application highly available? - What is the risk versus the cost? - Testing plays a critical role in making sure your applications can meet these requirements. Key points: - Test regularly to validate existing thresholds, targets, and assumptions. - Automate testing as much as possible. - Perform testing on both key Test environments and the production environment. - Verify how the end-to-end workload performs under intermittent failure conditions. - Test the application against critical functional and nonfunctional requirements for performance. - Conduct load testing with expected peak volumes to Test scalability and performance under load. - Perform chaos testing by injecting faults. Potential Benefits:\rImproves uptime and speeds recovery\rLearn More:\rTesting applications for availability and resiliency\rConsider building logic into your workload to handle errors\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIn a distributed system, ensuring that your application can recover from errors is critical. You can test your applications to prevent errors and failure, but you need to prepare for a wide range of issues. Testing doesn\u0026#39;t always catch everything, so you should understand how to handle errors and prevent potential failure. Many things in a distributed system, such as underlying cloud infrastructure and third-party runtime dependencies, are outside your span of control and your means to test. You can be sure something will fail eventually, so you need to be prepared. Key points: - Implement retry logic to handle transient application failures and transient failures with internal or external dependencies. - Uncover issues or failures in your application\u0026#39;s retry logic. - Configure request timeouts to manage intercomponent calls. - Configure and test health probes for your load balancers and traffic managers. - Segregate read operations from update operations across application data stores. Potential Benefits:\rEnhances recovery and error management\rLearn More:\rError handling for resilient applications in Azure\rPerform disaster recovery tests regularly\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDisaster recovery is the process of restoring application functionality after a catastrophic loss. In cloud environments, we acknowledge up front that failures happen. Instead of trying to prevent failures altogether, the goal is to minimize the effects of a single failing component. Testing is one way to minimize these effects. You should automate testing of your applications where possible, but you also need to be prepared for when they fail. When a failure happens, having backup and recovery strategies becomes important. Your tolerance for reduced functionality during a disaster is a business decision that varies from one application to the next. It might be acceptable for some applications to be temporarily unavailable, or partially available with reduced functionality or delayed processing. For other applications, any reduced functionality is unacceptable. Key points: - Create and test a disaster recovery plan regularly using key failure scenarios. - Design a disaster recovery strategy to run most applications with reduced functionality. - Design a backup strategy that\u0026#39;s tailored for the business requirements and circumstances of the application. - Automate failover and failback steps and processes. - Test and validate the failover and failback approach successfully at least once. Potential Benefits:\rEnhances recovery speed and reliability\rLearn More:\rBackup and disaster recovery for Azure applications\rUse chaos engineering to test Azure applications\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIdeally, you should apply chaos principles continuously. There\u0026#39;s constant change in the environments in which software and hardware run, so monitoring the changes is key. By constantly applying stress or faults on components, you can help expose issues early, before small problems are compounded by many other factors. Apply chaos engineering principles when you: - Deploy new code. - Add dependencies. - Observe changes in usage patterns. - Mitigate problems. Potential Benefits:\rEarly issue detection, prevents compounding\rLearn More:\rUse chaos engineering to test Azure applications\rTest application fault resiliency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHigh availability is a fundamental part of the SQL Database platform that works transparently for your database application. However, we recognize that you may want to test how the automatic failover operations initiated during planned or unplanned events would impact an application before you deploy it to production. You can manually trigger a failover by calling a special API to restart a database, or an elastic pool. In the case of a zone-redundant serverless or provisioned General Purpose database or elastic pool, the API call would result in redirecting client connections to the new primary in an Availability Zone different from the Availability Zone of the old primary. So in addition to testing how failover impacts existing database sessions, you can also verify if it changes the end-to-end performance due to changes in network latency. Because the restart operation is intrusive and a large number of them could stress the platform, only one failover call is allowed every 15 minutes for each database or elastic pool. Potential Benefits:\rEnhances fault resilience testing\rLearn More:\rTest application fault resiliency\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “3 - Test (Workload Testing)” and associated resources and their settings.\nBefore deploying the system, comprehensive tests are conducted to validate the design and implementation. This stage is crucial for identifying any weaknesses that could compromise reliability.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rTest your applications for availability and resiliency\rHigh\rHigh Availability\rVerified\rConsider building logic into your workload to handle errors\rHigh\rHigh Availability\rVerified\rPerform disaster recovery tests regularly\rHigh\rDisaster Recovery\rVerified\rUse chaos engineering to test Azure applications\rMedium\rHigh Availability\rVerified\rTest application fault resiliency\rHigh\rHigh Availability\rVerified\rDetails\rTest your applications for availability and resiliency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApplications should be tested to ensure availability and resiliency."},{"id":11,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-arg-queries/","title":"Create ARG Queries","parent":"Creating Content","content":"This section provides guidance on how to create new Azure Resource Graph (ARG) queries. The following requirements should be followed:\nRequirements for ARG Queries Requirements for ARG Query Files Requirements for Pull Requests Containing ARG Queries Requirements for ARG Queries\rAll ARG queries should have two comments at the top of the query, one comment stating Azure Resource Graph Query and another comment providing a description of the query results returned. For example:\n// Azure Resource Graph Query\r// Provides a list of Azure Container Registry resources that do not have soft delete enabled If the ARG query is under development, the query should have a single line stating: // under-development\nIf a recommendation query cannot be returned due to limitations with the data provided within ARG, the query should have a single line stating: // cannot-be-validated-with-arg\nQueries should only return resources that do not adhere to the APRL recommendation. For example, if the recommendation is to enable soft delete for Azure Container Registries, the associated query should only return Azure Container Registry resources that do not have soft delete enabled.\nIf a ARG query folder has a file with a file type suffixed with .fix, this means that the current query does not work as anticipated and to consider using this as a starting point for fixing the query. Once you have validated that the query is working as anticipated, please remove the file with the .fix suffix.\nARG query columns name returned should only include the following:\nThe column names should be in the order they are listed and match exactly.\rColumn Name Required Information Returned (Example) Description recommendationId Yes 4f63619f-5001-439c-bacb-8de891287727 The aprlGuid associated to the APRL recommendation. name Yes test-aks The resource name of the Azure resource that does not adhere to the APRL recommendation. id Yes /subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test-resource-group/providers/Microsoft.ContainerService/managedClusters/test-aks The resource ID of the Azure resource that does not adhere to the APRL recommendation. tags No {\u0026ldquo;Environment\u0026rdquo;:\u0026ldquo;Test\u0026rdquo;,\u0026ldquo;Department\u0026rdquo;:\u0026ldquo;IT\u0026rdquo;} Any relevant tags associated to the resource that does not adhere to the APRL recommendation. param1 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param2 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param3 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param4 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param5 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. If you need support with validating a query, please reach out to the APRL team via the APRL GitHub General Question/Feedback Form\rRequirements for ARG Query Files\rAll query files should be named to match the aprlGuid for the respective APRL recommendation. For instance, if the aprlGuid for a recommendation is 4f63619f-5001-439c-bacb-8de891287727, then the associated query file should be named 4f63619f-5001-439c-bacb-8de891287727.kql.\nAll query files should be placed in the relevant kql folder within the relevant directory. For example, if the recommendation is for Azure Container Registries, the query file should be placed in the azure-resources\\ContainerRegistry\\registries\\kql directory.\nRequirements for Pull Requests Containing ARG Queries\rAll pull requests that modify and/or create ARG queries should contain a screenshot of the query results returned from the Azure Resource Graph Explorer. The screenshot should be taken from the Azure Resource Graph Explorer and should include a resource that is not adhering to the APRL recommendation. This is to ensure that the query is returning the expected results and to validate that the columns are populated correctly.\n","description":"This section provides guidance on how to create new Azure Resource Graph (ARG) queries. The following requirements should be followed:\nRequirements for ARG Queries Requirements for ARG Query Files Requirements for Pull Requests Containing ARG Queries Requirements for ARG Queries\rAll ARG queries should have two comments at the top of the query, one comment stating Azure Resource Graph Query and another comment providing a description of the query results returned."},{"id":12,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/deploy/","title":"Deploy","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “4 - Deploy (Automation and Deployment)” and associated resources and their settings.\nAt this stage, the system is launched into a production environment. Proper deployment strategies, like blue-green or canary deployments, are used to minimize risks associated with releasing new versions.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rAvoid manual configuration to enforce consistency with Infrastructure as code\rMedium\rOther Best Practices\rVerified\rValidated all changes in development environments before applying them to production\rMedium\rOther Best Practices\rVerified\rEnsure the deployment method used is aligned to reliability strategy\rMedium\rOther Best Practices\rVerified\rImplement a full suite of tests during deployment\rMedium\rOther Best Practices\rVerified\rEnsure that failure scenarios are tested regularly\rMedium\rDisaster Recovery\rVerified\rRegularly test regional failovers\rMedium\rDisaster Recovery\rVerified\rEnsure failover automation is available during outages\rMedium\rDisaster Recovery\rVerified\rDetails\rAvoid manual configuration to enforce consistency with Infrastructure as code\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rInfrastructure as code (IaC) uses DevOps methodology and versioning with a descriptive model to define and deploy infrastructure, such as networks, virtual machines, load balancers, and connection topologies. Just as the same source code always generates the same binary, an IaC model generates the same environment every time it deploys. IaC is a key DevOps practice and a component of continuous delivery. With IaC, DevOps teams can work together with a unified set of practices and tools to deliver applications and their supporting infrastructure rapidly and reliably at scale. Key Points: - Avoid manual configuration to enforce consistency - Deliver stable test environments rapidly at scale - Use declarative definition files Potential Benefits:\rEnsures consistent, scalable deployments\rLearn More:\rAvoid manual configuration to enforce consistency\rValidated all changes in development environments before applying them to production\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rContinuously delivering value has become a mandatory requirement for organizations. To deliver value to your end users, you must release continually and without errors. Continuous delivery (CD) is the process of automating build, test, configuration, and deployment from a build to a production environment. A release pipeline can create multiple testing or staging environments to automate infrastructure creation and deploy new builds. Successive environments support progressively longer-running integration, load, and user acceptance testing activities. Potential Benefits:\rEnsures error-free releases\rLearn More:\rSafe deployment practices\rEnsure the deployment method used is aligned to reliability strategy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAnother aspect of reliability is the deployment method used to update or roll back your workload. You should ensure that the deployment method used is aligned to your reliability strategy and supports the availability and performance requirements of your workload. For example, you may choose to use blue-green deployments, canary deployments, or rolling deployments depending on the level of risk and impact you want to mitigate. You should also consider the trade-offs between speed and safety when deploying changes, and use appropriate testing and validation methods to ensure the quality of your code and configuration. Additionally, you should have a clear and documented process for handling deployment failures and communicate any changes or issues to your stakeholders and customers. Potential Benefits:\rAlign deployment strategy to reliability requirements\rLearn More:\rDeployment and testing for mission-critical workloads on Azure\rSafe deployment practices\rImplement a full suite of tests during deployment\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTesting your cloud solution at different stages of deployment can help you improve the quality and reliability of your solution and reduce the risk of costly and damaging incidents in production. By adopting a \u0026#34;shift left\u0026#34; approach, you can perform unit testing, smoke testing, load testing, and chaos testing to verify the functionality, integration, performance, scalability, resilience, and fault tolerance of your solution. These tests can help you identify and fix any issues or bugs before they affect your customers or users. Potential Benefits:\rCode has been extensively tested during build process\rLearn More:\rDeployment and testing for mission-critical workloads on Azure\rEnsure that failure scenarios are tested regularly\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFailure scenarios are situations where your cloud solution may not perform as expected or meet your service level objectives (SLOs) due to internal or external factors. For example, failure scenarios can include hardware failures, network outages, security breaches, configuration errors, unexpected spikes in demand, or dependencies on third-party services. Testing these scenarios regularly can help you assess the impact of failures on your solution and prepare contingency plans to mitigate them. You can use tools and techniques such as fault injection, disaster recovery drills, game days, and chaos engineering to simulate and test failure scenarios in a controlled environment. Potential Benefits:\rGain confidence in handling failures\rLearn More:\rDeployment and testing for mission-critical workloads on Azure\rRegularly test regional failovers\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA regional failover is a process of switching to a secondary region in case of a major disruption or outage in the primary region of your cloud solution. Regional failovers can help you maintain availability and performance of your solution across different geographic areas. However, regional failovers are not trivial and require careful planning and testing. You should regularly test regional failovers to verify that your backup region can handle the load and functionality of your solution, that your data is consistent and secure across regions, and that your failover and failback procedures are working as expected. Testing regional failovers can also help you identify and resolve potential issues or gaps in your failover strategy before they affect your users or customers. Potential Benefits:\rEnsure app resilience with regional failover testing\rLearn More:\rDeployment and testing for mission-critical workloads on Azure\rEnsure failover automation is available during outages\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rOne of the key aspects of a reliable failover strategy is automation. Automation can reduce the human error, latency, and complexity involved in switching to a secondary region during an outage. However, automation itself can be vulnerable to failures or disruptions, especially if it depends on components or services that are affected by the outage. Therefore, you should ensure that your failover automation is available and resilient during outages, and that it can be triggered without manual intervention. You should also monitor and test your failover automation regularly to ensure that it performs as expected under different scenarios and conditions. As an example, if you are using regional failover as a mitigation for a potential regional outage, the automation used to orchestrate the failover to the backup region should not be hosted in the region that suffers the outage. Consider hosting your automation in a region that does not contain the production environment of your workload. Potential Benefits:\rGain confidence in your failover automation\rLearn More:\rDeployment and testing for mission-critical workloads on Azure\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “4 - Deploy (Automation and Deployment)” and associated resources and their settings.\nAt this stage, the system is launched into a production environment. Proper deployment strategies, like blue-green or canary deployments, are used to minimize risks associated with releasing new versions.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rAvoid manual configuration to enforce consistency with Infrastructure as code\rMedium\rOther Best Practices\rVerified\rValidated all changes in development environments before applying them to production\rMedium\rOther Best Practices\rVerified\rEnsure the deployment method used is aligned to reliability strategy\rMedium\rOther Best Practices\rVerified\rImplement a full suite of tests during deployment\rMedium\rOther Best Practices\rVerified\rEnsure that failure scenarios are tested regularly\rMedium\rDisaster Recovery\rVerified\rRegularly test regional failovers\rMedium\rDisaster Recovery\rVerified\rEnsure failover automation is available during outages\rMedium\rDisaster Recovery\rVerified\rDetails\rAvoid manual configuration to enforce consistency with Infrastructure as code\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rInfrastructure as code (IaC) uses DevOps methodology and versioning with a descriptive model to define and deploy infrastructure, such as networks, virtual machines, load balancers, and connection topologies."},{"id":13,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/monitor/","title":"Monitor","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “5 - Monitor (Observability and Monitoring)” and associated resources and their settings.\nOngoing monitoring is essential for maintaining system reliability. Key performance indicators (KPIs) are constantly observed to ensure the system is meeting its defined objectives. Services like Azure Monitor, Network Watcher, and Service Health can be invaluable here.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rMake sure your application\u0026#39;s health is being monitored\rMedium\rMonitoring and Alerting\rVerified\rDefine a health model based on performance, availability, and recovery targets\rLow\rMonitoring and Alerting\rVerified\rCreate Dashboards and Alerts for Azure Platform resources\rLow\rMonitoring and Alerting\rVerified\rUtilize built-in Resilience policies\rMedium\rGovernance\rVerified\rDefine metrics to track reliability in relation to business requirements\rLow\rMonitoring and Alerting\rPreview\rDetails\rMake sure your application\u0026#39;s health is being monitored\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring and diagnostics are crucial for availability and resiliency. If something fails, you need to know that it failed, when it failed, and why. Monitoring isn\u0026#39;t the same as failure detection. For example, your application might detect a transient error and retry, avoiding downtime. It should also log the retry operation so that you can monitor the error rate to get an overall picture of application health. Key points: - Define alerts that are actionable and effectively prioritized. - Create alerts that poll for services nearing their limits and quotas. - Use application instrumentation to detect and resolve performance anomalies. - Track the progress of long-running processes. - Troubleshoot issues to gain an overall view of application health. - Document how to analyze, diagnose, and respond to signals being monitored Potential Benefits:\rEnhanced availability and issue tracking\rLearn More:\rMonitoring application health for reliability\rDefine a health model based on performance, availability, and recovery targets\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe health model should be able to surface the health of critical system flows or key subsystems to ensure that appropriate operational prioritization is applied. For example, the health model should be able to represent the current state of the user sign-in transaction flow. The health model shouldn\u0026#39;t treat all failures the same. The health model should distinguish between transient and non transient faults. It should clearly distinguish between expected-transient but recoverable failures and a true disaster state. Key points: - Know how to tell if an application is healthy or unhealthy. - Understand the effects of logs in diagnostic data. - Ensure the consistent use of diagnostic settings across the application. - Use critical system flows in your health model. Potential Benefits:\rEnhanced system health insights\rLearn More:\rHealth modeling for reliability\rHealth Modeling for Workloads\rCreate Dashboards and Alerts for Azure Platform resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIn this stage, telemetry data is presented so that an operator can quickly notice problems or trends. Examples include Workbook, Dashboards or email alerts. With Azure Workbooks and/or dashboards, you can build a single pane of glass view of monitoring graphs originating from Application Insights, Log Analytics, Azure Monitor metrics and service health. With Azure Monitor alerts, you can create alerts on service health and resource health. Potential Benefits:\rQuick issue detection and response\rLearn More:\rAzure Workbooks templates\rUtilize built-in Resilience policies\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUtilize Azure\u0026#39;s built-in Resilience policies to audit and enforce resilient configurations of Azure services. Azure Policy helps to enforce organizational standards and to assess compliance at-scale. Potential Benefits:\rEnsures compliance and upscale resilience\rLearn More:\rBuilt-in Resilience policy definitions\rGet policy compliance data\rDefine metrics to track reliability in relation to business requirements\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rTo measure and improve the reliability of your cloud solution, you need to define metrics that reflect how well your solution meets your business requirements. For example, you can use availability, latency, throughput, error rate, and durability as metrics to quantify the performance and reliability of your solution. These metrics can help you track the progress of your reliability goals, such as SLAs and SLOs, and identify areas for improvement. You should also align your metrics with your customer expectations and feedback, and use them to prioritize your reliability efforts. Potential Benefits:\rPerformance insights align with business requirements\rLearn More:\rRecommendations for defining reliability targets\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “5 - Monitor (Observability and Monitoring)” and associated resources and their settings.\nOngoing monitoring is essential for maintaining system reliability. Key performance indicators (KPIs) are constantly observed to ensure the system is meeting its defined objectives. Services like Azure Monitor, Network Watcher, and Service Health can be invaluable here.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rMake sure your application\u0026#39;s health is being monitored\rMedium\rMonitoring and Alerting\rVerified\rDefine a health model based on performance, availability, and recovery targets\rLow\rMonitoring and Alerting\rVerified\rCreate Dashboards and Alerts for Azure Platform resources\rLow\rMonitoring and Alerting\rVerified\rUtilize built-in Resilience policies\rMedium\rGovernance\rVerified\rDefine metrics to track reliability in relation to business requirements\rLow\rMonitoring and Alerting\rPreview\rDetails\rMake sure your application\u0026#39;s health is being monitored\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring and diagnostics are crucial for availability and resiliency."},{"id":14,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/","title":"Well-Architected Framework","parent":"Azure Proactive Resiliency Library v2","content":"\rDevelop\rDefine\rDesign\rTest\rDeploy\rMonitor\rRespond\r","description":"\rDevelop\rDefine\rDesign\rTest\rDeploy\rMonitor\rRespond\r"},{"id":15,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/","title":"Tools","parent":"Azure Proactive Resiliency Library v2","content":"This section lists of all of the information pertaining to the APRL tooling/scripts. The guidance is broken down into the following sections:\nOverview and Usage of APRL Scripts ","description":"This section lists of all of the information pertaining to the APRL tooling/scripts. The guidance is broken down into the following sections:\nOverview and Usage of APRL Scripts "},{"id":16,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/","title":"Contributor Guide","parent":"Azure Proactive Resiliency Library v2","content":"This section lists all contribution guidance available. The guidance is broken down into the following sections:\nGetting Started\rCreating Content\rCreate Recommendations\rAdd Dependent Azure Resources for Specialized Workloads\rCreate Content from Templates\rCreate ARG Queries\rIf you cannot find guidance for what you need, please let us know via GitHub Issues 👍\r","description":"This section lists all contribution guidance available. The guidance is broken down into the following sections:\nGetting Started\rCreating Content\rCreate Recommendations\rAdd Dependent Azure Resources for Specialized Workloads\rCreate Content from Templates\rCreate ARG Queries\rIf you cannot find guidance for what you need, please let us know via GitHub Issues 👍\r"},{"id":17,"href":"/Azure-Proactive-Resiliency-Library-v2/glossary/","title":"Glossary","parent":"Azure Proactive Resiliency Library v2","content":"This page holds a table of all the terms, abbreviations, and acronyms that are used across this site.\nTerm/Abbreviation/Acronym Definition AAC Azure Architecture Center WAF Well-Architected Framework CAF Cloud Adoption Framework ARG Azure Resource Graph ","description":"This page holds a table of all the terms, abbreviations, and acronyms that are used across this site.\nTerm/Abbreviation/Acronym Definition AAC Azure Architecture Center WAF Well-Architected Framework CAF Cloud Adoption Framework ARG Azure Resource Graph "},{"id":18,"href":"/Azure-Proactive-Resiliency-Library-v2/faq/","title":"FAQ","parent":"Azure Proactive Resiliency Library v2","content":"This section lists frequently asked questions about the Azure Proactive Resiliency Library (APRL) and its content. See the following sections for answers to common questions:\nFAQ 1: Local Website Inconsistencies FAQ 1: Local Website Inconsistencies\rIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository. Got an unanswered question? Create a GitHub Issue so we can get it answered and added here for everyone\u0026rsquo;s benefit 👍\r","description":"This section lists frequently asked questions about the Azure Proactive Resiliency Library (APRL) and its content. See the following sections for answers to common questions:\nFAQ 1: Local Website Inconsistencies FAQ 1: Local Website Inconsistencies\rIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository."},{"id":19,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/respond/","title":"Respond","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “6 - Respond (Responding to Failures)” and associated resources and their settings.\nThis respond stage involves having plans and procedures in place to react to incidents affecting reliability. This includes automated failovers, backup restoration, and escalation protocols for manual intervention.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rImplement proactive Incident Response\rHigh\rDisaster Recovery\rVerified\rDetails\rImplement proactive Incident Response\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPrevention of all problems is a laudable, but impossible goal. Things will go wrong, so we need a plan to limit the impact on our end users and return operations to normal as quickly as possible. The key is to respond with urgency, rather than react. A reaction tends to be more impulsive and based in the present moment, without consideration of long-term effects. A response is well-thought-out, organized, and information based. Your incident response approach determines your effectiveness at: - Understanding what\u0026#39;s going on (diagnosing the problem) - Triaging (determining the urgency) and prioritizing the problem - Engaging the right resources to mitigate the issue(s) - Communicating with stakeholders about the problem. - After the problem has been remediated, you can then learn from the incident through a post-incident review process. That\u0026#39;s an important subject which has a whole separate module worth of discussion. Potential Benefits:\rQuicker recovery, less impact\rLearn More:\rImportance of incident response\rIncident tracking\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage “6 - Respond (Responding to Failures)” and associated resources and their settings.\nThis respond stage involves having plans and procedures in place to react to incidents affecting reliability. This includes automated failovers, backup restoration, and escalation protocols for manual intervention.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rImplement proactive Incident Response\rHigh\rDisaster Recovery\rVerified\rDetails\rImplement proactive Incident Response\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPrevention of all problems is a laudable, but impossible goal."},{"id":20,"href":"/Azure-Proactive-Resiliency-Library-v2/privacy/","title":"Privacy","parent":"Azure Proactive Resiliency Library v2","content":" We partner with Microsoft Clarity to capture how you use and interact with our website through behavioral metrics, heatmaps, and session replay to improve the content and usage of the website. Website usage data is captured using first and third-party cookies and other tracking technologies and is used for site optimization. For more information about how Microsoft collects and uses your data, visit the Microsoft Privacy Statement.\n","description":"We partner with Microsoft Clarity to capture how you use and interact with our website through behavioral metrics, heatmaps, and session replay to improve the content and usage of the website. Website usage data is captured using first and third-party cookies and other tracking technologies and is used for site optimization. For more information about how Microsoft collects and uses your data, visit the Microsoft Privacy Statement."},{"id":21,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Bing/accounts/","title":"accounts","parent":"Bing","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":22,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/CognitiveServices/accounts/","title":"accounts","parent":"CognitiveServices","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":23,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeAnalytics/accounts/","title":"accounts","parent":"DataLakeAnalytics","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":24,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeStore/accounts/","title":"accounts","parent":"DataLakeStore","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":25,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataShare/accounts/","title":"accounts","parent":"DataShare","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":26,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maps/accounts/","title":"accounts","parent":"Maps","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":27,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/accounts/","title":"accounts","parent":"Monitor","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":28,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Purview/accounts/","title":"accounts","parent":"Purview","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":29,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Singularity/accounts/","title":"accounts","parent":"Singularity","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":30,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VideoIndexer/accounts/","title":"accounts","parent":"VideoIndexer","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":31,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/actionGroups/","title":"actionGroups","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":32,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/actionRules/","title":"actionRules","parent":"AlertsManagement","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":33,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/activityLogAlerts/","title":"activityLogAlerts","parent":"Insights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Resource Health Alerts\rLow\rMonitoring and Alerting\rNo\rVerified\rConfigure Service Health Alerts\rHigh\rMonitoring and Alerting\rYes\rVerified\rDetails\rConfigure Resource Health Alerts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status. Potential Benefits:\rStay informed on resource status\rLearn More:\rResource Health\rConfigure Resource Health alerts in the Azure portal\rAlerts Health\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure Service Health Alerts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rService health gives a personalized health view of Azure services and regions used, offering the best place for notifications on outages, planned maintenance, and health advisories by knowing the services used. Potential Benefits:\rProactive outage and maintenance alerts\rLearn More:\rWhat is Azure Service Health?\rConfigure alerts for service health events\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all subscriptions without Service Health alerts configured. resourcecontainers | where type == \u0026#39;microsoft.resources/subscriptions\u0026#39; | project subscriptionAlerts=tostring(id),name,tags | join kind=leftouter ( resources | where type == \u0026#39;microsoft.insights/activitylogalerts\u0026#39; and properties.condition contains \u0026#34;ServiceHealth\u0026#34; | extend subscriptions = properties.scopes | project subscriptions | mv-expand subscriptions | project subscriptionAlerts = tostring(subscriptions) ) on subscriptionAlerts | where isempty(subscriptionAlerts1) | project-away subscriptionAlerts1 | project recommendationID = \u0026#34;9729c89d-8118-41b4-a39b-e12468fa872b\u0026#34;,id=subscriptionAlerts,name,tags ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Resource Health Alerts\rLow\rMonitoring and Alerting\rNo\rVerified\rConfigure Service Health Alerts\rHigh\rMonitoring and Alerting\rYes\rVerified\rDetails\rConfigure Resource Health Alerts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status."},{"id":34,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/","title":"Advisor","parent":"Azure Resources","content":"","description":""},{"id":35,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/alertRules/","title":"alertRules","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":36,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/alerts/","title":"alerts","parent":"AlertsManagement","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":37,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/alertsManagement/","title":"alertsManagement","parent":"Monitor","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":38,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/","title":"AlertsManagement","parent":"Azure Resources","content":"","description":""},{"id":39,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AnalysisServices/","title":"AnalysisServices","parent":"Azure Resources","content":"","description":""},{"id":40,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ApiManagement/","title":"ApiManagement","parent":"Azure Resources","content":"","description":""},{"id":41,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/","title":"App","parent":"Azure Resources","content":"","description":""},{"id":42,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppConfiguration/","title":"AppConfiguration","parent":"Azure Resources","content":"","description":""},{"id":43,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationGateways/","title":"applicationGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure autoscale has been enabled\rHigh\rScalability\rYes\rVerified\rSecure all incoming connections with SSL\rHigh\rSecurity\rYes\rVerified\rEnable Web Application Firewall policies\rHigh\rSecurity\rYes\rVerified\rUse Application GW V2 instead of V1\rHigh\rScalability\rYes\rVerified\rMonitor and Log the configurations and traffic\rHigh\rMonitoring and Alerting\rNo\rVerified\rUse Health Probes to detect backend availability\rHigh\rMonitoring and Alerting\rYes\rVerified\rDeploy Application Gateway in a zone-redundant configuration\rHigh\rHigh Availability\rYes\rVerified\rPlan for backend maintenance by using connection draining\rMedium\rHigh Availability\rYes\rVerified\rEnsure Application Gateway Subnet is using a /24 subnet mask\rHigh\rOther Best Practices\rYes\rVerified\rDetails\rEnsure autoscale has been enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default. Enabling autoscale ensures the service is not reliant on manual intervention for scaling. Potential Benefits:\rEnhances uptime and enables autoscaling\rLearn More:\rApplication Gateway Autoscaling Zone-Redundant\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Application Gateways that do not have autoscale enabled or have a min capacity of 1 resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where isnull(properties.autoscaleConfiguration) or properties.autoscaleConfiguration.minCapacity \u0026lt;= 1 | project recommendationId = \u0026#34;823b0cff-05c0-2e4e-a1e7-9965e1cfa16f\u0026#34;, name, id, tags, param1 = \u0026#34;autoScaleConfiguration: isNull or MinCapacity \u0026lt;= 1\u0026#34; | order by id asc Secure all incoming connections with SSL\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSecure all incoming connections using HTTPS for production services with end-to-end SSL/TLS or SSL/TLS termination at the Application Gateway to protect against attacks and ensure data remains private and encrypted between the web server and browsers. Potential Benefits:\rEnhanced security and privacy\rLearn More:\rApplication Gateway Security\rApplication Gateway SSL Overview\rApplication Gateway SSL Policy Overview\rApplication Gateway KeyVault Certs\rApplication Gateway SSL Cert Management\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // You can use the following Azure Resource Graph query to check if an HTTP rule is using an SSL certificate or is using Azure Key Vault to store the certificates resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | mv-expand frontendPorts = properties.frontendPorts | mv-expand httpListeners = properties.httpListeners | where isnull(parse_json(httpListeners.properties.sslCertificate)) | project recommendationId=\u0026#34;233a7008-71e9-e745-923e-1a1c7a0b92f3\u0026#34;, name, id, tags, param1=strcat(\u0026#34;frontendPort: \u0026#34;, frontendPorts.properties.port), param2=\u0026#34;tls: false\u0026#34; Enable Web Application Firewall policies\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Application Gateway with Web Application Firewall (WAF) in an application virtual network to safeguard inbound HTTP/S internet traffic. WAF offers centralized defense against potential exploits through OWASP core rule sets-based rules. Potential Benefits:\rEnhanced security for HTTP/S traffic\rLearn More:\rWell-Architected Framework Application Gateway Overview\rApplication Gateway - Web Application Firewall\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Application Gateways that do not have WAF enabled Resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where properties.firewallpolicy != \u0026#34;\u0026#34; | project recommendationId = \u0026#34;8d9223c4-730d-ca47-af88-a9a024c37270\u0026#34;, name, id, tags, param1 = \u0026#34;webApplicationFirewallConfiguration: isNull\u0026#34; | order by id asc Use Application GW V2 instead of V1\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Application Gateway v2 for built-in features like autoscaling, static VIPs, Azure KeyVault integration for better traffic management and performance, unless v1 is necessary. Potential Benefits:\rBetter performance, autoscaling, more features\rLearn More:\rApplication Gateway Overview V2\rApplication Gateway Feature Comparison Between V1 and V2\rApplication Gateway V1 Retirement\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Get all Application Gateways, which are using the deprecated V1 SKU resources | where type =~ \u0026#39;microsoft.network/applicationgateways\u0026#39; | extend tier = properties.sku.tier | where tier == \u0026#39;Standard\u0026#39; or tier == \u0026#39;WAF\u0026#39; | project recommendationId = \u0026#34;7893f0b3-8622-1d47-beed-4b50a19f7895\u0026#34;, name, id, tags Monitor and Log the configurations and traffic\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable logging in storage accounts, Log Analytics, and monitoring services for auditing and insights. If using NSGs, enable NSG flow logs to be stored, providing in-depth traffic analysis into Azure Cloud. Potential Benefits:\rEnhanced traffic insight and audit\rLearn More:\rApplication Gateway Metrics\rApplication Gateway Diagnostics\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Health Probes to detect backend availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUsing custom health probes enhances understanding of backend availability and facilitates monitoring of backend services for any impact. Potential Benefits:\rEnsures backend uptime monitoring.\rLearn More:\rApplication Gateway Probe Overview\rWell-Architected Framework Application Gateway Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Application Gateways are not using health probes to monitor the availability of the backend systems resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where array_length(properties.probes) == 0 | project recommendationId=\u0026#34;847a8d88-21c4-bc48-a94e-562206edd767\u0026#34;, name, id, tags, param1=\u0026#34;customHealthProbeUsed: false\u0026#34; Deploy Application Gateway in a zone-redundant configuration\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDeploying Application Gateway in a zone-aware configuration ensures continued customer access to services even if a specific zone goes down, as services in other zones remain available. Potential Benefits:\rEnhanced uptime and customer access\rLearn More:\rWell-Architected Framework Application Gateway Reliability\rApplication Gateway V2 Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list Application Gateways that are not configured to use at least 2 Availability Zones resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend zoneValue = iff((isnull(zones)), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;c9c00f2a-3888-714b-a72b-b4c9e8fcffb2\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Zones value: \u0026#34;, zoneValue ) Plan for backend maintenance by using connection draining\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUsing connection draining for backend maintenance ensures graceful removal of backend pool members during updates or health issues. It\u0026#39;s enabled via Backend Setting and applies to all members during rule creation. Potential Benefits:\rSmooth updates, no dropped users\rLearn More:\rApplication Gateway Connection Draining\rApplication Gateway Connection Draining HTTP Settings\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will check if connection draining is enabled resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | mv-expand backendHttpSettings = properties.backendHttpSettingsCollection | extend connectionDrainingEnabled = backendHttpSettings.properties.connectionDraining.enabled | where connectionDrainingEnabled != true | extend backendPoolName = backendHttpSettings.name | project recommendationId = \u0026#34;10f02bc6-e2e7-004d-a2c2-f9bf9f16b915\u0026#34;, name, id, tags, param1 = \u0026#34;connectionDraining: Disabled\u0026#34;, param2 = strcat(\u0026#34;backendSettingsName: \u0026#34;, backendPoolName) Ensure Application Gateway Subnet is using a /24 subnet mask\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApplication Gateway v2 (Standard_v2 or WAF_v2 SKU) can support up to 125 instances. A /24 subnet isn\u0026#39;t mandatory for deployment but is advised to provide enough space for autoscaling and maintenance upgrades. Potential Benefits:\rAllows autoscaling and maintenance\rLearn More:\rAzure Application Gateway infrastructure configuration | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will validate the subnet id for an appGW ends with a /24 resources | where type =~ \u0026#39;Microsoft.Network/applicationGateways\u0026#39; | extend subnetid = tostring(properties.gatewayIPConfigurations[0].properties.subnet.id) | join kind=leftouter(resources | where type == \u0026#34;microsoft.network/virtualnetworks\u0026#34; | mv-expand properties.subnets | extend subnetid = tostring(properties_subnets.id) | extend addressprefix = tostring(properties_subnets.properties.addressPrefix) | project subnetid, addressprefix) on subnetid | where addressprefix !endswith \u0026#39;/24\u0026#39; | project recommendationID = \u0026#34;8364fd0a-7c0e-e240-9d95-4bf965aec243\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;AppGW subnet prefix: \u0026#39;, addressprefix) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure autoscale has been enabled\rHigh\rScalability\rYes\rVerified\rSecure all incoming connections with SSL\rHigh\rSecurity\rYes\rVerified\rEnable Web Application Firewall policies\rHigh\rSecurity\rYes\rVerified\rUse Application GW V2 instead of V1\rHigh\rScalability\rYes\rVerified\rMonitor and Log the configurations and traffic\rHigh\rMonitoring and Alerting\rNo\rVerified\rUse Health Probes to detect backend availability\rHigh\rMonitoring and Alerting\rYes\rVerified\rDeploy Application Gateway in a zone-redundant configuration\rHigh\rHigh Availability\rYes\rVerified\rPlan for backend maintenance by using connection draining\rMedium\rHigh Availability\rYes\rVerified\rEnsure Application Gateway Subnet is using a /24 subnet mask\rHigh\rOther Best Practices\rYes\rVerified\rDetails\rEnsure autoscale has been enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default."},{"id":44,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationGatewayWebApplicationFirewallPolicies/","title":"applicationGatewayWebApplicationFirewallPolicies","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":45,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/applications/","title":"applications","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":46,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationSecurityGroups/","title":"applicationSecurityGroups","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":47,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppPlatform/","title":"AppPlatform","parent":"Azure Resources","content":"","description":""},{"id":48,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/","title":"Authorization","parent":"Azure Resources","content":"","description":""},{"id":49,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Automation/","title":"Automation","parent":"Azure Resources","content":"","description":""},{"id":50,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Automation/automationAccounts/","title":"automationAccounts","parent":"Automation","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rSet up disaster recovery of Automation accounts and its dependent resources\rHigh\rHigh Availability\rNo\rPreview\rDetails\rSet up disaster recovery of Automation accounts and its dependent resources\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rSet up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures. A replica Automation account should be ready in a secondary region for failover. Potential Benefits:\rEnsures continuity during outages\rLearn More:\rDisaster recovery for Automation accounts\rDisaster recovery scenarios for cloud and hybrid jobs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rSet up disaster recovery of Automation accounts and its dependent resources\rHigh\rHigh Availability\rNo\rPreview\rDetails\rSet up disaster recovery of Automation accounts and its dependent resources\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rSet up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures. A replica Automation account should be ready in a secondary region for failover."},{"id":51,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/availabilitySets/","title":"availabilitySets","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":52,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AVS/","title":"AVS","parent":"Azure Resources","content":"","description":""},{"id":53,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/hpc/","title":"Azure High Performance Computing","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rHigh\rHigh Availability\rNo\rPreview\rAutomatically grow and shrink HPC Pack cluster resources\rMedium\rScalability\rNo\rPreview\rUse multiple head nodes for HPC Pack\rMedium\rHigh Availability\rNo\rPreview\rUse HPC Pack Azure AD Integration or other highly available AD configuration\rHigh\rHigh Availability\rNo\rPreview\rDetails\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCurrently in all HPC Pack ARM templates we create the cluster share on one of the head node which is not highly available. Potential Benefits:\rEnhances job metadata availability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatically grow and shrink HPC Pack cluster resources\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rBy deploying Azure \u0026#34;burst\u0026#34; nodes (both Windows and Linux) in your HPC Pack cluster or creating your HPC Pack cluster in Azure, you can automatically grow or shrink the cluster\u0026#39;s resources such as nodes or cores according to the workload on the cluster. Potential Benefits:\rEfficient, uninterrupted execution\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use multiple head nodes for HPC Pack\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEstablish a cluster with a minimum of two head nodes. In the event of a head node failure, the active HPC Service will be automatically transferred from the affected head node to another functioning one. Potential Benefits:\rEnhanced reliability for HPC\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use HPC Pack Azure AD Integration or other highly available AD configuration\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rWhen HPC failed to connect to the Domain controller, admin and user will not be able to connect to the HPC Service thus not able to manage and submit jobs to the cluster. Potential Benefits:\rEnhanced reliability and job management\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rHigh\rHigh Availability\rNo\rPreview\rAutomatically grow and shrink HPC Pack cluster resources\rMedium\rScalability\rNo\rPreview\rUse multiple head nodes for HPC Pack\rMedium\rHigh Availability\rNo\rPreview\rUse HPC Pack Azure AD Integration or other highly available AD configuration\rHigh\rHigh Availability\rNo\rPreview\rDetails\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCurrently in all HPC Pack ARM templates we create the cluster share on one of the head node which is not highly available."},{"id":54,"href":"/Azure-Proactive-Resiliency-Library-v2/","title":"Azure Proactive Resiliency Library v2","parent":"","content":"","description":""},{"id":55,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/avd/","title":"Azure Virtual Desktop","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Create a validation host pool for testing of planned updates DesktopVirtualization hostPools Configure host pool scheduled agent updates DesktopVirtualization hostPools Ensure a unique OU is used when deploying host pools with domain joined session hosts DesktopVirtualization hostPools Use Azure Site Recovery or backups to protect VMs supporting personal desktops DesktopVirtualization hostPools Scaling plans should be created per region and not scaled across regions DesktopVirtualization scalingPlans Replicate your Image Templates to a secondary region Compute galleries A minimum of three replicas should be kept for production image versions Compute galleries Zone redundant storage should be used for image versions Compute galleries Deploy VMs across Availability Zones Compute virtualMachines Backup VMs with Azure Backup service Compute virtualMachines Production VMs should be using SSD disks Compute virtualMachines Configure diagnostic settings for all Azure Virtual Machines Compute virtualMachines Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes Network expressRouteCircuits Ensure ExpressRoute\u0026rsquo;s physical links connect to distinct network edge devices Network expressRouteCircuits Use Zone-redundant ExpressRoute gateway SKUs Network virtualNetworkGateways Configure NSG Flow Logs Network networkSecurityGroups Ensure that storage accounts are zone or region redundant Storage storageAccounts Enable Azure Private Link Service for Key vault Keyvault vaults Configure Service Health Alerts Insights activityLogAlerts Dependent Well-Architected Framework - Reliability Recommendations\rRecommendation Reliability Stage Ensure that all fault-points and fault-modes are understood and operationalized Design Design a BCDR strategy that will help to meet the business requirements Design General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor service health and resource health for AVD\rHigh\rGovernance\rYes\rVerified\rConfigure AVD Insights workbook\rHigh\rMonitoring and Alerting\rNo\rVerified\rEnsure separate log analytics workspaces for Prod and DR\rLow\rDisaster Recovery\rNo\rVerified\rOrganize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rLow\rGovernance\rNo\rVerified\rMonitor and plan capacity for AVD resources\rLow\rDisaster Recovery\rNo\rVerified\rEnsure DNS regions are replicated to avoid single point of failure\rHigh\rHigh Availability\rNo\rVerified\rImplement a multi-region BCDR Plan\rMedium\rDisaster Recovery\rNo\rVerified\rCreate only one FSLogix file share per Storage Account\rMedium\rScalability\rNo\rVerified\rCreate a dedicated FSLogix file share and setup per host pool\rMedium\rScalability\rNo\rVerified\rEnable Azure backup for FSLogix storage account file shares\rMedium\rHigh Availability\rNo\rVerified\rImplement RDP shortpath for public or managed networks\rMedium\rOther Best Practices\rNo\rVerified\rEnsure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rMedium\rGovernance\rNo\rVerified\rEnsure secondary Entra ID connect synchronization server\rLow\rSecurity\rNo\rVerified\rEnsure virtual networks have route tables/route server configured for all regions\rMedium\rHigh Availability\rNo\rVerified\rEnsure virtual networks isolation with separate IP space and NSGs for Prod and DR\rMedium\rBusiness Continuity\rNo\rVerified\rEnsure route tables accommodate failover\rMedium\rDisaster Recovery\rNo\rVerified\rConfigure static routes for session hosts to directly access the AVD control plane subnet\rMedium\rOther Best Practices\rNo\rVerified\rCreate updated image version and replace session hosts rather than updating host directly\rLow\rGovernance\rNo\rVerified\rEnsure the standard FSLogix configuration is deployed\rMedium\rGovernance\rNo\rVerified\rEnsure user permissions are set correctly on FSLogix SMB shares\rMedium\rSecurity\rNo\rVerified\rConfigure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rMedium\rMonitoring and Alerting\rNo\rVerified\rManually install FSLogix updates\rLow\rGovernance\rNo\rVerified\rTurn on continuous availability for ANF when using it for app attach\rMedium\rHigh Availability\rNo\rVerified\rUse dedicated file share for App attach and include the storage in the disaster recovery plan\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure resilient deployment of key vaults for AVD Host Pools\rHigh\rDisaster Recovery\rNo\rVerified\rDeploy two or more domain controllers on Azure VMs across availability zones in the AVD region\rHigh\rDisaster Recovery\rNo\rVerified\rDeploy domain controllers on Azure VMs across availability zones in the AVD region\rHigh\rHigh Availability\rNo\rVerified\rDetails\rMonitor service health and resource health for AVD\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSet up Service Health alerts so that you stay aware of service issues, planned maintenance, or other changes that might affect your Azure Virtual Desktop resources. Use Resource Health to monitor your VMs and storage solutions. Potential Benefits:\rEnhanced AVD error tracking and resolution\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query, will return rows if service health alerts haven\u0026#39;t been configured for AVD service resourcecontainers | where type == \u0026#39;microsoft.resources/subscriptions\u0026#39; | project subscriptionAlerts=tostring(id),name,tags | join kind=leftouter ( resources | where type == \u0026#39;microsoft.insights/activitylogalerts\u0026#39; and properties.condition contains \u0026#34;ServiceHealth\u0026#34; | extend subscriptions = properties.scopes | project subscriptions | mv-expand subscriptions | project subscriptionAlerts = tostring(subscriptions) ) on subscriptionAlerts | where isempty(subscriptionAlerts1) | project-away subscriptionAlerts1 | project recommendationID = \u0026#34;0bf1a2bb-7617-4ab2-a784-e7ea40c5f01b\u0026#34;,id=subscriptionAlerts,name,tags, param1 = \u0026#34;AVDServiceHealthAlertsConfigured: False\u0026#34; Configure AVD Insights workbook\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure AVD insights workbook template to monitor and troubleshoot AVD workloads across metrics, logs, events, and more. Both Production and DR workloads should be enabled with AVD Insights. Potential Benefits:\rEnhanced AVD monitoring and troubleshooting\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure separate log analytics workspaces for Prod and DR\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHaving separate Log Analytics ensures that your DR environment is fully operational for visibility of the metrics, performance, and other auditing tools your workload teams will rely on in the event of an incident. Potential Benefits:\rImproved DR visibility and operation\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Organize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFollow AVD Landing Zone best practices using multiple resource groups based on resource type and associated shared resources for AVD workloads. Potential Benefits:\rEnhanced organization and scalability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor and plan capacity for AVD resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitor and plan for subscription limits and API throttling limits. Keep track of resource usage within your subscription. Consider scaling across multiple subscriptions if further scaling is required. To handle a large number of users, consider scaling horizontally by creating multiple host pools. Potential Benefits:\rAvoids limits, ensures smooth scaling\rLearn More:\rCapacity Planning\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure DNS regions are replicated to avoid single point of failure\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rActive Directory Domain Services (AD DS) integrated DNS/other should target Secondary/Tertiary customer DNS across multi-region zones. If using custom DNS, ensure there are redundant DNS servers to avoid a single point of failure. Potential Benefits:\rImproves uptime \u0026amp; resilience\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement a multi-region BCDR Plan\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIt is recommended to adopt a multi-region deployment (active-active or active-passive) for AVD. Each region should contain at least identity, name resolution, AVD management resources, and session hosts in case of a primary region outage. Potential Benefits:\rEnhanced resilience and uptime\rLearn More:\rMulti-region BCDR\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create only one FSLogix file share per Storage Account\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo maximize capacity and performance scaling it is recommended to creat only one file share per Azure files storage account, with this approach the single file share will be able to grow to the maximum capacities of the storage account. Potential Benefits:\rEnhanced scaling and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a dedicated FSLogix file share and setup per host pool\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo maximize capacity and performance scaling of the file share service and avoid user\u0026#39;s profile contention, it is recommended to create one file share target and FSLogix setup per host pool. Potential Benefits:\rEnhanced performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Azure backup for FSLogix storage account file shares\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIt is recommended to enable backup on the FSLogix Storage Account. Ensuring the user profiles are resilient will allow user data and experience to be consistent through outages. Potential Benefits:\rEnsures data resilience and consistency\rLearn More:\rFSLogix\rBackup Storage Account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement RDP shortpath for public or managed networks\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rRDP Shortpath establishes a direct UDP-based connection between a client and the session host. By default, Remote Desktop Protocol (RDP) tries to establish connection using UDP and uses a TCP-based reverse connect transport as a fallback connection mechanism. UDP-based transport offers better connection reliability and more consistent latency. Potential Benefits:\rBetter reliability and consistent latency\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure that AVD session hosts can effectively communicate with the AVD control plane and that UDP ports are open if UDP is utilized. Validate the connectivity of VMs to the AVD Control Plane and confirm the accessibility of UDP TURN ports. Whitelist global URLs and ensure that UDP/TURN ports are open and accessible to facilitate smooth user connections. Potential Benefits:\rEnhanced performance \u0026amp; user experience\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure secondary Entra ID connect synchronization server\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHybrid - Entra ID Connect best to run in Azure but can be hosted on-prem. Secondary or more VMs should be setup in staging mode in event of failover. Set up secondary server in staging mode for Entra Connect for syncing to Entra in case of primary server outage. Potential Benefits:\rImproved failover reliability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure virtual networks have route tables/route server configured for all regions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor high availability connections back to on-premises data centers should consider backup paths across the regions that have been utilized. Ensure redundancy in routing by having a secondary route table in the secondary region. Potential Benefits:\rEnhanced availability \u0026amp; routing\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure virtual networks isolation with separate IP space and NSGs for Prod and DR\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rNSG and ASG per AVD persona and IP space per Prod/DR regions. It\u0026#39;s important your organization plans for IP addressing in Azure. Planning ensures the IP address space doesn\u0026#39;t overlap across on-premises locations and Azure regions. Overlapping IP address spaces across on-premises and Azure regions create major contention challenges. Potential Benefits:\rEnhances security and prevents IP conflicts\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure route tables accommodate failover\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure Route Tables that force tunnel traffic to FW/NVA have failover considerations evaluated and won\u0026#39;t fail or trigger next-gen FW protections. AVD workload teams should collaborate with centralized teams that manage the shared infrastructure, like networking, to ensure that both Production and DR workloads have the appropriate route tables in place for failover of routing to perform as expected. Potential Benefits:\rEnhanced failover reliability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure static routes for session hosts to directly access the AVD control plane subnet\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure that Route Tables have static routes to allow session host traffic that targets AVD control plane to go outbound directly out of the subnet to the internet (next hop), this will avoid any delays of inspecting or adding additional hops in the communication of trusted traffic. Potential Benefits:\rEnhanced performance and Disaster Recovery\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create updated image version and replace session hosts rather than updating host directly\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEstablish a systematic process for handling image updates within your Azure Virtual Desktop environment. Instead of directly updating individual session hosts, create a new version of the updated image. This process involves creating and configuring a golden image with the necessary updates and configurations. Potential Benefits:\rEnsures consistency; minimizes drift\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the standard FSLogix configuration is deployed\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure all session hosts have the standard FSLogix configuration deployed. Regularly validate settings for consistency and alignment with best practices. Potential Benefits:\rOptimized session reliability and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure user permissions are set correctly on FSLogix SMB shares\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rVerify user permissions are correctly set on SMB shares so that users have appropriate access to only their own profile and not other user profiles, while administrators have full access at the root volume. Also ensure secondary storage path permissions are set in case of a DR event. Potential Benefits:\rEnhanced security \u0026amp; disaster recovery\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure diagnostic settings on FSLogix storage resources and regularly its metrics and FSLogix logs for errors. Events can be reviewed by looking locally inside the Session Host, but it is recommended to configure AVD insights workbook to consolidate this information to a Log Analytics workspace. Potential Benefits:\rEnhanced AVD error tracking and resolution\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Manually install FSLogix updates\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure a process is in place to regularly check for FSLogix agent upgrades and maintain FSLogix up to date. We recommend customers upgrade to the latest version of FSLogix as quickly as their deployment process can allow. FSLogix will provide hotfix releases which address current and potential bugs that impact customer deployments. Additionally, it is the first requirement when opening any support case. Potential Benefits:\rEnhanced reliability \u0026amp; support\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Turn on continuous availability for ANF when using it for app attach\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTurn on Continuous Availability if using Azure Netapp Files. Verify the number of users connecting to each file share to make sure the SMB path can handle the number of file connections. Currently, Azure Files supports up to 10k handles per root directory. Potential Benefits:\rEnhanced stability \u0026amp; user limit checks\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use dedicated file share for App attach and include the storage in the disaster recovery plan\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApp Attach packages should be on a separate share from profiles. And App Attach files should be backed up. Requirements can vary greatly depending on how many packaged applications are stored in an image, and you need to test your applications to understand your requirements. Your file share should be in the same Azure region as your session hosts. Potential Benefits:\rEnhances performance and scalability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure resilient deployment of key vaults for AVD Host Pools\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo ensure continuous availability and disaster recovery readiness, it is recommended to provision a secondary Key Vault in a secondary region. In the event of a primary region failure, this secondary Key Vault will ensure that critical secrets are accessible for use in deployments in the secondary region. Potential Benefits:\rEnsures DR readiness and access\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy two or more domain controllers on Azure VMs across availability zones in the AVD region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen using an AD DS identity solution with AVD, it is recommended to deploy two or more domain controllers on Azure virtual machines across availability zones. This improves the environment\u0026#39;s reliability by removing a dependency on an on-premises service and improves performance by creating a shorter path for user authentication. This recommendation doesn\u0026#39;t apply when using Microsoft Entra ID or Entra Domain Services joined session hosts. Potential Benefits:\rEnhanced identity resilience\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy domain controllers on Azure VMs across availability zones in the AVD region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen using custom DNS servers, it is recommended to deploy DNS servers on Azure virtual machines across availability zones. This improves the environment\u0026#39;s reliability by removing a dependency on an on-premises service and improves performance by creating a shorter path for name resolution. Potential Benefits:\rEnhanced reliability and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Create a validation host pool for testing of planned updates DesktopVirtualization hostPools Configure host pool scheduled agent updates DesktopVirtualization hostPools Ensure a unique OU is used when deploying host pools with domain joined session hosts DesktopVirtualization hostPools Use Azure Site Recovery or backups to protect VMs supporting personal desktops DesktopVirtualization hostPools Scaling plans should be created per region and not scaled across regions DesktopVirtualization scalingPlans Replicate your Image Templates to a secondary region Compute galleries A minimum of three replicas should be kept for production image versions Compute galleries Zone redundant storage should be used for image versions Compute galleries Deploy VMs across Availability Zones Compute virtualMachines Backup VMs with Azure Backup service Compute virtualMachines Production VMs should be using SSD disks Compute virtualMachines Configure diagnostic settings for all Azure Virtual Machines Compute virtualMachines Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes Network expressRouteCircuits Ensure ExpressRoute\u0026rsquo;s physical links connect to distinct network edge devices Network expressRouteCircuits Use Zone-redundant ExpressRoute gateway SKUs Network virtualNetworkGateways Configure NSG Flow Logs Network networkSecurityGroups Ensure that storage accounts are zone or region redundant Storage storageAccounts Enable Azure Private Link Service for Key vault Keyvault vaults Configure Service Health Alerts Insights activityLogAlerts Dependent Well-Architected Framework - Reliability Recommendations\rRecommendation Reliability Stage Ensure that all fault-points and fault-modes are understood and operationalized Design Design a BCDR strategy that will help to meet the business requirements Design General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor service health and resource health for AVD\rHigh\rGovernance\rYes\rVerified\rConfigure AVD Insights workbook\rHigh\rMonitoring and Alerting\rNo\rVerified\rEnsure separate log analytics workspaces for Prod and DR\rLow\rDisaster Recovery\rNo\rVerified\rOrganize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rLow\rGovernance\rNo\rVerified\rMonitor and plan capacity for AVD resources\rLow\rDisaster Recovery\rNo\rVerified\rEnsure DNS regions are replicated to avoid single point of failure\rHigh\rHigh Availability\rNo\rVerified\rImplement a multi-region BCDR Plan\rMedium\rDisaster Recovery\rNo\rVerified\rCreate only one FSLogix file share per Storage Account\rMedium\rScalability\rNo\rVerified\rCreate a dedicated FSLogix file share and setup per host pool\rMedium\rScalability\rNo\rVerified\rEnable Azure backup for FSLogix storage account file shares\rMedium\rHigh Availability\rNo\rVerified\rImplement RDP shortpath for public or managed networks\rMedium\rOther Best Practices\rNo\rVerified\rEnsure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rMedium\rGovernance\rNo\rVerified\rEnsure secondary Entra ID connect synchronization server\rLow\rSecurity\rNo\rVerified\rEnsure virtual networks have route tables/route server configured for all regions\rMedium\rHigh Availability\rNo\rVerified\rEnsure virtual networks isolation with separate IP space and NSGs for Prod and DR\rMedium\rBusiness Continuity\rNo\rVerified\rEnsure route tables accommodate failover\rMedium\rDisaster Recovery\rNo\rVerified\rConfigure static routes for session hosts to directly access the AVD control plane subnet\rMedium\rOther Best Practices\rNo\rVerified\rCreate updated image version and replace session hosts rather than updating host directly\rLow\rGovernance\rNo\rVerified\rEnsure the standard FSLogix configuration is deployed\rMedium\rGovernance\rNo\rVerified\rEnsure user permissions are set correctly on FSLogix SMB shares\rMedium\rSecurity\rNo\rVerified\rConfigure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rMedium\rMonitoring and Alerting\rNo\rVerified\rManually install FSLogix updates\rLow\rGovernance\rNo\rVerified\rTurn on continuous availability for ANF when using it for app attach\rMedium\rHigh Availability\rNo\rVerified\rUse dedicated file share for App attach and include the storage in the disaster recovery plan\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure resilient deployment of key vaults for AVD Host Pools\rHigh\rDisaster Recovery\rNo\rVerified\rDeploy two or more domain controllers on Azure VMs across availability zones in the AVD region\rHigh\rDisaster Recovery\rNo\rVerified\rDeploy domain controllers on Azure VMs across availability zones in the AVD region\rHigh\rHigh Availability\rNo\rVerified\rDetails\rMonitor service health and resource health for AVD\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSet up Service Health alerts so that you stay aware of service issues, planned maintenance, or other changes that might affect your Azure Virtual Desktop resources."},{"id":56,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/avs/","title":"Azure VMware Solution","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Configure Azure Service Health notifications and alerts for Azure VMware Solution AVS privateClouds Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit AVS privateClouds Monitor when Azure VMware Solution Cluster Size is approaching the host limit AVS privateClouds Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore AVS privateClouds Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization AVS privateClouds Configure Syslog in Diagnostic Settings for Azure VMware Solution AVS privateClouds Monitor CPU Utilization to ensure sufficient resources for workloads AVS privateClouds Monitor Memory Utilization to ensure sufficient resources for workloads AVS privateClouds Apply Resource delete lock on the resource group hosting the private cloud AVS privateClouds Use key autorotation for vSAN datastore customer-managed keys AVS privateClouds Use multiple DNS servers per private FQDN zone AVS privateClouds For better data path performance enable FastPath on ExpressRoute Direct and Gateway Network connections Configure an Azure Resource Lock on connections to prevent accidental deletion Network connections Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Network virtualNetworkGateways Monitor gateway health Network virtualNetworkGateways Configure customer-controlled gateway maintenance Network virtualNetworkGateways General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rHigh\rHigh Availability\rNo\rVerified\rIntegrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rHigh\rSecurity\rNo\rVerified\rUse HCX Network Extension High Availability\rHigh\rHigh Availability\rNo\rVerified\rVerify Management Networks are not extended with HCX Network Extension\rHigh\rOther Best Practices\rNo\rVerified\rVerify vSAN FTT configuration aligns with the cluster size\rHigh\rHigh Availability\rNo\rVerified\rAlign ExpressRoute configuration with best practices for circuit resilience\rHigh\rHigh Availability\rNo\rVerified\rDeploy two or more circuits in different peering locations when using stretched clusters\rHigh\rHigh Availability\rNo\rVerified\rDeploy dual Azure VMware Solution clouds in different regions for disaster recovery\rHigh\rDisaster Recovery\rNo\rVerified\rDetails\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse the Interconnect feature for direct communication between private clouds in different availability zones, enabling connectivity between the private clouds management and workload networks. Potential Benefits:\rEnhanced private cloud connectivity\rLearn More:\rConnect Private Clouds in the same region\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Integrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure two external identity sources are configured for NSX and vCenter Server. The VMware vCenter Server and NSX Manager use these for authentication with external identities. Potential Benefits:\rContinuous login access during maintenances\rLearn More:\rSet an external identity source for vCenter\rSet an external identity for NSX-T\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Use HCX Network Extension High Availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable Network Extension High Availability for appliance failure tolerance in HCX service. It pairs selected appliances for Active Standby configuration, ensuring high availability and quick recovery, keeping configurations in-service despite failures. Potential Benefits:\rImproves HCX service continuity\rLearn More:\rHCX Network extension high availability\rUnderstanding Network Extension High Availability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Verify Management Networks are not extended with HCX Network Extension\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDo not extend the network used by the HCX Management devices to ensure the network\u0026#39;s security and stability. Potential Benefits:\rEnhanced network safety and performance\rLearn More:\rRequirements for Network Extension\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Verify vSAN FTT configuration aligns with the cluster size\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe Azure VMware Solution\u0026#39;s service SLA is influenced by vSAN storage policies, which change based on cluster size. For clusters over 6 hosts, an FTT-2 policy (RAID-1 or RAID-6) is advised. FTT refers to the Fault Tolerance feature. Potential Benefits:\rEnhanced cluster reliability\rLearn More:\rUse fault domains\rConfigure storage policy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Align ExpressRoute configuration with best practices for circuit resilience\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMicrosoft suggests using two or more ExpressRoute circuits at distinct peering locations for critical workloads. Connect these circuits and your Azure VMware Solutions private clouds using Global Reach. Potential Benefits:\rEnhanced circuit resilience for Azure VMware\rLearn More:\rAPRL guidance for ExpressRoute circuits\rCreate a new ExpressRoute circuit\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Deploy two or more circuits in different peering locations when using stretched clusters\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure VMware Solution vSAN stretched clusters cover 2 Availability Zones plus a third for witness. Use ExpressRoute for added resilience by deploying two circuits in different locations. With Global Reach, create a mesh topology by connecting on-premises circuits to Azure\u0026#39;s managed circuits. Potential Benefits:\rEnhanced resilience and connectivity\rLearn More:\rDeploy vSAN streched cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Deploy dual Azure VMware Solution clouds in different regions for disaster recovery\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTwo Azure VMware Solution private clouds can be deployed in different regions for business continuity, implementing a mesh network topology based on ExpressRoute Gateway Connections and Global Reach Connections. Potential Benefits:\rEnhanced disaster recovery\rLearn More:\rPrivate Clouds in two regions\rDual Region Network Topology\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Configure Azure Service Health notifications and alerts for Azure VMware Solution AVS privateClouds Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit AVS privateClouds Monitor when Azure VMware Solution Cluster Size is approaching the host limit AVS privateClouds Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore AVS privateClouds Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization AVS privateClouds Configure Syslog in Diagnostic Settings for Azure VMware Solution AVS privateClouds Monitor CPU Utilization to ensure sufficient resources for workloads AVS privateClouds Monitor Memory Utilization to ensure sufficient resources for workloads AVS privateClouds Apply Resource delete lock on the resource group hosting the private cloud AVS privateClouds Use key autorotation for vSAN datastore customer-managed keys AVS privateClouds Use multiple DNS servers per private FQDN zone AVS privateClouds For better data path performance enable FastPath on ExpressRoute Direct and Gateway Network connections Configure an Azure Resource Lock on connections to prevent accidental deletion Network connections Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Network virtualNetworkGateways Monitor gateway health Network virtualNetworkGateways Configure customer-controlled gateway maintenance Network virtualNetworkGateways General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rHigh\rHigh Availability\rNo\rVerified\rIntegrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rHigh\rSecurity\rNo\rVerified\rUse HCX Network Extension High Availability\rHigh\rHigh Availability\rNo\rVerified\rVerify Management Networks are not extended with HCX Network Extension\rHigh\rOther Best Practices\rNo\rVerified\rVerify vSAN FTT configuration aligns with the cluster size\rHigh\rHigh Availability\rNo\rVerified\rAlign ExpressRoute configuration with best practices for circuit resilience\rHigh\rHigh Availability\rNo\rVerified\rDeploy two or more circuits in different peering locations when using stretched clusters\rHigh\rHigh Availability\rNo\rVerified\rDeploy dual Azure VMware Solution clouds in different regions for disaster recovery\rHigh\rDisaster Recovery\rNo\rVerified\rDetails\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse the Interconnect feature for direct communication between private clouds in different availability zones, enabling connectivity between the private clouds management and workload networks."},{"id":57,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/azureFirewalls/","title":"azureFirewalls","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy Azure Firewall across multiple availability zones\rHigh\rHigh Availability\rYes\rVerified\rMonitor Azure Firewall metrics\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure DDoS Protection on the Azure Firewall VNet\rHigh\rSecurity\rYes\rVerified\rLeverage Azure Policy inheritance model\rMedium\rGovernance\rNo\rVerified\rConfigure 2-4 PIPs for SNAT Port utilization\rMedium\rHigh Availability\rNo\rPreview\rMonitor AZFW Latency Probes metric\rHigh\rMonitoring and Alerting\rNo\rPreview\rDetails\rDeploy Azure Firewall across multiple availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance. Potential Benefits:\rEnhanced SLA and reliability\rLearn More:\rAzure Well Architected Framework - Azure Firewall\rDeploy Azure Firewall across multiple availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Azure Firewalls that are not configured with multiple availability zones or deployed without a zone resources | where type == \u0026#39;microsoft.network/azurefirewalls\u0026#39; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | where isempty(properties.virtualHub.id) or isnull(properties.virtualHub.id) | project recommendationId = \u0026#34;c72b7fee-1fa0-5b4b-98e5-54bcae95bb74\u0026#34;, name, id, tags, param1=\u0026#34;multipleZones:false\u0026#34; Monitor Azure Firewall metrics\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitor Azure Firewall for overall health, processed throughput, and outbound SNAT port usage. Get alerted before limits impact services. Consider NAT gateway integration with zonal deployments; note limitations with zone redundant firewalls and secure virtual hub networks. Potential Benefits:\rImprove health and performance monitoring\rLearn More:\rAzure Firewall metrics supported in Azure Monitor\rAzure Firewall performance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Azure Firewalls resources in-scope, along with any metrics associated to Azure Monitor alert rules, that are not fully configured. resources | where type == \u0026#34;microsoft.network/azurefirewalls\u0026#34; | project firewallId = tolower(id), name, tags | join kind = leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | where properties_scopes contains \u0026#34;azureFirewalls\u0026#34; | project metricId = tolower(properties_scopes), monitoredMetric = properties_criteria_allOf.metricName, tags | summarize monitoredMetrics = make_list(monitoredMetric) by tostring(metricId) | project metricId, monitoredMetrics, allAlertsConfigured = monitoredMetrics contains(\u0026#34;FirewallHealth\u0026#34;) and monitoredMetrics contains (\u0026#34;Throughput\u0026#34;) and monitoredMetrics contains (\u0026#34;SNATPortUtilization\u0026#34;) ) on $left.firewallId == $right.metricId | extend alertsNotFullyConfigured = isnull(allAlertsConfigured) or not(allAlertsConfigured) | where alertsNotFullyConfigured | project recommendationId = \u0026#34;c8fa7c6-6b78-a24a-a63f-348a7c71acb9\u0026#34;, name, id = firewallId, tags, param1 = strcat(\u0026#34;MetricsAlerts:\u0026#34;, monitoredMetrics) Configure DDoS Protection on the Azure Firewall VNet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAssociate a DDoS protection plan with the virtual network hosting Azure Firewall to provide enhanced mitigation against DDoS attacks. Azure Firewall Manager integrates the creation of firewall infrastructure and DDoS protection plans. Potential Benefits:\rEnhanced DDoS attack defense\rLearn More:\rAzure DDoS Protection overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all in-scope Azure Firewall resources, where the VNet is not associated to a DDoS Protection Plan resources | where type =~ \u0026#34;Microsoft.Network/azureFirewalls\u0026#34; | where isempty(properties.virtualHub.id) or isnull(properties.virtualHub.id) | mv-expand ipConfig = properties.ipConfigurations | project name, firewallId = id, tags, vNetName = split(ipConfig.properties.subnet.id, \u0026#34;/\u0026#34;, 8)[0], vNetId = tolower(substring(ipConfig.properties.subnet.id, 0, indexof(ipConfig.properties.subnet.id, \u0026#34;/subnet\u0026#34;))) | join kind=fullouter ( resources | where type =~ \u0026#34;Microsoft.Network/ddosProtectionPlans\u0026#34; | mv-expand vNet = properties.virtualNetworks | project ddosProtectionPlanId = id, vNetId = tolower(vNet.id) ) on vNetId | where isempty(ddosProtectionPlanId) | project recommendationId = \u0026#34;1b2dbf4a-8a0b-5e4b-8f4e-3f758188910d\u0026#34;, name, id = firewallId, tags, param1 = strcat(\u0026#34;vNet: \u0026#34;, vNetName), param2 = \u0026#34;ddosProtection: Disabled\u0026#34; Leverage Azure Policy inheritance model\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Firewall policy supports rule hierarchies for compliance enforcement, using a central base policy with higher priority over child policies, and employs Azure custom roles to safeguard base policy and manage access within subscriptions or groups. Potential Benefits:\rEnhanced compliance and rule hierarchy\rLearn More:\rAzure Firewall Policy hierarchy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure 2-4 PIPs for SNAT Port utilization\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rConfigure a minimum of two to four public IP addresses per Azure Firewall to avoid SNAT exhaustion. Azure Firewall offers SNAT for all outbound traffic to public IPs, providing 2,496 SNAT ports for each additional PIP. Potential Benefits:\rAvoids SNAT exhaustion.\rLearn More:\rAzure Well-Architected Framework review - Azure Firewall\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under development Monitor AZFW Latency Probes metric\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCreating a metric to monitor latency probes over 20ms for periods longer than 30ms helps identify when firewall instance CPUs are stressed, potentially indicating issues. Potential Benefits:\rImproved CPU stress detection\rLearn More:\rAzure Well-Architected Framework review - Azure Firewall\rAzure Firewall metrics overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy Azure Firewall across multiple availability zones\rHigh\rHigh Availability\rYes\rVerified\rMonitor Azure Firewall metrics\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure DDoS Protection on the Azure Firewall VNet\rHigh\rSecurity\rYes\rVerified\rLeverage Azure Policy inheritance model\rMedium\rGovernance\rNo\rVerified\rConfigure 2-4 PIPs for SNAT Port utilization\rMedium\rHigh Availability\rNo\rPreview\rMonitor AZFW Latency Probes metric\rHigh\rMonitoring and Alerting\rNo\rPreview\rDetails\rDeploy Azure Firewall across multiple availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance."},{"id":58,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/","title":"AzureLargeInstance","parent":"Azure Resources","content":"","description":""},{"id":59,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/azureLargeInstances/","title":"azureLargeInstances","parent":"AzureLargeInstance","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":60,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/azureLargeStorageInstances/","title":"azureLargeStorageInstances","parent":"AzureLargeInstance","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":61,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/","title":"AzureStackHCI","parent":"Azure Resources","content":"","description":""},{"id":62,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/azureTrafficCollectors/","title":"azureTrafficCollectors","parent":"NetworkFunction","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits\rMedium\rMonitoring and Alerting\rNo\rVerified\rDetails\rEnsure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute Traffic Collector samples network flows over ExpressRoute Direct circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM. Potential Benefits:\rEnhanced network flow analysis and DR readiness\rLearn More:\rAzure ExpressRoute Traffic Collector\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits\rMedium\rMonitoring and Alerting\rNo\rVerified\rDetails\rEnsure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute Traffic Collector samples network flows over ExpressRoute Direct circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM."},{"id":63,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/","title":"BareMetalInfrastructure","parent":"Azure Resources","content":"","description":""},{"id":64,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/bareMetalInstances/","title":"bareMetalInstances","parent":"BareMetalInfrastructure","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":65,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/bareMetalMachines/","title":"bareMetalMachines","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":66,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/bareMetalStorageInstances/","title":"bareMetalStorageInstances","parent":"BareMetalInfrastructure","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":67,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/bastionHosts/","title":"bastionHosts","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":68,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Batch/","title":"Batch","parent":"Azure Resources","content":"","description":""},{"id":69,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Batch/batchAccounts/","title":"batchAccounts","parent":"Batch","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor Batch Account quota\rMedium\rMonitoring and Alerting\rNo\rPreview\rCreate an Azure Batch pool across Availability Zones\rHigh\rHigh Availability\rNo\rPreview\rDetails\rMonitor Batch Account quota\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rTo ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits. Potential Benefits:\rEnsures business continuity\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create an Azure Batch pool across Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rWhen using Virtual Machine Configuration for Azure Batch pools, opting to distribute your pool across Availability Zones bolsters your compute nodes against Azure datacenter failures. Potential Benefits:\rEnhanced reliability and failure protection\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor Batch Account quota\rMedium\rMonitoring and Alerting\rNo\rPreview\rCreate an Azure Batch pool across Availability Zones\rHigh\rHigh Availability\rNo\rPreview\rDetails\rMonitor Batch Account quota\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rTo ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits."},{"id":70,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Bing/","title":"Bing","parent":"Azure Resources","content":"","description":""},{"id":71,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BotService/","title":"BotService","parent":"Azure Resources","content":"","description":""},{"id":72,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BotService/botServices/","title":"botServices","parent":"BotService","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":73,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/","title":"Cache","parent":"Azure Resources","content":"","description":""},{"id":74,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageCache/caches/","title":"caches","parent":"StorageCache","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":75,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Fabric/capacities/","title":"capacities","parent":"Fabric","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":76,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/PowerBIDedicated/capacities/","title":"capacities","parent":"PowerBIDedicated","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":77,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/capacityReservationGroups/","title":"capacityReservationGroups","parent":"MachineLearningServices","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":78,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/cassandraClusters/","title":"cassandraClusters","parent":"DocumentDB","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":79,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/","title":"Cdn","parent":"Azure Resources","content":"","description":""},{"id":80,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/CdnWebApplicationFirewallPolicies/","title":"CdnWebApplicationFirewallPolicies","parent":"Cdn","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":81,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ChangeAnalysis/","title":"ChangeAnalysis","parent":"Azure Resources","content":"","description":""},{"id":82,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ChangeAnalysis/changes/","title":"changes","parent":"ChangeAnalysis","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":83,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HardwareSecurityModules/cloudHsmClusters/","title":"cloudHsmClusters","parent":"HardwareSecurityModules","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":84,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/cloudServices/","title":"cloudServices","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":85,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/cloudServicesNetworks/","title":"cloudServicesNetworks","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":86,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/clusterManagers/","title":"clusterManagers","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":87,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/clusterPools/","title":"clusterPools","parent":"HDInsight","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":88,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/clusters/","title":"clusters","parent":"AzureStackHCI","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":89,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/clusters/","title":"clusters","parent":"EventHub","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":90,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/clusters/","title":"clusters","parent":"HDInsight","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":91,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Kusto/clusters/","title":"clusters","parent":"Kusto","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":92,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/clusters/","title":"clusters","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":93,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/clusters/","title":"clusters","parent":"ServiceFabric","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":94,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/clusters/","title":"clusters","parent":"StreamAnalytics","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":95,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/CognitiveServices/","title":"CognitiveServices","parent":"Azure Resources","content":"","description":""},{"id":96,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/components/","title":"components","parent":"Insights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConvert Classic Deployments\rMedium\rService Upgrade and Retirement\rYes\rPreview\rDetails\rConvert Classic Deployments\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rClassic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024. Potential Benefits:\rAvoid service disruption post-Feb 2024\rLearn More:\rMigrate an Application Insights classic resource to a workspace-based resource\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Filters Application Insights resources with ‘Classic’ deployment type resources | where type =~ \u0026#34;microsoft.insights/components\u0026#34; | extend IngestionMode = properties.IngestionMode | where IngestionMode =~ \u0026#39;ApplicationInsights\u0026#39; | project recommendationId= \u0026#34;dac421ec-2832-4c37-839e-b6dc5a38f2fa\u0026#34;, name, id, tags, param1=\u0026#34;ApplicationInsightsDeploymentType: Classic\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConvert Classic Deployments\rMedium\rService Upgrade and Retirement\rYes\rPreview\rDetails\rConvert Classic Deployments\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rClassic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024. Potential Benefits:\rAvoid service disruption post-Feb 2024\rLearn More:\rMigrate an Application Insights classic resource to a workspace-based resource\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":97,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/","title":"Compute","parent":"Azure Resources","content":"","description":""},{"id":98,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/configurations/","title":"configurations","parent":"Advisor","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":99,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppConfiguration/configurationStores/","title":"configurationStores","parent":"AppConfiguration","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":100,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/connectedEnvironments/","title":"connectedEnvironments","parent":"App","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":101,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/connections/","title":"connections","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rFor better data path performance enable FastPath on ExpressRoute Direct and Gateway\rMedium\rScalability\rNo\rVerified\rConfigure an Azure Resource Lock on connections to prevent accidental deletion\rHigh\rHigh Availability\rNo\rVerified\rDetails\rFor better data path performance enable FastPath on ExpressRoute Direct and Gateway\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization. Potential Benefits:\rEnhances speed and resiliency\rLearn More:\rAbout ExpressRoute FastPath\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure an Azure Resource Lock on connections to prevent accidental deletion\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure an Azure Resource lock for Gateway Connection resources to prevent accidental deletion and maintain connectivity between on-premises networks and Azure workloads. Potential Benefits:\rPrevents accidental deletion of connections\rLearn More:\rProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rFor better data path performance enable FastPath on ExpressRoute Direct and Gateway\rMedium\rScalability\rNo\rVerified\rConfigure an Azure Resource Lock on connections to prevent accidental deletion\rHigh\rHigh Availability\rNo\rVerified\rDetails\rFor better data path performance enable FastPath on ExpressRoute Direct and Gateway\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization."},{"id":102,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/containerApps/","title":"containerApps","parent":"App","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":103,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/containerApps/","title":"containerApps","parent":"Web","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":104,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerInstance/containerGroups/","title":"containerGroups","parent":"ContainerInstance","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":105,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerInstance/","title":"ContainerInstance","parent":"Azure Resources","content":"","description":""},{"id":106,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerRegistry/","title":"ContainerRegistry","parent":"Azure Resources","content":"","description":""},{"id":107,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/","title":"ContainerService","parent":"Azure Resources","content":"","description":""},{"id":108,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/databaseAccounts/","title":"databaseAccounts","parent":"DocumentDB","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure at least two regions for high availability\rHigh\rHigh Availability\rYes\rVerified\rEnable service-managed failover for multi-region accounts with single write region\rHigh\rDisaster Recovery\rYes\rVerified\rEvaluate multi-region write capability\rHigh\rHigh Availability\rYes\rVerified\rConfigure continuous backup mode\rHigh\rDisaster Recovery\rYes\rVerified\rEnsure query results are fully drained\rHigh\rScalability\rNo\rVerified\rMaintain singleton pattern in your client\rMedium\rScalability\rNo\rVerified\rImplement retry logic in your client\rMedium\rHigh Availability\rNo\rVerified\rMonitor Cosmos DB health and set up alerts\rMedium\rMonitoring and Alerting\rNo\rVerified\rDetails\rConfigure at least two regions for high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable a secondary region in Cosmos DB for higher SLA without downtime. Simple as pinning a location on a map. For Strong consistency, configure at least three regions for write availability in case of failure. Potential Benefits:\rEnhances SLA and resilience\rLearn More:\rDistribute data globally with Azure Cosmos DB | Microsoft Learn\rTips for building highly available applications | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to find Azure Cosmos DB accounts that have less than 2 regions or less than 3 regions with strong consistency level Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026lt; 2 or (array_length(properties.locations) \u0026lt; 3 and properties.consistencyPolicy.defaultConsistencyLevel == \u0026#39;Strong\u0026#39;) | project recommendationId=\u0026#39;43663217-a1d3-844b-80ea-571a2ce37c6c\u0026#39;, name, id, tags Enable service-managed failover for multi-region accounts with single write region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCosmos DB boasts high uptime and resiliency. Even so, issues may arise. With Service-Managed failover, if a region is down, Cosmos DB automatically switches to the next available region, requiring no user action. Potential Benefits:\rAuto failover for high uptime\rLearn More:\rManage an Azure Cosmos DB account by using the Azure portal | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all Azure Cosmos DB accounts that do not have multiple write locations or automatic failover enabled Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026gt; 1 and tobool(properties.enableAutomaticFailover) == false and tobool(properties.enableMultipleWriteLocations) == false | project recommendationId=\u0026#39;9cabded7-a1fc-6e4a-944b-d7dd98ea31a2\u0026#39;, name, id, tags Evaluate multi-region write capability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMulti-region write capability allows for designing applications that are highly available across multiple regions, though it demands careful attention to consistency requirements and conflict resolution. Improper setup may decrease availability and cause data corruption due to unhandled conflicts. Potential Benefits:\rEnhances high availability\rLearn More:\rDistribute data globally with Azure Cosmos DB | Microsoft Learn\rConflict resolution types and resolution policies in Azure Cosmos DB | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to find Azure Cosmos DB accounts that have multiple read locations but do not have multiple write locations enabled Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026gt; 1 and properties.enableMultipleWriteLocations == false | project recommendationId=\u0026#39;9ce78192-74a0-104c-b5bb-9a443f941649\u0026#39;, name, id, tags Configure continuous backup mode\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCosmos DB\u0026#39;s backup is always on, offering protection against data mishaps. Continuous mode allows for self-serve restoration to a pre-mishap point, unlike periodic mode which requires contacting Microsoft support, leading to longer restore times. Potential Benefits:\rFaster self-serve data restore\rLearn More:\rContinuous backup with point in time restore feature in Azure Cosmos DB | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query all Azure Cosmos DB accounts that do not have continuous backup mode configured Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where properties.backupPolicy.type == \u0026#39;Periodic\u0026#39; and properties.enableMultipleWriteLocations == false and properties.enableAnalyticalStorage == false | project recommendationId=\u0026#39;e544520b-8505-7841-9e77-1f1974ee86ec\u0026#39;, name, id, tags Ensure query results are fully drained\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCosmos DB has a 4 MB response limit, leading to paginated results for large or partition-spanning queries. Each page shows availability and provides a continuation token for the next. A while loop in code is necessary to traverse all pages until completion. Potential Benefits:\rMaximizes data retrieval efficiency\rLearn More:\rPagination in Azure Cosmos DB | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Maintain singleton pattern in your client\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUsing a single instance of the SDK client for each account and application is crucial as connections are tied to the client. Compute environments have a limit on open connections, affecting connectivity when exceeded. Potential Benefits:\rOptimizes connections and efficiency\rLearn More:\rDesigning resilient applications with Azure Cosmos DB SDKs | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement retry logic in your client\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCosmos DB SDKs automatically manage many transient errors through retries. Despite this, it\u0026#39;s crucial for applications to implement additional retry policies targeting specific cases that the SDKs can\u0026#39;t generically address, ensuring more robust error handling. Potential Benefits:\rEnhances error handling resilience\rLearn More:\rDesigning resilient applications with Azure Cosmos DB SDKs | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor Cosmos DB health and set up alerts\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring the availability and responsiveness of Azure Cosmos DB resources and having alerts set up for your workload is a good practice. This ensures you stay proactive in handling unforeseen events. Potential Benefits:\rProactive issue management\rLearn More:\rCreate alerts for Azure Cosmos DB using Azure Monitor | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure at least two regions for high availability\rHigh\rHigh Availability\rYes\rVerified\rEnable service-managed failover for multi-region accounts with single write region\rHigh\rDisaster Recovery\rYes\rVerified\rEvaluate multi-region write capability\rHigh\rHigh Availability\rYes\rVerified\rConfigure continuous backup mode\rHigh\rDisaster Recovery\rYes\rVerified\rEnsure query results are fully drained\rHigh\rScalability\rNo\rVerified\rMaintain singleton pattern in your client\rMedium\rScalability\rNo\rVerified\rImplement retry logic in your client\rMedium\rHigh Availability\rNo\rVerified\rMonitor Cosmos DB health and set up alerts\rMedium\rMonitoring and Alerting\rNo\rVerified\rDetails\rConfigure at least two regions for high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable a secondary region in Cosmos DB for higher SLA without downtime."},{"id":109,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBox/","title":"DataBox","parent":"Azure Resources","content":"","description":""},{"id":110,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBoxEdge/","title":"DataBoxEdge","parent":"Azure Resources","content":"","description":""},{"id":111,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBoxEdge/dataBoxEdgeDevices/","title":"dataBoxEdgeDevices","parent":"DataBoxEdge","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":112,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Databricks/","title":"Databricks","parent":"Azure Resources","content":"","description":""},{"id":113,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataFactory/","title":"DataFactory","parent":"Azure Resources","content":"","description":""},{"id":114,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeAnalytics/","title":"DataLakeAnalytics","parent":"Azure Resources","content":"","description":""},{"id":115,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeStore/","title":"DataLakeStore","parent":"Azure Resources","content":"","description":""},{"id":116,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataShare/","title":"DataShare","parent":"Azure Resources","content":"","description":""},{"id":117,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMariaDB/","title":"DBforMariaDB","parent":"Azure Resources","content":"","description":""},{"id":118,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/","title":"DBforMySQL","parent":"Azure Resources","content":"","description":""},{"id":119,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/","title":"DBforPostgreSQL","parent":"Azure Resources","content":"","description":""},{"id":120,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/ddosProtectionPlans/","title":"ddosProtectionPlans","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor Azure DDoS Protection Plan metrics\rMedium\rSecurity\rNo\rVerified\rDetails\rMonitor Azure DDoS Protection Plan metrics\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded). Potential Benefits:\rEnhanced security and traffic insight\rLearn More:\rMonitoring Azure DDoS Protection\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor Azure DDoS Protection Plan metrics\rMedium\rSecurity\rNo\rVerified\rDetails\rMonitor Azure DDoS Protection Plan metrics\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded). Potential Benefits:\rEnhanced security and traffic insight\rLearn More:\rMonitoring Azure DDoS Protection\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":121,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/deployments/","title":"deployments","parent":"Resources","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":122,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/","title":"DesktopVirtualization","parent":"Azure Resources","content":"","description":""},{"id":123,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevAI/","title":"DevAI","parent":"Azure Resources","content":"","description":""},{"id":124,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevCenter/","title":"DevCenter","parent":"Azure Resources","content":"","description":""},{"id":125,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevCenter/devCenters/","title":"devCenters","parent":"DevCenter","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":126,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/develop/","title":"Develop","parent":"Well-Architected Framework","content":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include the Develop Stage and associated resources and their settings.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rUse appropriate patterns for managing outgoing connections\rMedium\rScalability\rPreview\rExpect outgoing connections to fail\rMedium\rHigh Availability\rPreview\rEnsure the infrastructure can support the number of outgoing connections\rHigh\rScalability\rPreview\rImplement Coding Patterns to handle partial failures\rMedium\rHigh Availability\rPreview\rImplement circuit breakers to prevent cascading failures\rHigh\rHigh Availability\rPreview\rDetails\rUse appropriate patterns for managing outgoing connections\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rOutgoing connections are the requests that your cloud solution makes to external services or resources, such as databases, APIs, or third-party providers. Managing these connections properly is crucial for ensuring the reliability and performance of your solution. You should use appropriate patterns for opening, closing, reusing, and pooling outgoing connections, depending on the type and frequency of the requests. For example, you can use the circuit breaker pattern to prevent your solution from making repeated requests to a failing service, or you can use connection pooling to reuse existing connections and reduce the overhead of creating new ones. Additionally, you can use patterns like dependency injection or factory patterns to manage connection objects in code, and make sure to close connections you no longer use to prevent port exhaustion. Potential Benefits:\rIncrease connection management\rLearn More:\rUsing dependency injection in .NET\rUse IHttpClientFactory to implement resilient HTTP requests\rExpect outgoing connections to fail\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rOne of the main challenges of cloud computing is that you have to deal with uncertainty and unpredictability of network communication. Outgoing connections can fail for various reasons, such as network congestion, timeouts, service outages, or configuration errors. You should expect these failures to occur and design your solution to handle them gracefully. For example, you can use patterns like retry, fallback, or timeout to recover from transient failures, or use patterns like bulkhead or queue-based load leveling to isolate and manage the impact of failures on your system. By expecting and handling outgoing connection failures, you can improve the resilience and availability of your cloud solution. Potential Benefits:\rIncrease the application\u0026#39;s outgoing connection reliability\rLearn More:\rArchitecture Center - Retry Patterns\rEnsure the infrastructure can support the number of outgoing connections\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rOutgoing connections go through various components on the network path to their destination. These components include gateways, proxies, firewalls, or other appliances as well as Azure NAT gateways or other means of scaling outgoing connections. Make sure that these components can scale to at least the expected outgoing traffic volume. Potential Benefits:\rIncrease the application\u0026#39;s outgoing connection Scalability\rLearn More:\rEnsure zone resilient outbound connectivity with NAT gateway\rImplement Coding Patterns to handle partial failures\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rPartial failures are inevitable in distributed systems, where some components may fail or become unavailable while others continue to function. Therefore, cloud solutions should implement patterns to handle partial failures gracefully and avoid disrupting the entire system. Some of these patterns include retrying failed operations with exponential backoff, using timeouts to limit the impact of slow or unresponsive services, and fallback logic to provide alternative responses when the primary service is not available. As an example, dynamic content loaded into a webpage should revert to default values if the content is unavailable or should be hidden altogether. This presents a more favorable user experience than displaying error messages. Potential Benefits:\rEnable users to function despite ongoing issues\rLearn More:\rRecommendations for self-healing and self-preservation\rImplement circuit breakers to prevent cascading failures\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCircuit breakers are a design pattern that can help prevent cascading failures in distributed systems. The idea is to monitor the health of each service and stop sending requests to it if it becomes unhealthy or unresponsive. This way, the failure of one service does not affect the rest of the system, and the service can recover faster by avoiding overload. Circuit breakers can also trigger fallback logic, such as using cached data or default values, when the primary service is unavailable. This improves the reliability and resilience of the system and provides a better user experience. Potential Benefits:\rPrevent cascading failures during reliability incidents\rLearn More:\rArchitecture Center - Circuit Breaker Pattern\r","description":"The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include the Develop Stage and associated resources and their settings.\nSummary\rRecommendation\rImpact\rCategory\rPG Verified\rUse appropriate patterns for managing outgoing connections\rMedium\rScalability\rPreview\rExpect outgoing connections to fail\rMedium\rHigh Availability\rPreview\rEnsure the infrastructure can support the number of outgoing connections\rHigh\rScalability\rPreview\rImplement Coding Patterns to handle partial failures\rMedium\rHigh Availability\rPreview\rImplement circuit breakers to prevent cascading failures\rHigh\rHigh Availability\rPreview\rDetails\rUse appropriate patterns for managing outgoing connections\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rOutgoing connections are the requests that your cloud solution makes to external services or resources, such as databases, APIs, or third-party providers."},{"id":127,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Devices/","title":"Devices","parent":"Azure Resources","content":"","description":""},{"id":128,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevTestLab/","title":"DevTestLab","parent":"Azure Resources","content":"","description":""},{"id":129,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/diagnosticSettings/","title":"diagnosticSettings","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":130,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsForwardingRulesets/","title":"dnsForwardingRulesets","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":131,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsResolvers/","title":"dnsResolvers","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":132,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsZones/","title":"dnsZones","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":133,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/","title":"DocumentDB","parent":"Azure Resources","content":"","description":""},{"id":134,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/domains/","title":"domains","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":135,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Easm/","title":"Easm","parent":"Azure Resources","content":"","description":""},{"id":136,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/edgeSites/","title":"edgeSites","parent":"Orbital","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":137,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Elastic/","title":"Elastic","parent":"Azure Resources","content":"","description":""},{"id":138,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ElasticSan/","title":"ElasticSan","parent":"Azure Resources","content":"","description":""},{"id":139,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ElasticSan/elasticSans/","title":"elasticSans","parent":"ElasticSan","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":140,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/","title":"EventGrid","parent":"Azure Resources","content":"","description":""},{"id":141,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/","title":"EventHub","parent":"Azure Resources","content":"","description":""},{"id":142,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/eventSubscriptions/","title":"eventSubscriptions","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":143,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteCircuits/","title":"expressRouteCircuits","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes\rHigh\rHigh Availability\rNo\rVerified\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rVerified\rEnsure both connections of an ExpressRoute circuit are configured in active-active mode\rHigh\rHigh Availability\rNo\rVerified\rActivate Bidirectional Forwarding Detection on edge devices for faster failover\rHigh\rHigh Availability\rNo\rVerified\rConfigure monitoring and alerting for ExpressRoute circuits\rHigh\rMonitoring and Alerting\rNo\rVerified\rConfigure service health to receive ExpressRoute circuit maintenance notification\rHigh\rMonitoring and Alerting\rNo\rVerified\rUse a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConnecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails. Potential Benefits:\rEnhanced reliability and redundancy\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMicrosoft or the ExpressRoute provider always ensures physical redundancy in their services. It\u0026#39;s essential to maintain this level of physical redundancy (two devices, two links) from the ExpressRoute peering location to your network for optimal performance and reliability. Potential Benefits:\rEnhanced reliability and fault tolerance\rLearn More:\rDesigning for high availability with ExpressRoute\rAzure Well-Architected Framework review - Azure ExpressRoute - Design Checklist\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure both connections of an ExpressRoute circuit are configured in active-active mode\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rOperating both connections of an ExpressRoute circuit in active-active mode enhances high availability as the Microsoft network will load balance the traffic across the connections on a per-flow basis. Potential Benefits:\rImproved high availability and load balancing\rLearn More:\rDesigning for high availability with ExpressRoute - Active-active connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Activate Bidirectional Forwarding Detection on edge devices for faster failover\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnabling BFD over ExpressRoute speeds up link failure detection between MSEE devices and routers configured for ExpressRoute (CE/PE), applicable over both customer and Partner Edge routing devices with managed Layer 3 service. Potential Benefits:\rFaster link failure detection\rLearn More:\rConfigure BFD over ExpressRoute\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure monitoring and alerting for ExpressRoute circuits\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Network Insights for monitoring ExpressRoute circuit availability, QoS, and throughput. Set alerts based on Azure Monitor Baseline Alerts for availability, QoS metrics, and throughput metrics exceeding specific thresholds. Potential Benefits:\rEnhanced network performance and health\rLearn More:\rAzure ExpressRoute Insights using Network Insights | Microsoft Learn\rMonitoring Azure ExpressRoute\rConfigure Traffic Collector for ExpressRoute Direct - Azure ExpressRoute | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure service health to receive ExpressRoute circuit maintenance notification\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute leverages service health for notifications on both planned and unplanned maintenance, ensuring users are informed about any changes to their ExpressRoute circuits. Potential Benefits:\rStay informed on circuit updates\rLearn More:\rHow to view and configure alerts for Azure ExpressRoute circuit maintenance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIf you haven\u0026#39;t added a second ExpressRoute circuit, use a site-to-site VPN as a temporary solution until the second circuit is available. This ensures network reliability and continuity of service. Potential Benefits:\rEnsures continuity and reliability\rLearn More:\rUsing S2S VPN as a backup for ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes\rHigh\rHigh Availability\rNo\rVerified\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rVerified\rEnsure both connections of an ExpressRoute circuit are configured in active-active mode\rHigh\rHigh Availability\rNo\rVerified\rActivate Bidirectional Forwarding Detection on edge devices for faster failover\rHigh\rHigh Availability\rNo\rVerified\rConfigure monitoring and alerting for ExpressRoute circuits\rHigh\rMonitoring and Alerting\rNo\rVerified\rConfigure service health to receive ExpressRoute circuit maintenance notification\rHigh\rMonitoring and Alerting\rNo\rVerified\rUse a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConnecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails."},{"id":144,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteCrossConnections/","title":"expressRouteCrossConnections","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":145,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteGateways/","title":"expressRouteGateways","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":146,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRoutePorts/","title":"expressRoutePorts","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rHigh\rHigh Availability\rYes\rVerified\rEnsure you do not over-subscribe an ExpressRoute Direct\rHigh\rScalability\rYes\rVerified\rImplement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rMedium\rScalability\rNo\rVerified\rDetails\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIn Azure ExpressRoute Direct, the \u0026#34;Admin State\u0026#34; indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off. Potential Benefits:\rEnsures optimal connectivity.\rLearn More:\rHow to configure ExpressRoute Direct Change Admin State of links\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Express Route Directs that do not have Admin State of both Links Enabled resources | where type == \u0026#34;microsoft.network/expressrouteports\u0026#34; | where properties[\u0026#39;links\u0026#39;][0][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;] == \u0026#34;Disabled\u0026#34; or properties[\u0026#39;links\u0026#39;][1][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;] == \u0026#34;Disabled\u0026#34; | project recommendationId = \u0026#34;60077378-7cb1-4b35-89bb-393884d9921d\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;Link1AdminState: \u0026#34;, properties[\u0026#39;links\u0026#39;][0][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;]), param2 = strcat(\u0026#34;Link2AdminState: \u0026#34;, properties[\u0026#39;links\u0026#39;][1][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;]) Ensure you do not over-subscribe an ExpressRoute Direct\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProvisioning ExpressRoute circuits on a 10-Gbps or 100-Gbps ExpressRoute Direct resource up to 20-Gbps or 200-Gbps is possible but not recommended for resiliency. If an ExpressRoute Direct port fails, and circuits are using full capacity, the remaining port won\u0026#39;t handle the extra load. Potential Benefits:\rImproves resilience during port failures\rLearn More:\rAbout ExpressRoute Direct Circuit Sizes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Express Route Directs that are over subscribed resources | where type == \u0026#34;microsoft.network/expressrouteports\u0026#34; | where toint(properties[\u0026#39;provisionedBandwidthInGbps\u0026#39;]) \u0026gt; toint(properties[\u0026#39;bandwidthInGbps\u0026#39;]) | project recommendationId = \u0026#34;0bee356b-7348-4799-8cab-0c71ffe13018\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisionedBandwidthInGbps: \u0026#34;, properties[\u0026#39;provisionedBandwidthInGbps\u0026#39;]), param2 = strcat(\u0026#34;bandwidthInGbps: \u0026#34;, properties[\u0026#39;bandwidthInGbps\u0026#39;]) Implement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rRate limiting controls traffic volume between on-premises networks and Azure via ExpressRoute Direct, applying to private or Microsoft peering. It distributes port bandwidth, ensures stability, and prevents congestion, with steps outlined for enabling on circuits. Potential Benefits:\rOptimizes network, prevents congestion\rLearn More:\rRate limiting for ExpressRoute Direct circuits (Preview)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rHigh\rHigh Availability\rYes\rVerified\rEnsure you do not over-subscribe an ExpressRoute Direct\rHigh\rScalability\rYes\rVerified\rImplement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rMedium\rScalability\rNo\rVerified\rDetails\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIn Azure ExpressRoute Direct, the \u0026#34;Admin State\u0026#34; indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off."},{"id":147,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteProviderPorts/","title":"expressRouteProviderPorts","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":148,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Fabric/","title":"Fabric","parent":"Azure Resources","content":"","description":""},{"id":149,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataFactory/factories/","title":"factories","parent":"DataFactory","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":150,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/firewallPolicies/","title":"firewallPolicies","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":151,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/fleets/","title":"fleets","parent":"ContainerService","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":152,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/flexibleServers/","title":"flexibleServers","parent":"DBforMySQL","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rVerified\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rVerified\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rHigh availability concepts in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;88856605-53d8-4bbd-a75b-4a7b14939d32\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; Enable custom maintenance schedule\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied. Potential Benefits:\rControl update timings\rLearn More:\rScheduled maintenance in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that do not have a custom maintenance window resources | where type =~ \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;82a9a0f2-24ee-496f-9ad2-25f81710942d\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;])\r","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rVerified\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rVerified\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rHigh availability concepts in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":153,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/flexibleServers/","title":"flexibleServers","parent":"DBforPostgreSQL","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rVerified\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rVerified\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rOverview of high availability with Azure Database for PostgreSQL\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;ca87914f-aac4-4783-ab67-82a6f936f194\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; Enable custom maintenance schedule\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied. Potential Benefits:\rControl update timings\rLearn More:\rScheduled maintenance in Azure Database for PostgreSQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that do not have a custom maintenance window resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;b2bad57d-7e03-4c0f-9024-597c9eb295bb\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;]) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rVerified\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rVerified\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rOverview of high availability with Azure Database for PostgreSQL\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":154,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FluidRelay/","title":"FluidRelay","parent":"Azure Resources","content":"","description":""},{"id":155,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FluidRelay/fluidRelayServers/","title":"fluidRelayServers","parent":"FluidRelay","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":156,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/frontDoors/","title":"frontDoors","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":157,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/frontDoorWebApplicationFirewallPolicies/","title":"frontDoorWebApplicationFirewallPolicies","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rInspect Azure Front Door WAF logs for wrongfully blocked legitimate requests\rHigh\rMonitoring and Alerting\rNo\rVerified\rCheck Azure Application Gateway WAF logs for mistakenly blocked valid requests\rHigh\rMonitoring and Alerting\rNo\rVerified\rMonitor Web Application Firewall\rHigh\rMonitoring and Alerting\rNo\rPreview\rDetails\rInspect Azure Front Door WAF logs for wrongfully blocked legitimate requests\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWAF may mistakenly block legitimate requests (false positives). These can be identified by examining the last 24 hours of blocked requests in Log Analytics. Potential Benefits:\rReduces false positives, improves access\rLearn More:\rAzure Web Application Firewall monitoring and logging - Access Log\rUnderstanding WAF logs\rWeb Application Firewall exclusion lists\rFixing a false positive\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Check Azure Application Gateway WAF logs for mistakenly blocked valid requests\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWAF may block legitimate requests as false positives. Identifying blocked requests within the last 24 hours through Log Analytics can help manage and mitigate these incorrect blockages efficiently. Potential Benefits:\rImprove false positive identification\rLearn More:\rAzure Web Application Firewall Monitoring and Logging\rDiagnostic logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor Web Application Firewall\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rMonitoring the health of your Web Application Firewall and the applications it protects is crucial. This can be achieved through integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs, ensuring optimal performance and security. Potential Benefits:\rEnhanced security and health insight\rLearn More:\rWAF monitoring\rAzure Monitor Workbook for WAF\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rInspect Azure Front Door WAF logs for wrongfully blocked legitimate requests\rHigh\rMonitoring and Alerting\rNo\rVerified\rCheck Azure Application Gateway WAF logs for mistakenly blocked valid requests\rHigh\rMonitoring and Alerting\rNo\rVerified\rMonitor Web Application Firewall\rHigh\rMonitoring and Alerting\rNo\rPreview\rDetails\rInspect Azure Front Door WAF logs for wrongfully blocked legitimate requests\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWAF may mistakenly block legitimate requests (false positives)."},{"id":158,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FullPath/","title":"FullPath","parent":"Azure Resources","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":159,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/galleries/","title":"galleries","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rA minimum of three replicas should be kept for production image versions\rMedium\rHigh Availability\rYes\rVerified\rZone redundant storage should be used for image versions\rMedium\rHigh Availability\rYes\rVerified\rConsider creating TrustedLaunchSupported images where possible\rLow\rHigh Availability\rYes\rVerified\rDetails\rA minimum of three replicas should be kept for production image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rKeeping a minimum of 3 replicas for production images in Azure\u0026#39;s Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas. This reduces the risk of overloading a single replica. Potential Benefits:\rEnhances scalability and avoids throttling\rLearn More:\rCompute Gallery best practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all image versions,its associated image name and version replica configurations per region in a compute gallery whose version replicas is less than 3 resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | mv-expand VersionReplicas = properties.publishingProfile.targetRegions | project RecommendationId=\u0026#34;b49a39fd-f431-4b61-9062-f2157849d845\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;VersionReplicaRegionName: \u0026#34;,VersionReplicas.name),param4=strcat(\u0026#34;VersionReplicationCount: \u0026#34;,VersionReplicas.regionalReplicaCount),rc=toint(VersionReplicas.regionalReplicaCount) | where rc \u0026lt; 3 | project-away rc Zone redundant storage should be used for image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse ZRS for high availability when creating image/VM versions in Azure Compute Gallery, offering resilience against Availability Zone failures. ZRS accounts are advisable in regions with Availability Zones, with the choice of Standard_ZRS recommended over Standard_LRS for these regions. Potential Benefits:\rEnhances image version availability\rLearn More:\rCompute Gallery best practices\rZone-redundant storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all image versions and its associated image and gallery name whose Storage account type is not using ZRS resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | extend StorageAccountType = tostring(properties.publishingProfile.storageAccountType) | where StorageAccountType !has \u0026#34;ZRS\u0026#34; | project RecommendationId=\u0026#34;488dcc8b-f2e3-40ce-bf95-73deb2db095f\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;StorageAccountType: \u0026#34;,StorageAccountType) Consider creating TrustedLaunchSupported images where possible\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWe recommend creating Trusted Launch Supported Images for benefits like Secure Boot, vTPM, trusted launch VMs, large boot volume. These are Gen 2 Images by default and you cannot change a VM\u0026#39;s generation after creation, so review the considerations first. Potential Benefits:\rEnhances VM security and features\rLearn More:\rCompute Gallery best practices\rGeneration 1 vs Generation 2 in Hyper-V\rImages in Compute gallery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all images whose Hyper-V generation is not V2 resources | where type =~ \u0026#34;microsoft.compute/galleries/images\u0026#34; | extend VMGeneration = properties.hyperVGeneration | where VMGeneration \u0026lt;\u0026gt; \u0026#39;V2\u0026#39; | project RecommendationId=\u0026#34;1c5e1e58-4e56-491c-8529-10f37af9d4ed\u0026#34;,name,id,tags,param1=strcat(\u0026#34;VMGeneration: \u0026#34;,VMGeneration) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rA minimum of three replicas should be kept for production image versions\rMedium\rHigh Availability\rYes\rVerified\rZone redundant storage should be used for image versions\rMedium\rHigh Availability\rYes\rVerified\rConsider creating TrustedLaunchSupported images where possible\rLow\rHigh Availability\rYes\rVerified\rDetails\rA minimum of three replicas should be kept for production image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rKeeping a minimum of 3 replicas for production images in Azure\u0026#39;s Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas."},{"id":160,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/gateways/","title":"gateways","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":161,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/globalCommunicationsSites/","title":"globalCommunicationsSites","parent":"Orbital","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":162,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/groundStations/","title":"groundStations","parent":"Orbital","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":163,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HanaOnAzure/hanaInstances/","title":"hanaInstances","parent":"HanaOnAzure","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":164,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HanaOnAzure/","title":"HanaOnAzure","parent":"Azure Resources","content":"","description":""},{"id":165,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HardwareSecurityModules/","title":"HardwareSecurityModules","parent":"Azure Resources","content":"","description":""},{"id":166,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/","title":"HDInsight","parent":"Azure Resources","content":"","description":""},{"id":167,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthBot/","title":"HealthBot","parent":"Azure Resources","content":"","description":""},{"id":168,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthBot/healthBots/","title":"healthBots","parent":"HealthBot","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":169,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/","title":"HealthcareApis","parent":"Azure Resources","content":"","description":""},{"id":170,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/hostGroups/","title":"hostGroups","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":171,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/hostingEnvironments/","title":"hostingEnvironments","parent":"Web","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":172,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/","title":"hostPools","parent":"DesktopVirtualization","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rCreate a validation host pool for testing of planned updates\rMedium\rGovernance\rNo\rVerified\rConfigure host pool scheduled agent updates\rMedium\rGovernance\rNo\rVerified\rEnsure a unique OU is used when deploying host pools with domain joined session hosts\rMedium\rGovernance\rNo\rVerified\rUse Azure Site Recovery or backups to protect VMs supporting personal desktops\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rCreate a validation host pool for testing of planned updates\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate a Validation Pool for early issue detection with planned AVD updates. Adjust limits based on needs. Scale by adding multiple host pools for more users. Regularly test updates on host pools. Validate changes before applying to main environment to avoid downtime. Potential Benefits:\rEnhanced environment stability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure host pool scheduled agent updates\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate maintenance schedules for AVD agent updates to avoid disruptions. Use Scheduled Agent Updates to set maintenance windows for updating Azure Virtual Desktop agent, side-by-side stack, and Geneva Monitoring agent. Potential Benefits:\rEnhanced environment stability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all AVD host pools that does not have scheduled agent updates configured resources | where type =~ \u0026#34;Microsoft.DesktopVirtualization/hostpools\u0026#34; | where isnull(properties.agentUpdate) | project recommendationID = \u0026#34;979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7\u0026#34;, name, id, tags, param1 = \u0026#39;No scheduled agent updates\u0026#39; Ensure a unique OU is used when deploying host pools with domain joined session hosts\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor optimized AVD configuration, place Hybrid VMs in unique OUs. Segregate Prod and DR units for environment-specific settings. This ensures targeted configurations for session hosts, including Fslogix, timeouts, and session controls. Potential Benefits:\rImproved AVD hostpool config \u0026amp; segmentation\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Azure Site Recovery or backups to protect VMs supporting personal desktops\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rImplement Azure Site Recovery (ASR) or Azure Backup for personal host pools to enable seamless failover and failback. This replicates VMs supporting personal desktops to a secondary Azure region, ensuring recovery from a known state in case of a disaster or outage. Potential Benefits:\rEnsures VM recovery \u0026amp; failover\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rCreate a validation host pool for testing of planned updates\rMedium\rGovernance\rNo\rVerified\rConfigure host pool scheduled agent updates\rMedium\rGovernance\rNo\rVerified\rEnsure a unique OU is used when deploying host pools with domain joined session hosts\rMedium\rGovernance\rNo\rVerified\rUse Azure Site Recovery or backups to protect VMs supporting personal desktops\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rCreate a validation host pool for testing of planned updates\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate a Validation Pool for early issue detection with planned AVD updates."},{"id":173,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/images/","title":"images","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":174,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VirtualMachineImages/imageTemplates/","title":"imageTemplates","parent":"VirtualMachineImages","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Generation 2 virtual machine source image\rLow\rHigh Availability\rNo\rVerified\rReplicate your Image Templates to a secondary region\rLow\rDisaster Recovery\rYes\rVerified\rDetails\rUse Generation 2 virtual machine source image\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports \u0026gt;2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1\u0026#39;s BIOS-based architecture. Potential Benefits:\rMore memory, supports \u0026gt;2TB disks, faster boot\rLearn More:\rGeneration 1 vs generation 2 virtual machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Replicate your Image Templates to a secondary region\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe Azure Image Builder service, used for deploying Image Templates, lacks availability zones support. By replicating Image Templates to a secondary, preferably paired, region, quick recovery from a region failure is enabled, ensuring continuous virtual machine deployment from these templates. Potential Benefits:\rEnhances disaster recovery capability\rLearn More:\rImage Template resiliency\rAzure Image Builder Supported Regions\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Image Templates that are not replicated to another region resources | where type =~ \u0026#34;microsoft.virtualmachineimages/imagetemplates\u0026#34; | mv-expand distribution=properties.distribute | where array_length(parse_json(distribution).replicationRegions) == 1 | project recommendationId = \u0026#34;21fb841b-ba70-1f4e-a460-1f72fb41aa51\u0026#34;, name, id, param1=strcat(\u0026#34;replicationRegions:\u0026#34;,parse_json(distribution).replicationRegions) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Generation 2 virtual machine source image\rLow\rHigh Availability\rNo\rVerified\rReplicate your Image Templates to a secondary region\rLow\rDisaster Recovery\rYes\rVerified\rDetails\rUse Generation 2 virtual machine source image\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports \u0026gt;2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1\u0026#39;s BIOS-based architecture."},{"id":175,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/insights/","title":"insights","parent":"Monitor","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":176,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/","title":"Insights","parent":"Azure Resources","content":"","description":""},{"id":177,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/instancePools/","title":"instancePools","parent":"Sql","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":178,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevAI/instances/","title":"instances","parent":"DevAI","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":179,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/integrationServiceEnvironments/","title":"integrationServiceEnvironments","parent":"Logic","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":180,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/IntegrationSpaces/","title":"IntegrationSpaces","parent":"Azure Resources","content":"","description":""},{"id":181,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Devices/iotHubs/","title":"iotHubs","parent":"Devices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDevice Identities are exported to a secondary region\rHigh\rDisaster Recovery\rNo\rPreview\rDo not use free tier\rHigh\rHigh Availability\rYes\rPreview\rUse Availability Zones\rHigh\rHigh Availability\rNo\rPreview\rUse Device Provisioning Service\rHigh\rScalability\rYes\rPreview\rDefine Failover Guidelines\rHigh\rHigh Availability\rNo\rPreview\rDisabled Fallback Route\rLow\rMonitoring and Alerting\rYes\rPreview\rDetails\rDevice Identities are exported to a secondary region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rDevice Identities should be copied to the failover region IoT-Hub for all IoT devices to ensure connectivity in case of a failover. Manual Failover to another region is quicker (RTO), suitable for mission critical workloads. Potential Benefits:\rFaster failover; Ensures device connectivity\rLearn More:\rImport and export IoT Hub device identities in bulk\rIoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Do not use free tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIn a production scenario, the IoT Hub tier should not be Free because the Free tier does not provide the necessary Service Level Agreement. Potential Benefits:\rEnsures SLA for production\rLearn More:\rChoose the right IoT Hub tier and size for your solution\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that are using the Free tier resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; and tostring(sku.tier) =~ \u0026#39;Free\u0026#39; | project recommendationId=\u0026#34;eeba3a49-fef0-481f-a471-7ff01139b474\u0026#34;, name, id, tags, param1=strcat(\u0026#34;tier:\u0026#34;, tostring(sku.tier)) Use Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIn regions supporting Availability Zones for IoT Hub, using these zones boosts availability. They\u0026#39;re automatically activated for new IoT Hubs in supported areas. Potential Benefits:\rBoosts IoT Hub availability\rLearn More:\rAzure IoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Device Provisioning Service\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rDevice Provisioning Service (DPS) enables easy redistribution of IoT devices for scaling and availability, allowing devices to be reassigned and not bound to specific IoT Hub instances. Devices in IoT Hubs using DPS should be verified for DPS utilization. Potential Benefits:\rEnhances scalability and availability\rLearn More:\rIoT Hub Device Provisioning Service (DPS) terminology\rBest practices for large-scale IoT device deployments\rIoT Hub Device Provisioning Service high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that do not have a linked IoT Hub Device Provisioning Service (DPS) resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; | project id, iotHubName=tostring(properties.hostName), tags, resourceGroup | join kind=fullouter ( resources | where type == \u0026#34;microsoft.devices/provisioningservices\u0026#34; | mv-expand iotHubs=properties.iotHubs | project iotHubName = tostring(iotHubs.name), dpsName = name, name=iotHubs.name ) on iotHubName | where dpsName == \u0026#39;\u0026#39; | project recommendationId=\u0026#34;b1e1378d-4572-4414-bebd-b8872a6d4d1c\u0026#34;, name=iotHubName, id, tags, param1=\u0026#39;DPS:none\u0026#39; Define Failover Guidelines\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIn case of a regional failure, an IoT Hub can failover to a second region, automatically or manually, to ensure your application continues working. Potential Benefits:\rEnsures business continuity\rLearn More:\rIoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Disabled Fallback Route\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUsing message routing for custom endpoints in IoT Hub, messages might not reach these destinations if specific conditions are unmet. A default route ensures all messages are received, but disabling this safety net risks leaving some messages undelivered. Potential Benefits:\rPrevents undelivered messages\rLearn More:\rUse message routing - Fallback route\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that have the fallback route disabled resources | where type == \u0026#34;microsoft.devices/iothubs\u0026#34; | extend fallbackEnabled=properties.routing.fallbackRoute.isEnabled | where fallbackEnabled == false | project recommendationId=\u0026#34;e7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e\u0026#34;, name, id, tags, param1=\u0026#39;FallbackRouteEnabled:false\u0026#39; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDevice Identities are exported to a secondary region\rHigh\rDisaster Recovery\rNo\rPreview\rDo not use free tier\rHigh\rHigh Availability\rYes\rPreview\rUse Availability Zones\rHigh\rHigh Availability\rNo\rPreview\rUse Device Provisioning Service\rHigh\rScalability\rYes\rPreview\rDefine Failover Guidelines\rHigh\rHigh Availability\rNo\rPreview\rDisabled Fallback Route\rLow\rMonitoring and Alerting\rYes\rPreview\rDetails\rDevice Identities are exported to a secondary region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rDevice Identities should be copied to the failover region IoT-Hub for all IoT devices to ensure connectivity in case of a failover."},{"id":182,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBox/jobs/","title":"jobs","parent":"DataBox","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":183,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/","title":"KeyVault","parent":"Azure Resources","content":"","description":""},{"id":184,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/kubernetesClusters/","title":"kubernetesClusters","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":185,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Kusto/","title":"Kusto","parent":"Azure Resources","content":"","description":""},{"id":186,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/l2Connections/","title":"l2Connections","parent":"Orbital","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":187,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/l3Networks/","title":"l3Networks","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":188,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevTestLab/labs/","title":"labs","parent":"DevTestLab","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":189,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/loadBalancers/","title":"loadBalancers","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Standard Load Balancer SKU\rHigh\rHigh Availability\rYes\rVerified\rEnsure the Backend Pool contains at least two instances\rHigh\rHigh Availability\rYes\rVerified\rUse NAT Gateway instead of Outbound Rules for Production Workloads\rMedium\rHigh Availability\rYes\rVerified\rEnsure Standard Load Balancer is zone-redundant\rHigh\rHigh Availability\rYes\rVerified\rUse Health Probes to detect backend instances availability\rHigh\rMonitoring and Alerting\rYes\rVerified\rDetails\rUse Standard Load Balancer SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSelecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures. Unlike Basic, it supports global load balancing and offers an SLA. Potential Benefits:\rEnhanced reliability and SLA support\rLearn More:\rReliability and Azure Load Balancer\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers using Basic SKU resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | where sku.name == \u0026#39;Basic\u0026#39; | project recommendationId = \u0026#34;38c3bca1-97a1-eb42-8cd3-838b243f35ba\u0026#34;, name, id, tags, Param1=strcat(\u0026#34;sku-tier: basic\u0026#34;) Ensure the Backend Pool contains at least two instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDeploying Azure Load Balancers with at least two instances in the backend prevents a single point of failure and supports scalability. Pairing with Virtual Machine Scale Sets is advised for optimal scale building. Potential Benefits:\rEnhances reliability and scalability\rLearn More:\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers which only have 1 backend pool defined or only 1 VM in the backend pool resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend bep = properties.backendAddressPools | extend BackEndPools = array_length(bep) | where BackEndPools == 0 | project recommendationId = \u0026#34;6d82d042-6d61-ad49-86f0-6a5455398081\u0026#34;, name, id, Param1=BackEndPools, Param2=0, tags | union (resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend bep = properties.backendAddressPools | extend BackEndPools = array_length(bep) | mv-expand bip = properties.backendAddressPools | extend BackendAddresses = array_length(bip.properties.loadBalancerBackendAddresses) | where BackendAddresses \u0026lt;= 1 | project recommendationId = \u0026#34;6d82d042-6d61-ad49-86f0-6a5455398081\u0026#34;, name, id, tags, Param1=BackEndPools, Param2=BackendAddresses) Use NAT Gateway instead of Outbound Rules for Production Workloads\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rOutbound rules for Standard Public Load Balancer involve manual port allocation for backend pools, limiting scalability and risk of SNAT port exhaustion. NAT Gateway is recommended for its dynamic scaling and secure internet connectivity. Potential Benefits:\rEnhanced scalability and reliability\rLearn More:\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers with Outbound rules configured resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend outboundRules = array_length(properties.outboundRules) | where outboundRules \u0026gt; 0 | project recommendationId = \u0026#34;8d319a05-677b-944f-b9b4-ca0fb42e883c\u0026#34;, name, id, tags, Param1 = \u0026#34;outboundRules: \u0026gt;=1\u0026#34; Ensure Standard Load Balancer is zone-redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIn regions with Availability Zones, assigning a zone-redundant frontend IP to a Standard Load Balancer ensures continuous traffic distribution even if one availability zone fails, provided other healthy zones and backend instances are available to receive the traffic. Potential Benefits:\rEnhances uptime and resilience\rLearn More:\rLoad Balancer and Availability Zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers with with regional or zonal public IP Addresses resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PrivateSubnetId = toupper(feIPconfigs.properties.subnet.id), PrivateIPZones = feIPconfigs.zones, PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PrivateSubnetId) | where isnull(PrivateIPZones) or array_length(PrivateIPZones) \u0026lt; 2 | project name, feConfigName, id | union (resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PIPid) | join kind=innerunique ( resources | where type == \u0026#34;microsoft.network/publicipaddresses\u0026#34; | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend LBid = toupper(substring(properties.ipConfiguration.id, 0, indexof(properties.ipConfiguration.id, \u0026#39;/frontendIPConfigurations\u0026#39;))), InnerID = toupper(id) ) on $left.PIPid == $right.InnerID) | project recommendationId = \u0026#34;621dbc78-3745-4d32-8eac-9e65b27b7512\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Frontend IP Configuration:\u0026#34;, \u0026#34; \u0026#34;, feConfigName) Use Health Probes to detect backend instances availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHealth probes are used by Azure Load Balancers to determine the status of backend endpoints. Using custom health probes that are aligned with vendor recommendations enhances understanding of backend availability and facilitates monitoring of backend services for any impact. Potential Benefits:\rEnsures backend uptime monitoring.\rLearn More:\rLoad Balancer Health Probe Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List the load balancers which don\u0026#39;t have health probe configured resources | where type =~ \u0026#34;microsoft.network/loadbalancers\u0026#34; | where array_length(properties.probes) == 0 | project recommendationId=\u0026#34;e5f5fcea-f925-4578-8599-9a391e888a60\u0026#34;, name, id, tags, param1=\u0026#34;customHealthProbeUsed: false\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Standard Load Balancer SKU\rHigh\rHigh Availability\rYes\rVerified\rEnsure the Backend Pool contains at least two instances\rHigh\rHigh Availability\rYes\rVerified\rUse NAT Gateway instead of Outbound Rules for Production Workloads\rMedium\rHigh Availability\rYes\rVerified\rEnsure Standard Load Balancer is zone-redundant\rHigh\rHigh Availability\rYes\rVerified\rUse Health Probes to detect backend instances availability\rHigh\rMonitoring and Alerting\rYes\rVerified\rDetails\rUse Standard Load Balancer SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSelecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures."},{"id":190,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/localNetworkGateways/","title":"localNetworkGateways","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":191,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/locks/","title":"locks","parent":"Authorization","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":192,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/","title":"Logic","parent":"Azure Resources","content":"","description":""},{"id":193,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/","title":"MachineLearning","parent":"Azure Resources","content":"","description":""},{"id":194,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/","title":"MachineLearningServices","parent":"Azure Resources","content":"","description":""},{"id":195,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maintenance/","title":"Maintenance","parent":"Azure Resources","content":"","description":""},{"id":196,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maintenance/maintenanceConfigurations/","title":"maintenanceConfigurations","parent":"Maintenance","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":197,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/managedClusters/","title":"managedClusters","parent":"ContainerService","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy AKS cluster across availability zones\rHigh\rHigh Availability\rYes\rVerified\rIsolate system and application pods\rHigh\rHigh Availability\rYes\rPreview\rDisable local accounts\rHigh\rSecurity\rYes\rPreview\rConfigure Azure CNI networking for dynamic allocation of IPs\rMedium\rScalability\rYes\rPreview\rEnable the cluster auto-scaler on an existing cluster\rHigh\rScalability\rYes\rVerified\rBack up Azure Kubernetes Service\rLow\rDisaster Recovery\rYes\rVerified\rPlan an AKS version upgrade\rHigh\rService Upgrade and Retirement\rNo\rPreview\rUse zone-redundant storage for persistent volumes when running multi-zone AKS\rMedium\rHigh Availability\rNo\rVerified\rUpgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rHigh\rGovernance\rNo\rVerified\rImplement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits\rLow\rScalability\rNo\rPreview\rAttach Virtual Nodes (ACI) to the AKS cluster\rLow\rScalability\rNo\rPreview\rUpdate AKS tier to Standard\rHigh\rHigh Availability\rYes\rVerified\rEnable AKS Monitoring\rHigh\rMonitoring and Alerting\rYes\rVerified\rUse Ephemeral OS disks on AKS clusters\rMedium\rScalability\rYes\rVerified\rEnable and remediate Azure Policies configured for AKS\rLow\rGovernance\rYes\rPreview\rEnable GitOps when using DevOps frameworks\rLow\rOther Best Practices\rYes\rPreview\rUse pod topology spread constraints to ensure that pods are spread across different nodes or zones\rHigh\rHigh Availability\rNo\rVerified\rConfigures Pods Liveness, Readiness, and Startup Probes\rHigh\rHigh Availability\rNo\rVerified\rUse deployments with multiple replicas in production applications to guarantee availability\rHigh\rHigh Availability\rNo\rVerified\rConfigure system nodepool count\rHigh\rHigh Availability\rYes\rVerified\rConfigure user nodepool count\rHigh\rHigh Availability\rYes\rVerified\rConfigure pod disruption budgets (PDBs)\rMedium\rHigh Availability\rNo\rVerified\rNodepool subnet size needs to accommodate maximum auto-scale settings\rHigh\rHigh Availability\rYes\rPreview\rNode pool auto-scale settings should not exceed subscription core quota\rHigh\rHigh Availability\rNo\rPreview\rDetails\rDeploy AKS cluster across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures. Potential Benefits:\rEnhanced fault tolerance for AKS\rLearn More:\rAKS Availability Zones\rZone Balancing\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns AKS clusters that do not have any availability zones enabled or only use a single zone resources | where type =~ \u0026#34;Microsoft.ContainerService/managedClusters\u0026#34; | project id, name, tags, location, pools = properties.agentPoolProfiles | mv-expand pool = pools | extend numOfAvailabilityZones = iif(isnull(pool.availabilityZones), 0, array_length(pool.availabilityZones)) | where numOfAvailabilityZones \u0026lt; 2 | project recommendationId = \u0026#34;4f63619f-5001-439c-bacb-8de891287727\u0026#34;, id, name, tags, param1 = strcat(\u0026#34;NodePoolName: \u0026#34;, pool.name), param2 = strcat(\u0026#34;Mode: \u0026#34;, pool.mode), param3 = strcat(\u0026#34;AvailabilityZones: \u0026#34;, iif(numOfAvailabilityZones == 0, \u0026#34;None\u0026#34;, strcat(\u0026#34;Zone \u0026#34;, strcat_array(pool.availabilityZones, \u0026#34;, \u0026#34;)))), param4 = strcat(\u0026#34;Location: \u0026#34;, location) Isolate system and application pods\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIsolate system node so that user workload does not run on system node. This can be done by 1) assigning taint to worker load, 2)labeling worker node with CriticalAddonsOnly or 3)configuring taint as CriticalAddonsOnly. Note: System node has label kubernetes.azure.com/mode: system) Potential Benefits:\rEnhanced reliability via pod isolation\rLearn More:\rSystem and user node pools\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that do not have system pods labelled with CriticalAddonsOnly resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | where agentPoolProfile.mode =~ \u0026#39;System\u0026#39; // system node pools | extend taint = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend hasCriticalAddonsTaint = agentPoolProfile.kubeletConfig has \u0026#39;CriticalAddonsOnly\u0026#39; | extend hasNodeLabel = agentPoolProfile.customNodeLabels has \u0026#39;CriticalAddonsOnly\u0026#39; | extend hasCriticalAddonsOnly = hasCriticalAddonsTaint or hasNodeLabel or isempty(taint) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where hasCriticalAddonsOnly | project recommendationid=\u0026#34;5ee083cd-6ac3-4a83-8913-9549dd36cf56\u0026#34;, id, name, tags, param1=strcat(\u0026#34;nodepoolName: \u0026#34;, nodePool) Disable local accounts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rLocal Kubernetes accounts in AKS, being non-auditable and legacy, are discouraged. Microsoft Entra\u0026#39;s integration offers centralized management, multi-factor authentication, RBAC for detailed access, and a secure, scalable authentication system compatible with Azure and external identity providers. Potential Benefits:\rEnhanced security and access control\rLearn More:\rEntra integration\rUse Azure role-based access control for AKS\rManage AKS local accounts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns a list of AKS clusters not using AAD enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend aadProfile = tostring (parse_json(properties.aadProfile)) | extend disablelocalAdmin = tostring(parse_json(properties.disableLocalAccounts)) | extend RBAC = tostring(parse_json(properties.enableRBAC)) | where RBAC == \u0026#34;false\u0026#34; | project recommendationId=\u0026#34;ca324d71-54b0-4a3e-b9e4-10e767daa9fc\u0026#34;, name, id, tags, param1=strcat(\u0026#34;aadProfile: \u0026#34;, aadProfile), param2=strcat(\u0026#34;disablelocalAdmin: \u0026#34;,disablelocalAdmin), param3=strcat(\u0026#34;RBAC: \u0026#34;, RBAC) Configure Azure CNI networking for dynamic allocation of IPs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure CNI enhances cluster IP and network management, allowing dynamic IP allocation, scalable subnets, direct pod-VNET connectivity, and supports diverse network policies for pods and nodes with Azure Network Policies and Calico, optimizing network efficiency and security Potential Benefits:\rDynamic IP allocation, scalable subnets, direct VNET access\rLearn More:\rConfigure Azure CNI networking\rConfigure Azure CNI Overlay networking\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Check AKS Clusters using kubenet network profile resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend networkProfile = tostring (parse_json(properties.networkProfile.networkPlugin)) | where networkProfile ==\u0026#34;kubenet\u0026#34; | project recommendationId=\u0026#34;c22db132-399b-4e7c-995d-577a60881be8\u0026#34;, name, id, tags, param1=strcat(\u0026#34;networkProfile :\u0026#34;,networkProfile) Enable the cluster auto-scaler on an existing cluster\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe cluster auto-scaler in AKS adjusts node counts based on pod resource needs and available capacity, enabling scaling as per demand to prevent outages. Potential Benefits:\rOptimizes scaling and prevents outages\rLearn More:\rUse the Cluster Autoscaler on AKS\rBest practices for advanced scheduler features\rNode pool scaling considerations and best practices\rBest practices for basic scheduler features\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find AKS clusters with auto-scaling disabled Resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend autoScaling = tostring (parse_json(properties.agentPoolProfiles.[0].enableAutoScaling)) | where autoScaling == \u0026#34;false\u0026#34; | project recommendationId=\u0026#34;902c82ff-4910-4b61-942d-0d6ef7f39b67\u0026#34;, name, id, tags, param1=strcat(\u0026#34;autoScaling :\u0026#34;, autoScaling) Back up Azure Kubernetes Service\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAKS, popular for stateful apps needing backups, can now use Azure Backup to secure clusters and attached volumes through an installed Backup Extension, enabling backup and restore operations via a Backup Vault. Potential Benefits:\rEnsures data safety for AKS\rLearn More:\rAKS Backups\rBest Practices for AKS Backups\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find AKS clusters that do not have backup enabled resources | where type =~ \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | extend lname = tolower(name) | join kind=leftouter(recoveryservicesresources | where type =~ \u0026#39;microsoft.dataprotection/backupvaults/backupinstances\u0026#39; | extend lname = tolower(tostring(split(properties.dataSourceInfo.resourceID, \u0026#39;/\u0026#39;)[8])) | extend protectionState = properties.currentProtectionState | project lname, protectionState) on lname | where protectionState != \u0026#39;ProtectionConfigured\u0026#39; | extend param1 = iif(isnull(protectionState), \u0026#39;Protection Not Configured\u0026#39;, strcat(\u0026#39;Protection State: \u0026#39;, protectionState)) | project recommendationID = \u0026#34;269a9f1a-6675-460a-831e-b05a887a8c4b\u0026#34;, name, id, tags, param1 Plan an AKS version upgrade\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rMinor version releases bring new features and improvements. Patch releases, often weekly, focus on critical bug fixes within a minor version, including security vulnerabilities or major bugs. Unsupported Kubernetes versions may lead to unsupported clusters when seeking AKS support. Potential Benefits:\rEnhances features, fixes bugs, ensures support\rLearn More:\rUpdating to the latest AKS version\rUpgrade cluster\rAuto-upgrading cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use zone-redundant storage for persistent volumes when running multi-zone AKS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rZRS ensures data replication across three zones, protecting against zonal outages. It\u0026#39;s available for Azure Disks, Container Storage, Files, and Blob by setting the SKU to ZRS in storage classes, enhancing multi-zone AKS clusters from v1.29. Potential Benefits:\rIncreases data durability and availability\rLearn More:\rAvailability zones overview\rZone-redundant storage\rZRS disks\rConvert a disk from LRS to ZRS\rEnable multi-zone storage redundancy in Azure Container Storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Upgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFrom Kubernetes 1.26, Azure Disk and Azure File in-tree drivers are deprecated in favor of CSI drivers. Existing deployments remain operational but untested; users should switch to CSI drivers for new features and SKUs. Potential Benefits:\rEnsures future compatibility\rLearn More:\rCSI Storage Drivers\rCSI Migrate in Tree Volumes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Implement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rA ResourceQuota object sets limits on resource use per namespace, controlling the number and type of objects created, and the total compute resources available. Potential Benefits:\rLimits AKS resource usage per namespace\rLearn More:\rResource Quotas\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Attach Virtual Nodes (ACI) to the AKS cluster\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rTo rapidly scale AKS workloads, utilize virtual nodes for quick pod provisioning, unlike Kubernetes auto-scaler. For clusters with availability zones, ensure one nodepool per AZ due to persistent volumes not working across AZs, preventing auto-scaler pod creation failures if lacking access. Potential Benefits:\rFaster scaling with virtual nodes\rLearn More:\rVirtual Nodes\rAzure Container Instances\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Update AKS tier to Standard\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProduction AKS clusters require the Standard tier for a financially backed SLA and enhanced node scalability, as the free service lacks these features. Potential Benefits:\rSLA guarantee and better scalability\rLearn More:\rPricing Tiers\rAKS Baseline Architecture\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns all AKS clusters not running on the Standard tier resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | where sku.tier != \u0026#34;Standard\u0026#34; | project recommendationId=\u0026#34;0611251f-e70f-4243-8ddd-cfe894bec2e7\u0026#34;, id, name, tags, param1=strcat(\u0026#34;skuName: \u0026#34;, sku.name), param2=strcat(\u0026#34;skuTier: \u0026#34;, sku.tier) Enable AKS Monitoring\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Monitor enables real-time health and performance insights for AKS by collecting events, capturing container logs, and gathering CPU/Memory data from the Metrics API. It allows data visualization using Azure Monitor Container Insights, Prometheus, Grafana, or others. Potential Benefits:\rReal-time AKS health/performance insights\rLearn More:\rMonitor AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns AKS clusters where either Azure Monitor is not enabled and/or Container Insights is not enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend azureMonitor = tostring(parse_json(properties.azureMonitorProfile.metrics.enabled)) | extend insights = tostring(parse_json(properties.addonProfiles.omsagent.enabled)) | where isempty(azureMonitor) or isempty(insights) | project recommendationId=\u0026#34;dcaf8128-94bd-4d53-9235-3a0371df6b74\u0026#34;,id, name, tags, param1=strcat(\u0026#34;azureMonitorProfileEnabled: \u0026#34;, iff(isempty(azureMonitor), \u0026#34;false\u0026#34;, azureMonitor)), param2=strcat(\u0026#34;containerInsightsEnabled: \u0026#34;, iff(isempty(insights), \u0026#34;false\u0026#34;, insights)) Use Ephemeral OS disks on AKS clusters\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEphemeral OS disks on AKS offer lower read/write latency due to local attachment, eliminating the need for replication seen with managed disks. This enhances performance and speeds up cluster operations such as scaling or upgrading due to quicker re-imaging and boot times. Potential Benefits:\rLower latency, faster re-imaging and booting\rLearn More:\rEphemeral OS disk\rConfigure an AKS cluster\rEverything you want to know about ephemeral OS disks and AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns any AKS cluster nodepools that do not have Ephemeral Disks resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend type = tostring(agentPoolProfile.osDiskType) | where type != \u0026#39;Ephemeral\u0026#39; | project recommendationid=\u0026#34;a7bfcc18-b0d8-4d37-81f3-8131ed8bead5\u0026#34;, name, id, param1=strcat(\u0026#34;osDiskType: \u0026#34;, type) Enable and remediate Azure Policies configured for AKS\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Policies in AKS clusters help enforce governance best practices concerning security, authentication, provisioning, networking, and more, ensuring a robust and secure environment for operations. Potential Benefits:\rEnhanced AKS governance and security\rLearn More:\rAKS Baseline - Policy Management\rBuilt-in Policy Definitions for AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns a count of non-compliant policy items per AKS cluster PolicyResources | where type =~ \u0026#39;Microsoft.PolicyInsights/PolicyStates\u0026#39; | extend complianceState = tostring(properties.complianceState) | where complianceState == \u0026#39;NonCompliant\u0026#39; | where properties.resourceType == \u0026#39;microsoft.containerservice/managedclusters\u0026#39; or properties.resourceType == \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | extend id = tostring(properties.resourceId) | summarize count() by id | project recommendationId=\u0026#34;26ebaf1f-c70d-4ebd-8641-4b60a0ce0094\u0026#34;, name, id, param1=strcat(\u0026#34;numNonCompliantAlerts: \u0026#34;, count_) Enable GitOps when using DevOps frameworks\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rGitOps, an operating model for cloud-native apps, uses Git for storing application and infrastructure code as a source of truth for continuous delivery. Potential Benefits:\rEnsures AKS config consistency\rLearn More:\rGitOps with AKS\rGitOps for AKS - Reference Architecture\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns AKS clusters where GitOps is not enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend gitops = tostring (parse_json(properties.addOnProfiles.gitops.enabled)) | where isempty(gitops) | project recommendationId=\u0026#34;5f3cbd68-692a-4121-988c-9770914859a9\u0026#34;, id, name, tags, param1=strcat(\u0026#34;gitopsEnabled: \u0026#34;, \u0026#34;false\u0026#34;) Use pod topology spread constraints to ensure that pods are spread across different nodes or zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnhance availability and reliability by using pod topology spread constraints to control pod distribution based on node or zone topology, ensuring pods are spread across your cluster. Potential Benefits:\rEnsures high availability and efficient use\rLearn More:\rTopology Spread Constraints\rAssign Pod Node\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configures Pods Liveness, Readiness, and Startup Probes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAKS kubelet controller uses liveness probes to validate containers and applications health, ensuring the system knows when to restart a container based on its health status. Potential Benefits:\rEnhances container health monitoring\rLearn More:\rConfigure probes\rAssign Pod Node\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use deployments with multiple replicas in production applications to guarantee availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfiguring multiple replicas in Pod or Deployment manifests stabilizes the number of replica Pods, ensuring that a specified number of identical Pods are always available, thereby guaranteeing their availability. Potential Benefits:\rEnsures stable pod availability\rLearn More:\rReplica Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure system nodepool count\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe system node pool should be configured with a minimum node count of two to ensure critical system pods are resilient to node outages. Potential Benefits:\rEnsures pod resilience\rLearn More:\rSystem nodepools\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have system nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationid=\u0026#34;7f7ae535-a5ba-4665-b7e0-c451dbdda01f\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) Configure user nodepool count\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfiguring the user node pool with at least two nodes is essential for applications needing high availability, ensuring they remain operational and accessible without interruption. Potential Benefits:\rEnsures high app availability\rLearn More:\rAzure Well-Architected Framework review for Azure Kubernetes Service (AKS)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have user nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints !has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationid=\u0026#34;005ccbbd-aeab-46ef-80bd-9bd4479412ec\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) Configure pod disruption budgets (PDBs)\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA Pod Disruption Budget is a Kubernetes resource configuring the minimum number or percentage of pods that should remain available during disruptions like maintenance or scaling, ensuring a minimum number of pods are always available in the cluster. Potential Benefits:\rEnsures cluster resiliency during disruptions\rLearn More:\rConfigure PDBs\rPlan availability using PDBs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Nodepool subnet size needs to accommodate maximum auto-scale settings\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rNodepool subnets sized for max auto-scale settings enable AKS to efficiently scale out nodes, meeting increased demand while reducing resource constraints and potential service disruptions. Potential Benefits:\rEfficient scaling, reduced disruptions\rLearn More:\rAzure CNI Dynamic IP Allocation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have user nodepools with a subnetmask that does not match autoscale configured max-nodes // Subtracting the network address, broadcast address, and default 3 addresses Azure reserves within each subnet resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend nodePools = properties[\u0026#39;agentPoolProfiles\u0026#39;] | mv-expand nodePools = properties.agentPoolProfiles | where nodePools.enableAutoScaling == true | extend nodePoolName=nodePools.name, maxNodes = nodePools.maxCount, subnetId = tostring(nodePools.vnetSubnetID) | project clusterId = id, clusterName=name, nodePoolName=nodePools.name, toint(maxNodes), subnetId | join kind = leftouter ( resources | where type == \u0026#39;microsoft.network/virtualnetworks\u0026#39; | extend subnets = properties.subnets | mv-expand subnets | project id = tostring(subnets.id), addressPrefix = tostring(subnets.properties[\u0026#39;addressPrefix\u0026#39;]) | extend subnetmask = toint(substring(addressPrefix, indexof(addressPrefix, \u0026#39;/\u0026#39;)+1, string_size(addressPrefix))) | extend possibleMaxNodeCount = toint(exp2(32-subnetmask) - 5) ) on $left.subnetId == $right.id | project-away id, subnetmask | where possibleMaxNodeCount \u0026lt;= maxNodes | extend param1 = strcat(nodePoolName, \u0026#34; autoscaler upper limit: \u0026#34;, maxNodes) | extend param2 = strcat(\u0026#34;ip addresses on subnet: \u0026#34;, possibleMaxNodeCount) | project recommendationId=\u0026#34;e620fa98-7a40-41a0-bfc9-b4407297fb58\u0026#34;, name=clusterName, id=clusterId, param1, param2 Node pool auto-scale settings should not exceed subscription core quota\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rNode pool settings should not exceed the subscription core quota to ensure AKS can scale out nodes efficiently, meeting increased demand while reducing resource constraints and potential service disruptions. Potential Benefits:\rReduced disruptions\rLearn More:\rAzure Quotas\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy AKS cluster across availability zones\rHigh\rHigh Availability\rYes\rVerified\rIsolate system and application pods\rHigh\rHigh Availability\rYes\rPreview\rDisable local accounts\rHigh\rSecurity\rYes\rPreview\rConfigure Azure CNI networking for dynamic allocation of IPs\rMedium\rScalability\rYes\rPreview\rEnable the cluster auto-scaler on an existing cluster\rHigh\rScalability\rYes\rVerified\rBack up Azure Kubernetes Service\rLow\rDisaster Recovery\rYes\rVerified\rPlan an AKS version upgrade\rHigh\rService Upgrade and Retirement\rNo\rPreview\rUse zone-redundant storage for persistent volumes when running multi-zone AKS\rMedium\rHigh Availability\rNo\rVerified\rUpgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rHigh\rGovernance\rNo\rVerified\rImplement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits\rLow\rScalability\rNo\rPreview\rAttach Virtual Nodes (ACI) to the AKS cluster\rLow\rScalability\rNo\rPreview\rUpdate AKS tier to Standard\rHigh\rHigh Availability\rYes\rVerified\rEnable AKS Monitoring\rHigh\rMonitoring and Alerting\rYes\rVerified\rUse Ephemeral OS disks on AKS clusters\rMedium\rScalability\rYes\rVerified\rEnable and remediate Azure Policies configured for AKS\rLow\rGovernance\rYes\rPreview\rEnable GitOps when using DevOps frameworks\rLow\rOther Best Practices\rYes\rPreview\rUse pod topology spread constraints to ensure that pods are spread across different nodes or zones\rHigh\rHigh Availability\rNo\rVerified\rConfigures Pods Liveness, Readiness, and Startup Probes\rHigh\rHigh Availability\rNo\rVerified\rUse deployments with multiple replicas in production applications to guarantee availability\rHigh\rHigh Availability\rNo\rVerified\rConfigure system nodepool count\rHigh\rHigh Availability\rYes\rVerified\rConfigure user nodepool count\rHigh\rHigh Availability\rYes\rVerified\rConfigure pod disruption budgets (PDBs)\rMedium\rHigh Availability\rNo\rVerified\rNodepool subnet size needs to accommodate maximum auto-scale settings\rHigh\rHigh Availability\rYes\rPreview\rNode pool auto-scale settings should not exceed subscription core quota\rHigh\rHigh Availability\rNo\rPreview\rDetails\rDeploy AKS cluster across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures."},{"id":198,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/managedClusters/","title":"managedClusters","parent":"ServiceFabric","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":199,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/managedEnvironments/","title":"managedEnvironments","parent":"App","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":200,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/managedHSMs/","title":"managedHSMs","parent":"KeyVault","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":201,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/managedInstances/","title":"managedInstances","parent":"Sql","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":202,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/","title":"Management","parent":"Azure Resources","content":"","description":""},{"id":203,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/managementGroups/","title":"managementGroups","parent":"Management","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":204,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maps/","title":"Maps","parent":"Azure Resources","content":"","description":""},{"id":205,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Media/","title":"Media","parent":"Azure Resources","content":"","description":""},{"id":206,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Media/mediaServices/","title":"mediaServices","parent":"Media","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":207,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/meshVpns/","title":"meshVpns","parent":"NetworkFunction","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":208,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/metricAlerts/","title":"metricAlerts","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":209,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/","title":"MixedReality","parent":"Azure Resources","content":"","description":""},{"id":210,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/mongoClusters/","title":"mongoClusters","parent":"DocumentDB","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":211,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/","title":"Monitor","parent":"Azure Resources","content":"","description":""},{"id":212,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Elastic/monitors/","title":"monitors","parent":"Elastic","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":213,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/namespaces/","title":"namespaces","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":214,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/namespaces/","title":"namespaces","parent":"EventHub","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable auto-inflate on Event Hub Standard tier\rHigh\rScalability\rYes\rPreview\rDetails\rEnable auto-inflate on Event Hub Standard tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnable auto-inflate on Event Hub Standard tier namespaces to automatically scale up TUs, meeting usage needs and preventing data ingress or egress throttle scenarios by adjusting to allowed rates. Potential Benefits:\rPrevents throttling by autoscaling TUs\rLearn More:\rAzure Event Hubs - Automatically scale throughput units\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Event Hub namespace instances that are Standard tier and do not have Auto Inflate enabled resources | where type == \u0026#34;microsoft.eventhub/namespaces\u0026#34; | where sku.tier == \u0026#34;Standard\u0026#34; | where properties.isAutoInflateEnabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;fbfef3df-04a5-41b2-a8fd-b8541eb04956\u0026#34;, name, id, tags, param1 = \u0026#34;AutoInflateEnabled: False\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable auto-inflate on Event Hub Standard tier\rHigh\rScalability\rYes\rPreview\rDetails\rEnable auto-inflate on Event Hub Standard tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnable auto-inflate on Event Hub Standard tier namespaces to automatically scale up TUs, meeting usage needs and preventing data ingress or egress throttle scenarios by adjusting to allowed rates. Potential Benefits:\rPrevents throttling by autoscaling TUs\rLearn More:\rAzure Event Hubs - Automatically scale throughput units\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":215,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NotificationHubs/namespaces/","title":"namespaces","parent":"NotificationHubs","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":216,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Relay/namespaces/","title":"namespaces","parent":"Relay","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":217,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceBus/namespaces/","title":"namespaces","parent":"ServiceBus","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable Availability Zones for Service Bus namespaces\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable Availability Zones for Service Bus namespaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse Service Bus with zone redundancy for high availability. The Premium SKU supports availability zones, ensuring isolations within the same region. It manages 3 copies of the messaging store, kept in sync. Potential Benefits:\rEnhances fault tolerance and uptime\rLearn More:\rService Bus and reliability\rAzure Service Bus Geo-disaster recovery\rInsulate Azure Service Bus applications against outages and disasters\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns Service Bus namespaces that do not have any availability zones enabled resources | where type =~ \u0026#39;Microsoft.ServiceBus/namespaces\u0026#39; | where properties.zoneRedundant == \u0026#39;false\u0026#39; | project recommendationId = \u0026#34;20057905-262c-49fe-a9be-49f423afb359\u0026#34;, name, id, tags, param1=strcat(\u0026#34;zoneRedundant: \u0026#34;, properties.zoneRedundant), param2=strcat(\u0026#34;SKU: \u0026#34;, sku.name), param3=iff(tolower(sku.name) == \u0026#39;premium\u0026#39;, \u0026#39;Move Service Bus namespace to a region that supports Availability Zones\u0026#39;, \u0026#39;Migrate to Premium SKU in a region that supports Availability Zones\u0026#39;) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable Availability Zones for Service Bus namespaces\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable Availability Zones for Service Bus namespaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse Service Bus with zone redundancy for high availability. The Premium SKU supports availability zones, ensuring isolations within the same region. It manages 3 copies of the messaging store, kept in sync. Potential Benefits:\rEnhances fault tolerance and uptime\rLearn More:\rService Bus and reliability\rAzure Service Bus Geo-disaster recovery\rInsulate Azure Service Bus applications against outages and disasters\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":218,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/natGateways/","title":"natGateways","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":219,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetApp/","title":"NetApp","parent":"Azure Resources","content":"","description":""},{"id":220,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetApp/netAppAccounts/","title":"netAppAccounts","parent":"NetApp","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse the correct service level and volume quota size for the expected performance level\rMedium\rScalability\rNo\rVerified\rUse standard network features for production in Azure NetApp Files\rHigh\rGovernance\rYes\rVerified\rUse availability zones for high availability in Azure NetApp Files\rHigh\rHigh Availability\rYes\rVerified\rDeploy ANF volumes in the same availability zone with Azure compute and other services\rHigh\rOther Best Practices\rNo\rVerified\rUse snapshots for data protection in Azure NetApp Files\rHigh\rHigh Availability\rYes\rVerified\rEnable backup for data protection in Azure NetApp Files\rHigh\rDisaster Recovery\rYes\rVerified\rEnable Cross-region replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rVerified\rEnable Cross-zone replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rVerified\rMonitor Azure NetApp Files metrics to better understand usage pattern and performance\rMedium\rMonitoring and Alerting\rNo\rVerified\rEnforce standards and assess compliance in Azure NetApp Files with Azure policy\rMedium\rGovernance\rNo\rVerified\rRestrict default access to Azure NetApp Files volumes\rMedium\rSecurity\rNo\rVerified\rMake use of SMB continuous availability for supported applications\rMedium\rHigh Availability\rNo\rVerified\rEnsure application resilience for service maintenance events\rMedium\rHigh Availability\rNo\rVerified\rDetails\rUse the correct service level and volume quota size for the expected performance level\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rService levels, part of capacity pool attributes, determine the maximum throughput per volume quota in Azure NetApp Files. It combines read and write speed, offering three levels: Standard (16 MiB/s per 1TiB), Premium (64 MiB/s per 1TiB), and Ultra (128 MiB/s per 1TiB) throughput. Potential Benefits:\rOptimized performance and cost efficiency\rLearn More:\rService levels for Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use standard network features for production in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rStandard network feature in Azure NetApp Files enhances IP limits and VNet capabilities, including network security groups, user-defined routes on subnets, and diverse connectivity options. Potential Benefits:\rEnhanced connectivity and security\rLearn More:\rGuidelines for Azure NetApp Files network planning | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without standard network features. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.networkFeatures != \u0026#34;Standard\u0026#34; | project recommendationId = \u0026#34;ab984130-c57b-6c4a-8d04-6723b4e1bdb6\u0026#34;, name, id, tags Use availability zones for high availability in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAvailability zones are distinct locations within an Azure region to withstand local failures. Deploy your workload in multiple availability zones and use application-based replication and failover technologies or consider using Azure NetApp Files cross-zone replication to achieve high availability. Potential Benefits:\rHigh Availability across availability zones\rLearn More:\rUse availability zones for high availability in Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without an availability zone defined. Resources | where type =~ \u0026#34;Microsoft.NetApp/netAppAccounts/capacityPools/volumes\u0026#34; | where array_length(zones) == 0 or isnull(zones) | project recommendationId = \u0026#34;47d100a5-7f85-5742-967a-67eb5081240a\u0026#34;, name, id, tags Deploy ANF volumes in the same availability zone with Azure compute and other services\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files\u0026#39; availability zone (AZ) volume placement feature lets you deploy volumes in the same AZ with Azure compute and other services to have within AZ latency and share the same AZ failure domain. Potential Benefits:\rWithin AZ latency and tolerate failure of other AZ\rLearn More:\rManage availability zone volume placement for Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use snapshots for data protection in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files snapshot technology ensures stability, scalability, and swift data recoverability without affecting performance. It supports automatic snapshot creation via policies for Azure NetApp Files data. Potential Benefits:\rStable, scalable, swift recovery, no perf impact\rLearn More:\rHow Azure NetApp Files snapshots work | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without a snapshot policy defined. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.dataProtection.snapshot.snapshotPolicyId == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;72827434-c773-4345-9493-34848ddf5803\u0026#34;, name, id, tags Enable backup for data protection in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files offers a fully managed backup solution enhancing long-term recovery, archiving, and compliance. Potential Benefits:\rEnhances data recovery and compliance\rLearn More:\rUnderstand Azure NetApp Files backup | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without a backup policy defined. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.dataProtection.backup.backupPolicyId == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;b2fb3e60-97ec-e34d-af29-b16a0d61c2ac\u0026#34;, name, id, tags Enable Cross-region replication of Azure NetApp Files volumes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files replication offers data protection by allowing asynchronous cross-region volume replication for application failover in case of regional outages. Volumes can be replicated across regions, not concurrently with cross-zone replication. Potential Benefits:\rEnhanced data protection and disaster recovery\rLearn More:\rCross-region replication of Azure NetApp Files volumes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without cross-region replication. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend remoteVolumeRegion = properties.dataProtection.replication.remoteVolumeRegion | extend volumeType = properties.volumeType | extend replicationType = iff((remoteVolumeRegion == location), \u0026#34;CZR\u0026#34;, iff((remoteVolumeRegion == \u0026#34;\u0026#34;),\u0026#34;n/a\u0026#34;,\u0026#34;CRR\u0026#34;)) | where replicationType != \u0026#34;CRR\u0026#34; and volumeType != \u0026#34;DataProtection\u0026#34; | project recommendationId = \u0026#34;e30317d2-c502-4dfe-a2d3-0a737cc79545\u0026#34;, name, id, tags Enable Cross-zone replication of Azure NetApp Files volumes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe cross-zone replication (CZR) feature enables asynchronous data replication between Azure NetApp Files volumes across different availability zones, ensuring data protection and critical application failover in case of zone-wide disasters. Potential Benefits:\rEnhances disaster recovery across availability zones\rLearn More:\rCross-zone replication of Azure NetApp Files volumes | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without cross-zone replication. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend remoteVolumeRegion = properties.dataProtection.replication.remoteVolumeRegion | extend volumeType = properties.volumeType | extend replicationType = iff((remoteVolumeRegion == location), \u0026#34;CZR\u0026#34;, iff((remoteVolumeRegion == \u0026#34;\u0026#34;),\u0026#34;n/a\u0026#34;,\u0026#34;CRR\u0026#34;)) | where replicationType != \u0026#34;CZR\u0026#34; and volumeType != \u0026#34;DataProtection\u0026#34; | project recommendationId = \u0026#34;e3d742e1-dacd-9b48-b6b1-510ec9f87c96\u0026#34;, name, id, tags Monitor Azure NetApp Files metrics to better understand usage pattern and performance\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files offers metrics like allocated storage, actual usage, volume IOPS, and latency, enabling a better understanding of usage patterns and volume performance for NetApp accounts. Potential Benefits:\rOptimize usage and performance\rLearn More:\rWays to monitor Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enforce standards and assess compliance in Azure NetApp Files with Azure policy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files supports Azure policy integration using either built-in policy definitions or by creating custom ones to maintain organizational standards and compliance. Potential Benefits:\rEnforce standards and assess compliance\rLearn More:\rAzure Policy definitions for Azure NetApp Files | Microsoft Learn\rCreating custom policy definitions | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Restrict default access to Azure NetApp Files volumes\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAccess to the delegated subnet should be limited to specific Azure Virtual Networks. SMB-enabled volumes\u0026#39; share permissions should move away from \u0026#39;Everyone/Full control\u0026#39;. NFS-enabled volumes\u0026#39; access needs to be controlled via export policies and/or NFSv4.1 ACLs. Potential Benefits:\rEnhanced security, Reduced data breach risk\rLearn More:\rConfigure network features for an Azure NetApp Files volume\rManage SMB share ACLs in Azure NetApp Files\rConfigure export policy for NFS or dual-protocol volumes\rConfigure access control lists on NFSv4.1 volumes for Azure NetApp Files\rConfigure Unix permissions and change ownership mode for NFS and dual-protocol volumes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Make use of SMB continuous availability for supported applications\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCertain SMB applications need SMB Transparent Failover for maintenance without interrupting server connectivity. Azure NetApp Files provides this through SMB Continuous Availability for applications like Citrix App Layering, FSLogix user/profile containers, Microsoft SQL Server, MSIX app attach. Potential Benefits:\rZero downtime for SMB apps\rLearn More:\rDo I need to take special precautions for SMB-based applications? | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure application resilience for service maintenance events\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure NetApp Files might undergo occasional planned maintenance such as platform updates or service and software upgrades. It\u0026#39;s important to be aware of the application\u0026#39;s resiliency settings to cope with these storage service maintenance events. Potential Benefits:\rMinimizes downtime during maintenance\rLearn More:\rWhat do you recommend for handling potential application disruptions due to storage service maintenance events? | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse the correct service level and volume quota size for the expected performance level\rMedium\rScalability\rNo\rVerified\rUse standard network features for production in Azure NetApp Files\rHigh\rGovernance\rYes\rVerified\rUse availability zones for high availability in Azure NetApp Files\rHigh\rHigh Availability\rYes\rVerified\rDeploy ANF volumes in the same availability zone with Azure compute and other services\rHigh\rOther Best Practices\rNo\rVerified\rUse snapshots for data protection in Azure NetApp Files\rHigh\rHigh Availability\rYes\rVerified\rEnable backup for data protection in Azure NetApp Files\rHigh\rDisaster Recovery\rYes\rVerified\rEnable Cross-region replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rVerified\rEnable Cross-zone replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rVerified\rMonitor Azure NetApp Files metrics to better understand usage pattern and performance\rMedium\rMonitoring and Alerting\rNo\rVerified\rEnforce standards and assess compliance in Azure NetApp Files with Azure policy\rMedium\rGovernance\rNo\rVerified\rRestrict default access to Azure NetApp Files volumes\rMedium\rSecurity\rNo\rVerified\rMake use of SMB continuous availability for supported applications\rMedium\rHigh Availability\rNo\rVerified\rEnsure application resilience for service maintenance events\rMedium\rHigh Availability\rNo\rVerified\rDetails\rUse the correct service level and volume quota size for the expected performance level\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rService levels, part of capacity pool attributes, determine the maximum throughput per volume quota in Azure NetApp Files."},{"id":221,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/","title":"Network","parent":"Azure Resources","content":"","description":""},{"id":222,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/","title":"NetworkCloud","parent":"Azure Resources","content":"","description":""},{"id":223,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/","title":"NetworkFunction","parent":"Azure Resources","content":"","description":""},{"id":224,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkManagers/","title":"networkManagers","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":225,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/networks/","title":"networks","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":226,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkSecurityGroups/","title":"networkSecurityGroups","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Diagnostic Settings for all network security groups\rMedium\rMonitoring and Alerting\rNo\rVerified\rMonitor changes in Network Security Groups with Azure Monitor\rLow\rMonitoring and Alerting\rYes\rVerified\rConfigure locks for Network Security Groups to avoid accidental changes and/or deletion\rLow\rGovernance\rNo\rVerified\rConfigure NSG Flow Logs\rMedium\rMonitoring and Alerting\rYes\rVerified\rThe NSG only has Default Security Rules, make sure to configure the necessary rules\rMedium\rSecurity\rYes\rVerified\rDetails\rConfigure Diagnostic Settings for all network security groups\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations. Potential Benefits:\rEnhanced monitoring and security insights\rLearn More:\rDiagnostic settings in Azure Monitor\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor changes in Network Security Groups with Azure Monitor\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate Alerts with Azure Monitor for operations like creating or updating Network Security Group rules to catch unauthorized/undesired changes to resources and spot attempts to bypass firewalls or access resources from the outside. Potential Benefits:\rEnhanced security and change monitoring\rLearn More:\rAzure Monitor activity log\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Network Security Groups without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project name, id, tags, lowerCaseNsgId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Network Security Group (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39;) or // All administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/join/action\u0026#34;\u0026#39;) ) | project lowerCaseNsgIdOfScope = tolower(scope) ) on $left.lowerCaseNsgId == $right.lowerCaseNsgIdOfScope | where isempty(lowerCaseNsgIdOfScope) | project recommendationId = \u0026#34;8bb4a57b-55e4-d24e-9c19-2679d8bc779f\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; Configure locks for Network Security Groups to avoid accidental changes and/or deletion\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAs an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental deletions and modifications. The lock overrides user permissions. Locks can prevent either deletions or modifications and are known as Delete and Read-only in the portal. Potential Benefits:\rPrevents accidental edits/deletions\rLearn More:\rLock your resources to protect your infrastructure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure NSG Flow Logs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring, managing, and understanding your network is crucial for protection and optimization. Knowing the current state, who and from where connections are made, open internet ports, expected and irregular behavior, and traffic spikes is essential. Potential Benefits:\rEnhances security and optimizes network\rLearn More:\rFlow logging for network security groups\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Network Security Groups without NSG Flow logs configured or disabled. resources | where type =~ \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project name, id, tags, lowerCaseNsgId = tolower(id) | join kind = leftouter ( resources | where type == \u0026#34;microsoft.network/networkwatchers/flowlogs\u0026#34; and properties.enabled == true | project flowLogName = name, lowerCaseTargetNsgId = tolower(properties.targetResourceId) ) on $left.lowerCaseNsgId == $right.lowerCaseTargetNsgId | where isempty(lowerCaseTargetNsgId) | project recommendationId = \u0026#34;da1a3c06-d1d5-a940-9a99-fcc05966fe7c\u0026#34;, name, id, tags, param1 = \u0026#34;NSGFlowLog: Not configured/Disabled\u0026#34; The NSG only has Default Security Rules, make sure to configure the necessary rules\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure network security groups filter network traffic between resources in a virtual network, using security rules to allow or deny inbound or outbound traffic based on source, destination, port, and protocol. Potential Benefits:\rEnhanced traffic control and security\rLearn More:\rSecurity rules\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all NSGs that have NO security rules resources | where type =~ \u0026#34;microsoft.network/networksecuritygroups\u0026#34; | extend sr = string_size(properties.securityRules) | where sr \u0026lt;=2 or isnull(properties.securityRules) | project recommendationId = \u0026#34;8291c1fa-650c-b44b-b008-4deb7465919d\u0026#34;, name, id ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Diagnostic Settings for all network security groups\rMedium\rMonitoring and Alerting\rNo\rVerified\rMonitor changes in Network Security Groups with Azure Monitor\rLow\rMonitoring and Alerting\rYes\rVerified\rConfigure locks for Network Security Groups to avoid accidental changes and/or deletion\rLow\rGovernance\rNo\rVerified\rConfigure NSG Flow Logs\rMedium\rMonitoring and Alerting\rYes\rVerified\rThe NSG only has Default Security Rules, make sure to configure the necessary rules\rMedium\rSecurity\rYes\rVerified\rDetails\rConfigure Diagnostic Settings for all network security groups\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations."},{"id":227,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkVirtualAppliances/","title":"networkVirtualAppliances","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":228,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkVirtualApplianceSkus/","title":"networkVirtualApplianceSkus","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":229,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkWatchers/","title":"networkWatchers","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy Network Watcher in all regions where you have networking services\rLow\rMonitoring and Alerting\rYes\rVerified\rFix Flow Log configurations in Failed state or Disabled Status\rLow\rMonitoring and Alerting\rYes\rVerified\rDetails\rDeploy Network Watcher in all regions where you have networking services\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Network Watcher offers tools for monitoring, diagnosing, viewing metrics, and managing logs for IaaS resources. It helps maintain the health of VMs, VNets, application gateways, load balancers, but not for PaaS or Web analytics. Potential Benefits:\rEnhanced monitoring and diagnostics for Azure IaaS\rLearn More:\rWhat is Azure Network Watcher?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all locations that do not have a Network Watcher deployed resources | where location != \u0026#34;global\u0026#34; | union (Resources | where type =~ \u0026#34;microsoft.network/networkwatchers\u0026#34;) | summarize NetworkWatcherCount = countif(type =~ \u0026#39;Microsoft.Network/networkWatchers\u0026#39;) by location | where NetworkWatcherCount == 0 | project recommendationId = \u0026#34;4e133bd0-8762-bc40-a95b-b29142427d73\u0026#34;, name=location, id=\u0026#34;n/a\u0026#34;, tags, param1 = strcat(\u0026#34;LocationMisingNetworkWatcher:\u0026#34;, location) Fix Flow Log configurations in Failed state or Disabled Status\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rNetwork security group flow logging is a feature of Azure Network Watcher that logs IP traffic info through a network security group. If in Failed state, monitoring data from the associated resource is not collected. Potential Benefits:\rEnsures IP traffic logging\rLearn More:\rManage NSG flow logs using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Network Watcher Flow Logs that are not enabled or in a succeeded state resources | where type =~ \u0026#34;microsoft.network/networkwatchers/flowlogs\u0026#34; and isnotnull(properties) | extend targetResourceId = tostring(properties.targetResourceId) | extend status = iff(properties.enabled =~ \u0026#39;true\u0026#39;, \u0026#34;Enabled\u0026#34;, \u0026#34;Disabled\u0026#34;) | extend provisioningState = tostring(properties.provisioningState) | extend flowLogType = iff(properties.targetResourceId contains \u0026#34;Microsoft.Network/virtualNetworks\u0026#34;, \u0026#39;Virtual network\u0026#39;, \u0026#39;Network security group\u0026#39;) | where provisioningState != \u0026#34;Succeeded\u0026#34; or status != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;22a769ed-0ecb-8b49-bafe-8f52e6373d9c\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState:\u0026#34;, provisioningState), param2=strcat(\u0026#34;Status:\u0026#34;, status), param3=strcat(\u0026#34;targetResourceId:\u0026#34;,targetResourceId), param4=strcat(\u0026#34;flowLogType:\u0026#34;,flowLogType) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy Network Watcher in all regions where you have networking services\rLow\rMonitoring and Alerting\rYes\rVerified\rFix Flow Log configurations in Failed state or Disabled Status\rLow\rMonitoring and Alerting\rYes\rVerified\rDetails\rDeploy Network Watcher in all regions where you have networking services\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Network Watcher offers tools for monitoring, diagnosing, viewing metrics, and managing logs for IaaS resources."},{"id":230,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NotificationHubs/","title":"NotificationHubs","parent":"Azure Resources","content":"","description":""},{"id":231,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/objectAnchorsAccounts/","title":"objectAnchorsAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":232,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RedHatOpenShift/openShiftClusters/","title":"openShiftClusters","parent":"RedHatOpenShift","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":233,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/OperationalInsights/","title":"OperationalInsights","parent":"Azure Resources","content":"","description":""},{"id":234,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/","title":"Orbital","parent":"Azure Resources","content":"","description":""},{"id":235,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/p2sVpnGateways/","title":"p2sVpnGateways","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":236,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/partnerNamespaces/","title":"partnerNamespaces","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":237,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/partnerTopics/","title":"partnerTopics","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":238,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Peering/","title":"Peering","parent":"Azure Resources","content":"","description":""},{"id":239,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Peering/peerings/","title":"peerings","parent":"Peering","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":240,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/policies/","title":"policies","parent":"Subscription","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":241,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/policyDefinitions/","title":"policyDefinitions","parent":"Authorization","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":242,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/PowerBIDedicated/","title":"PowerBIDedicated","parent":"Azure Resources","content":"","description":""},{"id":243,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AVS/privateClouds/","title":"privateClouds","parent":"AVS","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Azure Service Health notifications and alerts for Azure VMware Solution\rHigh\rMonitoring and Alerting\rYes\rVerified\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rMedium\rMonitoring and Alerting\rNo\rVerified\rMonitor when Azure VMware Solution Cluster Size is approaching the host limit\rMedium\rMonitoring and Alerting\rNo\rVerified\rEnable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rLow\rHigh Availability\rYes\rVerified\rConfigure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure Syslog in Diagnostic Settings for Azure VMware Solution\rHigh\rMonitoring and Alerting\rNo\rVerified\rMonitor CPU Utilization to ensure sufficient resources for workloads\rMedium\rMonitoring and Alerting\rYes\rVerified\rMonitor Memory Utilization to ensure sufficient resources for workloads\rMedium\rMonitoring and Alerting\rYes\rVerified\rApply Resource delete lock on the resource group hosting the private cloud\rHigh\rGovernance\rNo\rVerified\rUse key autorotation for vSAN datastore customer-managed keys\rHigh\rSecurity\rNo\rVerified\rUse multiple DNS servers per private FQDN zone\rHigh\rHigh Availability\rNo\rVerified\rDetails\rConfigure Azure Service Health notifications and alerts for Azure VMware Solution\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure Azure Service Health notifications are set for Azure VMware Solution across all used regions and subscriptions. This communicates service/security issues and maintenance activities like host replacements and upgrades, reducing service request submissions. Potential Benefits:\rPrompt mitigation of issues.\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have one or more service health alerts covering AVS private clouds in the deployed subscription and region pairs. //full list of private clouds (resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend locale = tolower(location) | extend subscriptionId = tolower(subscriptionId) | project id, name, tags, subscriptionId, locale) | join kind=leftouter //Alert ID\u0026#39;s that include all incident types filtered by AVS Service Health alerts ((resources | where type == \u0026#34;microsoft.insights/activitylogalerts\u0026#34; | extend alertproperties = todynamic(properties) | where alertproperties.condition.allOf[0].field == \u0026#34;category\u0026#34; and alertproperties.condition.allOf[0].equals == \u0026#34;ServiceHealth\u0026#34; | where alertproperties.condition.allOf[1].field == \u0026#34;properties.impactedServices[*].ServiceName\u0026#34; and set_has_element(alertproperties.condition.allOf[1].containsAny, \u0026#34;Azure VMware Solution\u0026#34;) | extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[2].containsAny),\u0026#39; \u0026#39;), \u0026#39;\u0026#39;) | mv-expand todynamic(locale) | where locale != \u0026#34;global\u0026#34; | project subscriptionId, tostring(locale) ) | union //Alert ID\u0026#39;s that include only some of the incident types after filtering by service health alerts covering AVS private clouds. (resources | where type == \u0026#34;microsoft.insights/activitylogalerts\u0026#34; | extend subscriptionId = tolower(subscriptionId) | extend alertproperties = todynamic(properties) | where alertproperties.condition.allOf[0].field == \u0026#34;category\u0026#34; and alertproperties.condition.allOf[0].equals == \u0026#34;ServiceHealth\u0026#34; | where alertproperties.condition.allOf[2].field == \u0026#34;properties.impactedServices[*].ServiceName\u0026#34; and set_has_element(alertproperties.condition.allOf[2].containsAny, \u0026#34;Azure VMware Solution\u0026#34;) | extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[3].containsAny),\u0026#39; \u0026#39;), \u0026#39;\u0026#39;) | mv-expand todynamic(locale) | mv-expand alertproperties.condition.allOf[1].anyOf | extend incidentType = alertproperties_condition_allOf_1_anyOf.equals | where locale != \u0026#34;global\u0026#34; | project id, subscriptionId, locale, incidentType | distinct subscriptionId, tostring(locale), tostring(incidentType) | summarize incidentTypes=count() by subscriptionId, locale | where incidentTypes == 5 //only include this subscription, region pair if it includes all the incident types. | project subscriptionId, locale)) on subscriptionId, locale | where subscriptionId1 == \u0026#34;\u0026#34; or locale1 == \u0026#34;\u0026#34; or isnull(subscriptionId1) or isnull(locale1) | project recommendationId = \u0026#34;74fcb9f2-9a25-49a6-8c42-d32851c4afb7\u0026#34;, name, id, tags, param1 = \u0026#34;avsServiceHealthAlertsAllIncidentTypesConfigured: False\u0026#34; Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSet an alert for when the node count in Azure VMware Solution Private Cloud hits or exceeds 90 hosts, enabling timely planning for a new private cloud. Potential Benefits:\rProactive capacity planning\rLearn More:\rConfigure and streamline alerts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Monitor when Azure VMware Solution Cluster Size is approaching the host limit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAlert when the cluster size reaches 14 hosts. Set up periodic alerts for planning new clusters or datastores due to growth, especially from storage needs. Beyond 14 hosts, trigger alerts for each new host addition for proactive resource monitoring. Potential Benefits:\rProactive resource management\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor Azure VMware Solution, enabling Stretched Clusters offers 99.99% SLA, synchronous storage replication (RPO=0), and spreads vSAN datastore across two AZs. Must be done at initial setup, needing double quota due to extension across AZs. Potential Benefits:\r99.99% SLA, 0 RPO, Multi-AZ\rLearn More:\rLearn More\rStretched Clusters\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that aren\u0026#39;t configured as stretched clusters and in supported regions. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend avsproperties = todynamic(properties) | where avsproperties.availability.strategy != \u0026#34;DualZone\u0026#34; | where location in (\u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;australiaeast\u0026#34;) | project recommendationId = \u0026#34;9ec5b4c8-3dd8-473a-86ee-3273290331b9\u0026#34;, name, id, tags, param1 = \u0026#34;stretchClusters: Disabled\u0026#34; Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure VMware vSAN datastore slack space is maintained for SLA by monitoring storage utilization and setting alerts at 70% and 75% utilization to allow for capacity planning. To expand, add hosts or external storage like Azure Elastic SAN, Azure NetApp Files, if CPU and RAM requirements are met. Potential Benefits:\rOptimized capacity planning for vSAN\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a vSAN capacity critical alert with a threshold of 75% or a warning capacity of 70%. ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 75 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4232eb32-3241-4049-9e14-9b8005817b56\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityCriticalAlert: isNull or threshold != 75\u0026#34; ) | union ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 70 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4232eb32-3241-4049-9e14-9b8005817b56\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityWarningAlert: isNull or threshold != 70\u0026#34; ) Configure Syslog in Diagnostic Settings for Azure VMware Solution\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure Diagnostic Settings are configured for each private cloud to send syslogs to external sources for analysis and/or archiving. Azure VMware Solution Syslogs contain data for troubleshooting and performance, aiding quicker issue resolution and early detection of issues. Potential Benefits:\rFaster issue resolution, early detection\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Monitor CPU Utilization to ensure sufficient resources for workloads\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure sufficient compute resources to avoid host resource exhaustion in Azure VMware Solution, which utilizes vSphere DRS and HA for dynamic workload resource management. However, sustained CPU utilization over 95% may increase CPU Ready times, impacting workloads. Potential Benefits:\rAvoids resource exhaustion, optimizes performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a Cluster CPU capacity critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;EffectiveCpuAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4ee5d535-c47b-470a-9557-4a3dd297d62f\u0026#34;, name, id, tags, param1 = \u0026#34;hostCpuCriticalAlert: isNull or threshold != 95\u0026#34; Monitor Memory Utilization to ensure sufficient resources for workloads\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure sufficient memory resources to prevent host resource exhaustion in Azure VMware Solution. It uses vSphere DRS and vSphere HA for dynamic workload management. Yet, continuous memory use over 95% leads to disk swapping, affecting workloads. Potential Benefits:\rAvoids host exhaustion and swapping\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a cluster host memory critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;UsageAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;029208c8-5186-4a76-8ee8-6e3445fef4dd\u0026#34;, name, id, tags, param1 = \u0026#34;hostMemoryCriticalAlert: isNull or threshold != 95\u0026#34; Apply Resource delete lock on the resource group hosting the private cloud\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApplying a resource delete lock to the Azure VMware Solution Private Cloud resource group prevents unauthorized or accidental deletion by anyone with contributor access, ensuring the protection and reliability of the Azure VMware Solution Private Cloud. Potential Benefits:\rPrevents accidental deletion\rLearn More:\rLock your resources to protect your infrastructure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Use key autorotation for vSAN datastore customer-managed keys\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen using customer-managed keys for encrypting vSAN datastores, leveraging Azure Key Vault for central management and accessing them via a managed identity linked to the private cloud is advised. The expiration of these keys can render the vSAN datastore and its associated workloads inaccessible. Potential Benefits:\rAvoid outages with key auto-rotation\rLearn More:\rConfigure Customer Managed Keys\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG Use multiple DNS servers per private FQDN zone\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure VMware Solution private clouds support up to three DNS servers for a single FQDN, preventing a single DNS server from becoming a point of failure. It\u0026#39;s crucial to use multiple DNS servers for on-premises FQDN resolution from each private cloud. Potential Benefits:\rEnhances reliability and avoids failure\rLearn More:\rConfigure DNS forwarder\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot be validated with ARG ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Azure Service Health notifications and alerts for Azure VMware Solution\rHigh\rMonitoring and Alerting\rYes\rVerified\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rMedium\rMonitoring and Alerting\rNo\rVerified\rMonitor when Azure VMware Solution Cluster Size is approaching the host limit\rMedium\rMonitoring and Alerting\rNo\rVerified\rEnable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rLow\rHigh Availability\rYes\rVerified\rConfigure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure Syslog in Diagnostic Settings for Azure VMware Solution\rHigh\rMonitoring and Alerting\rNo\rVerified\rMonitor CPU Utilization to ensure sufficient resources for workloads\rMedium\rMonitoring and Alerting\rYes\rVerified\rMonitor Memory Utilization to ensure sufficient resources for workloads\rMedium\rMonitoring and Alerting\rYes\rVerified\rApply Resource delete lock on the resource group hosting the private cloud\rHigh\rGovernance\rNo\rVerified\rUse key autorotation for vSAN datastore customer-managed keys\rHigh\rSecurity\rNo\rVerified\rUse multiple DNS servers per private FQDN zone\rHigh\rHigh Availability\rNo\rVerified\rDetails\rConfigure Azure Service Health notifications and alerts for Azure VMware Solution\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure Azure Service Health notifications are set for Azure VMware Solution across all used regions and subscriptions."},{"id":244,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateDnsZones/","title":"privateDnsZones","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rProtect private DNS zones and records\rMedium\rSecurity\rNo\rVerified\rMonitor Private DNS Zones health and set up alerts\rHigh\rMonitoring and Alerting\rNo\rVerified\rAlign Production and DR zones with identical workload and resource failover entries\rMedium\rGovernance\rNo\rVerified\rDetails\rProtect private DNS zones and records\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPrivate DNS zones and records are critical and their deletion can cause service outages. To protect against unauthorized or accidental changes, the Private DNS Zone Contributor role, a built-in role for managing these resources, should be assigned to specific users or groups. Potential Benefits:\rPrevents DNS outages\rLearn More:\rProtecting private DNS Zones and Records - Azure DNS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor Private DNS Zones health and set up alerts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe records in a private DNS zone are only resolvable from linked virtual networks. You can link a private DNS zone to multiple networks and enable autoregistration to manage DNS records for virtual machines automatically. Potential Benefits:\rEnhanced DNS reliability and alerting\rLearn More:\rScenarios for Azure Private DNS zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Align Production and DR zones with identical workload and resource failover entries\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Private DNS offers a reliable, secure way to handle domain names within virtual networks, using custom domains instead of default Azure names. Records in these zones aren\u0026#39;t internet-accessible, only resolvable within linked virtual networks. Potential Benefits:\rEnsures seamless failover for DNS\rLearn More:\rScenarios for Azure Private DNS zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rProtect private DNS zones and records\rMedium\rSecurity\rNo\rVerified\rMonitor Private DNS Zones health and set up alerts\rHigh\rMonitoring and Alerting\rNo\rVerified\rAlign Production and DR zones with identical workload and resource failover entries\rMedium\rGovernance\rNo\rVerified\rDetails\rProtect private DNS zones and records\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPrivate DNS zones and records are critical and their deletion can cause service outages."},{"id":245,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateEndpoints/","title":"privateEndpoints","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rResolve issues with Private Endpoints in non Succeeded connection state\rMedium\rHigh Availability\rYes\rVerified\rDetails\rResolve issues with Private Endpoints in non Succeeded connection state\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource. Potential Benefits:\rEnsure connection availability\rLearn More:\rPrivate endpoint connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Private Endpoints that are not in a Succeeded state resources | where type =~ \u0026#34;microsoft.network/privateendpoints\u0026#34; | where properties.provisioningState != \u0026#34;Succeeded\u0026#34; or properties.privateLinkServiceConnections[0].properties.provisioningState != \u0026#34;Succeeded\u0026#34; | project recommendationId = \u0026#34;b89c9acc-0aba-fb44-9ff2-3dbfcf97dce7\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.provisioningState)), param2 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.privateLinkServiceConnections[0].properties.provisioningState)) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rResolve issues with Private Endpoints in non Succeeded connection state\rMedium\rHigh Availability\rYes\rVerified\rDetails\rResolve issues with Private Endpoints in non Succeeded connection state\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource."},{"id":246,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/privateLinkScopes/","title":"privateLinkScopes","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":247,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateLinkServices/","title":"privateLinkServices","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":248,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/profiles/","title":"profiles","parent":"Cdn","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rAvoid combining Traffic Manager and Front Door\rHigh\rBusiness Continuity\rYes\rVerified\rRestrict traffic to your origins\rHigh\rSecurity\rNo\rVerified\rUse the latest API version and SDK version\rMedium\rGovernance\rNo\rVerified\rConfigure logs\rMedium\rMonitoring and Alerting\rNo\rVerified\rUse end-to-end TLS\rHigh\rSecurity\rYes\rVerified\rUse HTTP to HTTPS redirection\rHigh\rSecurity\rYes\rVerified\rUse managed TLS certificates\rHigh\rSecurity\rNo\rVerified\rUse latest version for customer-managed certificates\rMedium\rSecurity\rNo\rVerified\rUse the same domain name on Front Door and your origin\rMedium\rGovernance\rNo\rVerified\rEnable the WAF\rMedium\rSecurity\rYes\rVerified\rDisable health probes when there is only one origin in an origin group\rLow\rHigh Availability\rYes\rVerified\rSelect good health probe endpoints\rMedium\rHigh Availability\rNo\rVerified\rUse HEAD health probes\rMedium\rScalability\rNo\rVerified\rUse geo-filtering in Azure Front Door\rMedium\rSecurity\rNo\rVerified\rSecure your Origin with Private Link in Azure Front Door\rMedium\rSecurity\rNo\rVerified\rDetails\rAvoid combining Traffic Manager and Front Door\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor most solutions, choose either Azure Front Door for content caching, CDN, TLS termination, and WAF, or Traffic Manager for simple global load balancing. Potential Benefits:\rOptimized network routing and security\rLearn More:\rAzure Load Balancing Options\rAzure Traffic Manager\rAzure Front Door\rMission-critical global content delivery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Avoid combining Traffic Manager and Front Door resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | mvexpand(properties.endpoints) | extend endpoint=tostring(properties_endpoints.properties.target) | project name, trafficmanager=id, matchname=endpoint, tags | join ( resources | where type =~ \u0026#34;microsoft.cdn/profiles/afdendpoints\u0026#34; | extend matchname= tostring(properties.hostName) | extend splitid=split(id, \u0026#34;/\u0026#34;) | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \u0026#34;/\u0026#34;)) | project name, id, matchname, frontdoorid, type | union (cdnresources | where type =~ \u0026#34;Microsoft.Cdn/Profiles/CustomDomains\u0026#34; | extend matchname= tostring(properties.hostName) | extend splitid=split(id, \u0026#34;/\u0026#34;) | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \u0026#34;/\u0026#34;)) | project name, id, matchname, frontdoorid, type) ) on matchname | project recommendationId = \u0026#34;9437634c-d69e-2747-b13e-631c13182150\u0026#34;, name=split(trafficmanager, \u0026#34;/\u0026#34;)[-1], id=trafficmanager, tags, param1=strcat(\u0026#34;hostname:\u0026#34;, matchname), param2=strcat(\u0026#34;frontdoorid:\u0026#34;, frontdoorid) Restrict traffic to your origins\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFront Door\u0026#39;s features perform optimally when traffic exclusively comes through Front Door. It\u0026#39;s advised to set up your origin to deny access to traffic that bypasses Front Door. Potential Benefits:\rEnhances security and performance\rLearn More:\rSecure traffic to Azure Front Door origins\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use the latest API version and SDK version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen working with Azure Front Door through APIs, ARM templates, Bicep, or SDKs, using the latest API or SDK version is crucial. Updates bring new functions, important security patches, and bug fixes. Potential Benefits:\rEnhanced security and features\rLearn More:\rREST API Reference\rClient library for Java\rSDK for Python\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure logs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFront Door logs offer comprehensive telemetry on each request, crucial for understanding your solution\u0026#39;s performance and responses, especially when caching is enabled, as origin servers might not receive every request. Potential Benefits:\rEnhanced insights and solution monitoring\rLearn More:\rMonitor metrics and logs in Azure Front Door\rWAF logs\rConfigure Azure Front Door logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use end-to-end TLS\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFront Door terminates TCP and TLS connections from clients and establishes new connections from each PoP to the origin. Securing these connections with TLS, even for Azure-hosted origins, ensures data is always encrypted during transit. Potential Benefits:\rEnsures data encryption in transit\rLearn More:\rEnd-to-end TLS with Azure Front Door\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Use end-to-end TLS cdnresources | where type == \u0026#34;microsoft.cdn/profiles/afdendpoints/routes\u0026#34; | extend forwardingProtocol=tostring(properties.forwardingProtocol),supportedProtocols=properties.supportedProtocols | project id,name,forwardingProtocol,supportedProtocols,tags | where forwardingProtocol !~ \u0026#34;httpsonly\u0026#34; or supportedProtocols has \u0026#34;http\u0026#34; | project recommendationId= \u0026#34;d9bd6780-0d6f-cd4c-bc66-8ddcab12f3d1\u0026#34;, name,id,tags,param1=strcat(\u0026#34;forwardingProtocol:\u0026#34;,forwardingProtocol),param2=strcat(\u0026#34;supportedProtocols:\u0026#34;,supportedProtocols) Use HTTP to HTTPS redirection\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUsing HTTPS is ideal for secure connections. However, for compatibility with older clients, HTTP requests may be necessary. Azure Front Door enables auto redirection of HTTP to HTTPS, enhancing security without sacrificing accessibility. Potential Benefits:\rEnhances security and compliance\rLearn More:\rCreate HTTP to HTTPS redirect rule\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Use HTTP to HTTPS redirection cdnresources | where type == \u0026#34;microsoft.cdn/profiles/afdendpoints/routes\u0026#34; | extend httpsRedirect=tostring(properties.httpsRedirect) | project id,name,httpsRedirect,tags | where httpsRedirect !~ \u0026#34;enabled\u0026#34; | project recommendationId= \u0026#34;24ab9f11-a3e4-3043-a985-22cf94c4933a\u0026#34;, name,id,tags,param1=strcat(\u0026#34;httpsRedirect:\u0026#34;,httpsRedirect) Use managed TLS certificates\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen Front Door manages your TLS certificates, it reduces your operational costs and helps you to avoid costly outages caused by forgetting to renew a certificate. Front Door automatically issues and rotates the managed TLS certificates. Potential Benefits:\rLowers costs, avoids outages\rLearn More:\rConfigure HTTPS on an Azure Front Door custom domain using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use latest version for customer-managed certificates\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIf you use your own TLS certificates, set the Key Vault certificate version to \u0026#39;Latest\u0026#39; to avoid reconfiguring Azure Front Door for new certificate versions and waiting for deployment across Front Door\u0026#39;s environments. Potential Benefits:\rSaves time and automates TLS updates\rLearn More:\rSelect the certificate for Azure Front Door to deploy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use the same domain name on Front Door and your origin\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFront Door can rewrite Host headers for custom domain names routing to a single origin, useful for avoiding custom domain configuration at both Front Door and the origin. Potential Benefits:\rImproves session/auth handling\rLearn More:\rPreserve the original HTTP host name between a reverse proxy and its back-end web application\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable the WAF\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor internet-facing applications, enabling the Front Door web application firewall (WAF) and configuring it to use managed rules is recommended for protection against a wide range of attacks using Microsoft-managed rules. Potential Benefits:\rEnhances web app security\rLearn More:\rWeb Application Firewall on Azure Front Door\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Enable the WAF resources | where type =~ \u0026#34;microsoft.cdn/profiles\u0026#34; and sku has \u0026#34;AzureFrontDoor\u0026#34; | project name, cdnprofileid=tolower(id), tostring(tags), resourceGroup, subscriptionId,skuname=tostring(sku.name) | join kind= fullouter ( cdnresources | where type == \u0026#34;microsoft.cdn/profiles/securitypolicies\u0026#34; | extend wafpolicyid=tostring(properties[\u0026#39;parameters\u0026#39;][\u0026#39;wafPolicy\u0026#39;][\u0026#39;id\u0026#39;]) | extend splitid=split(id, \u0026#34;/\u0026#34;) | extend cdnprofileid=tolower(strcat_array(array_slice(splitid, 0, 8), \u0026#34;/\u0026#34;)) | project secpolname=name, cdnprofileid, wafpolicyid ) on cdnprofileid | project name, cdnprofileid, secpolname, wafpolicyid,skuname | join kind = fullouter ( resources | where type == \u0026#34;microsoft.network/frontdoorwebapplicationfirewallpolicies\u0026#34; | extend managedrulesenabled=iff(tostring(properties.managedRules.managedRuleSets) != \u0026#34;[]\u0026#34;, true, false), enabledState = tostring(properties.policySettings.enabledState) | project afdwafname=name, managedrulesenabled, wafpolicyid=id, enabledState, tostring(tags) ) on wafpolicyid | where name != \u0026#34;\u0026#34; | summarize associatedsecuritypolicies=countif(secpolname != \u0026#34;\u0026#34;), wafswithmanagedrules=countif(managedrulesenabled == 1) by name, id=cdnprofileid, tags,skuname | where associatedsecuritypolicies == 0 or wafswithmanagedrules == 0 | project recommendationId = \u0026#34;1bd2b7e8-400f-e64a-99a2-c572f7b08a62\u0026#34;, name, id, todynamic(tags), param1 = strcat(\u0026#34;associatedsecuritypolicies:\u0026#34;, associatedsecuritypolicies), param2 = strcat(\u0026#34;wafswithmanagedrules:\u0026#34;, wafswithmanagedrules), param3 = strcat(\u0026#34;skuname:\u0026#34;,skuname) Disable health probes when there is only one origin in an origin group\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFront Door health probes help detect unavailable or unhealthy origins, directing traffic to alternate origins if needed. Potential Benefits:\rReduces unnecessary origin traffic\rLearn More:\rHealth probes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Disable health probes when there is only one origin in an origin group cdnresources | where type =~ \u0026#34;microsoft.cdn/profiles/origingroups\u0026#34; | extend healthprobe=tostring(properties.healthProbeSettings) | project origingroupname=name, id, tags, resourceGroup, subscriptionId, healthprobe | join ( cdnresources | where type =~ \u0026#34;microsoft.cdn/profiles/origingroups/Origins\u0026#34; | extend origingroupname = tostring(properties.originGroupName) ) on origingroupname | summarize origincount=count(), enabledhealthprobecount=countif(healthprobe != \u0026#34;\u0026#34;) by origingroupname, id, tostring(tags), resourceGroup, subscriptionId | where origincount == 1 and enabledhealthprobecount != 0 | project recommendationId = \u0026#34;38f3d542-6de6-a44b-86c6-97e3be690281\u0026#34;, name=origingroupname, id, todynamic(tags), param1 = strcat(\u0026#34;origincount:\u0026#34;, origincount), param2 = strcat(\u0026#34;enabledhealthprobecount:\u0026#34;, enabledhealthprobecount) Select good health probe endpoints\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConsider selecting a webpage or location specifically designed for health monitoring as the endpoint for Azure Front Door\u0026#39;s health probes. This should encompass the status of critical components like application servers, databases, and caches to serve production traffic efficiently. Potential Benefits:\rImproves traffic routing and uptime\rLearn More:\rHealth Endpoint Monitoring pattern\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use HEAD health probes\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHealth probes in Azure Front Door can use GET or HEAD HTTP methods. Using the HEAD method for health probes is a recommended practice because it reduces the traffic load on your origins, being less resource-intensive. Potential Benefits:\rReduces traffic load on origins\rLearn More:\rSupported HTTP methods for health probes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use geo-filtering in Azure Front Door\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Front Door\u0026#39;s geo-filtering through WAF enables defining custom access rules by country/region to restrict or allow web app access. Potential Benefits:\rEnhanced regional access control\rLearn More:\rGeo filter WAF policy - GeoMatch\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Secure your Origin with Private Link in Azure Front Door\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Private Link enables secure access to Azure PaaS and services over a private endpoint in your virtual network, ensuring traffic goes over the Microsoft backbone network, not the public internet. Potential Benefits:\rEnhanced security and private connectivity\rLearn More:\rPrivate link for Azure Front Door\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rAvoid combining Traffic Manager and Front Door\rHigh\rBusiness Continuity\rYes\rVerified\rRestrict traffic to your origins\rHigh\rSecurity\rNo\rVerified\rUse the latest API version and SDK version\rMedium\rGovernance\rNo\rVerified\rConfigure logs\rMedium\rMonitoring and Alerting\rNo\rVerified\rUse end-to-end TLS\rHigh\rSecurity\rYes\rVerified\rUse HTTP to HTTPS redirection\rHigh\rSecurity\rYes\rVerified\rUse managed TLS certificates\rHigh\rSecurity\rNo\rVerified\rUse latest version for customer-managed certificates\rMedium\rSecurity\rNo\rVerified\rUse the same domain name on Front Door and your origin\rMedium\rGovernance\rNo\rVerified\rEnable the WAF\rMedium\rSecurity\rYes\rVerified\rDisable health probes when there is only one origin in an origin group\rLow\rHigh Availability\rYes\rVerified\rSelect good health probe endpoints\rMedium\rHigh Availability\rNo\rVerified\rUse HEAD health probes\rMedium\rScalability\rNo\rVerified\rUse geo-filtering in Azure Front Door\rMedium\rSecurity\rNo\rVerified\rSecure your Origin with Private Link in Azure Front Door\rMedium\rSecurity\rNo\rVerified\rDetails\rAvoid combining Traffic Manager and Front Door\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor most solutions, choose either Azure Front Door for content caching, CDN, TLS termination, and WAF, or Traffic Manager for simple global load balancing."},{"id":249,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/proximityPlacementGroups/","title":"proximityPlacementGroups","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":250,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/publicIPAddresses/","title":"publicIPAddresses","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Standard SKU and Zone-Redundant IPs when applicable\rHigh\rHigh Availability\rYes\rVerified\rUse NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rMedium\rHigh Availability\rYes\rVerified\rUpgrade Basic SKU public IP addresses to Standard SKU\rMedium\rHigh Availability\rYes\rVerified\rDetails\rUse Standard SKU and Zone-Redundant IPs when applicable\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPublic IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant. Zone-redundant IPs are accessible across all zones, resisting any single zone failure, thereby providing higher resilience. Potential Benefits:\rEnhanced resilience with zone redundancy\rLearn More:\rPublic IP addresses - Availability Zones\rUpgrading a basic public IP address to Standard SKU\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // List public IP addresses that are not Zone-Redundant Resources | where type =~ \u0026#34;Microsoft.Network/publicIPAddresses\u0026#34; and sku.tier =~ \u0026#34;Regional\u0026#34; | where isempty(zones) or array_length(zones) \u0026lt;= 1 | extend az = case(isempty(zones), \u0026#34;Non-zonal\u0026#34;, array_length(zones) \u0026lt;= 1, strcat(\u0026#34;Zonal (\u0026#34;, strcat_array(zones, \u0026#34;,\u0026#34;), \u0026#34;)\u0026#34;), zones) | project recommendationId = \u0026#34;c63b81fb-7afc-894c-a840-91bb8a8dcfaf\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name), param2 = strcat(\u0026#34;availabilityZone: \u0026#34;, az) Use NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPrevent connectivity failures due to SNAT port exhaustion by employing NAT gateway for outbound traffic from virtual networks, ensuring dynamic scaling and secure internet connections. Potential Benefits:\rAvoids SNAT port exhaustion risks\rLearn More:\rUse NAT GW for outbound connectivity\rTCP and SNAT Ports\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Lists VMs with PIPs resources | where type =~ \u0026#39;Microsoft.Network/publicIPAddresses\u0026#39; | where tostring(properties.ipConfiguration.id) contains \u0026#34;microsoft.network/networkinterfaces\u0026#34; | project recommendationid=\u0026#34;1adba190-5c4c-e646-8527-dd1b2a6d8b15\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Migrate from instance IP to NAT Gateway\u0026#34;) Upgrade Basic SKU public IP addresses to Standard SKU\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rBasic SKU public IP addresses will be retired on September 30, 2025. Users are advised to upgrade to Standard SKU public IP addresses before this date to avoid service disruptions. Potential Benefits:\rAvoids service disruption\rLearn More:\rUpgrading a basic public IP address to Standard SKU - Guidance\rUpgrade to Standard SKU public IP addresses in Azure by 30 September 2025 as Basic SKU will be retired\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // List Basic SKU public IP addresses Resources | where type =~ \u0026#34;Microsoft.Network/publicIPAddresses\u0026#34; | where sku.name =~ \u0026#34;Basic\u0026#34; | project recommendationId = \u0026#34;5cea1501-6fe4-4ec4-ac8f-f72320eb18d3\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Standard SKU and Zone-Redundant IPs when applicable\rHigh\rHigh Availability\rYes\rVerified\rUse NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rMedium\rHigh Availability\rYes\rVerified\rUpgrade Basic SKU public IP addresses to Standard SKU\rMedium\rHigh Availability\rYes\rVerified\rDetails\rUse Standard SKU and Zone-Redundant IPs when applicable\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPublic IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant."},{"id":251,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/publicIPPrefixes/","title":"publicIPPrefixes","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":252,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Purview/","title":"Purview","parent":"Azure Resources","content":"","description":""},{"id":253,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quantum/","title":"Quantum","parent":"Azure Resources","content":"","description":""},{"id":254,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/","title":"Quota","parent":"Azure Resources","content":"","description":""},{"id":255,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/quotas/","title":"quotas","parent":"Quota","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":256,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/racks/","title":"racks","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":257,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RecoveryServices/","title":"RecoveryServices","parent":"Azure Resources","content":"","description":""},{"id":258,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RedHatOpenShift/","title":"RedHatOpenShift","parent":"Azure Resources","content":"","description":""},{"id":259,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/Redis/","title":"Redis","parent":"Cache","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable zone redundancy for Azure Cache for Redis\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable zone redundancy for Azure Cache for Redis\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability. Potential Benefits:\rHigher resilience and availability\rLearn More:\rEnable zone redundancy for Azure Cache for Redis\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Cache for Redis instances with one or no Zones selected resources | where type == \u0026#34;microsoft.cache/redis\u0026#34; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable zone redundancy for Azure Cache for Redis\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable zone redundancy for Azure Cache for Redis\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability. Potential Benefits:\rHigher resilience and availability\rLearn More:\rEnable zone redundancy for Azure Cache for Redis\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":260,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/redisEnterprise/","title":"redisEnterprise","parent":"Cache","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":261,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerRegistry/registries/","title":"registries","parent":"ContainerRegistry","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Premium tier for critical production workloads\rHigh\rScalability\rYes\rPreview\rEnable zone redundancy\rHigh\rHigh Availability\rYes\rPreview\rEnable geo-replication\rHigh\rDisaster Recovery\rYes\rPreview\rUse Repository namespaces\rLow\rSecurity\rNo\rPreview\rMove Container Registry to a dedicated resource group\rLow\rGovernance\rYes\rPreview\rManage registry size\rMedium\rScalability\rYes\rPreview\rDisable anonymous pull access\rMedium\rSecurity\rYes\rPreview\rConfigure Diagnostic Settings for all Azure Container Registries\rMedium\rMonitoring and Alerting\rNo\rPreview\rMonitor Azure Container Registry with Azure Monitor\rMedium\rMonitoring and Alerting\rNo\rPreview\rEnable soft delete policy\rMedium\rDisaster Recovery\rYes\rPreview\rDetails\rUse Premium tier for critical production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rChoose a service tier of Azure Container Registry to meet your performance needs. Premium offers the most bandwidth and highest rate of read and write operations for high-volume deployments. Use Basic to start, Standard for production, and Premium for hyper-scale performance and geo-replication. Potential Benefits:\rHigh-volume support and geo-replication\rLearn More:\rContainer Registry Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that are not using the Premium tier resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where sku.name != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;eb005943-40a8-194b-9db2-474d430046b7\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SkuName: \u0026#34;, tostring(sku.name)) | order by id asc Enable zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Container Registry\u0026#39;s optional zone redundancy enhances resiliency and high availability for registries or replication resources in a specific region by distributing resources across multiple zones. Potential Benefits:\rEnhances resiliency and high availability\rLearn More:\rRegistry best practices - Enable zone redundancy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that do not have zone redundancy enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.zoneRedundancy != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;63491f70-22e4-3b4a-8b0c-845450e46fac\u0026#34;, name, id, tags, param1=strcat(\u0026#34;zoneRedundancy: \u0026#34;, tostring(properties.zoneRedundancy)) | order by id asc Enable geo-replication\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse Azure Container Registry\u0026#39;s geo-replication for multi-region deployments to simplify registry management and minimize latency. It enables serving global customers from local data centers and supports distributed development teams. Regional webhooks can notify of events in replicas. Potential Benefits:\rSimplifies management, reduces latency\rLearn More:\rRegistry best practices - Enable geo-replication\rGeo-Replicate Container Registry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that do not have geo-replication enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | project registryName = name, registryId = id, tags, primaryRegion = location | join kind=leftouter ( Resources | where type =~ \u0026#34;microsoft.containerregistry/registries/replications\u0026#34; | project replicationRegion=name, replicationId = id | extend registryId=strcat_array(array_slice(split(replicationId, \u0026#39;/\u0026#39;), 0, -3), \u0026#39;/\u0026#39;) ) on registryId | project-away registryId1, replicationId | where isempty(replicationRegion) | project recommendationId = \u0026#34;36ea6c09-ef6e-d743-9cfb-bd0c928a430b\u0026#34;, name=registryName, id=registryId, tags | order by id asc Use Repository namespaces\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUsing repository namespaces allows a single registry to be shared across multiple groups and deployments within an organization, supporting nested namespaces for group isolation. However, repositories are managed independently, not hierarchically. Potential Benefits:\rEnables sharing and group isolation\rLearn More:\rRegistry best practices - use repository namespaces\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Move Container Registry to a dedicated resource group\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rContainer registries, used across multiple hosts, should be in their own resource group to prevent accidental deletion of images when container instances are deleted, preserving the image collection while experimenting with hosts. Potential Benefits:\rSafeguards image collection\rLearn More:\rRegistry best practices - Use dedicated resource group\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List container registries that contain additional resources within the same resource group. resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | project registryName=name, registryId=id, registryTags=tags, resourceGroupId=strcat(\u0026#39;/subscriptions/\u0026#39;, subscriptionId, \u0026#39;/resourceGroups/\u0026#39;, resourceGroup), resourceGroup, subscriptionId | join kind=inner ( resources | where not(type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34;) | summarize recourceCount=count() by subscriptionId, resourceGroup | where recourceCount != 0 ) on resourceGroup, subscriptionId | project recommendationId = \u0026#34;8e389532-5db5-7e4c-9d4d-443b3e55ae82\u0026#34;, name=registryName, id=registryId, tags=registryTags, param1=strcat(\u0026#39;resourceGroupName:\u0026#39;,resourceGroup), param2=strcat(\u0026#39;resourceGroupId:\u0026#39;,resourceGroupId) Manage registry size\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rThe storage constraints of Azure Container Registry\u0026#39;s service tiers align with usage scenarios: Basic for starters, Standard for production, and Premium for high-scale performance and geo-replication. Potential Benefits:\rReduce costs, optimize storage\rLearn More:\rRegistry best practices - Manage registry size\rRetention Policy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that have their retention policy disabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.policies.retentionPolicy.status == \u0026#34;disabled\u0026#34; | project recommendationId = \u0026#34;3ef86f16-f65b-c645-9901-7830d6dc3a1b\u0026#34;, name, id, tags, param1=\u0026#39;retentionPolicy:disabled\u0026#39; | order by id asc Disable anonymous pull access\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rBy default, Azure container registry requires authentication for pull/push actions. Enabling anonymous pull access exposes all content for public read actions. This applies to all repositories, potentially allowing unrestricted access if repository-scoped tokens are used. Potential Benefits:\rEnhanced security and controlled access\rLearn More:\rEnable anonymous pull access\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that have anonymous pull access enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.anonymousPullEnabled == \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;03f4a7d8-c5b4-7842-8e6e-14997a34842b\u0026#34;, name, id, tags | order by id asc Configure Diagnostic Settings for all Azure Container Registries\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations. Potential Benefits:\rEnhanced tracking and debugging\rLearn More:\rMonitoring Azure Container Registry data reference - Resource Logs\rMonitor Azure Container Registry - Enable diagnostic logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor Azure Container Registry with Azure Monitor\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rMonitoring Azure resources using Azure Monitor enhances their availability, performance, and operation. Azure Container Registry, a full-stack monitoring service, provides features for Azure and other cloud and on-premises resources. Potential Benefits:\rEnhanced monitoring and operation\rLearn More:\rMonitoring Azure Container Registry data reference\rMonitor Azure Container Registry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable soft delete policy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling soft delete in Azure Container Registry (ACR) allows for the management of deleted artifacts with a specified retention period. Users can list, filter, and restore these artifacts until automatically purged post-retention. Potential Benefits:\rRecovery of deleted artifacts\rLearn More:\rEnable soft delete policy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Container Registry resources that do not have soft delete enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.policies.softDeletePolicy.status == \u0026#34;disabled\u0026#34; | project recommendationId = \u0026#34;e7f0fd54-fba0-054e-9ab8-e676f2851f88\u0026#34;, name, id, tags | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Premium tier for critical production workloads\rHigh\rScalability\rYes\rPreview\rEnable zone redundancy\rHigh\rHigh Availability\rYes\rPreview\rEnable geo-replication\rHigh\rDisaster Recovery\rYes\rPreview\rUse Repository namespaces\rLow\rSecurity\rNo\rPreview\rMove Container Registry to a dedicated resource group\rLow\rGovernance\rYes\rPreview\rManage registry size\rMedium\rScalability\rYes\rPreview\rDisable anonymous pull access\rMedium\rSecurity\rYes\rPreview\rConfigure Diagnostic Settings for all Azure Container Registries\rMedium\rMonitoring and Alerting\rNo\rPreview\rMonitor Azure Container Registry with Azure Monitor\rMedium\rMonitoring and Alerting\rNo\rPreview\rEnable soft delete policy\rMedium\rDisaster Recovery\rYes\rPreview\rDetails\rUse Premium tier for critical production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rChoose a service tier of Azure Container Registry to meet your performance needs."},{"id":262,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Relay/","title":"Relay","parent":"Azure Resources","content":"","description":""},{"id":263,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/remoteRenderingAccounts/","title":"remoteRenderingAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":264,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/resourceGroups/","title":"resourceGroups","parent":"Resources","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure Resource Group and its Resources are located in the same Region\rHigh\rDisaster Recovery\rYes\rVerified\rDetails\rEnsure Resource Group and its Resources are located in the same Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only. Potential Benefits:\rImproves outage management\rLearn More:\rAzure Resource Manager Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Resource Groups that have resources deployed in a region different than the Resource Group region resources | project id, name, tags, resourceGroup, location | where location != \u0026#34;global\u0026#34; // exclude global resources | where resourceGroup != \u0026#34;networkwatcherrg\u0026#34; // exclude networkwatcherrg | where split(id, \u0026#34;/\u0026#34;, 3)[0] =~ \u0026#34;resourceGroups\u0026#34; // resource is in a resource group | extend resourceGroupId = strcat_array(array_slice(split(id, \u0026#34;/\u0026#34;),0,4), \u0026#34;/\u0026#34;) // create resource group resource id | join (resourcecontainers | project containerid=id, containerlocation=location ) on $left.resourceGroupId == $right.[\u0026#39;containerid\u0026#39;] // join to resourcecontainers table | where location != containerlocation | project recommendationId=\u0026#34;98bd7098-49d6-491b-86f1-b143d6b1a0ff\u0026#34;, name, id, tags | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure Resource Group and its Resources are located in the same Region\rHigh\rDisaster Recovery\rYes\rVerified\rDetails\rEnsure Resource Group and its Resources are located in the same Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only."},{"id":265,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/resources/","title":"resources","parent":"Management","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":266,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/","title":"Resources","parent":"Azure Resources","content":"","description":""},{"id":267,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/routeFilters/","title":"routeFilters","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":268,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/routeTables/","title":"routeTables","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor changes in Route Tables with Azure Monitor\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure locks for Route Tables to avoid accidental changes or deletion\rLow\rGovernance\rNo\rVerified\rDetails\rMonitor changes in Route Tables with Azure Monitor\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources. This setup aids in identifying improper routing changes, including efforts to evade firewalls or access resources from outside. Potential Benefits:\rEnhanced security and change detection\rLearn More:\rAzure activity log - Azure Monitor | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Route Tables without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/routeTables\u0026#34; | project name, id, tags, lowerCaseRouteTableId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/routeTables\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Route Table (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39;) or // All Administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/join/action\u0026#34;\u0026#39;) ) | project lowerCaseRouteTableIdOfScope = tolower(scope) ) on $left.lowerCaseRouteTableId == $right.lowerCaseRouteTableIdOfScope | where isempty(lowerCaseRouteTableIdOfScope) | project recommendationId = \u0026#34;23b2dfc7-7e5d-9443-9f62-980ca621b561\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; Configure locks for Route Tables to avoid accidental changes or deletion\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAs an administrator, you can protect Azure subscriptions, resource groups, or resources from accidental deletions and modifications by setting locks. Potential Benefits:\rPrevents accidental edits/deletions\rLearn More:\rProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMonitor changes in Route Tables with Azure Monitor\rHigh\rMonitoring and Alerting\rYes\rVerified\rConfigure locks for Route Tables to avoid accidental changes or deletion\rLow\rGovernance\rNo\rVerified\rDetails\rMonitor changes in Route Tables with Azure Monitor\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources."},{"id":269,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/sap/","title":"SAP on Azure","parent":"Specialized Workloads","content":"Refer to:\nAzure Center for SAP Solutions Opensource Quality Checks Openssource Inventory Checks General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure that each SAP production system is designed for high availability across availability zones\rHigh\rHigh Availability\rNo\rVerified\rRun SAP application servers on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rNo\rVerified\rIf using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rHigh\rHigh Availability\rYes\rVerified\rEnsure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rHigh\rHigh Availability\rNo\rVerified\rDesign SAP shared file systems for high availability, utilizing availability zones when possible\rHigh\rHigh Availability\rNo\rVerified\rTest high availability solutions thoroughly to ensure fail overs work as expected\rHigh\rHigh Availability\rNo\rVerified\rRemove unwanted location constraints from Linux Pacemaker clusters\rHigh\rHigh Availability\rNo\rVerified\rSecure compute resource capacity for critical VM roles in DR region\rMedium\rDisaster Recovery\rNo\rVerified\rReplicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rHigh\rDisaster Recovery\rNo\rVerified\rSAP components are backed up to DR location using an appropriate backup tool or ASR\rHigh\rDisaster Recovery\rNo\rVerified\rSAP shared files systems are replicated or backed up to DR location\rHigh\rDisaster Recovery\rNo\rVerified\rAutomate DR infrastructure build or pre-deploy DR resources\rMedium\rDisaster Recovery\rNo\rVerified\rDocument and test DR procedure ensure it meets RPO and RTO targets\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure there is a robust monitoring and alerting solution in place for the entire DR solution\rMedium\rDisaster Recovery\rNo\rVerified\rConfigure scheduled events notification\rHigh\rMonitoring and Alerting\rNo\rVerified\rConfigure a Pacemaker cluster for SAP ASCS high availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the load balancer is configured correctly for SAP ASCS High availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the Pacemaker cluster has been setup for SAP HANA DB high availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the load balancer is configured correctly for SAP HANA DB High availability\rHigh\rHigh Availability\rNo\rVerified\rDetails\rEnsure that each SAP production system is designed for high availability across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Availability Zones are physically separate locations within each Azure region that are tolerant to local failures. Use availability zones to protect your applications and data against unlikely data center failures. Ensure each single point of failure of each SAP production system is protected with high availability using multiple availability zones. If you cannot deploy across different zones in a region, then refer to Microsoft guidance for High availability deployment options for SAP workload. Potential Benefits:\rHigh availability for SAP systems\rLearn More:\rSAP ACSS Quality Insights\rOpenSource Inventory Checks\rOpenSource Quality Checks\rMove Regional SAP HA to Zonal\rHigh Availability Deployment Options for SAP\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Run SAP application servers on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Virtual Machines Scale Set (VMSS) with flexible orchestration to distribute the virtual machines across specified zones and within each zone to also distribute VMs across different fault domains within the zone on a best effort basis. Configure VMSS Flex following Microsoft recommendation for SAP workload using the right mode and correct settings. If you aren\u0026#39;t currently using VMSS Flex for SAP application servers and also not using Availability Sets with Fault domain and Update domain distribution, then you should consider moving to VMSS Flex architecture to improve the resiliency posture of your SAP deployment. The following blog post in links below outlines the details on the process of migrating existing SAP workloads that are deployed in an availability set or availability zone to a flexible scale set with FD=1 deployment option. Potential Benefits:\rEnhanced resiliency for SAP on Azure\rLearn More:\rOpenSource Inventory Checks\rVirtual machine Scale Set SAP Deployment Guide\rConsiderations for Flexible VM Scale Sets for SAP\rMigrate existing SAP system VMs to VMSS Flex\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development If using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor single-instance VMs, both OS and data disks must be either Premium SSD or Ultra Disk to achieve the single-instance SLA of 99.9% availability. Potential Benefits:\rHigher SLA of 99.9% with SSDs\rLearn More:\rSAP ACSS Insights\rOpenSource Inventory Checks\rOpenSource Quality Checks\rVM SLA\rSAP Storage Planning Guide\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all single instance VMs that have an attached disk that is not in the Premium or Ultra sku tier. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.virtualMachineScaleSet.id) | where isnotnull(properties.availabilitySet) | extend lname = tolower(name) | join kind=leftouter(resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where not(sku.tier =~ \u0026#39;Premium\u0026#39;) and not(sku.tier =~ \u0026#39;Ultra\u0026#39;) | extend lname = tolower(tostring(split(managedBy, \u0026#39;/\u0026#39;)[8])) | project lname, name | summarize disks = make_list(name) by lname) on lname | where isnotnull(disks) | project recommendationId = \u0026#34;df0ff862-814d-45a3-95e4-4fad5a244ba6\u0026#34;, name, id, tags, param1=strcat(\u0026#34;AffectedDisks: \u0026#34;, disks) Ensure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rHigh availability for databases should be implemented using database native replication technologies and the data should be replicated synchronously that is in SYNC mode from primary database to a stand-by node. Potential Benefits:\rEnsures high availability for SAP data\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Design SAP shared file systems for high availability, utilizing availability zones when possible\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSAP shared file systems such as /sapmnt, /usr/trans, interfaces should be made highly available. In case of Azure File Shares, we recommend that you use ZRS (Zone-redundant storage) and for Azure NetApp Files use Zonal replication for your volumes. Potential Benefits:\rEnhanced data availability for SAP\rLearn More:\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Test high availability solutions thoroughly to ensure fail overs work as expected\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTest all high availability solutions thoroughly (including kernel panic in Linux VMs and also fail-back). Include zonal failure scenarios in your testing, the testing should confirm that each layer of your SAP solution including database, central services, application servers and shared file systems is configured correctly for zone redundancy, the solution meets RPO = 0 and the application fails over automatically meeting your RTO. The fail back can be either automatic or manual. Potential Benefits:\rEnsures SAP Azure\u0026#39;s failover reliability\rLearn More:\rTest Cases\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Remove unwanted location constraints from Linux Pacemaker clusters\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen executing a migrate command in a Linux Pacemaker cluster, the system generates a temporary \u0026#34;prefer\u0026#34; location constraint, aiming to move a resource to a specified node. This constraint prioritizes the target node for the resource temporarily without permanently altering the cluster\u0026#39;s configuration. During planned maintenances and fail over testing, you can leverage the migrate command for temporary resource relocation during maintenance or administrative tasks to ensure minimal disruption. This constraint is not permanent and does not survive reboots or cluster resets. It\u0026#39;s designed for short-term adjustments. Once the planned task necessitating the resource migration is complete, manually remove the temporary constraint to revert to the cluster\u0026#39;s original resource management policies. This approach allows for controlled resource movement within the cluster, facilitating maintenance while preserving the integrity and efficiency of the cluster\u0026#39;s configuration. Potential Benefits:\rEnhanced maintenance and failover handling\rLearn More:\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Secure compute resource capacity for critical VM roles in DR region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo ensure the availability of compute resources for critical VM roles in a DR region, consider securing capacity either through a warm standby approach or by utilizing Azure\u0026#39;s On-demand Capacity Reservation. Warm standby involves keeping VMs in the DR region running. On-demand Capacity Reservation, on the other hand, reserves compute capacity without having to run the VMs, allowing you to start them when needed. When DR VMs are not needed, the reserved capacity may safely be used to run other workloads without the risk of losing the capacity to other customers. This strategy guarantees resource availability for your critical workloads in the event of a disaster, balancing cost and readiness. Potential Benefits:\rGuarantees DR region availability\rLearn More:\rCapacity Reservation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Replicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rReplicate production databases (ASYNC) to the DR location using the database vendor\u0026#39;s replication technology. Potential Benefits:\rEnhanced DR resilience\rLearn More:\rSAP Disaster Recovery Guide\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development SAP components are backed up to DR location using an appropriate backup tool or ASR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSAP components such as (A)SCS, application servers, WebDispatchers, etc are backed up to DR location using an appropriate backup tool or ASR. Potential Benefits:\rEnsures SAP data safety and recovery\rLearn More:\rSAP ACSS Insights\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development SAP shared files systems are replicated or backed up to DR location\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rImplementing robust monitoring and alerting for DR in SAP on Azure ensures coverage across its complex, multi-layer architecture. This strategy is crucial for databases, services, applications, and shared systems. Potential Benefits:\rEnhances SAP DR oversight\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automate DR infrastructure build or pre-deploy DR resources\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAutomate the build of disaster recovery (DR) infrastructure (or pre-deploy DR resources) and streamline SAP service recovery as much as possible. Potential Benefits:\rFaster SAP recovery, reduced downtime\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Document and test DR procedure ensure it meets RPO and RTO targets\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCreate detailed documentation of your DR procedures for each layer of the SAP architecture-database, central services, application servers, and shared file systems. This documentation should include configuration details, failover mechanisms, and step-by-step recovery procedures. Test a wide range of failure scenarios, including regional outages. Testing should confirm that your DR strategy is robust, meets your RPO and RTO targets, and provides seamless failover across all layers of the SAP architecture. This will ensure a comprehensive and resilient DR strategy capable of withstanding regional failures and ensuring business continuity. Potential Benefits:\rEnsures robust DR, meets RPO/RTO\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure there is a robust monitoring and alerting solution in place for the entire DR solution\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor an SAP solution hosted on Azure it is imperative to implement a robust monitoring and alerting solution that comprehensively covers DR of each layer of the SAP architecture. Given the complexity of SAP systems, which span multiple layers using diverse technologies and Azure resources, each with potentially distinct DR replication mechanisms, an appropriate monitoring strategy is crucial. The different layers include database, central services, application, and shared file systems. Potential Benefits:\rImproved DR oversight and rapid issue response\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure scheduled events notification\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rScheduled events is an Azure Metadata Services that provides proactive notifications about upcoming maintenance events (for example, reboot) so that your application can prepare for them and limit disruption. You should configure scheduled events for all your critical Azure VMs. Resource agent azure-events-az can also integrate with Pacemaker clusters. To ensure high availability and service continuity in your Azure VMs, you should configure the azure-events-az resource agent within your Pacemaker clusters. This agent monitors for scheduled Azure maintenance events and can proactively relocate resources for a graceful node shutdown. Configure the agent to monitor specific event types such as Reboot and Redeploy, and enable verbose logging for detailed diagnostics. In addition, it is also important that you define a procedure on how to react to scheduled events. Potential Benefits:\rProactive maintenance awareness\rLearn More:\rVM Scheduled Events\rConfigure Pacemaker for Azure Scheduled Events\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure a Pacemaker cluster for SAP ASCS high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor the ASCS-Pacemaker (Central Server Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability. Potential Benefits:\rEnhances SAP ASCS uptime\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rASCS-Pacemaker - Central Server Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the load balancer is configured correctly for SAP ASCS High availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor the ASCS-LB (Central Server Instance), ensure that the load balancer is configured correctly for SAP ASCS high availability. Potential Benefits:\rEnhanced HA for SAP ASCS\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rASCS-LB - Central Server Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor the DBHANA-Pacemaker (Database Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP HANA database high availability. Potential Benefits:\rEnhances SAP HANA DB uptime\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rDBHANA-Pacemaker - Database Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the load balancer is configured correctly for SAP HANA DB High availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor the DBHANA-LB (Database Instance), make sure the load balancer is configured correctly for SAP HANA database high availability. Potential Benefits:\rEnhanced DB availability\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rDBHANA-LB- Database Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Refer to:\nAzure Center for SAP Solutions Opensource Quality Checks Openssource Inventory Checks General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure that each SAP production system is designed for high availability across availability zones\rHigh\rHigh Availability\rNo\rVerified\rRun SAP application servers on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rNo\rVerified\rIf using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rHigh\rHigh Availability\rYes\rVerified\rEnsure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rHigh\rHigh Availability\rNo\rVerified\rDesign SAP shared file systems for high availability, utilizing availability zones when possible\rHigh\rHigh Availability\rNo\rVerified\rTest high availability solutions thoroughly to ensure fail overs work as expected\rHigh\rHigh Availability\rNo\rVerified\rRemove unwanted location constraints from Linux Pacemaker clusters\rHigh\rHigh Availability\rNo\rVerified\rSecure compute resource capacity for critical VM roles in DR region\rMedium\rDisaster Recovery\rNo\rVerified\rReplicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rHigh\rDisaster Recovery\rNo\rVerified\rSAP components are backed up to DR location using an appropriate backup tool or ASR\rHigh\rDisaster Recovery\rNo\rVerified\rSAP shared files systems are replicated or backed up to DR location\rHigh\rDisaster Recovery\rNo\rVerified\rAutomate DR infrastructure build or pre-deploy DR resources\rMedium\rDisaster Recovery\rNo\rVerified\rDocument and test DR procedure ensure it meets RPO and RTO targets\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure there is a robust monitoring and alerting solution in place for the entire DR solution\rMedium\rDisaster Recovery\rNo\rVerified\rConfigure scheduled events notification\rHigh\rMonitoring and Alerting\rNo\rVerified\rConfigure a Pacemaker cluster for SAP ASCS high availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the load balancer is configured correctly for SAP ASCS High availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the Pacemaker cluster has been setup for SAP HANA DB high availability\rHigh\rHigh Availability\rNo\rVerified\rEnsure the load balancer is configured correctly for SAP HANA DB High availability\rHigh\rHigh Availability\rNo\rVerified\rDetails\rEnsure that each SAP production system is designed for high availability across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Availability Zones are physically separate locations within each Azure region that are tolerant to local failures."},{"id":270,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/scalingPlans/","title":"scalingPlans","parent":"DesktopVirtualization","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rScaling plans should be created per region and not scaled across regions\rMedium\rScalability\rNo\rVerified\rDetails\rScaling plans should be created per region and not scaled across regions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEach region has its own scaling plans assigned to host pools within that region. However, these plans can become inaccessible if there\u0026#39;s a regional failure. To mitigate this risk, it\u0026#39;s advisable to create a secondary scaling plan in another region. Potential Benefits:\rEnhanced scaling\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rScaling plans should be created per region and not scaled across regions\rMedium\rScalability\rNo\rVerified\rDetails\rScaling plans should be created per region and not scaled across regions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEach region has its own scaling plans assigned to host pools within that region. However, these plans can become inaccessible if there\u0026#39;s a regional failure."},{"id":271,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/scheduledQueryRules/","title":"scheduledQueryRules","parent":"Insights","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":272,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Search/","title":"Search","parent":"Azure Resources","content":"","description":""},{"id":273,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Search/searchServices/","title":"searchServices","parent":"Search","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":274,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/secrets/","title":"secrets","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":275,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/serverFarms/","title":"serverFarms","parent":"Web","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMigrate App Service to availability Zone Support\rHigh\rHigh Availability\rYes\rPreview\rUse Standard or Premium tier\rHigh\rHigh Availability\rYes\rPreview\rAvoid scaling up or down\rMedium\rScalability\rYes\rPreview\rCreate separate App Service plans for production and test\rHigh\rGovernance\rNo\rPreview\rEnable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rMedium\rScalability\rNo\rPreview\rDetails\rMigrate App Service to availability Zone Support\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure\u0026#39;s feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services. Potential Benefits:\rEnhances app resiliency and reliability\rLearn More:\rMigrate App Service to availability zone support\rHigh availability enterprise deployment using App Service Environment\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // The query filters the qualified App Service Plans that do not have Zone Redundancy enabled. // Its important to check regions that support availability zones for Azure App Services running on multi-tenant and App Service Environments https://learn.microsoft.com/en-us/azure/reliability/reliability-app-service?tabs=graph%2Ccli#:~:text=The%20following%20regions%20support%20Azure%20App%20Services%20running%20on%20multi%2Dtenant%20environments%3A resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | extend zoneRedundant = tobool(properties.zoneRedundant) | extend sku_tier = tostring(sku.tier) | where (tolower(sku_tier) contains \u0026#34;isolated\u0026#34; or tolower(sku_tier) contains \u0026#34;premium\u0026#34;) and zoneRedundant == false | project recommendationid=\u0026#34;88cb90c2-3b99-814b-9820-821a63f600dd\u0026#34;, name, id, tags, param1=sku_tier, param2=\u0026#34;Not Zone Redundant\u0026#34; Use Standard or Premium tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rChoose Standard/Premium Azure App Service Plan for robust apps with advanced scaling, high availability, better performance, and multiple slots, ensuring resilience and continuous operation. Potential Benefits:\rEnhanced scaling and reliability\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure App Service Plans that are not in the \u0026#34;Standard\u0026#34;, \u0026#34;Premium\u0026#34;, or \u0026#34;IsolatedV2\u0026#34; SKU tiers. resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | extend sku_tier = tostring(sku.tier) | where tolower(sku_tier) !contains \u0026#34;standard\u0026#34; and tolower(sku_tier) !contains \u0026#34;premium\u0026#34; and tolower(sku_tier) !contains \u0026#34;isolatedv2\u0026#34; | project recommendationid=\u0026#34;b2113023-a553-2e41-9789-597e2fb54c31\u0026#34;, name, id, tags, param1= strcat(\u0026#34;SKU=\u0026#34;,sku_tier) Avoid scaling up or down\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAvoid frequent scaling up/down of Azure App Service instances to prevent service disruptions. Choose the right tier and size for the workload and scale out for traffic changes, as scaling adjustments can trigger application restarts. Potential Benefits:\rMinimizes restarts, enhances stability\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure App Service Plans and the number of changes that was made to the pricing tier, if the count is higher that 3 it means you need to avoid scaling up and down that often resourcechanges | extend changeTime = todatetime(properties.changeAttributes.timestamp), targetResourceId = tostring(properties.targetResourceId), changeType = tostring(properties.changeType), correlationId = properties.changeAttributes.correlationId, changedProperties = properties.changes, changeCount = properties.changeAttributes.changesCount | where changeTime \u0026gt; ago(14d) | join kind=inner (resources | project resources_Name = name, resources_Type = type, resources_Subscription= subscriptionId, resources_ResourceGroup= resourceGroup, id) on $left.targetResourceId == $right.id | where resources_Type contains \u0026#34;microsoft.web/serverfarms\u0026#34; | where changedProperties[\u0026#39;sku.name\u0026#39;].propertyChangeType == \u0026#39;Update\u0026#39; or changedProperties[\u0026#39;sku.tier\u0026#39;].propertyChangeType == \u0026#39;Update\u0026#39; | summarize count() by targetResourceId, resources_Name ,tostring(changedProperties[\u0026#39;sku.name\u0026#39;].previousValue), tostring(changedProperties[\u0026#39;sku.tier\u0026#39;].newValue) | project recommendationid=\u0026#34;07243659-4643-d44c-a1c6-07ac21635072\u0026#34;, name=resources_Name, id=targetResourceId, tags=\u0026#34;\u0026#34;, param1=[\u0026#39;changedProperties_sku.name_previousValue\u0026#39;], param2=[\u0026#39;changedProperties_sku.tier_newValue\u0026#39;], param3=count_ Create separate App Service plans for production and test\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIt is strongly recommended to create separate App Service plans for production and test environments to avoid using slots within your production deployment for testing purposes. Potential Benefits:\rProtects prod performance; avoids test impact\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling Autoscale/Automatic Scaling for your Azure App Service ensures sufficient resources for incoming requests. Autoscaling is rule-based, whereas Automatic Scaling, a newer feature, automatically adjusts resources based on HTTP traffic. Potential Benefits:\rOptimizes resources for traffic\rLearn More:\rAutomatic scaling in Azure App Service\rAuto Scale Web Apps\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMigrate App Service to availability Zone Support\rHigh\rHigh Availability\rYes\rPreview\rUse Standard or Premium tier\rHigh\rHigh Availability\rYes\rPreview\rAvoid scaling up or down\rMedium\rScalability\rYes\rPreview\rCreate separate App Service plans for production and test\rHigh\rGovernance\rNo\rPreview\rEnable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rMedium\rScalability\rNo\rPreview\rDetails\rMigrate App Service to availability Zone Support\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure\u0026#39;s feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services."},{"id":276,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/serverGroupsv2/","title":"serverGroupsv2","parent":"DBforPostgreSQL","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":277,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AnalysisServices/servers/","title":"servers","parent":"AnalysisServices","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":278,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMariaDB/servers/","title":"servers","parent":"DBforMariaDB","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":279,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/servers/","title":"servers","parent":"DBforMySQL","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":280,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/servers/","title":"servers","parent":"DBforPostgreSQL","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":281,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/servers/","title":"servers","parent":"Sql","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rHigh\rDisaster Recovery\rYes\rVerified\rAuto Failover Groups can encompass one or multiple databases, usually used by the same app.\rHigh\rDisaster Recovery\rYes\rVerified\rUse a Zone-Redundant Database\rMedium\rHigh Availability\rYes\rVerified\rImplement Retry Logic\rHigh\rHigh Availability\rNo\rVerified\rMonitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rHigh\rMonitoring and Alerting\rYes\rVerified\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rActive Geo Replication ensures business continuity by utilizing readable secondary database replicas. In case of primary database failure, manually failover to secondary database. Secondaries, up to four, can be in same/different regions, used for read-only access. Potential Benefits:\rEnhanced disaster recovery and read scalability\rLearn More:\rActive Geo Replication\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not part of Geo Replication. resources | where type == \u0026#34;microsoft.sql/servers/databases\u0026#34; | summarize secondaryTypeCount = countif(isnotempty(properties.secondaryType)) by name | where secondaryTypeCount == 0 | join kind=inner ( Resources | where type == \u0026#34;microsoft.sql/servers/databases\u0026#34; ) on name | extend param1 = \u0026#34;Not part of Geo Replication\u0026#34; | project recommendationId = \u0026#34;74c2491d-048b-0041-a140-935960220e20\u0026#34;, name, id, tags, param1 Auto Failover Groups can encompass one or multiple databases, usually used by the same app.\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFailover Groups facilitate disaster recovery by configuring databases on one logical server to replicate to another region\u0026#39;s logical server. This streamlines geo-replicated database management, offering a single endpoint for connection routing to replicated databases if the primary server fails. Potential Benefits:\rImproves load balancing and disaster recovery\rLearn More:\rAutoFailover Groups\rDR Design\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not configured to use a failover-group. resources | where type =~\u0026#39;microsoft.sql/servers/databases\u0026#39; | where isnull(properties[\u0026#39;failoverGroupId\u0026#39;]) | project recommendationId = \u0026#34;943c168a-2ec2-a94c-8015-85732a1b4859\u0026#34;, name, id, tags, param1= strcat(\u0026#34;databaseId=\u0026#34;, properties[\u0026#39;databaseId\u0026#39;]) Use a Zone-Redundant Database\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rBy default, Azure SQL Database premium tier provisions multiple copies within the same region. For geo redundancy, databases can be set as Zone Redundant, distributing copies across Azure Availability Zones to maintain availability during regional outages. Potential Benefits:\rEnhanced reliability, no extra cost\rLearn More:\rZone Redundant Databases\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Finds non-zone redundant SQL databases and lists them Resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | where tolower(tostring(properties.zoneRedundant))=~\u0026#39;false\u0026#39; |project recommendationId = \u0026#34;c0085c32-84c0-c247-bfa9-e70977cbf108\u0026#34;, name, id, tags Implement Retry Logic\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDuring transient failures, the application should handle connection retries effectively with Azure SQL Database. No Database layer configuration is needed; instead, the application must be set up for graceful retrying. Potential Benefits:\rEnhanced connectivity stability\rLearn More:\rHow to Implement Retry Logic\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring and alerting are an important part of database operations. When working with Azure SQL Database, make use of Azure Monitor and SQL Insights to ensure that you capture relevant database metrics. Potential Benefits:\rQuick incident detection and response\rLearn More:\rAzure Monitor\rAzure SQL Database Monitoring\rMonitoring SQL Database Reference\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not configured for monitoring. resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | project databaseid = properties_scopes, monitoredMetric = properties_criteria_allOf.metricName | where databaseid contains \u0026#39;databases\u0026#39; | summarize monitoredMetrics=make_list(monitoredMetric) by tostring(databaseid) | join kind=fullouter ( resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | project databaseid = tolower(id), name, tags ) on databaseid |where isnull(monitoredMetrics) |project recommendationId = \u0026#34;7e7daec9-6a81-3546-a4cc-9aef72fec1f7\u0026#34;, name, id=databaseid1, tags, param1=strcat(\u0026#34;MonitoringMetrics=false\u0026#34; ) Back Up Your Keys\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIt is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up and stored in a secure manner. Potential Benefits:\rEnhanced security and data recovery\rLearn More:\rAzure Key Vault\rGetting Started with Always Encrypted\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rHigh\rDisaster Recovery\rYes\rVerified\rAuto Failover Groups can encompass one or multiple databases, usually used by the same app.\rHigh\rDisaster Recovery\rYes\rVerified\rUse a Zone-Redundant Database\rMedium\rHigh Availability\rYes\rVerified\rImplement Retry Logic\rHigh\rHigh Availability\rNo\rVerified\rMonitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rHigh\rMonitoring and Alerting\rYes\rVerified\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rVerified\rDetails\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rActive Geo Replication ensures business continuity by utilizing readable secondary database replicas."},{"id":282,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ApiManagement/service/","title":"service","parent":"ApiManagement","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMigrate API Management services to Premium SKU to support Availability Zones\rHigh\rHigh Availability\rYes\rPreview\rEnable Availability Zones on Premium API Management instances\rHigh\rHigh Availability\rYes\rPreview\rUpgrade to platform version stv2\rHigh\rHigh Availability\rYes\rPreview\rDetails\rMigrate API Management services to Premium SKU to support Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUpgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions. Potential Benefits:\rEnhanced availability and resilience\rLearn More:\rChange your API Management service tier\rMigrate Azure API Management to availability zone support\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all API Management instances that aren\u0026#39;t Premium resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend skuName = sku.name | where tolower(skuName) != tolower(\u0026#39;premium\u0026#39;) | project recommendationId = \u0026#34;baf3bfc0-32a2-4c0c-926d-c9bf0b49808e\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SKU: \u0026#34;, skuName) Enable Availability Zones on Premium API Management instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rZone redundancy for APIM instances ensures the gateway and control plane (Management API, developer portal, Git configuration) are replicated across datacenters in physically separated zones, boosting resilience to zone failures. Potential Benefits:\rImproved resilience to zone failures\rLearn More:\rEnsure API Management availability and reliability\rMigrate Azure API Management to availability zone support\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Premium API Management instances that aren\u0026#39;t zone redundant resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend skuName = sku.name | where tolower(skuName) == tolower(\u0026#39;premium\u0026#39;) | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend zoneValue = iff((isnull(zones)), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;740f2c1c-8857-4648-80eb-47d2c56d5a50\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Zones value: \u0026#34;, zoneValue ) Upgrade to platform version stv2\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUpgrading to API Management stv2 is required as stv1 retires on 31 Aug 2024, offering enhanced capabilities with the new platform version. Potential Benefits:\rEnsures service continuity\rLearn More:\rAzure API Management - stv1 platform retirement (August 2024)\rAzure API Management compute platform\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all API Management instances that aren\u0026#39;t upgraded to platform version stv2 resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend plat_version = properties.platformVersion | extend skuName = sku.name | where tolower(plat_version) != tolower(\u0026#39;stv2\u0026#39;) | project recommendationId = \u0026#34;e35cf148-8eee-49d1-a1c9-956160f99e0b\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Platform Version: \u0026#34;, plat_version) , param2=strcat(\u0026#34;SKU: \u0026#34;, skuName) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rMigrate API Management services to Premium SKU to support Availability Zones\rHigh\rHigh Availability\rYes\rPreview\rEnable Availability Zones on Premium API Management instances\rHigh\rHigh Availability\rYes\rPreview\rUpgrade to platform version stv2\rHigh\rHigh Availability\rYes\rPreview\rDetails\rMigrate API Management services to Premium SKU to support Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUpgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions."},{"id":283,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceBus/","title":"ServiceBus","parent":"Azure Resources","content":"","description":""},{"id":284,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/","title":"ServiceFabric","parent":"Azure Resources","content":"","description":""},{"id":285,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/","title":"ServiceFabricMesh","parent":"Azure Resources","content":"","description":""},{"id":286,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceNetworking/","title":"ServiceNetworking","parent":"Azure Resources","content":"","description":""},{"id":287,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/services/","title":"services","parent":"HealthcareApis","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":288,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServicesHub/","title":"ServicesHub","parent":"Azure Resources","content":"","description":""},{"id":289,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/signalR/","title":"signalR","parent":"SignalRService","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable zone redundancy for SignalR\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable zone redundancy for SignalR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime. Potential Benefits:\rEnhances reliability and uptime\rLearn More:\rAvailability zones support in Azure SignalR Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find SignalR instances that are not configured with the Premium tier resources | where type == \u0026#34;microsoft.signalrservice/signalr\u0026#34; | where sku.tier != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;6a8b3db9-5773-413a-a127-4f7032f34bbd\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable zone redundancy for SignalR\rHigh\rHigh Availability\rYes\rPreview\rDetails\rEnable zone redundancy for SignalR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime. Potential Benefits:\rEnhances reliability and uptime\rLearn More:\rAvailability zones support in Azure SignalR Service\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":290,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/","title":"SignalRService","parent":"Azure Resources","content":"","description":""},{"id":291,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Singularity/","title":"Singularity","parent":"Azure Resources","content":"","description":""},{"id":292,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/sites/","title":"sites","parent":"Web","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable diagnostics logging\rLow\rMonitoring and Alerting\rNo\rPreview\rMonitor Performance\rMedium\rMonitoring and Alerting\rNo\rPreview\rSeparate web apps from web APIs\rLow\rScalability\rNo\rPreview\rCreate a separate storage account for logs\rMedium\rScalability\rNo\rPreview\rDeploy to a staging slot\rMedium\rGovernance\rYes\rPreview\rStore configuration as app settings\rMedium\rOther Best Practices\rYes\rPreview\rDetails\rEnable diagnostics logging\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging. Potential Benefits:\rEnhanced monitoring and diagnostics\rLearn More:\rEnable diagnostics logging for apps in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under development Monitor Performance\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse Application Insights to monitor app performance and load behavior, offering real-time insights, issue diagnosis, and root-cause analysis. It supports ASP.NET, ASP.NET Core, Java, and Node.js on Azure App Service, now with built-in monitoring. Potential Benefits:\rReal-time insights and issue diagnosis\rLearn More:\rApplication Insights\rApplication monitoring for Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Separate web apps from web APIs\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rIf your solution includes both a web front end and a web API, decomposing them into separate App Service apps facilitates solution decomposition by workload, allowing for independent scaling. Initially, you can deploy both in the same plan and separate them for independent scaling when necessary. Potential Benefits:\rIndependent scaling, easier management\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a separate storage account for logs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCreating a separate storage account for logs and not using the same one for application data prevents logging activities from reducing application performance by ensuring that the resources dedicated to handling application data are not burdened by logging processes. Potential Benefits:\rImproves app performance\rLearn More:\rResiliency checklist\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Deploy to a staging slot\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCreate a deployment slot for staging to deploy updates, verify them, and ensure all instances are warmed up before production swap, reducing bad update chances. An LKG slot allows easy rollback to a previous good deployment if issues arise later, enhancing reliability. Potential Benefits:\rSafer updates and easy rollback\rLearn More:\rSet up staging environments in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Display App Service with the count of deployment slots for Apps under eligible App service plans and it shows if deployment slot is enabled or not resources | where type =~ \u0026#39;microsoft.web/sites\u0026#39; or type =~ \u0026#39;microsoft.web/sites/slots\u0026#39; | extend isSlot = iff(type =~ \u0026#39;microsoft.web/sites/slots\u0026#39;, 1, 0) | extend AspName = iff(isSlot == 1, split(name, \u0026#39;/\u0026#39;)[0], name) | extend Sku = tostring(properties.sku) | where tolower(Sku) contains \u0026#34;standard\u0026#34; or tolower(Sku) contains \u0026#34;premium\u0026#34; or tolower(Sku) contains \u0026#34;isolatedv2\u0026#34; | project id, name, AspName, isSlot, Sku | summarize Slots = countif(isSlot == 1) by id, name, AspName, Sku | extend DeploymentSlotEnabled = iff(Slots \u0026gt; 1, true, false) | where DeploymentSlotEnabled = false | project recommendationId=\u0026#34;a1d91661-32d4-430b-b3b6-5adeb0975df7\u0026#34;, name, id, tags=\u0026#34;\u0026#34;, param1=Sku, param2=Slots, param3=\u0026#34;DeploymentSlotEnabled=false\u0026#34; Store configuration as app settings\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse app settings for configuration and define them in Resource Manager templates or via PowerShell to facilitate part of an automated deployment/update process for improved reliability. Potential Benefits:\rEnhanced reliability via automation\rLearn More:\rConfigure web apps in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure App Service resources that don\u0026#39;t have App Settings configured appserviceresources | where type == \u0026#34;microsoft.web/sites/config\u0026#34; | extend AppSettings = iif(isempty(properties.AppSettings), true, false) | where AppSettings == false | project recommendationId=\u0026#34;0b80b67c-afbe-4988-ad58-a85a146b681e\u0026#34;, id, name, tags=\u0026#34;\u0026#34;, param1=\u0026#34;AppSettings is not configured\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable diagnostics logging\rLow\rMonitoring and Alerting\rNo\rPreview\rMonitor Performance\rMedium\rMonitoring and Alerting\rNo\rPreview\rSeparate web apps from web APIs\rLow\rScalability\rNo\rPreview\rCreate a separate storage account for logs\rMedium\rScalability\rNo\rPreview\rDeploy to a staging slot\rMedium\rGovernance\rYes\rPreview\rStore configuration as app settings\rMedium\rOther Best Practices\rYes\rPreview\rDetails\rEnable diagnostics logging\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging."},{"id":293,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/snapshots/","title":"snapshots","parent":"Compute","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":294,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/spacecrafts/","title":"spacecrafts","parent":"Orbital","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":295,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/IntegrationSpaces/spaces/","title":"spaces","parent":"IntegrationSpaces","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":296,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/spatialAnchorsAccounts/","title":"spatialAnchorsAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":297,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppPlatform/Spring/","title":"Spring","parent":"AppPlatform","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":298,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/","title":"Sql","parent":"Azure Resources","content":"","description":""},{"id":299,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/","title":"SqlVirtualMachine","parent":"Azure Resources","content":"","description":""},{"id":300,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/sqlVirtualMachineGroups/","title":"sqlVirtualMachineGroups","parent":"SqlVirtualMachine","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":301,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/sqlVirtualMachines/","title":"sqlVirtualMachines","parent":"SqlVirtualMachine","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":302,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/staticSites/","title":"staticSites","parent":"Web","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":303,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Storage/","title":"Storage","parent":"Azure Resources","content":"","description":""},{"id":304,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Storage/storageAccounts/","title":"storageAccounts","parent":"Storage","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure that storage accounts are zone or region redundant\rHigh\rHigh Availability\rYes\rVerified\rDo not use classic storage accounts\rHigh\rService Upgrade and Retirement\rYes\rVerified\rEnsure Performance tier is set as per workload\rMedium\rScalability\rNo\rVerified\rEnable soft delete for recovery of data\rMedium\rDisaster Recovery\rNo\rVerified\rEnable versioning for accidental modification and keep the number of versions below 1000\rLow\rDisaster Recovery\rNo\rVerified\rEnable point-in-time restore for GPv2 accounts to safeguard against data loss\rLow\rDisaster Recovery\rNo\rVerified\rMonitor all blob storage accounts\rLow\rMonitoring and Alerting\rNo\rVerified\rConsider upgrading legacy storage accounts to v2 storage accounts\rLow\rScalability\rYes\rVerified\rEnable Azure Private Link service for storage accounts\rMedium\rSecurity\rYes\rVerified\rDetails\rEnsure that storage accounts are zone or region redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rRedundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability. Locally redundant storage offers the least durability at the lowest cost. Potential Benefits:\rHigh availability and durability for storage\rLearn More:\rAzure Storage redundancy\rChange the redundancy configuration for a storage account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all storage accounts that are not using Zone or Region replication Resources | where type =~ \u0026#34;Microsoft.Storage/storageAccounts\u0026#34; | where sku.name in~ (\u0026#34;Standard_LRS\u0026#34;, \u0026#34;Premium_LRS\u0026#34;) | project recommendationId = \u0026#34;e6c7e1cc-2f47-264d-aa50-1da421314472\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name) Do not use classic storage accounts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rClassic storage accounts will be fully retired on August 31, 2024. If you have classic storage accounts, start planning your migration now. Potential Benefits:\rAvoids service retirement issues\rLearn More:\rAzure classic storage accounts retirement announcement\rMigrate your classic storage accounts to Azure Resource Manager\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure classic Storage Account resources | where type =~ \u0026#39;microsoft.classicstorage/storageaccounts\u0026#39; | project recommendationId = \u0026#39;63ad027e-611c-294b-acc5-8e3234db9a40\u0026#39;, name, id, tags, param1=type Ensure Performance tier is set as per workload\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConsider using the appropriate storage performance tier for workload scenarios. Each workload scenario requires appropriate performance tiers, and selecting the appropriate tiers based on storage usage is crucial. Potential Benefits:\rOptimized cost and performance\rLearn More:\rTypes of storage accounts\rScalability and performance targets for standard storage accounts\rPerformance and scalability checklist for Blob storage\rScalability and performance targets for Blob storage\rPremium block blob storage accounts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable soft delete for recovery of data\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe soft delete option enables data recovery if mistakenly deleted, while the Lock feature prevents the accidental deletion of the storage account itself, ensuring additional security and data integrity measures. Potential Benefits:\rPrevents accidental data/account loss\rLearn More:\rSoft delete detail docs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable versioning for accidental modification and keep the number of versions below 1000\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConsider enabling versioning for Azure Storage Accounts to recover from accidental modifications or deletions and manage blob operation latency. Microsoft advises maintaining fewer than 1000 versions per blob to optimize performance. Lifecycle management can help delete old versions automatically. Potential Benefits:\rRecover data, manage latency\rLearn More:\rBlob versioning\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable point-in-time restore for GPv2 accounts to safeguard against data loss\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConsider enabling point-in-time restore for standard general purpose v2 accounts with flat namespace to protect against accidental deletion or corruption by restoring block blob data to an earlier state. Potential Benefits:\rProtects data from loss/corruption\rLearn More:\rPoint-in-time restore for block blobs\rPerform a point-in-time restore on block blob data\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor all blob storage accounts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor critical applications and business processes relying on Azure, monitoring and alerts are crucial. Resource logs are only stored after creating a diagnostic setting to route logs to specified locations, requiring selection of log categories to collect. Potential Benefits:\rEnhanced alerting and log analysis\rLearn More:\rMonitor Azure Blob Storage\rBest practices for monitoring Azure Blob Storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Consider upgrading legacy storage accounts to v2 storage accounts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rGeneral-purpose v2 accounts are recommended for most storage scenarios offering the latest features or the lowest per-gigabyte pricing. Legacy accounts like Standard general-purpose v1 and Blob Storage aren\u0026#39;t advised by Microsoft but may fit specific scenarios. Potential Benefits:\rLatest features, lowest cost\rLearn More:\rLegacy storage account types\rUpgrade to a general-purpose v2 storage account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Storage Accounts, that upgradeable to General purpose v2. Resources | where type =~ \u0026#34;Microsoft.Storage/storageAccounts\u0026#34; and kind in~ (\u0026#34;Storage\u0026#34;, \u0026#34;BlobStorage\u0026#34;) | extend param1 = strcat(\u0026#34;AccountKind: \u0026#34;, case(kind =~ \u0026#34;Storage\u0026#34;, \u0026#34;Storage (general purpose v1)\u0026#34;, kind =~ \u0026#34;BlobStorage\u0026#34;, \u0026#34;BlobStorage\u0026#34;, kind)), param2 = strcat(\u0026#34;Performance: \u0026#34;, sku.tier), param3 = strcat(\u0026#34;Replication: \u0026#34;, sku.name) | project recommendationId = \u0026#34;2ad78dec-5a4d-4a30-8fd1-8584335ad781\u0026#34;, name, id, tags, param1, param2, param3 Enable Azure Private Link service for storage accounts\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rLeverage Azure Private Link Service for secure access to Azure Storage and services via Private Endpoint in your VNet. Eliminate the need for public IPs, ensuring data privacy. Enjoy granular access control for enhanced security. Potential Benefits:\rSecure, private access to storage with no public IPs\rLearn More:\rLearn More\rPrivate Link\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all storage accounts that does not have a Private Endpoint Connection or where a private endpoint exists but public access is enabled resources | where type =~ \u0026#34;Microsoft.Storage/StorageAccounts\u0026#34; | where isnull(properties.privateEndpointConnections) or properties.privateEndpointConnections[0].properties.provisioningState != (\u0026#34;Succeeded\u0026#34;) or (isnull(properties.networkAcls) and properties.publicNetworkAccess == \u0026#39;Enabled\u0026#39;) | extend param1 = strcat(\u0026#39;Private Endpoint: \u0026#39;, iif(isnotnull(properties.privateEndpointConnections),split(properties.privateEndpointConnections[0].properties.privateEndpoint.id,\u0026#39;/\u0026#39;)[8],\u0026#39;No Private Endpoint\u0026#39;)) | extend param2 = strcat(\u0026#39;Access: \u0026#39;, iif(properties.publicNetworkAccess == \u0026#39;Disabled\u0026#39;, \u0026#39;Public Access Disabled\u0026#39;, iif(isnotnull(properties.networkAcls), \u0026#39;NetworkACLs in place\u0026#39;,\u0026#39;Public Access Enabled\u0026#39;))) | project recommendationID = \u0026#34;dc55be60-6f8c-461e-a9d5-a3c7686ed94e\u0026#34;, name, id, tags, param1, param2 ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure that storage accounts are zone or region redundant\rHigh\rHigh Availability\rYes\rVerified\rDo not use classic storage accounts\rHigh\rService Upgrade and Retirement\rYes\rVerified\rEnsure Performance tier is set as per workload\rMedium\rScalability\rNo\rVerified\rEnable soft delete for recovery of data\rMedium\rDisaster Recovery\rNo\rVerified\rEnable versioning for accidental modification and keep the number of versions below 1000\rLow\rDisaster Recovery\rNo\rVerified\rEnable point-in-time restore for GPv2 accounts to safeguard against data loss\rLow\rDisaster Recovery\rNo\rVerified\rMonitor all blob storage accounts\rLow\rMonitoring and Alerting\rNo\rVerified\rConsider upgrading legacy storage accounts to v2 storage accounts\rLow\rScalability\rYes\rVerified\rEnable Azure Private Link service for storage accounts\rMedium\rSecurity\rYes\rVerified\rDetails\rEnsure that storage accounts are zone or region redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rRedundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability."},{"id":305,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/storageAppliances/","title":"storageAppliances","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":306,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageCache/","title":"StorageCache","parent":"Azure Resources","content":"","description":""},{"id":307,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageSync/","title":"StorageSync","parent":"Azure Resources","content":"","description":""},{"id":308,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageSync/storageSyncServices/","title":"storageSyncServices","parent":"StorageSync","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":309,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/","title":"StreamAnalytics","parent":"Azure Resources","content":"","description":""},{"id":310,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/streamingJobs/","title":"streamingJobs","parent":"StreamAnalytics","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":311,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/","title":"Subscription","parent":"Azure Resources","content":"","description":""},{"id":312,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/subscriptions/","title":"subscriptions","parent":"Resources","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":313,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/subscriptions/","title":"subscriptions","parent":"Subscription","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDo not create more than 2000 Citrix VDA servers per subscription\rHigh\rGovernance\rYes\rVerified\rSubscriptions should not be placed under the Tenant Root Management Group\rMedium\rGovernance\rYes\rVerified\rDetails\rDo not create more than 2000 Citrix VDA servers per subscription\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors. When close to the limit, signaled by a dashboard notification, and with sufficient licenses, request another subscription. Can\u0026#39;t exceed the given limits for catalogs. Potential Benefits:\rAvoids hitting limit, ensures reliability\rLearn More:\rCitrix Limits\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Count VM instances with a tag that contains \u0026#34;Citrix VDA\u0026#34; and create output if that count is \u0026gt;2000 for each subscription. // The Citrix published limit is 2500. This query runs an 80% check. resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | where tags contains \u0026#39;Citrix VDA\u0026#39; | summarize VMs=count() by subscriptionId | where VMs \u0026gt; 2000 | join (resourcecontainers| where type ==\u0026#39;microsoft.resources/subscriptions\u0026#39; | project subname=name, subscriptionId) on subscriptionId | project recommendationId=\u0026#39;c041d596-6c97-4c5f-b4b3-9cd37628f2e2\u0026#39;, name= subname, id = subscriptionId, param1=\u0026#39;Too many instances.\u0026#39;, param2= VMs Subscriptions should not be placed under the Tenant Root Management Group\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe root management group in Azure is designed for organizational hierarchy, allowing for all management groups and subscriptions to fold into it. Potential Benefits:\rEnhanced security, compliance, and management\rLearn More:\rManagement group recommendations\rRoot management group for each directory\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Subscriptions that are placed under the Tenant Root Management Group resourcecontainers | where type == \u0026#39;microsoft.resources/subscriptions\u0026#39; | extend mgParentSize = array_length(properties.managementGroupAncestorsChain) | where mgParentSize == 1 | project recommendationId=\u0026#34;5ada5ffa-7149-4e49-9fbf-e67be7c2594c\u0026#34;, name, id, tags ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDo not create more than 2000 Citrix VDA servers per subscription\rHigh\rGovernance\rYes\rVerified\rSubscriptions should not be placed under the Tenant Root Management Group\rMedium\rGovernance\rYes\rVerified\rDetails\rDo not create more than 2000 Citrix VDA servers per subscription\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors."},{"id":314,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Synapse/","title":"Synapse","parent":"Azure Resources","content":"","description":""},{"id":315,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/systemTopics/","title":"systemTopics","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":316,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/tags/","title":"tags","parent":"Resources","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":317,"href":"/Azure-Proactive-Resiliency-Library-v2/tags/","title":"Tags","parent":"Azure Proactive Resiliency Library v2","content":"","description":""},{"id":318,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/TestBase/","title":"TestBase","parent":"Azure Resources","content":"","description":""},{"id":319,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/TestBase/testBaseAccounts/","title":"testBaseAccounts","parent":"TestBase","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":320,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/topics/","title":"topics","parent":"EventGrid","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Diagnostic Settings for all Azure Event Grid resources\rLow\rMonitoring and Alerting\rNo\rPreview\rConfigure Dead-letter to save events that cannot be delivered\rLow\rPersonalized\rNo\rPreview\rConfigure Private Endpoints\rLow\rSecurity\rYes\rPreview\rDetails\rConfigure Diagnostic Settings for all Azure Event Grid resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively. Potential Benefits:\rEnhanced troubleshooting for Event Grid\rLearn More:\rAzure Event Grid - Enable diagnostic logs for Event Grid resources\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure Dead-letter to save events that cannot be delivered\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rPersonalized\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEvent Grid may not deliver an event within a specific time or after several attempts, leading to dead-lettering where undelivered events are sent to a storage account. Potential Benefits:\rSaves undelivered events\rLearn More:\rAzure Event Grid delivery and retry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure Private Endpoints\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rUse private endpoints for secure event ingress to custom topics/domains via a private link, avoiding the public internet. It employs an IP from the VNet space for your topic/domain. Potential Benefits:\rSecure, private VNet ingress\rLearn More:\rConfigure private endpoints for Azure Event Grid topics or domains\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all eventgrid services not protected by private endpoints. Resources | where type contains \u0026#34;eventgrid\u0026#34; | where properties[\u0026#39;publicNetworkAccess\u0026#39;] == \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;b2069f64-4741-3d4a-a71d-50c8b03f5ab7\u0026#34;, name, id, tags | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConfigure Diagnostic Settings for all Azure Event Grid resources\rLow\rMonitoring and Alerting\rNo\rPreview\rConfigure Dead-letter to save events that cannot be delivered\rLow\rPersonalized\rNo\rPreview\rConfigure Private Endpoints\rLow\rSecurity\rYes\rPreview\rDetails\rConfigure Diagnostic Settings for all Azure Event Grid resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively."},{"id":321,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/topicTypes/","title":"topicTypes","parent":"EventGrid","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":322,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceNetworking/trafficControllers/","title":"trafficControllers","parent":"ServiceNetworking","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":323,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/trafficManagerProfiles/","title":"trafficManagerProfiles","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rTraffic Manager Monitor Status Should be Online\rHigh\rHigh Availability\rYes\rVerified\rTraffic manager profiles should have more than one endpoint\rHigh\rHigh Availability\rYes\rVerified\rConfigure at least one endpoint within a another region\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure endpoint configured to (All World) for geographic profiles\rMedium\rDisaster Recovery\rYes\rVerified\rDetails\rTraffic Manager Monitor Status Should be Online\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitor status should be online to ensure failover for application workload. If Traffic Manager\u0026#39;s health shows Degraded, one or more endpoints may also be Degraded. Potential Benefits:\rEnsures failover functionality\rLearn More:\rAzure Traffic Manager endpoint monitoring\rEnable or disable health checks\rTroubleshooting degraded state on Azure Traffic Manager\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find traffic manager profiles that have an endpoint monitor status of not \u0026#39;Online\u0026#39; resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | mv-expand properties.endpoints | where properties_endpoints.properties.endpointMonitorStatus != \u0026#34;Online\u0026#34; | project recommendationId = \u0026#34;f05a3e6d-49db-2740-88e2-2b13706c1f67\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;Profile name: \u0026#39;,properties_endpoints.name), param2 = strcat(\u0026#39;endpointMonitorStatus: \u0026#39;, properties_endpoints.properties.endpointMonitorStatus) Traffic manager profiles should have more than one endpoint\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen configuring the Azure traffic manager, provision at least two endpoints to ensure workloads can fail-over to another instance, enhancing reliability and availability. Potential Benefits:\rEnhances failover capabilities\rLearn More:\rTraffic Manager Endpoint Types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find traffic manager profiles that have less than 2 endpoints resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | where array_length(properties.endpoints) \u0026lt; 2 | project recommendationId = \u0026#34;5b422a7f-8caa-3d48-becb-511599e5bba9\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;EndpointCount: \u0026#39;, array_length(properties.endpoints)) Configure at least one endpoint within a another region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProfiles should have multiple endpoints to ensure availability in case an endpoint fails. It\u0026#39;s also advised to distribute these endpoints across different regions for enhanced reliability. Potential Benefits:\rEnhances availability across regions\rLearn More:\rReliability recommendations\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure endpoint configured to (All World) for geographic profiles\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor geographic routing, traffic is directed to endpoints based on specific regions. If a region fails, without a predefined failover, configuring an endpoint to \u0026#34;All (World)\u0026#34; for geographic profiles can prevent traffic black holes, ensuring service remains available. Potential Benefits:\rAvoids traffic black holing, ensures availability\rLearn More:\rAdd an endpoint configured to \u0026#34;All (World)\u0026#34;\rTraffic Manager profile - GeographicProfile (Add an endpoint configured to \u0026#34;\u0026#34;All (World)\u0026#34;\u0026#34;).\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Traffic Manager resources that are not confirgured for all-World access Resources | where type == \u0026#39;microsoft.network/trafficmanagerprofiles\u0026#39; | where properties.trafficRoutingMethod =~ \u0026#34;Geographic\u0026#34; | extend endpoints = properties.endpoints | mv-expand endpoint = endpoints | where endpoint.properties.geoMapping !contains \u0026#34;WORLD\u0026#34; | extend endpointName = endpoint.name | project recommendationId=\u0026#34;c31f76a0-48cd-9f44-aa43-99ee904db9bc\u0026#34;, name, id, tags, param1=strcat(\u0026#34;endpointName:\u0026#34;,endpointName), param2=strcat(\u0026#34;GeoMapping:\u0026#34;, tostring(endpoint.properties.geoMapping)) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rTraffic Manager Monitor Status Should be Online\rHigh\rHigh Availability\rYes\rVerified\rTraffic manager profiles should have more than one endpoint\rHigh\rHigh Availability\rYes\rVerified\rConfigure at least one endpoint within a another region\rMedium\rDisaster Recovery\rNo\rVerified\rEnsure endpoint configured to (All World) for geographic profiles\rMedium\rDisaster Recovery\rYes\rVerified\rDetails\rTraffic Manager Monitor Status Should be Online\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitor status should be online to ensure failover for application workload."},{"id":324,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/trunkedNetworks/","title":"trunkedNetworks","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":325,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/usages/","title":"usages","parent":"Quota","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":326,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/vaults/","title":"vaults","parent":"KeyVault","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rKey vaults should have soft delete enabled\rHigh\rDisaster Recovery\rYes\rPreview\rKey vaults should have purge protection enabled\rHigh\rDisaster Recovery\rYes\rPreview\rEnable Azure Private Link Service for Key vault\rHigh\rSecurity\rYes\rPreview\rUse separate key vaults per application per environment\rHigh\rGovernance\rNo\rPreview\rDiagnostic logs in Key Vault should be enabled\rLow\rMonitoring and Alerting\rYes\rPreview\rDetails\rKey vaults should have soft delete enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rKey Vault\u0026#39;s soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates. When enabled, marked resources are retained for 90 days, allowing for their recovery, essentially undoing deletion. Potential Benefits:\rEnables recovery of deleted items\rLearn More:\rAzure Key Vault soft-delete overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Key Vaults that do not have soft delete enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enableSoftDelete) or properties.enableSoftDelete != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;1cca00d2-d9ab-8e42-a788-5d40f49405cb\u0026#34;, name, id, tags, param1 = \u0026#34;EnableSoftDelete: Disabled\u0026#34; Key vaults should have purge protection enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rPurge protection secures against malicious deletions by enforcing a retention period for soft deleted key vaults, ensuring no one, not even insiders or Microsoft, can purge your key vaults during this period, preventing permanent data loss. Potential Benefits:\rProtects from insider attacks, avoids data loss\rLearn More:\rAzure Key Vault purge-protection overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all Key Vaults that do not have Purge Protection enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enablePurgeProtection) or properties.enablePurgeProtection != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;70fcfe6d-00e9-5544-a63a-fff42b9f2edb\u0026#34;, name, id, tags, param1 = \u0026#34;EnablePurgeProtection: Disabled\u0026#34; Enable Azure Private Link Service for Key vault\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Private Link Service lets you securely and privately connect to Azure Key Vault via a Private Endpoint in your VNet, using a private IP and eliminating public Internet exposure. Potential Benefits:\rSecure Key Vault with Private Link\rLearn More:\rAzure Key Vault Private Link Service overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all Key Vaults that does not have a Private Endpoint Connection or where a private endpoint exists but public access is enabled resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.privateEndpointConnections) or properties.privateEndpointConnections[0].properties.provisioningState != (\u0026#34;Succeeded\u0026#34;) or (isnull(properties.networkAcls) and properties.publicNetworkAccess == \u0026#39;Enabled\u0026#39;) | extend param1 = strcat(\u0026#39;Private Endpoint: \u0026#39;, iif(isnotnull(properties.privateEndpointConnections),split(properties.privateEndpointConnections[0].properties.privateEndpoint.id,\u0026#39;/\u0026#39;)[8],\u0026#39;No Private Endpoint\u0026#39;)) | extend param2 = strcat(\u0026#39;Access: \u0026#39;, iif(properties.publicNetworkAccess == \u0026#39;Disabled\u0026#39;, \u0026#39;Public Access Disabled\u0026#39;, iif(isnotnull(properties.networkAcls), \u0026#39;NetworkACLs in place\u0026#39;,\u0026#39;Public Access Enabled\u0026#39;))) | project recommendationID = \u0026#34;00c3d2b0-ea6e-4c4b-89be-b78a35caeb51\u0026#34;, name, id, tags, param1, param2 Use separate key vaults per application per environment\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rKey vaults are security boundaries for secret storage. Grouping secrets together increases risk during a security event, as attacks could access multiple secrets. Potential Benefits:\rEnhanced security, Reduced risk\rLearn More:\rAzure Key Vault best practices overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Diagnostic logs in Key Vault should be enabled\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rEnable logs, set up alerts, and adhere to retention requirements for improved monitoring and security of Key Vault access, detailing the frequency and identity of users. Potential Benefits:\rEnhanced monitoring and security compliance\rLearn More:\rAzure Key Vault logging overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all Key Vaults that does not have Diagnostic logs enabled policyresources | where type == \u0026#39;microsoft.policyinsights/policystates\u0026#39; | where properties.complianceState == \u0026#39;NonCompliant\u0026#39; | extend policyDefinitionId = tostring(tolower(properties.policyDefinitionId)),resourceId = tostring(tolower(properties.resourceId)), PolicyAssignmentName = properties.policyAssignmentName, policySetDefinitionId = tostring(tolower(properties.policySetDefinitionId)) | project resourceId,policySetDefinitionId,policyDefinitionId | join kind=inner( policyresources | where type == \u0026#39;microsoft.authorization/policydefinitions\u0026#39; | extend displayName = tostring(properties.displayName) | where displayName contains \u0026#34;Resource logs in Key Vault should be enabled\u0026#34; | project policyDefinitionId=tostring(tolower(id)),displayName ) on policyDefinitionId | project resourceId,policySetDefinitionId,policyDefinitionId | join kind=inner( policyresources | where type == \u0026#39;microsoft.authorization/policysetdefinitions\u0026#39; | extend displayName = tostring(properties.displayName) | where displayName contains \u0026#34;Microsoft cloud security benchmark\u0026#34; | project policySetDefinitionId=tostring(tolower(id)),displayName ) on policySetDefinitionId | join kind=inner( resources | where type == \u0026#39;microsoft.keyvault/vaults\u0026#39; | project resourceId = tostring(tolower(id)),name,tags )on resourceId | project-away resourceId1,policySetDefinitionId1,policySetDefinitionId,policyDefinitionId,displayName | project recommendationID = \u0026#34;1dc0821d-4f14-7644-bab4-ba208ff5f7fa\u0026#34;,id=resourceId,name,tags ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rKey vaults should have soft delete enabled\rHigh\rDisaster Recovery\rYes\rPreview\rKey vaults should have purge protection enabled\rHigh\rDisaster Recovery\rYes\rPreview\rEnable Azure Private Link Service for Key vault\rHigh\rSecurity\rYes\rPreview\rUse separate key vaults per application per environment\rHigh\rGovernance\rNo\rPreview\rDiagnostic logs in Key Vault should be enabled\rLow\rMonitoring and Alerting\rYes\rPreview\rDetails\rKey vaults should have soft delete enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rKey Vault\u0026#39;s soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates."},{"id":327,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RecoveryServices/vaults/","title":"vaults","parent":"RecoveryServices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rHigh\rDisaster Recovery\rNo\rVerified\rValidate VM functionality with a Site Recovery test failover to check performance at target\rHigh\rDisaster Recovery\rYes\rVerified\rMigrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rMedium\rMonitoring and Alerting\rYes\rVerified\rOpt-in to Cross Region Restore for all Geo-Redundant Storage (GRS) Azure Recovery Services vaults\rMedium\rDisaster Recovery\rYes\rVerified\rEnable Soft Delete for Recovery Services Vaults in Azure Backup\rMedium\rDisaster Recovery\rYes\rPreview\rDetails\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure VM failover settings\u0026#39; static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it\u0026#39;s available or the next available IP otherwise. IP adjustments can be made in VM Network settings. Potential Benefits:\rSmooth failover IP management\rLearn More:\rSetup network mapping for site recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Validate VM functionality with a Site Recovery test failover to check performance at target\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPerform a test failover to validate your BCDR strategy and ensure that your applications are functioning correctly in the target region without impacting your production environment. Test your Disaster Recovery plan periodically without any data loss or downtime, using test failovers. Potential Benefits:\rEnsures BCDR plan accuracy and VM performance\rLearn More:\rRun a test failover\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs where replication has been enabled but Test Failover was never performed recoveryservicesresources | where type == \u0026#34;microsoft.recoveryservices/vaults/replicationfabrics/replicationprotectioncontainers/replicationprotecteditems\u0026#34; | where properties.providerSpecificDetails.dataSourceInfo.datasourceType == \u0026#39;AzureVm\u0026#39; and isnull(properties.lastSuccessfulTestFailoverTime) | project recommendationId=\u0026#34;17e877f7-3a89-4205-8a24-0670de54ddcd\u0026#34; , name = properties.providerSpecificDetails.recoveryAzureVMName, id=properties.providerSpecificDetails.dataSourceInfo.resourceId Migrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rClassic alerts for Recovery Services vaults in Azure Backup will be retired on 31 March 2026. Potential Benefits:\rEnhanced, scalable, and consistent alerting.\rLearn More:\rMove to Azure monitor Alerts\rClassic alerts retirement announcement\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Recovery services vault with Classic alerts enabled. resources | where type in~ (\u0026#39;microsoft.recoveryservices/vaults\u0026#39;) | extend monitoringSettings = parse_json(properties).monitoringSettings | extend isUsingClassicAlerts = case(isnull(monitoringSettings),\u0026#39;Enabled\u0026#39;,monitoringSettings.classicAlertSettings.alertsForCriticalOperations) | extend isUsingJobsAlerts = case(isnull(monitoringSettings), \u0026#39;Enabled\u0026#39;, monitoringSettings.azureMonitorAlertSettings.alertsForAllJobFailures) | where isUsingClassicAlerts == \u0026#39;Enabled\u0026#39; | project recommendationId = \u0026#34;2912472d-0198-4bdc-aa90-37f145790edc\u0026#34;, name, id, tags, param1=strcat(\u0026#34;isUsingClassicAlerts: \u0026#34;, isUsingClassicAlerts), param2=strcat(\u0026#34;isUsingJobsAlerts: \u0026#34;, isUsingJobsAlerts) Opt-in to Cross Region Restore for all Geo-Redundant Storage (GRS) Azure Recovery Services vaults\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCross Region Restore enables the restoration of Azure VMs in a secondary, Azure paired region, facilitating drills for audit or compliance and allowing recovery of VMs or disks in the event of a primary region disaster. It is an opt-in feature available exclusively for GRS vaults. Potential Benefits:\rEnhances disaster recovery capabilities\rLearn More:\rSet Cross Region Restore\rAzure Backup Best Practices\rMinimum Role Requirements for Cross Region Restore\rRecovery Services Vault\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Displays all recovery services vaults that do not have cross region restore enabled resources | where type == \u0026#34;microsoft.recoveryservices/vaults\u0026#34; | where properties.properties.enableCrossRegionRestore != true | project recommendationId = \u0026#34;1549b91f-2ea0-4d4f-ba2a-4596becbe3de\u0026#34;, name, id, tags Enable Soft Delete for Recovery Services Vaults in Azure Backup\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rWith soft delete, if backup data is deleted, the backup data is retained for 14 additional days, allowing the recovery of that backup item with no data loss with no cost to you. Soft delete is enabled by default. Disabling this feature isn\u0026#39;t recommended. Potential Benefits:\rEnhances disaster recovery capabilities\rLearn More:\rSoft Delete for Azure Backup\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Recovery Services vaults that do not have soft delete enabled resources | where type == \u0026#34;microsoft.recoveryservices/vaults\u0026#34; | mv-expand issoftDelete=properties.securitySettings.softDeleteSettings.softDeleteState | where issoftDelete == \u0026#39;Disabled\u0026#39; | project recommendationid = \u0026#34;9e39919b-78af-4a0b-b70f-c548dae97c25\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Soft Delete: \u0026#34;,issoftDelete) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rHigh\rDisaster Recovery\rNo\rVerified\rValidate VM functionality with a Site Recovery test failover to check performance at target\rHigh\rDisaster Recovery\rYes\rVerified\rMigrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rMedium\rMonitoring and Alerting\rYes\rVerified\rOpt-in to Cross Region Restore for all Geo-Redundant Storage (GRS) Azure Recovery Services vaults\rMedium\rDisaster Recovery\rYes\rVerified\rEnable Soft Delete for Recovery Services Vaults in Azure Backup\rMedium\rDisaster Recovery\rYes\rPreview\rDetails\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure VM failover settings\u0026#39; static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it\u0026#39;s available or the next available IP otherwise."},{"id":328,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VideoIndexer/","title":"VideoIndexer","parent":"Azure Resources","content":"","description":""},{"id":329,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/virtualClusters/","title":"virtualClusters","parent":"Sql","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":330,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualHubs/","title":"virtualHubs","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":331,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VirtualMachineImages/","title":"VirtualMachineImages","parent":"Azure Resources","content":"","description":""},{"id":332,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/virtualMachineInstances/","title":"virtualMachineInstances","parent":"AzureStackHCI","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":333,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/virtualMachines/","title":"virtualMachines","parent":"AzureStackHCI","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":334,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/virtualMachines/","title":"virtualMachines","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rRun production workloads on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rDeploy VMs across Availability Zones\rHigh\rHigh Availability\rYes\rVerified\rMigrate VMs using availability sets to VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rReplicate VMs using Azure Site Recovery\rMedium\rDisaster Recovery\rYes\rVerified\rUse Managed Disks for VM disks\rHigh\rHigh Availability\rYes\rVerified\rHost database data on a data disk\rLow\rScalability\rYes\rVerified\rBackup VMs with Azure Backup service\rMedium\rDisaster Recovery\rYes\rVerified\rProduction VMs should be using SSD disks\rHigh\rScalability\rYes\rVerified\rReview VMs in stopped state\rLow\rGovernance\rYes\rVerified\rEnable Accelerated Networking (AccelNet)\rMedium\rScalability\rYes\rVerified\rWhen AccelNet is enabled, you must manually update the GuestOS NIC driver\rLow\rGovernance\rNo\rVerified\rVMs should not have a Public IP directly associated\rMedium\rSecurity\rYes\rVerified\rVM network interfaces and associated subnets both have a Network Security Group (NSG) associated\rLow\rSecurity\rYes\rVerified\rIP Forwarding should only be enabled for Network Virtual Appliances\rMedium\rSecurity\rYes\rVerified\rCustomer DNS Servers should be configured in the Virtual Network level\rLow\rOther Best Practices\rYes\rVerified\rShared disks should only be enabled in clustered servers\rMedium\rOther Best Practices\rYes\rVerified\rNetwork access to the VM disk should be set to Disable public access and enable private access\rLow\rSecurity\rYes\rVerified\rEnsure that your VMs are compliant with Azure Policies\rLow\rGovernance\rYes\rVerified\rEnable advanced encryption options for your managed disks\rMedium\rSecurity\rNo\rVerified\rEnable VM Insights\rLow\rMonitoring and Alerting\rYes\rVerified\rConfigure monitoring for all Azure Virtual Machines\rLow\rMonitoring and Alerting\rYes\rVerified\rUse maintenance configurations for the VMs\rHigh\rHigh Availability\rYes\rVerified\rDon\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rHigh\rScalability\rYes\rVerified\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rVerified\rUse Azure Boost VMs for Maintenance sensitive workload\rMedium\rHigh Availability\rNo\rVerified\rEnable Scheduled Events for Maintenance sensitive workload VMs\rMedium\rHigh Availability\rNo\rVerified\rUse ZRS Disks or Protect LRS Disks from Availability Zone Failure\rMedium\rHigh Availability\rYes\rVerified\rDetails\rRun production workloads on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProduction VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates. Potential Benefits:\rEnhanced fault/update resilience\rLearn More:\rWhat has changed with Flexible orchestration mode\rAttach or detach a Virtual Machine to or from a Virtual Machine Scale Set\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not associated with a VMSS Flex instance resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.virtualMachineScaleSet.id) | project recommendationId=\u0026#34;273f6b30-68e0-4241-85ea-acf15ffb60bf\u0026#34;, name, id, tags Deploy VMs across Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Availability Zones, within each Azure region, are tolerant to local failures, protecting applications and data against unlikely Datacenter failures by being physically separate. Potential Benefits:\rEnhanced VM resilience to failures\rLearn More:\rCreate virtual machines in an availability zone using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not assigned to a Zone Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(zones) | project recommendationId=\u0026#34;2bd0be95-a825-6f47-a8c6-3db1fb5eb387\u0026#34;, name, id, tags, param1=\u0026#34;No Zone\u0026#34; Migrate VMs using availability sets to VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAvailability sets will soon be retired. Migrate workloads from VMs to VMSS Flex for deployment across zones or within the same zone across different fault domains (FDs) and update domains (UDs) for better reliability. Potential Benefits:\rEnhances reliability and future-proofs VMs\rLearn More:\rResiliency checklist for Virtual Machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs using Availability Sets resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.availabilitySet) | project recommendationId = \u0026#34;a8d25876-7951-b646-b4e8-880c9031596b\u0026#34;, name, id, tags, param1=strcat(\u0026#34;availabilitySet: \u0026#34;,properties.availabilitySet.id) Replicate VMs using Azure Site Recovery\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rReplicating Azure VMs via Site Recovery entails continuous, asynchronous disk replication to a target region. Recovery points are generated every few minutes, ensuring a Recovery Point Objective (RPO) in minutes. Potential Benefits:\rMinimize downtime in disasters\rLearn More:\rResiliency checklist for Virtual Machines\rRun a test failover (disaster recovery drill) to Azure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have replication with ASR enabled resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | extend securityType = iif(isnull(properties.securityProfile.securityType), \u0026#34;Standard\u0026#34;, properties.securityProfile.securityType) | where securityType !in~ (\u0026#34;TrustedLaunch\u0026#34;, \u0026#34;ConfidentialVM\u0026#34;) | project id, vmIdForJoin = tolower(id), name, tags | join kind = leftouter ( recoveryservicesresources | where type =~ \u0026#34;Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems\u0026#34; and properties.providerSpecificDetails.dataSourceInfo.datasourceType =~ \u0026#34;AzureVm\u0026#34; | project vmResourceId = tolower(properties.providerSpecificDetails.dataSourceInfo.resourceId) ) on $left.vmIdForJoin == $right.vmResourceId | where isempty(vmResourceId) | project recommendationId = \u0026#34;cfe22a65-b1db-fd41-9e8e-d573922709ae\u0026#34;, name, id, tags Use Managed Disks for VM disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure is retiring unmanaged disks on September 30, 2025. Users should plan the migration to avoid disruptions and maintain service reliability. Potential Benefits:\rAvoid retirement disruption, enhance reliability\rLearn More:\rMigrate your Azure unmanaged disks by Sep 30, 2025\rMigrate Windows VM from unmanaged disks to managed disks\rMigrate Linux VM from unmanaged disks to managed disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not using Managed Disks Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.storageProfile.osDisk.managedDisk) | project recommendationId = \u0026#34;122d11d7-b91f-8747-a562-f56b79bcfbdc\u0026#34;, name, id, tags Host database data on a data disk\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA data disk is a managed disk attached to a virtual machine for storing database or other essential data. These disks are SCSI drives labeled as per choice. Potential Benefits:\rEnhances performance, recovery, migration flexibility\rLearn More:\rIntroduction to Azure managed disks - Data disks\rAzure managed disk types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that only have OS Disk Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where array_length(properties.storageProfile.dataDisks) \u0026lt; 1 | project recommendationId = \u0026#34;4ea2878f-0d69-8d4a-b715-afc10d1e538e\u0026#34;, name, id, tags Backup VMs with Azure Backup service\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnable backups for your virtual machines with Azure Backup to secure and quickly recover your data. This service offers simple, secure, and cost-effective solutions for backing up and recovering data from the Microsoft Azure cloud. Potential Benefits:\rSecure data recovery and backup\rLearn More:\rWhat is the Azure Backup service?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have Backup enabled // Run query to see results. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project name, id, tags | join kind=leftouter ( recoveryservicesresources | where type =~ \u0026#39;Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\u0026#39; | where properties.dataSourceInfo.datasourceType =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project idBackupEnabled=properties.sourceResourceId | extend name=strcat_array(array_slice(split(idBackupEnabled, \u0026#39;/\u0026#39;), 8, -1), \u0026#39;/\u0026#39;) ) on name | where isnull(idBackupEnabled) | project-away idBackupEnabled | project-away name1 | project recommendationId = \u0026#34;1981f704-97b9-b645-9c57-33f8ded9261a\u0026#34;, name, id, tags | order by id asc Production VMs should be using SSD disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPremium SSD disks support I/O-intensive apps with high performance, low latency, ideal for production. Standard SSDs offer cost-effective solutions for less critical workloads with consistent performance. Potential Benefits:\rHigh-performance and reliability for critical apps\rLearn More:\rAzure managed disk types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all disks with StandardHDD sku attached to VMs Resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where sku.name == \u0026#39;Standard_LRS\u0026#39; and sku.tier == \u0026#39;Standard\u0026#39; | where managedBy != \u0026#34;\u0026#34; | project recommendationId = \u0026#34;d3f3ee41-b9aa-d34d-b442-5d46d20232b2\u0026#34;, name, id, tags, param1=strcat(\u0026#34;managedBy: \u0026#34;, managedBy) Review VMs in stopped state\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Virtual Machines (VM) instances have various states, like provisioning and power states. A non-running VM may indicate issues or it being unnecessary, suggesting removal could help cut costs. Potential Benefits:\rReduce costs by removing unused VMs\rLearn More:\rStates and billing status of Azure Virtual Machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are NOT running Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where properties.extended.instanceView.powerState.displayStatus != \u0026#39;VM running\u0026#39; | project recommendationId = \u0026#34;98b334c0-8578-6046-9e43-b6e8fce6318e\u0026#34;, name, id, tags Enable Accelerated Networking (AccelNet)\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAccelerated networking enables SR-IOV to a VM, greatly improving its networking performance by bypassing the host from the data path, which reduces latency, jitter, and CPU utilization for demanding network workloads on supported VM types. Potential Benefits:\rReduces latency, jitter and CPU use\rLearn More:\rAccelerated Networking (AccelNet) overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VM NICs that do not have Accelerated Networking enabled resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand nic = properties.networkProfile.networkInterfaces | project name, id, tags, lowerCaseNicId = tolower(nic.id), vmSize = tostring(properties.hardwareProfile.vmSize) | join kind = inner ( resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableAcceleratedNetworking == false | project nicName = split(id, \u0026#34;/\u0026#34;)[8], lowerCaseNicId = tolower(id) ) on lowerCaseNicId | summarize nicNames = make_set(nicName) by name, id, tostring(tags), vmSize | extend param1 = strcat(\u0026#34;NicName: \u0026#34;, strcat_array(nicNames, \u0026#34;, \u0026#34;)), param2 = strcat(\u0026#34;VMSize: \u0026#34;, vmSize) | project recommendationId = \u0026#34;dfedbeb1-1519-fc47-86a5-52f96cf07105\u0026#34;, name, id, tags, param1, param2 | order by id asc When AccelNet is enabled, you must manually update the GuestOS NIC driver\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen Accelerated Networking is enabled, the default Azure VNet interface in GuestOS is swapped for a Mellanox, and its driver comes from a 3rd party. Marketplace images have the latest Mellanox drivers, but post-deployment, updating the driver is the user\u0026#39;s responsibility. Potential Benefits:\rEnhanced VM network efficiency\rLearn More:\rAccelerated Networking (AccelNet) overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg VMs should not have a Public IP directly associated\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor outbound internet connectivity of Virtual Machines, using NAT Gateway or Azure Firewall is recommended to enhance security and service resilience, thanks to their higher availability and SNAT ports. Potential Benefits:\rEnhanced security and service resiliency\rLearn More:\rUse Source Network Address Translation (SNAT) for outbound connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs with PublicIPs directly associated with them Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where isnotnull(properties.ipConfigurations) | mv-expand ipconfig=properties.ipConfigurations | extend publicIp = tostring(ipconfig.properties.publicIPAddress.id) | where publicIp != \u0026#34;\u0026#34; | project name, nicId = tostring(id), publicIp ) on nicId | project recommendationId = \u0026#34;1f629a30-c9d0-d241-82ee-6f2eb9d42cb4\u0026#34;, name, id, tags | order by id asc VM network interfaces and associated subnets both have a Network Security Group (NSG) associated\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUnless you have a specific reason, it\u0026#39;s advised to associate a network security group to a subnet or a network interface, but not both, to avoid unexpected communication issues and troubleshooting due to potential rule conflicts between the two associations. Potential Benefits:\rReduces communication problems\rLearn More:\rHow network security groups filter network traffic\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of virtual machines and associated NICs that do have an NSG associated to them and also an NSG associated to the subnet. Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where isnotnull(properties.networkSecurityGroup) | mv-expand ipConfigurations = properties.ipConfigurations, nsg = properties.networkSecurityGroup | project nicId = tostring(id), subnetId = tostring(ipConfigurations.properties.subnet.id), nsgName=split(nsg.id, \u0026#39;/\u0026#39;)[8] | parse kind=regex subnetId with \u0026#39;/virtualNetworks/\u0026#39; virtualNetwork \u0026#39;/subnets/\u0026#39; subnet | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/NetworkSecurityGroups\u0026#39; and isnotnull(properties.subnets) | project name, resourceGroup, subnet=properties.subnets | mv-expand subnet | project subnetId=tostring(subnet.id) ) on subnetId | project nicId | join kind=leftouter ( Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project vmName = name, vmId = id, tags, nicId = nic.id, nicName=split(nic.id, \u0026#39;/\u0026#39;)[8] | extend nicId = tostring(nicId) ) on nicId | project recommendationId = \u0026#34;82b3cf6b-9ae2-2e44-b193-10793213f676\u0026#34;, name=vmName, id = vmId, tags, param1 = strcat(\u0026#34;nic-name=\u0026#34;, nicName) IP Forwarding should only be enabled for Network Virtual Appliances\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIP forwarding allows a virtual machine network interface to receive and send network traffic not destined for or originating from its assigned IP addresses. Potential Benefits:\rEnhances network appliance function\rLearn More:\rEnable or disable IP forwarding\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VM NICs that have IPForwarding enabled. This feature is usually only required for Network Virtual Appliances Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableIPForwarding == true | project nicId = tostring(id) ) on nicId | project recommendationId = \u0026#34;41a22a5e-5e08-9647-92d0-2ffe9ef1bdad\u0026#34;, name, id, tags | order by id asc Customer DNS Servers should be configured in the Virtual Network level\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfigure the DNS Server at the Virtual Network level to prevent any inconsistency across the environment. Potential Benefits:\rEnsures DNS consistency\rLearn More:\rName resolution for resources in Azure virtual networks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VM NICs that have DNS Server settings configured in any of the NICs Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | project name, id, dnsServers = properties.dnsSettings.dnsServers | extend hasDns = array_length(dnsServers) \u0026gt;= 1 | where hasDns != 0 | project name, nicId = tostring(id) ) on nicId | project recommendationId = \u0026#34;1cf8fe21-9593-1e4e-966b-779a294c0d30\u0026#34;, name, id, tags | order by id asc Shared disks should only be enabled in clustered servers\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure shared disks let you attach a disk to multiple VMs at once for deploying or migrating clustered applications, suitable only when a disk is shared among VM cluster members. Potential Benefits:\rEnhances clustered server performance\rLearn More:\rAzure Shared Disk Introduction\rEnable Shared Disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Disks configured to be Shared. This is not an indication of an issue, but if a disk with this configuration is assigned to two or more VMs without a proper disk control mechanism (like a WSFC) it can lead to data loss resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where isnotnull(properties.maxShares) | project id, name, tags, lowerCaseDiskId = tolower(id), diskState = tostring(properties.diskState) | join kind = leftouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id) | join kind = fullouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand dataDisks = properties.storageProfile.dataDisks | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id) ) on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName) ) on lowerCaseDiskId | summarize vmNames = make_set(vmName) by name, id, tostring(tags), diskState | extend param1 = strcat(\u0026#34;DiskState: \u0026#34;, diskState), param2 = iif(isempty(vmNames[0]), \u0026#34;VMName: n/a\u0026#34;, strcat(\u0026#34;VMName: \u0026#34;, strcat_array(vmNames, \u0026#34;, \u0026#34;))) | project recommendationId = \u0026#34;3263a64a-c256-de48-9818-afd3cbc55c2a\u0026#34;, name, id, tags, param1, param2 | order by id asc Network access to the VM disk should be set to Disable public access and enable private access\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rRecommended changing to \u0026#34;Disable public access and enable private access\u0026#34; and creating a Private Endpoint to improve security by restricting direct public access and ensuring connections are made privately, enhancing data protection and minimizing potential external threats. Potential Benefits:\rEnhances VM security and privacy\rLearn More:\rRestrict import/export access for managed disks using Azure Private Link\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Disks with \u0026#34;Enable public access from all networks\u0026#34; enabled resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where properties.publicNetworkAccess == \u0026#34;Enabled\u0026#34; | project id, name, tags, lowerCaseDiskId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id) | join kind = fullouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand dataDisks = properties.storageProfile.dataDisks | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id) ) on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName) ) on lowerCaseDiskId | summarize vmNames = make_set(vmName) by name, id, tostring(tags) | extend param1 = iif(isempty(vmNames[0]), \u0026#34;VMName: n/a\u0026#34;, strcat(\u0026#34;VMName: \u0026#34;, strcat_array(vmNames, \u0026#34;, \u0026#34;))) | project recommendationId = \u0026#34;70b1d2be-e6c4-b54e-9959-b1b690f9e485\u0026#34;, name, id, tags, param1 | order by id asc Ensure that your VMs are compliant with Azure Policies\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rKeeping your virtual machine (VM) secure is crucial for the applications you run. This involves using various Azure services and features to ensure secure access to your VMs and the secure storage of your data, aiming for overall security of your VM and applications. Potential Benefits:\rSecure VMs and applications\rLearn More:\rPolicy-driven governance\rAzure Policy Regulatory Compliance controls for Azure Virtual Machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs in \u0026#34;Non-compliant\u0026#34; state with Azure Policies policyresources | where type =~ \u0026#34;Microsoft.PolicyInsights/policyStates\u0026#34; and properties.resourceType =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; and properties.complianceState =~ \u0026#34;NonCompliant\u0026#34; | project policyDefinitionId = tolower(properties.policyDefinitionId), policyAssignmentId = tolower(properties.policyAssignmentId), targetResourceId = tolower(properties.resourceId) // Join the policy definition details | join kind = leftouter ( policyresources | where type =~ \u0026#34;Microsoft.Authorization/policyDefinitions\u0026#34; | project policyDefinitionId = tolower(id), policyDefinitionDisplayName = properties.displayName ) on policyDefinitionId | project policyDefinitionId, policyDefinitionDisplayName, policyAssignmentId, targetResourceId // Join the policy assignment details | join kind = leftouter ( policyresources | where type =~ \u0026#34;Microsoft.Authorization/policyAssignments\u0026#34; | project policyAssignmentId = tolower(id), policyAssignmentDisplayName = properties.displayName ) on policyAssignmentId | project policyDefinitionId, policyDefinitionDisplayName, policyAssignmentId, policyAssignmentDisplayName, targetResourceId // Join the target resource details | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | project targetResourceId = tolower(id), targetResourceIdPreservedCase = id, targetResourceName = name, targetResourceTags = tags ) on targetResourceId | project recommendationId = \u0026#34;c42343ae-2712-2843-a285-3437eb0b28a1\u0026#34;, name = targetResourceName, id = targetResourceIdPreservedCase, tags = targetResourceTags, param1 = strcat(\u0026#34;DefinitionName: \u0026#34;, policyDefinitionDisplayName), param2 = strcat(\u0026#34;DefinitionID: \u0026#34;, policyDefinitionId), param3 = strcat(\u0026#34;AssignmentName: \u0026#34;, policyAssignmentDisplayName), param4 = strcat(\u0026#34;AssignmentID: \u0026#34;, policyAssignmentId) Enable advanced encryption options for your managed disks\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConsider enabling Azure Disk Encryption (ADE) for encrypting Azure VM disks using DM-Crypt (Linux) or BitLocker (Windows). Additionally, consider Encryption at host and Confidential disk encryption for enhanced data security. Potential Benefits:\rEnhances data security and integrity\rLearn More:\rOverview of managed disk encryption options\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable VM Insights\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rVM Insights monitors VM and scale set performance, health, running processes, and dependencies. It enhances the predictability of application performance and availability by pinpointing performance bottlenecks and network issues, and it clarifies if problems are related to other dependencies. Potential Benefits:\rImproves VM performance and health\rLearn More:\rOverview of VM insights\rDid the extension install properly?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Check for VMs without Azure Monitoring Agent extension installed, missing Data Collection Rule or Data Collection Rule without performance enabled. Resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | project idVm = tolower(id), name, tags | join kind=leftouter ( InsightsResources | where type =~ \u0026#34;Microsoft.Insights/dataCollectionRuleAssociations\u0026#34; and id has \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | project idDcr = tolower(properties.dataCollectionRuleId), idVmDcr = tolower(substring(id, 0, indexof(id, \u0026#34;/providers/Microsoft.Insights/dataCollectionRuleAssociations/\u0026#34;)))) on $left.idVm == $right.idVmDcr | join kind=leftouter ( Resources | where type =~ \u0026#34;Microsoft.Insights/dataCollectionRules\u0026#34; | extend isPerformanceEnabled = iif(properties.dataSources.performanceCounters contains \u0026#34;Microsoft-InsightsMetrics\u0026#34; and properties.dataFlows contains \u0026#34;Microsoft-InsightsMetrics\u0026#34;, true, false), isMapEnabled = iif(properties.dataSources.extensions contains \u0026#34;Microsoft-ServiceMap\u0026#34; and properties.dataSources.extensions contains \u0026#34;DependencyAgent\u0026#34; and properties.dataFlows contains \u0026#34;Microsoft-ServiceMap\u0026#34;, true, false)//, | where isPerformanceEnabled or isMapEnabled | project dcrName = name, isPerformanceEnabled, isMapEnabled, idDcr = tolower(id)) on $left.idDcr == $right.idDcr | join kind=leftouter ( Resources | where type == \u0026#39;microsoft.compute/virtualmachines/extensions\u0026#39; and (name contains \u0026#39;AzureMonitorWindowsAgent\u0026#39; or name contains \u0026#39;AzureMonitorLinuxAgent\u0026#39;) | extend idVmExtension = tolower(substring(id, 0, indexof(id, \u0026#39;/extensions\u0026#39;))), extensionName = name) on $left.idVm == $right.idVmExtension | where isPerformanceEnabled != 1 or (extensionName != \u0026#39;AzureMonitorWindowsAgent\u0026#39; and extensionName != \u0026#39;AzureMonitorLinuxAgent\u0026#39;) | project recommendationId = \u0026#34;b72214bb-e879-5f4b-b9cd-642db84f36f4\u0026#34;, name, id = idVm, tags, param1 = strcat(\u0026#39;MonitoringExtension:\u0026#39;, extensionName), param2 = strcat(\u0026#39;DataCollectionRuleId:\u0026#39;, idDcr), param3 = strcat(\u0026#39;isPerformanceEnabled:\u0026#39;, isPerformanceEnabled) Configure monitoring for all Azure Virtual Machines\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Monitor Metrics automatically receives platform metrics, but platform logs, which offer detailed diagnostics and auditing for resources and their Azure platform, need to be manually routed for collection. Potential Benefits:\rEnhanced diagnostics and auditing capability\rLearn More:\rAzure Monitor Agent overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Virtual Machines without diagnostic settings enabled/with diagnostic settings enabled but not configured both performance counters and event logs/syslogs. resources | where type =~ \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project name, id, tags, lowerCaseVmId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines/extensions\u0026#34; and properties.publisher =~ \u0026#34;Microsoft.Azure.Diagnostics\u0026#34; | project lowerCaseVmIdOfExtension = tolower(substring(id, 0, indexof(id, \u0026#34;/extensions/\u0026#34;))), extensionType = properties.type, provisioningState = properties.provisioningState, storageAccount = properties.settings.StorageAccount, // Windows wadPerfCounters = properties.settings.WadCfg.DiagnosticMonitorConfiguration.PerformanceCounters.PerformanceCounterConfiguration, wadEventLogs = properties.settings.WadCfg.DiagnosticMonitorConfiguration.WindowsEventLog, // Linux ladPerfCounters = properties.settings.ladCfg.diagnosticMonitorConfiguration.performanceCounters.performanceCounterConfiguration, ladSyslog = properties.settings.ladCfg.diagnosticMonitorConfiguration.syslogEvents | extend // Windows isWadPerfCountersConfigured = iif(array_length(wadPerfCounters) \u0026gt; 0, true, false), isWadEventLogsConfigured = iif(isnotnull(wadEventLogs) and array_length(wadEventLogs.DataSource) \u0026gt; 0, true, false), // Linux isLadPerfCountersConfigured = iif(array_length(ladPerfCounters) \u0026gt; 0, true, false), isLadSyslogConfigured = isnotnull(ladSyslog) | project lowerCaseVmIdOfExtension, extensionType, provisioningState, storageAccount, isPerfCountersConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadPerfCountersConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadPerfCountersConfigured, false), isEventLogsConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadEventLogsConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadSyslogConfigured, false) ) on $left.lowerCaseVmId == $right.lowerCaseVmIdOfExtension | where isempty(lowerCaseVmIdOfExtension) or provisioningState !~ \u0026#34;Succeeded\u0026#34; or not(isPerfCountersConfigured and isEventLogsConfigured) | extend param1 = strcat(\u0026#34;DiagnosticSetting: \u0026#34;, iif(isnotnull(extensionType), strcat(\u0026#34;Enabled, partially configured (\u0026#34;, extensionType, \u0026#34;)\u0026#34;), \u0026#34;Not enabled\u0026#34;)), param2 = strcat(\u0026#34;ProvisioningState: \u0026#34;, iif(isnotnull(provisioningState), provisioningState, \u0026#34;n/a\u0026#34;)), param3 = strcat(\u0026#34;storageAccount: \u0026#34;, iif(isnotnull(storageAccount), storageAccount, \u0026#34;n/a\u0026#34;)), param4 = strcat(\u0026#34;PerformanceCounters: \u0026#34;, case(isnull(isPerfCountersConfigured), \u0026#34;n/a\u0026#34;, isPerfCountersConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)), param5 = strcat(\u0026#34;EventLogs/Syslogs: \u0026#34;, case(isnull(isEventLogsConfigured), \u0026#34;n/a\u0026#34;, isEventLogsConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)) | project recommendationId = \u0026#34;4a9d8973-6dba-0042-b3aa-07924877ebd5\u0026#34;, name, id, tags, param1, param2, param3, param4, param5 Use maintenance configurations for the VMs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe maintenance configuration settings let users schedule and manage updates, making sure the updates or interruptions on the VM are performed within a planned timeframe. Potential Benefits:\rScheduled updates for VMs\rLearn More:\rUse maintenance configurations to control and manage the VM updates\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMS that do not have maintenance configuration assigned Resources | extend resourceId = tolower(id) | project name, location, type, id, tags, resourceId, properties | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | join kind=leftouter ( maintenanceresources | where type =~ \u0026#34;microsoft.maintenance/configurationassignments\u0026#34; | project planName = name, type, maintenanceProps = properties | extend resourceId = tostring(maintenanceProps.resourceId) ) on resourceId | where isnull(maintenanceProps) | project recommendationId = \u0026#34;52ab9e5c-eec0-3148-8bd7-b6dd9e1be870\u0026#34;,name, id, tags | order by id asc Don\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA-series VMs are tailored for entry-level workloads like development and testing, including use cases such as development and test servers, low traffic web servers, and small to medium databases. Potential Benefits:\rEnsures full CPU usage for heavy tasks\rLearn More:\rB-series burstable virtual machine sizes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs using A or B series families resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | where properties.hardwareProfile.vmSize contains \u0026#34;Standard_B\u0026#34; or properties.hardwareProfile.vmSize contains \u0026#34;Standard_A\u0026#34; | project recommendationId = \u0026#34;3201dba8-d1da-4826-98a4-104066545170\u0026#34;, name, id, tags, param1=strcat(\u0026#34;vmSku: \u0026#34; , properties.hardwareProfile.vmSize) Mission Critical Workloads should consider using Premium or Ultra Disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCompared to Standard HDD and SSD, Premium SSD, SSDv2, and Ultra SSDs offer improved performance, configurability, and higher single-instance Virtual Machine uptime SLAs. The lowest SLA of all disks on a Virtual Machine applies, so it is best to use Premium or Ultra Disks for the highest uptime SLA. Potential Benefits:\rEnhanced performance, cost efficiency, and uptime SLA\rLearn More:\rDisk type comparison and decision tree\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that have an attached disk that is not in the Premium or Ultra sku tier. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | extend lname = tolower(name) | join kind=leftouter(resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where not(sku.tier =~ \u0026#39;Premium\u0026#39;) and not(sku.tier =~ \u0026#39;Ultra\u0026#39;) | extend lname = tolower(tostring(split(managedBy, \u0026#39;/\u0026#39;)[8])) | project lname, name | summarize disks = make_list(name) by lname) on lname | where isnotnull(disks) | project recommendationId = \u0026#34;df0ff862-814d-45a3-95e4-4fad5a244ba6\u0026#34;, name, id, tags, param1=strcat(\u0026#34;AffectedDisks: \u0026#34;, disks) Use Azure Boost VMs for Maintenance sensitive workload\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIf the workload is Maintenance sensitive, consider Azure Boost compatible VMs. Azure Boost is designed to lessen the impact on customers when Azure maintenance activities occur on the host, and the current list of compatible VM sizes are documented in the first link below. Potential Benefits:\rLess maintenance impact\rLearn More:\rMicrosoft Azure Boost\rAnnouncing the general availability of Azure Boost\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Scheduled Events for Maintenance sensitive workload VMs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rIf your workload is Maintenance sensitive, enable Scheduled Events. This Azure Metadata Service lets your app prepare for virtual machine maintenance by providing information on upcoming events like reboots, reducing disruptions. Potential Benefits:\rMinimize downtime for VMs\rLearn More:\rMonitor scheduled events for your Azure VMs\rAzure Metadata Service Scheduled Events for Linux VMs\rAzure Metadata Service Scheduled Events for Windows VMs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use ZRS Disks or Protect LRS Disks from Availability Zone Failure\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure disks offers a zone-redundant storage (ZRS) option for workloads that need to be resilient to an entire zone being down. Due to the cross-zone data replication, ZRS disks have higher write latency when compared to the locally-redundant option (LRS), so make sure to benchmark your disks. Potential Benefits:\rEnhanced Disk resilience to failures\rLearn More:\rRedundancy options for managed disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find eligible Disks that are not zonal nor zone redundant resources | where type == \u0026#39;microsoft.compute/disks\u0026#39; | where sku has \u0026#34;Premium_LRS\u0026#34; or sku has \u0026#34;StandardSSD_LRS\u0026#34; | where sku.name has_cs \u0026#39;ZRS\u0026#39; or array_length(zones) \u0026gt; 0 | project recommendationId=\u0026#34;fa0cf4f5-0b21-47b7-89a9-ee936f193ce1\u0026#34;, name, id, tags, param1 = sku, param2 = sku.name ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rRun production workloads on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rDeploy VMs across Availability Zones\rHigh\rHigh Availability\rYes\rVerified\rMigrate VMs using availability sets to VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rReplicate VMs using Azure Site Recovery\rMedium\rDisaster Recovery\rYes\rVerified\rUse Managed Disks for VM disks\rHigh\rHigh Availability\rYes\rVerified\rHost database data on a data disk\rLow\rScalability\rYes\rVerified\rBackup VMs with Azure Backup service\rMedium\rDisaster Recovery\rYes\rVerified\rProduction VMs should be using SSD disks\rHigh\rScalability\rYes\rVerified\rReview VMs in stopped state\rLow\rGovernance\rYes\rVerified\rEnable Accelerated Networking (AccelNet)\rMedium\rScalability\rYes\rVerified\rWhen AccelNet is enabled, you must manually update the GuestOS NIC driver\rLow\rGovernance\rNo\rVerified\rVMs should not have a Public IP directly associated\rMedium\rSecurity\rYes\rVerified\rVM network interfaces and associated subnets both have a Network Security Group (NSG) associated\rLow\rSecurity\rYes\rVerified\rIP Forwarding should only be enabled for Network Virtual Appliances\rMedium\rSecurity\rYes\rVerified\rCustomer DNS Servers should be configured in the Virtual Network level\rLow\rOther Best Practices\rYes\rVerified\rShared disks should only be enabled in clustered servers\rMedium\rOther Best Practices\rYes\rVerified\rNetwork access to the VM disk should be set to Disable public access and enable private access\rLow\rSecurity\rYes\rVerified\rEnsure that your VMs are compliant with Azure Policies\rLow\rGovernance\rYes\rVerified\rEnable advanced encryption options for your managed disks\rMedium\rSecurity\rNo\rVerified\rEnable VM Insights\rLow\rMonitoring and Alerting\rYes\rVerified\rConfigure monitoring for all Azure Virtual Machines\rLow\rMonitoring and Alerting\rYes\rVerified\rUse maintenance configurations for the VMs\rHigh\rHigh Availability\rYes\rVerified\rDon\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rHigh\rScalability\rYes\rVerified\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rVerified\rUse Azure Boost VMs for Maintenance sensitive workload\rMedium\rHigh Availability\rNo\rVerified\rEnable Scheduled Events for Maintenance sensitive workload VMs\rMedium\rHigh Availability\rNo\rVerified\rUse ZRS Disks or Protect LRS Disks from Availability Zone Failure\rMedium\rHigh Availability\rYes\rVerified\rDetails\rRun production workloads on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rProduction VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates."},{"id":335,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/virtualMachines/","title":"virtualMachines","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":336,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/virtualMachineScaleSets/","title":"virtualMachineScaleSets","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy VMSS with Flex orchestration mode instead of Uniform\rMedium\rScalability\rYes\rVerified\rEnable VMSS application health monitoring\rMedium\rMonitoring and Alerting\rYes\rVerified\rEnable Automatic Repair policy\rHigh\rOther Best Practices\rYes\rVerified\rConfigure VMSS Autoscale to custom and configure the scaling metrics\rHigh\rScalability\rYes\rVerified\rEnable Predictive autoscale and configure at least for Forecast Only\rLow\rScalability\rYes\rVerified\rDisable Force strictly even balance across zones to avoid scale in and out fail attempts\rHigh\rHigh Availability\rYes\rVerified\rDeploy VMSS across availability zones with VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rSet Patch orchestration options to Azure-orchestrated\rLow\rOther Best Practices\rYes\rVerified\rUpgrade VMSS Image versions scheduled to be deprecated or already retired\rHigh\rGovernance\rNo\rVerified\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rVerified\rDetails\rDeploy VMSS with Flex orchestration mode instead of Uniform\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDeploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability. This mode guarantees high availability (up to 1000 VMs) by distributing VMs across fault domains in a region or within an Availability Zone. Potential Benefits:\rHigher scalability and availability\rLearn More:\rWhen to use VMSS instead of VMs\rAzure Well-Architected Framework review - Virtual Machines and Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all zonal VMs that are NOT deployed with Flex orchestration mode resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode != \u0026#34;Flexible\u0026#34; | project recommendationId = \u0026#34;e7495e1c-0c75-0946-b266-b429b5c7f3bf\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;orchestrationMode: \u0026#34;, tostring(properties.orchestrationMode)) Enable VMSS application health monitoring\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMonitoring application health in Azure Virtual Machine Scale Sets is crucial for deployment management. It supports rolling upgrades such as automatic OS-image upgrades and VM guest patching, leveraging health monitoring for upgrading. Potential Benefits:\rEnhances deployment management and upgrades\rLearn More:\rUsing Application Health extension with Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have health monitoring enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=leftouter ( resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | mv-expand extension=properties.virtualMachineProfile.extensionProfile.extensions | where extension.properties.type in ( \u0026#34;ApplicationHealthWindows\u0026#34;, \u0026#34;ApplicationHealthLinux\u0026#34; ) | project id ) on id | where id1 == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;94794d2a-eff0-2345-9b67-6f9349d0a627\u0026#34;, name, id, tags, param1 = \u0026#34;extension: null\u0026#34; Enable Automatic Repair policy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnabling automatic instance repairs in Azure Virtual Machine Scale Sets enhances application availability through a continuous health check and maintenance process. Potential Benefits:\rBoosts app availability by auto-repair\rLearn More:\rAutomatic instance repairs for Azure Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have automatic repair policy enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.automaticRepairsPolicy.enabled == false | project recommendationId = \u0026#34;820f4743-1f94-e946-ae0b-45efafd87962\u0026#34;, name, id, tags, param1 = \u0026#34;automaticRepairsPolicy: Disabled\u0026#34; Configure VMSS Autoscale to custom and configure the scaling metrics\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse custom autoscale for VMSS based on metrics and schedules to improve performance and cost effectiveness, adjusting instances as demand changes. Potential Benefits:\rEnhances performance and cost-efficiency\rLearn More:\rGet started with autoscale in Azure\rOverview of autoscale in Azure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when autoscale is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where isnull(autoscalesettings) or autoscalesettings.enabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;ee66ff65-9aa3-2345-93c1-25827cf79f44\u0026#34;, name, id, tags, param1 = \u0026#34;autoscalesettings: Disabled\u0026#34; | order by id asc Enable Predictive autoscale and configure at least for Forecast Only\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rPredictive autoscale utilizes machine learning to efficiently manage and scale Azure Virtual Machine Scale Sets by forecasting CPU load through historical usage analysis, ensuring timely scale-out to meet demand. Potential Benefits:\rOptimizes scaling with ML predictions\rLearn More:\rUse predictive autoscale to scale out before load demands in virtual machine scale sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when predictiveAutoscalePolicy_scaleMode is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where autoscalesettings.enabled == \u0026#34;true\u0026#34; and autoscalesettings.predictiveAutoscalePolicy.scaleMode == \u0026#34;Disabled\u0026#34; | project recommendationId = \u0026#34;3f85a51c-e286-9f44-b4dc-51d00768696c\u0026#34;, name, id, tags, param1 = \u0026#34;predictiveAutoscalePolicy_scaleMode: Disabled\u0026#34; | order by id asc Disable Force strictly even balance across zones to avoid scale in and out fail attempts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rMicrosoft advises disabling strictly even VM instance distribution across Availability Zones in VMSS to improve scalability and flexibility, noting that uneven distribution may better serve application load demands despite the potential trade-off in resilience. Potential Benefits:\rImproves scaling, reduces fail attempts\rLearn More:\rUse scale-in policies with Azure Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances where strictly zoneBalance is set to True resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode == \u0026#34;Uniform\u0026#34; and properties.zoneBalance == true | project recommendationId = \u0026#34;b5a63aa0-c58e-244f-b8a6-cbba0560a6db\u0026#34;, name, id, tags, param1 = \u0026#34;strictly zoneBalance: Enabled\u0026#34; | order by id asc Deploy VMSS across availability zones with VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen creating VMSS, implement availability zones as a protection measure for your applications and data against the rare event of datacenter failure. Potential Benefits:\rEnhances disaster resilience\rLearn More:\rCreate a Virtual Machine Scale Set that uses Availability Zones\rUpdate scale set to add availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances with one or no Zones selected resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;1422c567-782c-7148-ac7c-5fc14cf45adc\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc Set Patch orchestration options to Azure-orchestrated\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnabling automatic VM guest patching eases update management by safely, automatically patching virtual machines to maintain security compliance, while limiting blast radius of VMs. Note, the KQL will not return sets using Uniform orchestration. Potential Benefits:\rEases patch management, enhances security\rLearn More:\rAutomatic VM Guest Patching for Azure VMs\rAuto OS Image Upgrades\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Identifies VMs and VMSS with manual patch settings, excluding automatic patch modes resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=inner ( resources | where type == \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties ) on id | extend recommendationId = \u0026#34;e4ffd7b0-ba24-c84e-9352-ba4819f908c0\u0026#34;, param1 = \u0026#34;patchMode: Manual\u0026#34;, vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode | where isnotnull(vmproperties.osProfile.linuxConfiguration) and vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode !in (\u0026#34;AutomaticByPlatform\u0026#34;, \u0026#34;AutomaticByOS\u0026#34;) | distinct recommendationId, name, id, param1 | union (resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=inner ( resources | where type == \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties ) on id | extend recommendationId = \u0026#34;e4ffd7b0-ba24-c84e-9352-ba4819f908c0\u0026#34;, param1 = \u0026#34;patchMode: Manual\u0026#34;, vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode | where isnotnull(vmproperties.osProfile.windowsConfiguration) and vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode !in (\u0026#34;AutomaticByPlatform\u0026#34;, \u0026#34;AutomaticByOS\u0026#34;) | distinct recommendationId, name, id, param1) Upgrade VMSS Image versions scheduled to be deprecated or already retired\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rEnsure current versions of images are in use to avoid disruption after image deprecation. Please review the publisher, offer, sku information of the VM to ensure you are running on a supported image. Enable Auto Guest Patching or Image Upgrades, to get notifications about image deprecation. Potential Benefits:\rAvoid disruptions by updating VMSS images.\rLearn More:\rDeprecated Azure Marketplace images\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r//cannot be validated with arg Mission Critical Workloads should consider using Premium or Ultra Disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCompared to Standard HDD and SSD, Premium SSD, SSDv2, and Ultra SSDs offer improved performance, configurability, and higher single-instance Virtual Machine uptime SLAs. The lowest SLA of all disks on a Virtual Machine applies, so it is best to use Premium or Ultra Disks for the highest uptime SLA. Potential Benefits:\rEnhanced performance, cost efficiency, and uptime SLA\rLearn More:\rDisk type comparison and decision tree\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDeploy VMSS with Flex orchestration mode instead of Uniform\rMedium\rScalability\rYes\rVerified\rEnable VMSS application health monitoring\rMedium\rMonitoring and Alerting\rYes\rVerified\rEnable Automatic Repair policy\rHigh\rOther Best Practices\rYes\rVerified\rConfigure VMSS Autoscale to custom and configure the scaling metrics\rHigh\rScalability\rYes\rVerified\rEnable Predictive autoscale and configure at least for Forecast Only\rLow\rScalability\rYes\rVerified\rDisable Force strictly even balance across zones to avoid scale in and out fail attempts\rHigh\rHigh Availability\rYes\rVerified\rDeploy VMSS across availability zones with VMSS Flex\rHigh\rHigh Availability\rYes\rVerified\rSet Patch orchestration options to Azure-orchestrated\rLow\rOther Best Practices\rYes\rVerified\rUpgrade VMSS Image versions scheduled to be deprecated or already retired\rHigh\rGovernance\rNo\rVerified\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rVerified\rDetails\rDeploy VMSS with Flex orchestration mode instead of Uniform\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDeploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability."},{"id":337,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworkGateways/","title":"virtualNetworkGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConnect ExpressRoute gateway with circuits from diverse peering locations for resilience\rHigh\rHigh Availability\rYes\rVerified\rUse Zone-redundant ExpressRoute gateway SKUs\rHigh\rHigh Availability\rYes\rVerified\rConfigure an Azure Resource lock for ExpressRoute gateway to prevent accidental deletion\rMedium\rHigh Availability\rNo\rVerified\rMonitor gateway health for ExpressRoute gateways\rHigh\rMonitoring and Alerting\rNo\rVerified\rAvoid using ExpressRoute circuits for VNet to VNet communication\rMedium\rHigh Availability\rNo\rVerified\rConfigure customer-controlled ExpressRoute gateway maintenance\rHigh\rHigh Availability\rYes\rVerified\rChoose a Zone-redundant VPN gateway\rHigh\rHigh Availability\rYes\rVerified\rPlan for Active-Active mode with VPN Gateways\rHigh\rHigh Availability\rYes\rVerified\rDeploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rHigh\rDisaster Recovery\rNo\rVerified\rMonitor VPN gateway connections and health\rHigh\rMonitoring and Alerting\rNo\rVerified\rEnable VPN gateway service health\rHigh\rMonitoring and Alerting\rNo\rVerified\rDeploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rHigh\rHigh Availability\rYes\rVerified\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations for resilience\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo increase reliability, it\u0026#39;s advised that each ExpressRoute gateway connects to at least two circuits, with each circuit originating from a different peering location than the other, ensuring diverse connectivity paths for enhanced resilience. Potential Benefits:\rEnhanced resiliency for Azure service\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of ExpressRoute Gateways that are not connected to two or more ExpressRoute Circuits. Baremetal circuits are excluded from consideration //This query assumes that the running entity has visibilty to the gateway, connection, and circuit scopes. //Start with a full list of gateways (resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=inner( resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=leftouter( //connections joined with circuit peer info resources | where type == \u0026#34;microsoft.network/connections\u0026#34; | extend connectionType = properties.connectionType | extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id)) | extend peerId = tolower(tostring(properties.peer.id)) | extend connectionId = tolower(tostring(id)) | where connectionType == \u0026#34;ExpressRoute\u0026#34; | join kind=leftouter( resources | where type == \u0026#34;microsoft.network/expressroutecircuits\u0026#34; //should this be location instead of peeringLocation | extend circuitId = tolower(tostring(id)) | extend peeringLocation = tostring(properties.serviceProviderProperties.peeringLocation) | extend peerId = tolower(id) ) on peerId ) on exrGatewayId //remove bare metal services connections/circuits | where not(isnotnull(connectionId) and isnull(sku1)) //group by gateway ID\u0026#39;s and peering locations | summarize by exrGatewayId, peeringLocation //summarize to connections with fewer than two unique connections | summarize connCount = count() by exrGatewayId | where connCount \u0026lt; 2) on exrGatewayId | project recommendationId = \u0026#34;d37db635-157f-584d-9bce-4f6fc8c65ce5\u0026#34;, name, id, tags, param1 = \u0026#34;twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\u0026#34;) | union ( resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=leftouter( //connections joined with circuit peer info resources | where type == \u0026#34;microsoft.network/connections\u0026#34; | extend connectionType = properties.connectionType | extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id)) | extend peerId = tolower(tostring(properties.peer.id)) | extend connectionId = tolower(tostring(id)) | where connectionType == \u0026#34;ExpressRoute\u0026#34;) on exrGatewayId | where isnull(connectionType) | project recommendationId = \u0026#34;d37db635-157f-584d-9bce-4f6fc8c65ce5\u0026#34;, name, id, tags, param1 = \u0026#34;twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\u0026#34;, param2 = \u0026#34;noConnectionsOnGateway: true\u0026#34; ) Use Zone-redundant ExpressRoute gateway SKUs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure ExpressRoute gateway offers variable SLAs based on deployment in single or multiple availability zones. To deploy virtual network gateways across zones automatically, use zone-redundant gateways for accessing critical, scalable services with increased resilience. Potential Benefits:\rEnhanced SLA and resilience\rLearn More:\rAbout ExpressRoute virtual network gateways - Zone-redundant gateway SKUs\rAbout zone-redundant virtual network gateway in Azure availability zones\rCreate a zone-redundant virtual network gateway in Azure Availability Zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // For all VNGs of type ExpressRoute, show any that do not have AZ in the SKU tier resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | where properties.sku.tier !contains \u0026#39;AZ\u0026#39; | project recommendationId = \u0026#34;bbe668b7-eb5c-c746-8b82-70afdedf0cae\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location | order by id asc Configure an Azure Resource lock for ExpressRoute gateway to prevent accidental deletion\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rConfiguring an Azure Resource lock for ExpressRoute gateway prevents accidental deletion by enabling administrators to lock an Azure subscription, resource group, or resource, thereby protecting them from unintended user deletions and modifications, with the lock overriding all user permissions. Potential Benefits:\rPrevents accidental deletions\rLearn More:\rProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor gateway health for ExpressRoute gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Network Insights for monitoring ExpressRoute Gateway\u0026#39;s health, including availability, performance, and scalability. Potential Benefits:\rEnhanced monitoring and alerting\rLearn More:\rExpressRoute monitoring, metrics, and alerts | ExpressRoute gateways\rAzure ExpressRoute Insights using Network Insights\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Avoid using ExpressRoute circuits for VNet to VNet communication\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhile multiple VNets can connect via the same ExpressRoute gateway, Microsoft recommends using alternatives like VNet peering, Azure Firewall, NVA, Azure Route Server, site-to-site VPN, virtual WAN, or SD-WAN for VNet-to-VNet communication to optimize network performance and management. Potential Benefits:\rEnhanced VNet integration efficiency\rLearn More:\rAbout ExpressRoute virtual network gateways - VNet-to-VNet connectivity\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure customer-controlled ExpressRoute gateway maintenance\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rExpressRoute gateways are updated for improved functionality, reliability, performance, and security. Customer-controlled maintenance configuration and scheduling minimize update impact and align with your maintenance windows. Potential Benefits:\rMinimizes update impact\rLearn More:\rConfigure customer-controlled maintenance for your virtual network gateway - ExpressRoute | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Virtual Network Gateways without Maintenance Configurations resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | extend resourceId = tolower(id) | join kind=leftouter ( maintenanceresources | where type =~ \u0026#34;Microsoft.Maintenance/configurationAssignments\u0026#34; | project JsonData = parse_json(properties) | extend maintenanceConfigurationId = tolower(tostring(JsonData.maintenanceConfigurationId)) | join kind=inner ( resources | where type =~ \u0026#34;Microsoft.Maintenance/maintenanceConfigurations\u0026#34; | project maintenanceConfigurationId=tolower(id) ) on maintenanceConfigurationId | project maintenanceConfigurationId, resourceId=tolower(tostring(JsonData.resourceId)) ) on resourceId | where isempty(maintenanceConfigurationId) | project recommendationId = \u0026#34;3e115044-a3aa-433e-be01-ce17d67e50da\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location Choose a Zone-redundant VPN gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure VPN gateway offers variable SLAs based on deployment in one or two availability zones. Deploying zone-redundant virtual network gateways across availability zones ensures zone-resiliency, improving access to mission-critical, scalable services on Azure. Potential Benefits:\rEnhanced reliability and scalability\rLearn More:\rZone redundant Virtual network gateway in availability zone\rGateway SKU\rSLA summary for Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // For all VNGs of type Vpn, show any that do not have AZ in the SKU tier resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.gatewayType == \u0026#34;Vpn\u0026#34; | where properties.sku.tier !contains \u0026#39;AZ\u0026#39; | project recommendationId = \u0026#34;5b1933a6-90e4-f642-a01f-e58594e5aab2\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location | order by id asc Plan for Active-Active mode with VPN Gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe active-active mode is available for all SKUs except Basic, allowing for two Gateway IP configurations and two public IP addresses, enhancing redundancy and traffic handling. Potential Benefits:\rEnhanced reliability and network capacity\rLearn More:\rActive-active VPN gateway\rGateway SKU\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Identifies non-active-active VPN type virtual network gateways resources | where type =~ \u0026#39;Microsoft.Network/virtualNetworkGateways\u0026#39; | where properties.gatewayType =~ \u0026#34;vpn\u0026#34; | extend gatewayType = properties.gatewayType, vpnType = properties.vpnType, connections = properties.connections, activeactive=properties.activeActive | where activeactive == false | project recommendationId = \u0026#34;281a2713-c0e0-3c48-b596-19f590c46671\u0026#34;, name, id, tags Deploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDeploying active-active VPN concentrators and Azure VPN Gateways maximizes resilience and availability using a fully-meshed topology with four IPSec tunnels. Potential Benefits:\rMaximizes resilience and availability\rLearn More:\rDual-redundancy active-active VPN gateways for both Azure and on-premises networks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor VPN gateway connections and health\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rSet up monitoring and alerts for Virtual Network Gateway health to utilize a variety of metrics for ensuring operational efficiency and prompt response to any disruptions. Potential Benefits:\rImproved uptime and issue awareness\rLearn More:\rVPN gateway data reference\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable VPN gateway service health\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rVPN gateway leverages service health to inform users about both planned and unplanned maintenance, ensuring they are notified about modifications to their VPN connectivity. Potential Benefits:\rImproves VPN maintenance alerts\rLearn More:\rGetting started with Azure Metrics Explorer\rMonitor VPN gateway\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rFor zone-redundant VPN gateways, always use zone-redundant Standard SKU public IPs to avoid deploying all instances in one zone. This ensures the gateway\u0026#39;s reliability, applying to both active-passive (single IP) and active-active (dual IP) setups. Potential Benefits:\rEnhanced reliability and disaster recovery\rLearn More:\rAbout zone-redundant virtual network gateway in Azure availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of zone-redundant Azure VPN gateways associated with non-zone-redundant Public IPs resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.gatewayType == \u0026#34;Vpn\u0026#34; | where properties.sku.tier contains \u0026#39;AZ\u0026#39; | mv-expand ipconfig = properties.ipConfigurations | extend pipId = tostring(ipconfig.properties.publicIPAddress.id) | join kind=inner ( resources | where type == \u0026#34;microsoft.network/publicipaddresses\u0026#34; | where isnull(zones) or array_length(zones) \u0026lt; 3 ) on $left.pipId == $right.id | project recommendationId = \u0026#34;4bae5a28-5cf4-40d9-bcf1-623d28f6d917\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;PublicIpAddressName: \u0026#34;, name1), param2 = strcat (\u0026#34;PublicIpAddressId: \u0026#34;,id1), param3 = strcat (\u0026#34;PublicIpAddressTags: \u0026#34;,tags1) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rConnect ExpressRoute gateway with circuits from diverse peering locations for resilience\rHigh\rHigh Availability\rYes\rVerified\rUse Zone-redundant ExpressRoute gateway SKUs\rHigh\rHigh Availability\rYes\rVerified\rConfigure an Azure Resource lock for ExpressRoute gateway to prevent accidental deletion\rMedium\rHigh Availability\rNo\rVerified\rMonitor gateway health for ExpressRoute gateways\rHigh\rMonitoring and Alerting\rNo\rVerified\rAvoid using ExpressRoute circuits for VNet to VNet communication\rMedium\rHigh Availability\rNo\rVerified\rConfigure customer-controlled ExpressRoute gateway maintenance\rHigh\rHigh Availability\rYes\rVerified\rChoose a Zone-redundant VPN gateway\rHigh\rHigh Availability\rYes\rVerified\rPlan for Active-Active mode with VPN Gateways\rHigh\rHigh Availability\rYes\rVerified\rDeploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rHigh\rDisaster Recovery\rNo\rVerified\rMonitor VPN gateway connections and health\rHigh\rMonitoring and Alerting\rNo\rVerified\rEnable VPN gateway service health\rHigh\rMonitoring and Alerting\rNo\rVerified\rDeploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rHigh\rHigh Availability\rYes\rVerified\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations for resilience\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo increase reliability, it\u0026#39;s advised that each ExpressRoute gateway connects to at least two circuits, with each circuit originating from a different peering location than the other, ensuring diverse connectivity paths for enhanced resilience."},{"id":338,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworks/","title":"virtualNetworks","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rAll Subnets should have a Network Security Group associated\rHigh\rSecurity\rYes\rVerified\rShield public endpoints in Azure VNets with Azure DDoS Standard Protection Plans\rHigh\rSecurity\rYes\rVerified\rWhen available, use Private Endpoints instead of Service Endpoints for PaaS Services\rMedium\rSecurity\rYes\rVerified\rDetails\rAll Subnets should have a Network Security Group associated\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rNetwork security groups and application security groups allow filtering of inbound and outbound traffic by IP, port, and protocol, adding a security layer at the Subnet level. Potential Benefits:\rEnhanced subnet security and traffic control\rLearn More:\rAzure Virtual Network - Concepts and best practices | Microsoft Learn\rGatewaySUbnet\rCan I associate a network security group (NSG) to the RouteServerSubnet?\rAre Network Security Groups (NSGs) supported on the AzureFirewallSubnet?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Subnets without NSG associated resources | where type =~ \u0026#39;Microsoft.Network/virtualnetworks\u0026#39; | mv-expand subnets = properties.subnets | extend sn = string_size(subnets.properties.networkSecurityGroup) | where sn == 0 and subnets.name !in (\u0026#34;GatewaySubnet\u0026#34;, \u0026#34;AzureFirewallSubnet\u0026#34;, \u0026#34;AzureFirewallManagementSubnet\u0026#34;, \u0026#34;RouteServerSubnet\u0026#34;) | project recommendationId = \u0026#34;f0bf9ae6-25a5-974d-87d5-025abec73539\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;SubnetName: \u0026#34;, subnets.name), param2 = \u0026#34;NSG: False\u0026#34; Shield public endpoints in Azure VNets with Azure DDoS Standard Protection Plans\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure DDoS Protection offers enhanced mitigation features against DDoS attacks and is auto-tuned to protect specific resources in a virtual network, combined with application design best practices. Potential Benefits:\rEnhanced DDoS attack mitigation\rLearn More:\rReliability and Azure Virtual Network - Microsoft Azure Well-Architected Framework | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find virtual networks without DDoS Protection resources | where type =~ \u0026#39;Microsoft.Network/virtualNetworks\u0026#39; | where isnull(properties.enableDdosProtection) or properties.enableDdosProtection contains \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;69ea1185-19b7-de40-9da1-9e8493547a5c\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;EnableDdosProtection: \u0026#34;, properties.enableDdosProtection) When available, use Private Endpoints instead of Service Endpoints for PaaS Services\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse VNet service endpoints only if Private Link isn\u0026#39;t available and no data movement concerns. This feature restricts Azure service access to specified VNet and subnet, enhancing network security and isolating service traffic. Potential Benefits:\rEnhanced security and data isolation\rLearn More:\rAzure Virtual Network FAQ | Microsoft Learn\rReliability and Network connectivity - Microsoft Azure Well-Architected Framework | Microsoft LearnNetworking Reliability\rAzure Private Link availability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Subnets with Service Endpoint enabled for services that offer Private Link resources | where type =~ \u0026#39;Microsoft.Network/virtualnetworks\u0026#39; | mv-expand subnets = properties.subnets | extend se = array_length(subnets.properties.serviceEndpoints) | where se \u0026gt;= 1 | project name, id, tags, subnets, serviceEndpoints=todynamic(subnets.properties.serviceEndpoints) | mv-expand serviceEndpoints | project name, id, tags, subnetName=subnets.name, serviceName=tostring(serviceEndpoints.service) | where serviceName in (parse_json(\u0026#39;[\u0026#34;Microsoft.CognitiveServices\u0026#34;,\u0026#34;Microsoft.AzureCosmosDB\u0026#34;,\u0026#34;Microsoft.DBforMariaDB\u0026#34;,\u0026#34;Microsoft.DBforMySQL\u0026#34;,\u0026#34;Microsoft.DBforPostgreSQL\u0026#34;,\u0026#34;Microsoft.EventHub\u0026#34;,\u0026#34;Microsoft.KeyVault\u0026#34;,\u0026#34;Microsoft.ServiceBus\u0026#34;,\u0026#34;Microsoft.Sql\u0026#34;, \u0026#34;Microsoft.Storage\u0026#34;,\u0026#34;Microsoft.StorageSync\u0026#34;,\u0026#34;Microsoft.Synapse\u0026#34;,\u0026#34;Microsoft.Web\u0026#34;]\u0026#39;)) | project recommendationId = \u0026#34;24ae3773-cc2c-3649-88de-c9788e25b463\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;subnet=\u0026#34;, subnetName), param2=strcat(\u0026#34;serviceName=\u0026#34;,serviceName), param3=\u0026#34;ServiceEndpoints=true\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rAll Subnets should have a Network Security Group associated\rHigh\rSecurity\rYes\rVerified\rShield public endpoints in Azure VNets with Azure DDoS Standard Protection Plans\rHigh\rSecurity\rYes\rVerified\rWhen available, use Private Endpoints instead of Service Endpoints for PaaS Services\rMedium\rSecurity\rYes\rVerified\rDetails\rAll Subnets should have a Network Security Group associated\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rNetwork security groups and application security groups allow filtering of inbound and outbound traffic by IP, port, and protocol, adding a security layer at the Subnet level."},{"id":339,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworkTaps/","title":"virtualNetworkTaps","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":340,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualRouters/","title":"virtualRouters","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":341,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualWans/","title":"virtualWans","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":342,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/volumes/","title":"volumes","parent":"NetworkCloud","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":343,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/volumes/","title":"volumes","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":344,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnGateways/","title":"vpnGateways","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":345,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnServerConfigurations/","title":"vpnServerConfigurations","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":346,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnSites/","title":"vpnSites","parent":"Network","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":347,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/","title":"Web","parent":"Azure Resources","content":"","description":""},{"id":348,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/webPubSub/","title":"webPubSub","parent":"SignalRService","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":349,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/webServices/","title":"webServices","parent":"MachineLearning","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":350,"href":"/Azure-Proactive-Resiliency-Library-v2/welcome/","title":"Welcome","parent":"Azure Proactive Resiliency Library v2","content":" Welcome to the home of the Azure Proactive Resiliency Library v2 (APRL). The purpose of this site is to provide a curated catalog of resiliency recommendations for workloads running in Azure. Many of the recommendations contain supporting Azure Resource Graph (ARG) queries to help identify non-compliant resources.\nThe site content is organized into four main sections:\nAzure Resources: This section provides recommendations for individual Azure resources. Recommendations are organized by Azure resource provider and resource type.\nSpecialized Workloads: This section provides recommendations for popular workload types. The recommendations cover multiple resource types and include workload specific guidance.\nWell-Architected Framework: This section provides resiliency recommendations from the Azure Well-Architected Framework\nTools: This section provides automation scripts for workload evaluation. The scripts execute the ARG queries and create documents for analysis, reporting, and triage.\nGet Started\rTo get started head over to the Azure Resources section and then navigate to your chosen resource provider and resource type. Each of the listed resource types will provide recommendations, supporting documentation, and, when available, ARG queries.\nYou can also use the basic search functionality provided by this site to locate the Azure resource you are looking for.\rContributing\rPlease see the contribution guide here.\n","description":"Welcome to the home of the Azure Proactive Resiliency Library v2 (APRL). The purpose of this site is to provide a curated catalog of resiliency recommendations for workloads running in Azure. Many of the recommendations contain supporting Azure Resource Graph (ARG) queries to help identify non-compliant resources.\nThe site content is organized into four main sections:\nAzure Resources: This section provides recommendations for individual Azure resources. Recommendations are organized by Azure resource provider and resource type."},{"id":351,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/workflows/","title":"workflows","parent":"Logic","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":352,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/workloads/","title":"workloads","parent":"Advisor","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":353,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Databricks/workspaces/","title":"workspaces","parent":"Databricks","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDatabricks runtime version is not latest or is not LTS version\rMedium\rGovernance\rNo\rVerified\rUse Databricks Pools\rHigh\rScalability\rNo\rVerified\rUse SSD backed VMs for Worker VM Type and Driver type\rMedium\rScalability\rNo\rVerified\rEnable autoscaling for batch workloads\rHigh\rScalability\rNo\rVerified\rEnable autoscaling for SQL warehouse\rHigh\rScalability\rNo\rVerified\rUse Delta Live Tables enhanced autoscaling\rMedium\rScalability\rNo\rVerified\rAutomatic Job Termination is enabled, ensure there are no user-defined local processes\rMedium\rHigh Availability\rNo\rVerified\rEnable Logging-Cluster log delivery\rMedium\rMonitoring and Alerting\rNo\rVerified\rUse Delta Lake for higher reliability\rHigh\rHigh Availability\rNo\rVerified\rUse Photon Acceleration\rLow\rHigh Availability\rNo\rVerified\rAutomatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rLow\rBusiness Continuity\rNo\rVerified\rConfigure jobs for automatic retries and termination\rHigh\rHigh Availability\rNo\rVerified\rUse a scalable and production-grade model serving infrastructure\rHigh\rScalability\rNo\rVerified\rUse a layered storage architecture\rMedium\rHigh Availability\rNo\rVerified\rImprove data integrity by reducing data redundancy\rLow\rBusiness Continuity\rNo\rVerified\rActively manage schemas\rMedium\rOther Best Practices\rNo\rVerified\rUse constraints and data expectations\rLow\rBusiness Continuity\rNo\rVerified\rCreate regular backups\rLow\rDisaster Recovery\rNo\rVerified\rRecover from Structured Streaming query failures\rHigh\rHigh Availability\rNo\rVerified\rRecover ETL jobs based on Delta time travel\rMedium\rDisaster Recovery\rNo\rVerified\rUse Databricks Workflows and built-in recovery\rLow\rDisaster Recovery\rNo\rVerified\rConfigure a disaster recovery pattern\rHigh\rDisaster Recovery\rNo\rPreview\rAutomate deployments and workloads\rHigh\rOther Best Practices\rNo\rPreview\rSet up monitoring, alerting, and logging\rHigh\rMonitoring and Alerting\rNo\rPreview\rDeploy workspaces in separate Subscriptions\rHigh\rScalability\rNo\rPreview\rIsolate each workspace in its own Vnet\rHigh\rScalability\rNo\rPreview\rDo not Store any Production Data in Default DBFS Folders\rHigh\rHigh Availability\rNo\rPreview\rDo not use Azure Spot VMs for critical Production workloads\rHigh\rHigh Availability\rNo\rPreview\rEvaluate regional isolation for workspaces\rHigh\rHigh Availability\rNo\rPreview\rDefine alternate VM SKUs\rMedium\rPersonalized\rNo\rPreview\rDetails\rDatabricks runtime version is not latest or is not LTS version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDatabricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support. If on Runtime 11.3 LTS or above, move directly to the latest 12.x version. If below, first migrate to 11.3 LTS, then to the latest 12.x version as per the migration guide. Potential Benefits:\rEnhanced stability and support\rLearn More:\rDatabricks runtime support lifecycles\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Databricks Pools\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDatabricks pools pre-provision VMs, reducing risks of provisioning errors during cluster start or scale, enhancing reliability. Potential Benefits:\rReduces provisioning errors\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use SSD backed VMs for Worker VM Type and Driver type\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUpgrade HDDs in premium VMs to SSDs for better speed and reliability. Premium SSDs boost IO-heavy apps; Standard SSDs balance cost and performance. Ideal for critical workloads, upgrading improves connectivity with brief reboot. Consider for vital VMs Potential Benefits:\rFaster, reliable VM performance\rLearn More:\rAzure managed disk types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable autoscaling for batch workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAutoscaling adjusts cluster sizes automatically based on workload demands, offering benefits for many use cases in terms of costs and performance. It includes guidance on when and how to best utilize Autoscaling. For streaming, Delta Live Tables with autoscaling is advised. Potential Benefits:\rCost and performance optimization\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable autoscaling for SQL warehouse\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rThe scaling parameter of a SQL warehouse defines the min and max number of clusters for distributing queries. By default, it\u0026#39;s set to one. Increasing the cluster count can accommodate more concurrent users effectively. Potential Benefits:\rImproves concurrency and efficiency\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Delta Live Tables enhanced autoscaling\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDatabricks enhanced autoscaling optimizes cluster utilization by automatically allocating cluster resources based on workload volume, with minimal impact on the data processing latency of your pipelines. Potential Benefits:\rOptimized resource use and minimal latency\rLearn More:\rBest practices for reliability\rDatabricks enhanced autoscaling\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatic Job Termination is enabled, ensure there are no user-defined local processes\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo conserve cluster resources, you can terminate a cluster to store its configuration for future reuse or autostart jobs. Clusters can auto-terminate after inactivity, but this only tracks Spark jobs, not local processes, which might still be running even after Spark jobs end. Potential Benefits:\rSaves cluster resources, avoids idle use\rLearn More:\rBest practices for reliability?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Logging-Cluster log delivery\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rWhen creating a Databricks cluster, you can set a log delivery location for the Spark driver, worker nodes, and events. Logs are delivered every 5 mins and archived hourly. Upon cluster termination, all generated logs until that point are guaranteed to be delivered. Potential Benefits:\rImproved troubleshooting and audit\rLearn More:\rCreate a cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Delta Lake for higher reliability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDelta Lake is an open source storage format enhancing data lakes\u0026#39; reliability with ACID transactions, schema enforcement, and scalable metadata handling. Potential Benefits:\rEnhances data reliability and processing\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Photon Acceleration\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rApache Spark in Databricks Lakehouse ensures resilient distributed data processing by automatically rescheduling failed tasks, aiding in overcoming external issues like network problems or revoked VMs. Potential Benefits:\rBoosts speed and reliability for Spark tasks\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rInvalid or nonconforming data can crash workloads dependent on specific data formats. Best practices recommend filtering such data at ingestion to improve end-to-end resilience, ensuring no data is lost or missed. Potential Benefits:\rEnhanced data resilience and integrity\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure jobs for automatic retries and termination\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Databricks and MLflow for deploying models as Spark UDFs for job scheduling, retries, autoscaling. Model serving offers scalable infrastructure, processes models using MLflow, and serves them via REST API using serverless compute managed in Databricks cloud. Potential Benefits:\rEnhanced reliability and autoscaling\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use a scalable and production-grade model serving infrastructure\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUse Databricks and MLflow for deploying models as Apache Spark UDFs, benefiting from job scheduling, retries, autoscaling, etc. Potential Benefits:\rEnhances scalability and reliability\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use a layered storage architecture\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCurate data by creating a layered architecture to increase data quality across layers. Start with a raw layer for ingested source data, continue with a curated layer for cleansed and refined data, and finish with a final layer catered to business needs, focusing on security and performance. Potential Benefits:\rEnhances data quality and trust\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Improve data integrity by reducing data redundancy\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rCopying data leads to redundancy, lost integrity, lineage, and access issues, affecting lakehouse data quality. Temporary copies are useful for agility and innovation but can become problematic operational data silos, questioning data\u0026#39;s master status and currency. Potential Benefits:\rEnhanced data integrity and quality\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Actively manage schemas\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rUncontrolled schema changes can lead to invalid data and failing jobs. Databricks validates and enforces schema through Delta Lake, which prevents bad records during ingestion, and Auto Loader, which detects new columns and supports schema evolution to maintain data integrity. Potential Benefits:\rPrevents invalid data and job failures\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use constraints and data expectations\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDelta tables verify data quality automatically with SQL constraints, triggering an error for violations. Delta Live Tables enhance this by defining expectations for data quality, utilizing Python or SQL, to manage actions for record failures, ensuring data integrity and compliance. Potential Benefits:\rEnsures data quality and integrity\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create regular backups\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rTo recover from a failure, regular backups are needed. The Databricks Labs project migrate lets admins create backups by exporting workspace assets using the Databricks CLI/API. These backups help in restoring or migrating workspaces. Potential Benefits:\rEnsures data recovery and migration\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Recover from Structured Streaming query failures\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rStructured Streaming ensures fault-tolerance and data consistency in streaming queries. With Azure Databricks workflows, you can set up your queries to automatically restart after failure, picking up precisely where they left off. Potential Benefits:\rFault-tolerance and auto-restart for queries\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Recover ETL jobs based on Delta time travel\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDespite thorough testing, a production job can fail or yield unexpected data. Sometimes, repairs are done by adding jobs post-issue identification and pipeline correction. Potential Benefits:\rEasy rollback and fix for ETL jobs\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Databricks Workflows and built-in recovery\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDatabricks Workflows enable efficient error recovery in multi-task jobs by offering a matrix view for issue examination. Fixes can be applied to initiate repair runs targeting only failed and dependent tasks, preserving successful outcomes and thereby saving time and money. Potential Benefits:\rSaves time and money with smart recovery\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure a disaster recovery pattern\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rImplementing a disaster recovery pattern is vital for Azure Databricks, a cloud-native data analytics platform, ensuring data teams\u0026#39; access even during rare regional outages caused by disasters like hurricanes or earthquakes. Potential Benefits:\rEnsures service continuity during disasters\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automate deployments and workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rThe Databricks Terraform provider manages Azure Databricks workspaces and cloud infrastructure flexibly and powerfully. Potential Benefits:\rEfficient, reliable automation\rLearn More:\rBest practices for operational excellence\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Set up monitoring, alerting, and logging\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rThe Databricks Terraform provider is a flexible, powerful tool for managing Azure Databricks workspaces and cloud infrastructure. Potential Benefits:\rEnhanced reliability and automation\rLearn More:\rBest practices for operational excellence\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy workspaces in separate Subscriptions\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rCustomers often naturally divide workspaces by teams or departments. However, it\u0026#39;s crucial to also consider Azure Subscription and ADB Workspace limits when partitioning. Potential Benefits:\rEnhanced limits management, team separation\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Isolate each workspace in its own Vnet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rDeploying only one Databricks Workspace per VNet aligns with ADB\u0026#39;s isolation model. Potential Benefits:\rEnhanced security and resource isolation\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Do not Store any Production Data in Default DBFS Folders\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rDriven by security and data availability concerns, each Azure Databricks Workspace comes with a default DBFS designed for system-level artifacts like libraries and Init scripts, not for production data. Potential Benefits:\rEnhanced security, data protection\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Do not use Azure Spot VMs for critical Production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Spot VMs are not suitable for critical production workloads needing high availability and reliability. They are meant for fault-tolerant tasks and can be evicted with 30-seconds notice if Azure needs the capacity, with no SLA guarantees. Potential Benefits:\rEnsures high reliability for production\rLearn More:\rUse Azure Spot Virtual Machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Evaluate regional isolation for workspaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rMove workspaces to in-region control plane for increased regional isolation. Identify current control plane region using the workspace URL and nslookup. When region from CNAME differs from workspace region and an in-region control is available, consider migration using tools provided below. Potential Benefits:\rImproves resilience and data sovereignty\rLearn More:\rAzure Databricks control plane addresses\rMigrate - maintained by Databricks Inc.\rDatabricks Terraform Exporter - maintained by Databricks Inc. (Experimental)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Define alternate VM SKUs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rPersonalized\rPG Verified:\u0026nbsp;\rPreview\rDescription:\rAzure Databricks planning should include VM SKU swap strategies for capacity issues. VMs are regional, and allocation failures may occur, shown by a \u0026#34;CLOUD PROVIDER\u0026#34; error. Potential Benefits:\rEnsures service availability\rLearn More:\rCompute configuration best practices\rGPU-enabled compute\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rDatabricks runtime version is not latest or is not LTS version\rMedium\rGovernance\rNo\rVerified\rUse Databricks Pools\rHigh\rScalability\rNo\rVerified\rUse SSD backed VMs for Worker VM Type and Driver type\rMedium\rScalability\rNo\rVerified\rEnable autoscaling for batch workloads\rHigh\rScalability\rNo\rVerified\rEnable autoscaling for SQL warehouse\rHigh\rScalability\rNo\rVerified\rUse Delta Live Tables enhanced autoscaling\rMedium\rScalability\rNo\rVerified\rAutomatic Job Termination is enabled, ensure there are no user-defined local processes\rMedium\rHigh Availability\rNo\rVerified\rEnable Logging-Cluster log delivery\rMedium\rMonitoring and Alerting\rNo\rVerified\rUse Delta Lake for higher reliability\rHigh\rHigh Availability\rNo\rVerified\rUse Photon Acceleration\rLow\rHigh Availability\rNo\rVerified\rAutomatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rLow\rBusiness Continuity\rNo\rVerified\rConfigure jobs for automatic retries and termination\rHigh\rHigh Availability\rNo\rVerified\rUse a scalable and production-grade model serving infrastructure\rHigh\rScalability\rNo\rVerified\rUse a layered storage architecture\rMedium\rHigh Availability\rNo\rVerified\rImprove data integrity by reducing data redundancy\rLow\rBusiness Continuity\rNo\rVerified\rActively manage schemas\rMedium\rOther Best Practices\rNo\rVerified\rUse constraints and data expectations\rLow\rBusiness Continuity\rNo\rVerified\rCreate regular backups\rLow\rDisaster Recovery\rNo\rVerified\rRecover from Structured Streaming query failures\rHigh\rHigh Availability\rNo\rVerified\rRecover ETL jobs based on Delta time travel\rMedium\rDisaster Recovery\rNo\rVerified\rUse Databricks Workflows and built-in recovery\rLow\rDisaster Recovery\rNo\rVerified\rConfigure a disaster recovery pattern\rHigh\rDisaster Recovery\rNo\rPreview\rAutomate deployments and workloads\rHigh\rOther Best Practices\rNo\rPreview\rSet up monitoring, alerting, and logging\rHigh\rMonitoring and Alerting\rNo\rPreview\rDeploy workspaces in separate Subscriptions\rHigh\rScalability\rNo\rPreview\rIsolate each workspace in its own Vnet\rHigh\rScalability\rNo\rPreview\rDo not Store any Production Data in Default DBFS Folders\rHigh\rHigh Availability\rNo\rPreview\rDo not use Azure Spot VMs for critical Production workloads\rHigh\rHigh Availability\rNo\rPreview\rEvaluate regional isolation for workspaces\rHigh\rHigh Availability\rNo\rPreview\rDefine alternate VM SKUs\rMedium\rPersonalized\rNo\rPreview\rDetails\rDatabricks runtime version is not latest or is not LTS version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rDatabricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support."},{"id":354,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/workspaces/","title":"workspaces","parent":"DesktopVirtualization","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":355,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Easm/workspaces/","title":"workspaces","parent":"Easm","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":356,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/workspaces/","title":"workspaces","parent":"HealthcareApis","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":357,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/workspaces/","title":"workspaces","parent":"MachineLearning","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":358,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/workspaces/","title":"workspaces","parent":"MachineLearningServices","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":359,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/OperationalInsights/workspaces/","title":"workspaces","parent":"OperationalInsights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable Log Analytics data export to GRS or GZRS\rMedium\rGovernance\rNo\rVerified\rCreate a health status alert rule for your Log Analytics workspace\rLow\rMonitoring and Alerting\rNo\rVerified\rConfigure minimal logging and retention of logs\rLow\rGovernance\rNo\rVerified\rDetails\rEnable Log Analytics data export to GRS or GZRS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rData export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools. Potential Benefits:\rEnhances compliance and regional fault tolerance\rLearn More:\rLog Analytics workspace data export in Azure Monitor\rAzure Monitor configuration recommendations\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a health status alert rule for your Log Analytics workspace\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rA health status alert will proactively notify you if a workspace becomes unavailable because of a datacenter or regional failure. Potential Benefits:\rEarly alert for workspace failure\rLearn More:\rMonitor Log Analytics workspace health\rAzure Monitor configuration recommendations\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure minimal logging and retention of logs\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rAzure Monitor Logs retain log data for specific periods depending on the data type, e.g., 30 days for platform logs. For compliance or business reasons, you might need longer retention. Data retention settings are adjustable. Potential Benefits:\rCost-saving and compliance with data rules\rLearn More:\rData retention and archive in Azure Monitor Logs\rRun search jobs in Azure Monitor\rRestore logs in Azure Monitor\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rPG Verified\rEnable Log Analytics data export to GRS or GZRS\rMedium\rGovernance\rNo\rVerified\rCreate a health status alert rule for your Log Analytics workspace\rLow\rMonitoring and Alerting\rNo\rVerified\rConfigure minimal logging and retention of logs\rLow\rGovernance\rNo\rVerified\rDetails\rEnable Log Analytics data export to GRS or GZRS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rPG Verified:\u0026nbsp;\rVerified\rDescription:\rData export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools."},{"id":360,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quantum/workspaces/","title":"workspaces","parent":"Quantum","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":361,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServicesHub/workspaces/","title":"workspaces","parent":"ServicesHub","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""},{"id":362,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Synapse/workspaces/","title":"workspaces","parent":"Synapse","content":"\r\n\r\n\r\n \r\n  \r\n\n","description":""}]