[{"id":0,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/collector/","title":"Collector Script","parent":"Tools","content":"\rOverview Requirements Quick Start (Cloud Shell or Local Machine) Local Machine Cloud Shell How to download How to run the script 1.1 - Cloud Shell 1.2 Local Machine Resource Filtering Order of operations Filtering Considerations Tags Filtering Runbooks How to run the 1_wara_collector.ps1 Example 1 Example 2 Example 3 Example 4 Example 5 Runbook Example Parameters Overview\rThis script is part of the Microsoft Well-Architected Reliability Assessment (WARA) engagement. It helps customers validate whether their Azure resources are architected and configured according to Microsoft best practices. The script achieves this by running Azure Resource Graph queries (Kusto/KQL) against Azure subscriptions and resources. Additionally, it collects information about closed support tickets, active Azure Advisor reliability recommendations, past Azure Service Health retirement and outage notifications, and the configuration of Azure Service Health alerts, all of which are relevant for the reliability recommendations provided at the end of the engagement. The collected data is then structured and exported into a JSON file, which is later used as input for the second script, the Data Analyzer script (2_wara_data_analyzer.ps1).\nThese Azure Resource Graph queries only read ARM (Azure Resource Manager) data. They do not access or collect any keys, secrets, passwords, or other confidential information. The queries only gather information about how resources are deployed and configured. If you would like to learn more, you can explore the Azure Resource Graph Explorer and run some of the query examples provided in the Azure portal.\rRequirements\rPowerShell 7 Git Azure PowerShell modules Az.ResourceGraph Az.Accounts Role Based Access Control: Reader role to access to resources to be evaluated Quick Start (Cloud Shell or Local Machine)\rWe recommend running the script from a Non-OneDrive folder. The script block below will handle this for you. Download and run the collector script by copying and modifying this script block You must replace the TenantID and SubscriptionIds/ResourceGroups to match your tenant and scope resource ids. Once the script is downloaded you can execute it by running ./1_wara_collector.ps1 #Create new \u0026#34;WARA\u0026#34; directory under C:\\ and navigate to C:\\WARA. If not Windows then do nothing and move on. $iswindows ? $(mkdir C:\\WARA -ErrorAction SilentlyContinue;cd C:\\WARA) : (Write-Host \u0026#34;C:\\WARA - Not Required\u0026#34;) #Download the latest version of the script invoke-webrequest https://aka.ms/aprl/tools/1 -out 1_wara_collector.ps1 #Remove file blocking if active and running windows $iswindows ? (unblock-file ./1_wara_collector.ps1) : (Write-host \u0026#34;Unblock not required - Not Windows OS\u0026#34;) #Modify these parameters and run the script ./1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; Local Machine\rCloud Shell\rHow to download\rGitHub Link to Download\nDownload the script using command-line\niwr https://aka.ms/aprl/tools/1 -out 1_wara_collector.ps1 GitHub Link to Sample Output\nHow to run the script\rSee at the end of this page various examples of how to run this script - Examples\nYou have two options to run the collector script:\nCloud Shell\nLocal Machine - Requires current modules leveraged in the script be installed\n1.1 - Cloud Shell\rFrom the Azure Portal open Cloud Shell, select PowerShell instead of BASH\nIf this is your first time using Cloud Shell, refer to the getting started guide from Microsoft Learn - Azure Cloud Shell. Upload the WARA Collector Script to Cloud Shell Or download the script from GitHub\niwr https://aka.ms/aprl/tools/1 -out 1_wara_collector.ps1 Execute script leveraging parameters\nThe script accepts both short and/or full paths. For complex Subscription, ResourceGroups and Tags filtering scenarios we highly recommend using ConfigFiles - See here an example under config.txt in Example 5 Select \u0026ldquo;A\u0026rdquo; to allow modules to install After Script completes, download the produced json file to your machine Read how to execute the Analyzer Script to generate the Excel report.\n1.2 Local Machine\rTo run the script there are 5 prerequisites that must be completed first:\nThe script must be executed from PowerShell 7. Other versions are not supported, for example: Windows PowerShell and PowerShell ISE Git must be installed on the local machine - Git Install required PowerShell Modules: Install-Module -Name ImportExcel -Force -SkipPublisherCheck Install-Module -Name Az.ResourceGraph -SkipPublisherCheck Install-Module -Name Az.Accounts -SkipPublisherCheck Unblock the Script So at this moment, you need to allow the execution of scripts not signed locally: Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope LocalMachine Reader permissions to target subscription(s) Open a new PowerShell 7 session after completing prerequisites\nChange your directory to the same location where you are hosting your WARA Collector script.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Create a c:\\wara\\ folder and save all scripts in this folder. Access the folder c:\\wara\\ and Execute script leveraging the necessary parameters\nAuthenticate with the account that has Reader permissions to the target subscription(s) After script completes, a json file with all the results will be saved to the same folder location.\nRead how to execute the Analyzer Script to generate the Excel report.\nResource Filtering\rThe filtering capabilities are designed for targeting specific Azure resources, enabling precise and flexible reliability assessments. The scope of the feature includes functionalities that allow users to define the scope and tags and criteria of their reliability checks using parameters or text files.\nOrder of operations\rSubscriptions\nSubscription scopes like -SubscriptionIds \u0026quot;/subscriptions/00000000-0000-0000-0000-000000000000\u0026quot; or [subscriptionIds] /subscriptions/11111111-1111-1111-1111-111111111111 in a configuration file always take explicit precedence over any smaller, more specific scope.\nResource Groups\nThese scopes can be used explicitly where you need to grab a resource group from a subscription but not evaluate the whole subscription. Tags\nWhen your resources have been explicitly scoped as above - the script will then further refine your results based on the tags provided to the script via parameters or configuration file. Filtering Considerations\rIf you set a subscription filter for subscription1 and you also set a resource group filter for subscription1/resourcegroups/rg-demo1 your results will contain all of the resources in subscription1 This is because we specified subscription1 and so all of subscription1 will be evaluated. If we only wanted to evaluate subscription1/resourcegroups/rg-demo1 then we would include that resource group as a filter and not the full subscription. If you set a subscription filter for subscription2 and a resourcegroup filter for subscription1/resourcegroups/rg-demo1 you will evaluate all of subscription2 and only the resource group rg-demo-1. Setting a subscription filter for subscription3, a resource group filter for subscription1/resourcegroups/rg-demo1, and a tag filter for environment=~prod will return only resources or those in resource groups tagged with environment=~prod within subscription3 and subscription1/resourcegroups/rg-demo1. Tags Filtering\rThe tag filtering feature can be broken into two distinct types:\n=~ Equals (non-case sensitive) to define your name/value pair values. !~ Not Equals (non-case sensitive) to define your name/value pair values. These tags can be further broken down into their Key:Value pairs and allow for the following logical operands:\n|| Or operations, when one or more TagName(s) could be equal to one or more TagValue(s). This separator to separate name/value pairs.\n, to separate name/value pairs. This allows you to build logical tag filtering:\nThe following example shows where the tag name can be App or Application and the value attributed to these tag names must be App1 or App2. In addition, a new entry acts as an AND operator. So the first line must be true, so must the second line where we state that the tag name can be env or environment and the value can be prod or production. Only when all of these criteria are met would a resource become included in the output file. In the configFile.txt the configuration looks like:\n[tags] App||Application=~App1||App2 env||environment=~prod||production In PowerShell command line the configuration looks like:\n-tags \u0026#34;App||Application=~App1||App2\u0026#34;,\u0026#34;env||environment=~prod||production\u0026#34;\u0026#34; Our next example will demonstrate how we can filter using a NOT operator. This will return all resources in scope, except those that meet the requirements of app or application not equalling App3, env or environment not equalling dev or qa. In the configFile.txt the configuration looks like:\n[tags] App||Application!~App3 env||environment!~dev||qa In PowerShell command line the configuration looks like:\n-tags \u0026#34;App||Application!~App3\u0026#34;,\u0026#34;env||environment!~dev||qa\u0026#34;\u0026#34; Runbooks\rRunbooks are an advanced feature designed for specific workload-aligned use cases. If you\u0026rsquo;re not sure if you need runbooks, you probably don\u0026rsquo;t. Before diving into runbooks, try using the filtering feature to see if it meets your needs.\rLearn more about using runbooks with the WARA collector script in the runbooks docs.\nHow to run the 1_wara_collector.ps1\rExample 1\rThe workload is entirely hosted in a single subscription that is not shared with other workloads:\nProvide parameters in command line:\n.\\1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; Provide parameters via ConfigFile:\n.\\1_Wara_Collector.ps1 -configFile config.txt config.txt\n[tenantId] 00000000-0000-0000-0000-000000000000 [subscriptionIds] /subscriptions/00000000-0000-0000-0000-000000000000 Example 2\rThe workload is hosted in two subscriptions (Sub-0 and Sub-5), but the Sub-5 subscription is shared with other workloads. I want to filter it by a single ResourceGroup specifically where the components of my workload are hosted:\nProvide parameters in command line:\n.\\1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; -ResourceGroups \u0026#34;/subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1\u0026#34; Provide parameters via ConfigFile:\n.\\Wara_Collector.ps1 -configFile config.txt config.txt\n[tenantId] 00000000-0000-0000-0000-000000000000 [subscriptionIds] /subscriptions/00000000-0000-0000-0000-000000000000 [resourceGroups] /subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1 As you\u0026rsquo;re filtering Sub-5 by ResourceGroup, do not pass Sub-5 in the Subscriptions parameter.\rExample 3\rThe workload is hosted in three subscriptions (Sub-0, Sub-3, and Sub-5). However, since the Sub-5 subscription is shared with other workloads, I need to filter it not only by a specific Resource Group where the components of my workload are hosted but also by two tags, Criticality and Env, as all my subscriptions are hosting non-production resources as well.\n.\\1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34;,\u0026#34;/subscriptions/33333333-3333-3333-3333-333333333333\u0026#34; -ResourceGroups \u0026#34;/subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1\u0026#34; -Tags \u0026#39;Criticality=~High\u0026#39;,\u0026#39;Env=~Prod\u0026#39; Provide parameters via ConfigFile:\n.\\1_Wara_Collector.ps1 -configFile config.txt config.txt\n[tenantid] 00000000-0000-0000-0000-000000000000 [subscriptionIds] /subscriptions/00000000-0000-0000-0000-000000000000 /subscriptions/33333333-3333-3333-3333-333333333333 [resourceGroups] /subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1 [tags] Criticality=~High Env=~Prod NAS you\u0026rsquo;re filtering Sub-5 by ResourceGroup, you do not pass Sub-5 in the Subscriptions parameter. In this scenario, the script will set as scope all resources in Sub-0 and Sub-3, and in Sub5/RG1, as long as they all have both Tags, Criticality and Env equal to the values that I defined, High and Prod. Resource that do meet these requirements will be put in a separate array called \u0026ldquo;out-of-scope\u0026rdquo;, you will see a Worksheet in the excel file with this name and all resources not validated by the tool.\rExample 4\rThe workload is hosted in three subscriptions (Sub-0, Sub-4, and Sub-5). However, since the Sub-4 and Sub-5 subscriptions are shared with other workloads, I need to filter them not only by the Resource Groups where the components of my workload are hosted but also by two tags, Criticality and Env, as all my subscriptions are hosting non-production resources as well.\n.\\1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; -ResourceGroups \u0026#34;/subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1\u0026#34;,\u0026#34; \u0026#34;,\u0026#34;/subscriptions/44444444-4444-4444-4444-444444444444/resourceGroups/RG-2\u0026#34; -Tags \u0026#39;Criticality=~High\u0026#39;,\u0026#39;Env=~Prod\u0026#39; Provide parameters via ConfigFile:\n.\\Wara_Collector.ps1 -configFile config.txt config.txt\n[tenantid] 00000000-0000-0000-0000-000000000000 [subscriptionIds] /subscriptions/00000000-0000-0000-0000-000000000000 [resourceGroups] /subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1 /subscriptions/44444444-4444-4444-4444-444444444444/resourceGroups/RG-2 [tags] Criticality=~High Env=~Prod Multiple values do not have to be in the same subscription. You can specify multiple resource groups in unique subscriptions.\rIn the configuration file, we separate multiple entries for a filter by new lines. Where as, from the command line we would pass multiple subscriptions or resource groups using the \u0026ldquo;string1\u0026rdquo;,\u0026ldquo;string2\u0026rdquo; pattern. The configuration file is useful for repeated runs, or numerous filters where it may be difficult to troubleshoot syntax in the command line.\rExample 5\rThe workload is hosted across three subscriptions (Sub-0, Sub-4, and Sub-5). Since Sub-4 and Sub-5 are shared with other workloads, I need to filter them by specific Resource Groups where my workload components are located, as well as by two sets of tags: \u0026lsquo;Criticality\u0026rsquo; and \u0026lsquo;Env\u0026rsquo; (or \u0026lsquo;Environment\u0026rsquo;). This filtering will ensure that non-production resources, such as QA and DEV environments, are excluded from my assessment.\n.\\1_wara_collector.ps1 -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; -ResourceGroups \u0026#34;/subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1\u0026#34;,\u0026#34; \u0026#34;,\u0026#34;/subscriptions/44444444-4444-4444-4444-444444444444/resourceGroups/RG-2\u0026#34; -Tags \u0026#39;Criticality=~High\u0026#39;,\u0026#39;Env||Environment!~Dev||QA\u0026#39; Provide parameters via ConfigFile:\n.\\Wara_Collector.ps1 -configFile config.txt config.txt\n[tenantId] 00000000-0000-0000-0000-000000000000 [subscriptionIds] /subscriptions/00000000-0000-0000-0000-000000000000 [resourceGroups] /subscriptions/55555555-5555-5555-5555-555555555555/resourceGroups/RG-1 /subscriptions/44444444-4444-4444-4444-444444444444/resourceGroups/RG-2 [tags] Criticality=~High Env||Environment!~Dev||QA Runbook Example\rLearn more about runbooks here\rRun a runbook.\n.\\1_wara_collector.ps1 ` -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; ` -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; ` -RunbookFile \u0026#34;.\\runbook.json\u0026#34; Run a runbook using implicit runbook selectors.\n.\\1_wara_collector.ps1 ` -TenantID \u0026#34;00000000-0000-0000-0000-000000000000\u0026#34; ` -SubscriptionIds \u0026#34;/subscriptions/00000000-0000-0000-0000-000000000000\u0026#34; ` -RunbookFile \u0026#34;.\\runbook.json\u0026#34; -UseImplicitRunbookSelectors Note that -SubscriptionIds are required when using a runbook. Runbooks are not compatible with -ConfigFile, -ResourceGroups, -Tags, -SAP, -AVS, -HPC, -AVD parameters. Specify subscriptions in scope using -SubscriptionIds parameter.\rParameters\rWhen calling the Collector script, you must provide some required parameters. Optional parameters can also be included. See the list below:\nTenantID Required Description: Target Tenant where the workload resides Type: String (GUID) Example: \u0026quot;00000000-0000-0000-0000-000000000000\u0026quot; SubscriptionIds Required if ResourceGroups is not provided Description: Specifies Subscription(s) to be included in the analysis. Type: String array Example: \u0026quot;/subscriptions/00000000-0000-0000-0000-000000000000\u0026quot;,\u0026quot;/subscriptions/AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA\u0026quot; ResourceGroups Required if SubscriptionIds is not provided Description: Specifies Resource Group(s) to be included in the analysis Type: String array Example: \u0026quot;/subscriptions/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/resourceGroups/ResourceGroup1\u0026quot;,\u0026quot;/subscriptions/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/resourceGroups/ResourceGroup2\u0026quot; Tags: Optional Type: String array Description: Specifies Tags to be used for filtering the resources. Operators: =~ for \u0026ldquo;Equal\u0026rdquo; (non-case sensitive) to define your name/value pair values. !~ for \u0026ldquo;Non Equal\u0026rdquo; (non-case sensitive) to define your name/value pair values. || for \u0026ldquo;Or\u0026rdquo; operations, when one or more TagName(s) could be equal to one or more TagValue(s). , to separate name/value pairs. Examples: \u0026quot;TagName=~TagValue\u0026quot; \u0026quot;TagName=~TagValue\u0026quot;,\u0026quot;TagName1=~TagValue1\u0026quot; \u0026quot;TagName1||TagName2=~TagValue1\u0026quot; \u0026quot;TagName1=~TagValue1||TagValue2\u0026quot; \u0026quot;TagName1||TagName2=~TagValue1||TagValue2\u0026quot; \u0026quot;Env||Environment=~Production||Prod\u0026quot;,\u0026quot;App=~Ecommerce\u0026quot; (Result: Subscriptions or ResourceGroups or Resources must have the Tag Env OR Environment EQUAL to Production OR Prod, AND must have the Tag App EQUAL to Ecommerce or Ecom (All non-case sensitive). If the Tag requirement is met at Subscription level, all Resources within the Subscription are included, if met at ResourceGroup level, all ResourceGroups with the Tags and all their resources are included; if only met at the Resource level, then only resources that met the tag requirement are included). ConfigFile: Required when the following parameters are nor provided via command line: TenantId, SubscriptionIDs, ResourceGroups . Note: It can\u0026rsquo;t be used in combination with command line parameters. Description: Alternate option to providing command line parameters. Specifies a file for filtering of Subscription, ResourceGroup, ResourceId, and Tags. Type: String (file name and extension) Example: -configFile configFileName.txt See ConfigFile example here AzureEnvironment: Optional Description: Specifies the Azure Environment to used for the analysis: AzureCloud, AzureUSGovernment. Type: String Examples: -AzureEnvironment AzureCloud or AzureUSGovernment SAP, AVS, AVD, HPC: Optional Description: Used for specialized workload analysis. Type: Switch Example: -sap or -avs or -avd or -hpc Debugging: Optional Description: Writes Debugging information of the script during the execution. Type: Switch Format/Values: -debugging RunbookFile: Optional Description: Specifies the file with the runbook (selectors \u0026amp; checks) to be used. Only used for a particular specialized workload. The parameters section defines the parameters used by the runbook. These parameters will be automatically merged into selectors and queries at runtime. The selectors section identifies groups of Azure resources that specific checks will be run against. Selectors can be any valid KQL predicate (e.g., resourceGroup =~ 'rg1'). The checks section maps resource graph queries (identified by GUIDs) to specific selectors. The query_overrides section enables catalogs of specialized resource graph queries to be included in the review. Type: String (file name and extension) Format/Values: -RunbookFile runbook.json Note: It can\u0026rsquo;t be used in combination with -ConfigFile, -ResourceGroups, or -Tags parameters. Specify subscriptions in scope using -SubscriptionIds parameter. UseImplicitRunbookSelectors: Optional Description: Enables the use of implicit runbook selectors. When this switch is enabled, each resource graph query will be wrapped in an inner join that filters the results to only include resources that match the selector. This is useful when queries do not include selectors. Type: Switch -UseImplicitRunbookSelectors ","description":"Overview Requirements Quick Start (Cloud Shell or Local Machine) Local Machine Cloud Shell How to download How to run the script 1.1 - Cloud Shell 1.2 Local Machine Resource Filtering Order of operations Filtering Considerations Tags Filtering Runbooks How to run the 1_wara_collector.ps1 Example 1 Example 2 Example 3 Example 4 Example 5 Runbook Example Parameters Overview\rThis script is part of the Microsoft Well-Architected Reliability Assessment (WARA) engagement. It helps customers validate whether their Azure resources are architected and configured according to Microsoft best practices."},{"id":1,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-recommendations/","title":"Create Recommendations","parent":"Creating Content","content":"\rAdding New Recommendation Recommendation Structure Recommendation Categories Writing a Meaningful Recommendation Examples This section provides guidance on how to create new recommendations. The following requirements should be followed:\nAdding New Recommendation\rTo contribute a new recommendation for an Azure resource, follow these steps:\nLocate the recommendations.yaml file within the directory corresponding to the Azure resource, Azure WAF design principle, or specialized workload you want to add a recommendation for.\nOpen the recommendations.yaml file and copy the following YAML template:\n- description: Your Recommendation Title Here (less than 100 characters) aprlGuid: Generate a Unique GUID using https://guidgenerator.com/online-guid-generator.aspx recommendationTypeId: null recommendationControl: HighAvailability/Business Continuity/Disaster Recovery/Scalability/Monitoring and Alerting/Service Upgrade and Retirement/Other Best Practices/Personalized/Governance recommendationImpact: Low/Medium/High recommendationResourceType: Friendly name to identity resource type recommendationMetadataState: Active longDescription: | Your Long Description Here (less than 300 characters) potentialBenefits: Potential Benefits of Implementing the Recommendation (less than 60 characters) pgVerified: false automationAvailable: false tags: null learnMoreLink: - name: Learn More url: \u0026#34;Link URL\u0026#34; Customize the placeholders with your recommendation\u0026rsquo;s specific details. See the Recommendation Structure section for more information on each key-value pair.\nOnce you\u0026rsquo;ve added your recommendation, save the file.\nTo test your changes, spin up your local hugo server by running the following command within your terminal:\nhugo server --disableFastRender Submit your changes by creating a pull request in the repository.\nThat\u0026rsquo;s all! Your suggestion will be reviewed for potential inclusion in the Azure Proactive Resiliency Library.\nQuestions or need assistance? Don\u0026rsquo;t hesitate to create a GitHub Issue for support.\nIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, or errors unrelated to your changes, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository. Recommendation Structure\rThe YAML structure for adding new recommendations consists of several key-value pairs, each providing specific information about the recommendation. Below is a table that describes each key-value pair:\nKey Example Value Data Type Allowed Values Description description Monitor Batch Account quota String Less than 100 characters Summarization of your recommendation aprlGuid 3464854d-6f75-4922-95e4-a2a308b53ce6 String 32-character hexadecimal string The unique identifier for the recommendation in the context of APRL and CXObserve. Generate a GUID for each new recommendation recommendationTypeId 3464854d-6f75-4922-95e4-a2a308b53ce6 String null until updated by the Azure Advisor team The unique identifier for the recommendation in the context of Advisor. recommendationControl Monitoring and Alerting String HighAvailability, BusinessContinuity, DisasterRecovery, Scalability, MonitoringAndAlerting, ServiceUpgradeAnd Retirement, OtherBestPractices, Personalized, Governance, Security Resiliency category associated with the recommendation recommendationImpact Medium String Low, Medium, High Importance of adopting the recommendation and/or the risk of choosing not to adopt recommendationResourceType Microsoft.Storage/storageAccounts String Align with the resource type Friendly name to identity resource type recommendationMetadataState Active String Active, Disabled Indicates whether the recommendation is visible longDescription To enable Cross-region disaster recovery and business continuity, ensure that the appropriate quotas are set for all user subscription Batch accounts. String The length should be less than 300 characters Detailed description of the recommendation and its implications potentialBenefits Enhanced data redundancy and boosts availability String The length should be less than 60 characters The potential benefits of implementing the recommendation pgVerified false Boolean true, false Indicates whether the recommendation is verified by the relevant product group automationAvailable false Boolean true, false Indicates whether automation is available for validating the recommendation tags null String null Generalized tags used for incorporating fields to automate learnMoreLink - name: Learn More url: \u0026ldquo;https://learn.microsoft.com/en-us/azure/reliability/reliability-batch#cross-region-disaster-recovery-and-business-continuity\u0026rdquo; Object Only 1 link per recommendation Links related to the recommendation, such as announcements or documentation Recommendation Categories\rEach recommendation should have one and only one associated recommendationCategory from this list below.\nRecommendation Category Summary HighAvailability Focuses on ensuring services remain accessible and operational with minimal downtime. BusinessContinuity Involves strategies to maintain essential functions during and after a disaster, ensuring business operations continue. DisasterRecovery Focuses on restoring systems and data after catastrophic failures, ensuring quick recovery post-disaster. Scalability Involves techniques to handle changes in load and maintain system performance under varying conditions. MonitoringAndAlerting Constant surveillance of system health, performance, and security, aiding in quick issue identification and resolution. ServiceUpgradAndRetirement Addresses the planning and execution of system upgrades and the retirement of outdated services. OtherBestPractices Encompasses miscellaneous best practices that improve system resilience, efficiency, and security. Personalized Customized recommendations tailored to specific system requirements, configurations, or preferences. Governance Involves policies, procedures, and oversight for IT resource utilization. Ensures adherence to legal, regulatory, and compatibility requirements, while guiding overall system management. (Includes Compliance and Compatibility) Writing a Meaningful Recommendation\rWhen writing a recommendation, consider the following:\nAPRL recommendations are intended to enable and accelerate the delivery of Well Architected Reliability Assessments. The purpose of APRL is not to replace existing Azure public documentation and guidance on best practices.\nEach recommendation should be actionable for the customer. The customer should be able to place the recommendation in their backlog and the engineer that picks it up should have complete clarity on the change that needs to be made and the specific resources that the change should be made to.\nEach recommendation should include a descriptive title, a short guidance section that contains additional detail on the recommendation, links to public documentation that provide additional information related to the recommendation, and a query to identify resources that are not compliant with the recommendation. The title and guidance sections alone should provide sufficient information for a CSA to evaluate a resource.\nRecommendations should not require the CSA to spend a lot of time on background reading, they should not be open to interpretation, and they should not be vague. Remember that the CSA delivering the WARA is reviewing a large number of Azure resources in a limited amount of time and is not an expert in every Azure resource.\nExamples\rGood recommendation: Use a /24 subnet for the resource Bad recommendation: Size your subnet appropriately Not all best practices make good APRL recommendations. If the best practice relates to a particular resource configuration and can be checked with an ARG query, it probably makes for a good APRL recommendation. If the best practice is more aligned to general architectural concepts that are true for many Azure resources or workload types, we very likely already have a recommendation in the APRL WAF section that addresses the topic. If not, consider adding a WAF recommendation to APRL. If neither is the case, APRL may not be the best location for this content.\n","description":"Adding New Recommendation Recommendation Structure Recommendation Categories Writing a Meaningful Recommendation Examples This section provides guidance on how to create new recommendations. The following requirements should be followed:\nAdding New Recommendation\rTo contribute a new recommendation for an Azure resource, follow these steps:\nLocate the recommendations.yaml file within the directory corresponding to the Azure resource, Azure WAF design principle, or specialized workload you want to add a recommendation for."},{"id":2,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/getting-started/","title":"Getting Started","parent":"Contributor Guide","content":"This section provides guidance on how to get started with contributing. The following should be considered and/or addressed before you start contributing:\nContext/Background I\u0026rsquo;m not familiar with Hugo. Is that okay? Prerequisites Required Software/Applications Installation with winget Additional Requirements Running and Accessing a Local Copy of APRL During Development Creating a pull request Context/Background\rBefore diving in, please take a moment to acquaint yourself with the context and background of how this library is built, which will help you contribute effectively moving forward.\nWebsite: The site is built using Hugo, a static site generator. Source Code: Stored in the APRL GitHub repository, this is also linked in the website\u0026rsquo;s header. Hosting: The site is hosted on GitHub Pages. We\u0026rsquo;ve chosen Hugo and GitHub Pages to present an easily navigable and consumable library. This combination ensures a user-friendly experience, especially across different devices, including mobile platforms.\nI\u0026rsquo;m not familiar with Hugo. Is that okay?\rAbsolutely! You don\u0026rsquo;t need to be. Hugo simply requires you to know how to write markdown (.md) files, and it handles the rest when generating the site. 👍\nPrerequisites\rTo prepare for contributing to APRL, follow the steps below to ensure you\u0026rsquo;re in a \u0026ldquo;ready state.\u0026rdquo;\nA \u0026ldquo;ready state\u0026rdquo; means you have forked the Azure/Azure-Proactive-Resiliency-Library-v2 repository, cloned it to your local machine, and opened it in VS Code.\nRequired Software/Applications\rTo contribute to this project/repository/library, you will need the following installed:\nYou can use winget to easily install all the prerequisites. Refer to the section below for installation commands.\rGit Visual Studio Code (VS Code) Extensions: editorconfig.editorconfig, streetsidesoftware.code-spell-checker, medo64.render-crlf, github.copilot-chat, esbenp.prettier-vscode VS Code will automatically recommend installing these when you open this repository, or a fork of it, in VS Code. Hugo Extended Installation with winget\rTo install the required software using winget, follow the instructions here.\nwinget install --id \u0026#39;Git.Git\u0026#39; winget install --id \u0026#39;Microsoft.VisualStudioCode\u0026#39; winget install --id \u0026#39;Hugo.Hugo.Extended\u0026#39; Additional Requirements\rEnsure you meet the following prerequisites:\nCreate a GitHub profile/account Fork the Azure/Azure-Proactive-Resiliency-Library-v2 repository to your GitHub organization/account and clone it locally to your machine. Instructions for forking a repository and cloning it can be found here. Running and Accessing a Local Copy of APRL During Development\rWhile in VS Code, you can open a terminal and execute the commands below to access a local copy of the APRL website from a web server provided by Hugo. Access it using the following address: http://localhost:1313/Azure-Proactive-Resiliency-Library-v2/:\nhugo server --disableFastRender Creating a pull request\rOnce you have committed changes to your fork of the APRL repo, you create a pull request to merge your changes into the APRL repo.\nGitHub - Creating a pull request from a fork ","description":"This section provides guidance on how to get started with contributing. The following should be considered and/or addressed before you start contributing:\nContext/Background I\u0026rsquo;m not familiar with Hugo. Is that okay? Prerequisites Required Software/Applications Installation with winget Additional Requirements Running and Accessing a Local Copy of APRL During Development Creating a pull request Context/Background\rBefore diving in, please take a moment to acquaint yourself with the context and background of how this library is built, which will help you contribute effectively moving forward."},{"id":3,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/add-dependent-azure-resources/","title":"Add Dependent Azure Resources for Specialized Workloads","parent":"Creating Content","content":"\rAdd Dependent Azure Resources for Specialized Workloads Example of a Dependent Azure Resource Recommendation Table This section provides information about referecing dependent Azure resources for specialized workloads. The following scenarios are covered:\nAdd Dependent Azure Resources for Specialized Workloads\rGo to the relevant specialized workload directory within the azure-specialized-workloads directory.\nOpen the _index.md file within the specialized workload directory.\nAdd the dependent Azure resources to the Dependent Azure Resource Recommendations table where the following columns are required:\nRecommendation: This will be a markdown URL built using recommendation key that links to the description key within the dependent Azure Resource YAML file and the path to the directory\nProvider Namespace: The provider namespace of the Azure resource. Utilize the recommendationResourceType key within the dependent Azure Resource YAML file. So if the recommendationResourceType key is Microsoft.Compute/virtualMachines, the provider namespace would be Compute.\nResource Type: The resource type of the Azure resource. Utilize the recommendationResourceType key within the dependent Azure Resource YAML file. So if the recommendationResourceType key is Microsoft.Compute/virtualMachines, the resource type would be virtualMachines.\nYou only need to update this table for dependent Azure resource recommendations that are located in the azure-resources directory.\nIf you add a new specialized workload recommendation, you will NOT need to update the dependent Azure resource recommendations table in the azure-specialized-workload directory.\nExample of a Dependent Azure Resource Recommendation Table\rSee the markdown example below for a dependent Azure resource recommendation table:\n| Recommendation | Provider Namespace | Resource Type | |:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------:|:-------------:| | [(Personal) Create a validation pool for testing of planned updates](../../../Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/#personal-create-a-validation-pool-for-testing-of-planned-updates) | DesktopVirtualization | hostPools | | [(Pooled) Configure scheduled agent updates](../../../Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/#pooled-configure-scheduled-agent-updates) | DesktopVirtualization | hostPools | ","description":"Add Dependent Azure Resources for Specialized Workloads Example of a Dependent Azure Resource Recommendation Table This section provides information about referecing dependent Azure resources for specialized workloads. The following scenarios are covered:\nAdd Dependent Azure Resources for Specialized Workloads\rGo to the relevant specialized workload directory within the azure-specialized-workloads directory.\nOpen the _index.md file within the specialized workload directory.\nAdd the dependent Azure resources to the Dependent Azure Resource Recommendations table where the following columns are required:"},{"id":4,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/analyzer/","title":"Analyzer Script","parent":"Tools","content":"\rOverview Requirements Quick Start (Local Machine only - Cloud Shell is not supported) How to Download How to run the script Action Plan Analysis PARAMETERS Debugging Help JSONFile EXAMPLES Example 1 Overview\rThis Data Analyzer script is the second script used during Well-Architected Reliability Assessment (WARA) engagements. Based on the data generated by the Collector script, the Data Analyzer script collects the necessary information about recommendations from the Azure Proactive Resiliency Library (APRL) and generates an Action Plan Excel spreadsheet. The goal of this tool is to summarize the collected data and provide actionable insights into the health and resiliency of the Azure environment.\nRequirements\rWindows OS PowerShell 7 Git Microsoft Excel installed Role Based Access Control: Reader role to access to resources to be evaluated. Although access to the Azure Subscriptions is not required to run the script, the access will be required for the user to complete some manual validations of configurations of Azure resources after the script generates the Excel file. Quick Start (Local Machine only - Cloud Shell is not supported)\rDownload and run the analyzer script by copying and modifying this script block Once the script is downloaded you can execute it by running ./2_wara_data_analyzer.ps1 #Create new \u0026#34;WARA\u0026#34; directory under C:\\ and navigate to C:\\WARA. If not Windows then do nothing and move on. $iswindows ? $(mkdir C:\\WARA -ErrorAction SilentlyContinue;cd C:\\WARA) : (Write-Host \u0026#34;C:\\WARA - Not Required\u0026#34;) #Download the latest version of the script invoke-webrequest https://aka.ms/aprl/tools/2 -out 2_wara_data_analyzer.ps1 #Remove file blocking if active and running windows $iswindows ? (unblock-file ./2_wara_data_analyzer.ps1) : (Write-host \u0026#34;Unblock not required - Not Windows OS\u0026#34;) #Modify these parameters and run the script ./2_wara_data_analyzer.ps1 -JSONFile .\\WARA_File_2024-08-08-11-57.json How to Download\rGitHub Link to Download\nDownload the script using command-line\niwr https://aka.ms/aprl/tools/2 -out 2_wara_data_analyzer.ps1 GitHub Link to Sample Output\nHow to run the script\rThe Data Analyzer script must be run from a Windows Machine with Excel installed.**\rChange your directory to the same location that you have downloaded the WARA Data Analyzer script to.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Execute script pointing the -JSONFile parameter to file created by the WARA Collector script.\nThe script accepts both short and/or full paths. Select \u0026ldquo;R\u0026rdquo; to allow script to run After the script completes it will create a file called WARA Action Plan.xlsx to the same file path.\nAction Plan Analysis\rOnce the script has completed, open the Excel Action Plan and familiarize yourself with the structure of the file, generated data, resources collected, pivot tables, and charts created. These are the worksheets: Recommendations: you will find all Recommendations, their category, impact, description, learn more links, and much more. Note that Columns A and B are counting the number of Azure Resources associated with the RecommendationID. ImpactedResources: you will find a list of Azure Resources associated with a RecommendationID. These are the Azure Resources NOT following Microsoft best practices for Reliability. Other-OutOfScope: you will find a list of the Resources that are Out of Scope of the WARA engagement based on the ResourceTypes, after all filters have been applied. ResourceTypes: you will find a list of all ResourceTypes the customer is using, number of Resources deployed for each one, and if there are Recommendations for the ResourceType in APRL. Outages: you will find a list of all the outages that impacted the subscriptions (this worksheet might not exist if there are no Outages to be found). Retirements: Azure services or features that are retired. You will find a list of all the next retirements in the subscriptions (this worksheet might not exist if there are no Retirements to be found). Support Tickets: you will find a list of all the Support Tickets for the subscriptions in the past 6 months (this worksheet might not exist if there are no Support Tickets to be found). PivotTable: you will find a couple of pivot tables used to automatically create the charts Charts: you will find 3 charts that will be used in the Executive Summary PPTx At this point, all Azure Resources with recommendations and Azure Resource Graph queries available in APRL, were automatically validated. Follow the next steps to validate the remaining services without automation or that does not exist in APRL yet. Go to the ImpactedResources worksheet, filter Column B by IMPORTANT, and validate manually the remaining resources for reliability. IMPORTANT - Query under development - For each Azure Resource in each row in this category, the resource could not be validated automatically because the associated recommendation in APRL does not have a KQL/Azure Resource Graph Query yet, thus manual validation is necessary. Using the GUID of the Recommendation, go to the \u0026ldquo;Recommendations\u0026rdquo; worksheet, read the recommendation, then open the Azure Portal and validate if the resource is compliant with the recommendations. If it is compliant, delete the row. IMPORTANT - Recommendation cannot be validated with ARGs - Validate Resources manually - For each Azure Resource in each row in this category, the resource could not be validated automatically because the associated recommendation in APRL is not possible to be validated with KQL/Azure Resource Graph Query, thus manual validation is necessary. Using the GUID of the Recommendation, go to the \u0026ldquo;Recommendations\u0026rdquo; worksheet, read the recommendation, then open the Azure Portal and validate if the resource is compliant with the recommendations. If it is compliant, delete the row. IMPORTANT - ServiceType Not Available in APRL - Validate Resources manually if Applicable, if not delete this row - For each Azure Resource in each row in this category, the resource could not be validated automatically because there are no recommendations in APRL or Advisor for the Service, thus manual validation is necessary. Based on the Azure Documentation for each Service, go to the \u0026ldquo;Recommendations\u0026rdquo; worksheet, create your own recommendations for Reliability, then open the Azure Portal and validate if the resources are compliant with the recommendation you created. If they are compliant, delete the rows in the \u0026ldquo;ImpactedResources\u0026rdquo;. Remove/add any recommendations based on your analysis prior to generating reports For relevant Outages, all Service Retirements, and relevant Support Tickets, create actionable Recommendations in the \u0026ldquo;Recommendations\u0026rdquo; worksheet. Once all manual validations of the resources in the \u0026ldquo;ImpactedResources\u0026rdquo; worksheet categorized by \u0026ldquo;IMPORTANT\u0026rdquo; are completed, and all recommendations for Service Retirements, Support Tickets and Outages were created in the \u0026ldquo;Recommendations\u0026rdquo; worksheet, the Action Plan is completed and it is time to run the last script that will generate final reports in Word and PowerPoint formats. Read how to execute the Reports Script to generate the final Word and PowerPoint reports. PARAMETERS\rDebugging\rSwitch to enable debugging mode.\nRequired: No Position: Named Help\rSwitch to display help information.\nRequired: No Position: Named JSONFile\rPath to the JSON file created by the 2_wara_data_analyzer.ps1 script.\nRequired: Yes Position: 0 EXAMPLES\rExample 1\r.\\2_wara_data_analyzer.ps1 -JSONFile \u0026#39;.\\WARA_File_2024-04-01-10-01.json\u0026#39; ","description":"Overview Requirements Quick Start (Local Machine only - Cloud Shell is not supported) How to Download How to run the script Action Plan Analysis PARAMETERS Debugging Help JSONFile EXAMPLES Example 1 Overview\rThis Data Analyzer script is the second script used during Well-Architected Reliability Assessment (WARA) engagements. Based on the data generated by the Collector script, the Data Analyzer script collects the necessary information about recommendations from the Azure Proactive Resiliency Library (APRL) and generates an Action Plan Excel spreadsheet."},{"id":5,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/","title":"Azure Resources","parent":"Azure Proactive Resiliency Library v2","content":"\rAAD\rdomainServices\rApiManagement\rservice\rApp\rcontainerApps\rmanagedEnvironments\rAppConfiguration\rconfigurationStores\rAutomation\rautomationAccounts\rAVS\rprivateClouds\rBatch\rbatchAccounts\rCache\rRedis\rCdn\rprofiles\rCognitiveServices\raccounts\rAiSearch\rCompute\rdisks\rgalleries\rvirtualMachines\rvirtualMachineScaleSets\rContainerRegistry\rregistries\rContainerService\rmanagedClusters\rDashboard\rgrafana\rDatabricks\rworkspaces\rDBforMySQL\rflexibleServers\rDBforPostgreSQL\rflexibleServers\rDesktopVirtualization\rhostPools\rscalingPlans\rDevices\riotHubs\rDocumentDB\rdatabaseAccounts\rEventGrid\rtopics\rEventHub\rnamespaces\rInsights\ractivityLogAlerts\rcomponents\rKeyVault\rvaults\rNetApp\rnetAppAccounts\rNetwork\rapplicationGateways\razureFirewalls\rconnections\rddosProtectionPlans\rdnsZones\rexpressRouteCircuits\rexpressRouteGateways\rexpressRoutePorts\rfrontDoorWebApplicationFirewallPolicies\rloadBalancers\rnatGateways\rnetworkSecurityGroups\rnetworkWatchers\rp2sVpnGateways\rprivateDnsZones\rprivateEndpoints\rpublicIPAddresses\rrouteTables\rtrafficManagerProfiles\rvirtualHubs\rvirtualNetworkGateways\rvirtualNetworks\rvirtualRouters\rvpnGateways\rNetworkFunction\razureTrafficCollectors\rOperationalInsights\rworkspaces\rRecoveryServices\rvaults\rResources\rsubscriptions\rServiceBus\rnamespaces\rSignalRService\rsignalR\rSql\rmanagedInstances\rservers\rStorage\rstorageAccounts\rStreamAnalytics\rstreamingJobs\rSubscription\rsubscriptions\rVirtualMachineImages\rimageTemplates\rWeb\rserverFarms\rsites\r","description":"\rAAD\rdomainServices\rApiManagement\rservice\rApp\rcontainerApps\rmanagedEnvironments\rAppConfiguration\rconfigurationStores\rAutomation\rautomationAccounts\rAVS\rprivateClouds\rBatch\rbatchAccounts\rCache\rRedis\rCdn\rprofiles\rCognitiveServices\raccounts\rAiSearch\rCompute\rdisks\rgalleries\rvirtualMachines\rvirtualMachineScaleSets\rContainerRegistry\rregistries\rContainerService\rmanagedClusters\rDashboard\rgrafana\rDatabricks\rworkspaces\rDBforMySQL\rflexibleServers\rDBforPostgreSQL\rflexibleServers\rDesktopVirtualization\rhostPools\rscalingPlans\rDevices\riotHubs\rDocumentDB\rdatabaseAccounts\rEventGrid\rtopics\rEventHub\rnamespaces\rInsights\ractivityLogAlerts\rcomponents\rKeyVault\rvaults\rNetApp\rnetAppAccounts\rNetwork\rapplicationGateways\razureFirewalls\rconnections\rddosProtectionPlans\rdnsZones\rexpressRouteCircuits\rexpressRouteGateways\rexpressRoutePorts\rfrontDoorWebApplicationFirewallPolicies\rloadBalancers\rnatGateways\rnetworkSecurityGroups\rnetworkWatchers\rp2sVpnGateways\rprivateDnsZones\rprivateEndpoints\rpublicIPAddresses\rrouteTables\rtrafficManagerProfiles\rvirtualHubs\rvirtualNetworkGateways\rvirtualNetworks\rvirtualRouters\rvpnGateways\rNetworkFunction\razureTrafficCollectors\rOperationalInsights\rworkspaces\rRecoveryServices\rvaults\rResources\rsubscriptions\rServiceBus\rnamespaces\rSignalRService\rsignalR\rSql\rmanagedInstances\rservers\rStorage\rstorageAccounts\rStreamAnalytics\rstreamingJobs\rSubscription\rsubscriptions\rVirtualMachineImages\rimageTemplates\rWeb\rserverFarms\rsites\r"},{"id":6,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/","title":"Creating Content","parent":"Contributor Guide","content":"This section provides information about creating new content for the Azure Proactive Resiliency Library. The following scenarios are covered:\nCreate Recommendations Create Content from Templates Create ARG Queries Ensure you have completed the prerequisites before you attempt to follow the guidance for any of the scenarios below.\r","description":"This section provides information about creating new content for the Azure Proactive Resiliency Library. The following scenarios are covered:\nCreate Recommendations Create Content from Templates Create ARG Queries Ensure you have completed the prerequisites before you attempt to follow the guidance for any of the scenarios below.\r"},{"id":7,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-archetypes/","title":"Create Content from Templates","parent":"Creating Content","content":"This section provides information about creating new content from Hugo archetypes/templates. The following scenarios are covered:\nCreate a New Azure Resource Provider Namespace Create a New Azure Resource Type within an Existing Provider Namespace Create a New Azure Specialized Workload Create a New WAF Reliability Stage Create a New Azure Resource Provider Namespace\rEnsure you are in the root directory of the repository within your terminal.\nRun the following hugo command within your terminal.\nhugo new --kind azure-provider-namespace \u0026#39;azure-resources/Storage\u0026#39; Replace Storage with the name of the Azure provider namespace you want to create. Ensure that the name aligns to the available resource providers found in the documentation here.\nAlso, ensure that it is formatted with no spaces and is using pascal case. For example, MachineLearningServices or VirtualMachineImages.\nYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-resources\\\\Storage\u0026#34; created Create a New Azure Resource Type within an Existing Provider Namespace\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal\nhugo new --kind azure-resource-type \u0026#39;azure-resources/Storage/locations\u0026#39; Replace storageAccounts with the name of the Azure resource type you want to create. Ensure that the name aligns to the available resource types found in the documentation here. At this time, we are only allowing the creation of resource types one level deep, so you cannot create a resource type that is nested within another resource type such as Storage/storageAccounts/blobServices.\nAlso, ensure that it is formatted with no spaces and is using camel casing. For example, automationAccounts or databaseAccounts.\nYou should see similar output within your terminal as shown below: Content dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-resources\\\\Storage\\\\locations\u0026#34; created You should now see a new directory created within the azure-resources/Storage directory, named after the Azure resource type you specified and containing the relevant folders and files to build out the resource type. You can also verify the creation by inspecting the resource type within your local Hugo site, which should have been rebuilt automatically with the change. Create a New Azure Specialized Workload\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal\nhugo new --kind azure-specialized-workload \u0026#39;azure-specialized-workloads/oracle\u0026#39; Replace oracle with the name of the specialized workload you want to create.\nAlso, ensure that it is formatted with no spaces and is using camel case. For example, hpcOnAzure.\nYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-specialized-workloads\\\\oracle\u0026#34; created You should now see a new directory created within the azure-specialized directory, named after the Azure specialized workload you specified. You can verify the creation by inspecting the directory in your local Hugo site, which should have been rebuilt automatically with the change.\nCreate a New WAF Reliability Stage\rEnsure you are in the root directory of the repository within your terminal\nRun the following hugo command within your terminal:\nhugo new --kind azure-waf \u0026#39;azure-waf/develop\u0026#39; Replace develop with the name of the WAF reliability stage you want to create.\rYou should see similar output within your terminal as shown below:\nContent dir \u0026#34;C:\\\\Repos\\\\Reliability\\\\Azure-Proactive-Resiliency-Library-v2\\\\azure-waf\\\\develop\u0026#34; created ","description":"This section provides information about creating new content from Hugo archetypes/templates. The following scenarios are covered:\nCreate a New Azure Resource Provider Namespace Create a New Azure Resource Type within an Existing Provider Namespace Create a New Azure Specialized Workload Create a New WAF Reliability Stage Create a New Azure Resource Provider Namespace\rEnsure you are in the root directory of the repository within your terminal.\nRun the following hugo command within your terminal."},{"id":8,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/reports/","title":"Reports Generator Script","parent":"Tools","content":"\rOverview Requirements Quick Start (Local Machine only - Cloud Shell is not supported) How to download How to run the script Local Machine - Reports Generator PARAMETERS Help Debugging CustomerName WorkloadName ExcelFile Heavy PPTTemplateFile WordTemplateFile EXAMPLES Example 1 Frequently asked questions The specified Excel file may be encrypted. If a sensitivity label is applied to the file, please change the sensitivity label to the label without encryption temporarily Overview\rThe Reports Generator script serves as the final step in a Well-Architected Reliability Assessment (WARA) engagement. It takes the Excel spreadsheet generated by the Data Analyzer script and converts it into Microsoft Word and PowerPoint formats. The Reports Generator automates the process of creating comprehensive reports from the analyzed data, making it easier to share insights and recommendations.\nRequirements\rPowerShell 7 Microsoft Excel, Word and PowerPoint installed Role Based Access Control: Reader role to access to resources to be evaluated. Although access to the Azure Subscriptions is not required to run the script, the access will be required for the user to complete some manual validations of configurations of Azure resources after the script generates the Excel file. Quick Start (Local Machine only - Cloud Shell is not supported)\rDownload and run the reports generator script by copying and modifying this script block Once the script is downloaded you can execute it by running ./3_wara_reports_generator.ps1 #Create new \u0026#34;WARA\u0026#34; directory under C:\\ and navigate to C:\\WARA. If not Windows then do nothing and move on. $iswindows ? $(mkdir C:\\WARA -ErrorAction SilentlyContinue;cd C:\\WARA) : (Write-Host \u0026#34;C:\\WARA - Not Required\u0026#34;) #Download the latest version of the script invoke-webrequest https://aka.ms/aprl/tools/3 -out 3_wara_reports_generator.ps1 #Remove file blocking if active and running windows $iswindows ? (unblock-file ./3_wara_reports_generator.ps1) : (Write-host \u0026#34;Unblock not required - Not Windows OS\u0026#34;) #Modify these parameters and run the script .\\3_wara_reports_generator.ps1 -CustomerName \u0026#39;Contoso\u0026#39; -WorkloadName \u0026#39;E-Commerce\u0026#39; -ExcelFile \u0026#39;.\\WARA Action Plan 2024-08-08-11-57.xlsx\u0026#39; How to download\rGitHub Link to Download\nDownload the script using command-line\niwr https://aka.ms/aprl/tools/3 -out 3_wara_reports_generator.ps1 Download the PowerPoint template using command-line\niwr https://aka.ms/aprl/tools/pptx -out \u0026#39;Mandatory - Executive Summary presentation - Template.pptx\u0026#39; Download the Word template using command-line\niwr https://aka.ms/aprl/tools/docx -out \u0026#39;Optional - Assessment Report - Template.docx\u0026#39; GitHub Link to Sample Output - Executive Summary Presentation\nGitHub Link to Sample Output - Assessment Report\nHow to run the script\rThe Reports Generator script must be run from a Windows Machine with Excel, Word, and PowerPoint installed.\rLocal Machine - Reports Generator\rYou will need to have both the Word and PowerPoint templates downloaded to the same file location. Change your directory to the same location that you have downloaded the WARA Reports Generator script to.\nWe recommend running this as close to your C:\\ as path to avoid errors related to file path length. Execute script leveraging needed parameters\nThe script accepts both short and/or full paths. .\\3_wara_reports_generator.ps1 -CustomerName \u0026#39;Contoso\u0026#39; -WorkloadName \u0026#39;E-Commerce\u0026#39; -ExcelFile \u0026#39;.\\WARA Action Plan 2024-08-08-11-57.xlsx\u0026#39; Select \u0026ldquo;R\u0026rdquo; to allow script to run After the script successfully runs, you will find two new files saved in your folder. Some of the information will be automatically populated based on the Action Plan.\nUpdates will need to be made prior to presenting to any audience.\rPARAMETERS\rHelp\rSwitch to display help information.\nRequired: No Position: Named Debugging\rSwitch to enable debugging mode.\nRequired: No Position: Named CustomerName\rName of the customer for whom the report is being generated.\nRequired: No Position: Named WorkloadName\rName of the workload being assessed.\nRequired: No Position: Named ExcelFile\rPath to the Excel file created by the 2_wara_data_analyzer script.\nRequired: Yes Position: 0 Heavy\rSwitch to enable heavy processing mode. When enabled, this mode introduces additional delays using Start-Sleep at various points in the script to handle heavy environments more gracefully. This can help in scenarios where the system resources are limited or the operations being performed are resource-intensive, ensuring the script doesn\u0026rsquo;t overwhelm the system.\nRequired: No Position: Named Notes: Use this parameter when your excel action plan has over 10,000 resources or is greater than 10MB. This will ensure your workstation is minimally impacted by the processing. PPTTemplateFile\rPath to the PowerPoint template file.\nRequired: No Position: Named WordTemplateFile\rPath to the Word template file.\nRequired: No Position: Named EXAMPLES\rExample 1\r.\\3_wara_reports_generator.ps1 -ExcelFile \u0026#39;.\\WARA Action Plan 2024-03-07-16-06.xlsx\u0026#39; -CustomerName \u0026#39;ABC Customer\u0026#39; -WorkloadName \u0026#39;SAP On Azure\u0026#39; -Heavy -PPTTemplateFile \u0026#39;.\\Template.pptx\u0026#39; -WordTemplateFile \u0026#39;.\\Template.docx\u0026#39; Frequently asked questions\rThe specified Excel file may be encrypted. If a sensitivity label is applied to the file, please change the sensitivity label to the label without encryption temporarily\rThe specified Excel file may be has a sensitivity label (encrypted). The 3_wara_reports_generator.ps1 script does not support encrypted Excel file currently. To avoid this issue, you need to change the sensitivity label to the label without encryption temporarily. For example, Confidential/Any User (No Protection) sensitivity. After completing the script running, you can re-apply the original sensitivity label (recommended).\nYou can change the sensitivity label on the file by Excel or Information Protection File Labeler.\nOption 1: Excel\nSelect a sensitivity label that you want from the sensitivity bar at the top of the Excel window. Save the Excel file. Learn more about the Sensitivity bar in Microsoft 365.\nOption 2: Information Protection File Labeler\nInstall the Microsoft Purview Information Protection client Right click the Excel file in the File Explorer then select Show more options. Select Apply sensitivity label with Microsoft Purview Select a sensitivity label that you want. Click the Apply button. Learn more about the detailed usage of the Information Protection File Labeler.\n","description":"Overview Requirements Quick Start (Local Machine only - Cloud Shell is not supported) How to download How to run the script Local Machine - Reports Generator PARAMETERS Help Debugging CustomerName WorkloadName ExcelFile Heavy PPTTemplateFile WordTemplateFile EXAMPLES Example 1 Frequently asked questions The specified Excel file may be encrypted. If a sensitivity label is applied to the file, please change the sensitivity label to the label without encryption temporarily Overview\rThe Reports Generator script serves as the final step in a Well-Architected Reliability Assessment (WARA) engagement."},{"id":9,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/","title":"Specialized Workloads","parent":"Azure Proactive Resiliency Library v2","content":"\rArtificial Intelligence (GPT-RAG)\rAzure High Performance Computing\rAzure Virtual Desktop\rAzure VMware Solution\rSAP on Azure\r","description":"\rArtificial Intelligence (GPT-RAG)\rAzure High Performance Computing\rAzure Virtual Desktop\rAzure VMware Solution\rSAP on Azure\r"},{"id":10,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/create-content/create-arg-queries/","title":"Create ARG Queries","parent":"Creating Content","content":"This section provides guidance on how to create new Azure Resource Graph (ARG) queries. The following requirements should be followed:\nRequirements for ARG Queries Requirements for ARG Query Files Requirements for Pull Requests Containing ARG Queries Requirements for ARG Queries\rAll ARG queries should have two comments at the top of the query, one comment stating Azure Resource Graph Query and another comment providing a description of the query results returned. For example:\n// Azure Resource Graph Query\r// Provides a list of Azure Container Registry resources that do not have soft delete enabled If the ARG query is under development, the query should have a single line stating: // under-development\nIf a recommendation query cannot be returned due to limitations with the data provided within ARG, the query should have a single line stating: // cannot-be-validated-with-arg\nQueries should only return resources that do not adhere to the APRL recommendation. For example, if the recommendation is to enable soft delete for Azure Container Registries, the associated query should only return Azure Container Registry resources that do not have soft delete enabled.\nIf a ARG query folder has a file with a file type suffixed with .fix, this means that the current query does not work as anticipated and to consider using this as a starting point for fixing the query. Once you have validated that the query is working as anticipated, please remove the file with the .fix suffix.\nARG query columns name returned should only include the following:\nThe column names should be in the order they are listed and match exactly.\rColumn Name Required Information Returned (Example) Description recommendationId Yes 4f63619f-5001-439c-bacb-8de891287727 The aprlGuid associated to the APRL recommendation. name Yes test-aks The resource name of the Azure resource that does not adhere to the APRL recommendation. id Yes /subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test-resource-group/providers/Microsoft.ContainerService/managedClusters/test-aks The resource ID of the Azure resource that does not adhere to the APRL recommendation. tags No {\u0026ldquo;Environment\u0026rdquo;:\u0026ldquo;Test\u0026rdquo;,\u0026ldquo;Department\u0026rdquo;:\u0026ldquo;IT\u0026rdquo;} Any relevant tags associated to the resource that does not adhere to the APRL recommendation. param1 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param2 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param3 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param4 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param5 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. If you need support with validating a query, please reach out to the APRL team via the APRL GitHub General Question/Feedback Form\rRequirements for ARG Query Files\rAll query files should be named to match the aprlGuid for the respective APRL recommendation. For instance, if the aprlGuid for a recommendation is 4f63619f-5001-439c-bacb-8de891287727, then the associated query file should be named 4f63619f-5001-439c-bacb-8de891287727.kql.\nAll query files should be placed in the relevant kql folder within the relevant directory. For example, if the recommendation is for Azure Container Registries, the query file should be placed in the azure-resources\\ContainerRegistry\\registries\\kql directory.\nRequirements for Pull Requests Containing ARG Queries\rAll pull requests that modify and/or create ARG queries should contain a screenshot of the query results returned from the Azure Resource Graph Explorer. The screenshot should be taken from the Azure Resource Graph Explorer and should include a resource that is not adhering to the APRL recommendation. This is to ensure that the query is returning the expected results and to validate that the columns are populated correctly.\n","description":"This section provides guidance on how to create new Azure Resource Graph (ARG) queries. The following requirements should be followed:\nRequirements for ARG Queries Requirements for ARG Query Files Requirements for Pull Requests Containing ARG Queries Requirements for ARG Queries\rAll ARG queries should have two comments at the top of the query, one comment stating Azure Resource Graph Query and another comment providing a description of the query results returned."},{"id":11,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/","title":"Well-Architected Framework","parent":"Azure Proactive Resiliency Library v2","content":"\rReliability\r","description":"\rReliability\r"},{"id":12,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/","title":"Tools","parent":"Azure Proactive Resiliency Library v2","content":"This section lists of all of the information pertaining to the APRL tooling/scripts. The guidance is broken down into the following sections:\nCollector Script Documentation Analyzer Script Documentation Reports Script Documentation ","description":"This section lists of all of the information pertaining to the APRL tooling/scripts. The guidance is broken down into the following sections:\nCollector Script Documentation Analyzer Script Documentation Reports Script Documentation "},{"id":13,"href":"/Azure-Proactive-Resiliency-Library-v2/contributing/","title":"Contributor Guide","parent":"Azure Proactive Resiliency Library v2","content":"This section lists all contribution guidance available. The guidance is broken down into the following sections:\nGetting Started\rCreating Content\rCreate Recommendations\rAdd Dependent Azure Resources for Specialized Workloads\rCreate Content from Templates\rCreate ARG Queries\rIf you cannot find guidance for what you need, please let us know via GitHub Issues 👍\r","description":"This section lists all contribution guidance available. The guidance is broken down into the following sections:\nGetting Started\rCreating Content\rCreate Recommendations\rAdd Dependent Azure Resources for Specialized Workloads\rCreate Content from Templates\rCreate ARG Queries\rIf you cannot find guidance for what you need, please let us know via GitHub Issues 👍\r"},{"id":14,"href":"/Azure-Proactive-Resiliency-Library-v2/glossary/","title":"Glossary","parent":"Azure Proactive Resiliency Library v2","content":"This page holds a table of all the terms, abbreviations, and acronyms that are used across this site.\nTerm/Abbreviation/Acronym Definition AAC Azure Architecture Center WAF Well-Architected Framework CAF Cloud Adoption Framework ARG Azure Resource Graph ","description":"This page holds a table of all the terms, abbreviations, and acronyms that are used across this site.\nTerm/Abbreviation/Acronym Definition AAC Azure Architecture Center WAF Well-Architected Framework CAF Cloud Adoption Framework ARG Azure Resource Graph "},{"id":15,"href":"/Azure-Proactive-Resiliency-Library-v2/faq/","title":"FAQ","parent":"Azure Proactive Resiliency Library v2","content":"This section lists frequently asked questions about the Azure Proactive Resiliency Library (APRL) and its content. See the following sections for answers to common questions:\nFAQ 1: Local Website Inconsistencies FAQ 1: Local Website Inconsistencies\rIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository. Got an unanswered question? Create a GitHub Issue so we can get it answered and added here for everyone\u0026rsquo;s benefit 👍\r","description":"This section lists frequently asked questions about the Azure Proactive Resiliency Library (APRL) and its content. See the following sections for answers to common questions:\nFAQ 1: Local Website Inconsistencies FAQ 1: Local Website Inconsistencies\rIf you encounter inconsistencies on the local version of the website that do not reflect your content updates, follow these steps:\nPress CTRL + C to terminate the Hugo local web server. Restart the Hugo web server by running hugo server --disableFastRender from the root of the repository."},{"id":16,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-waf/reliability/","title":"Reliability","parent":"Well-Architected Framework","content":"This section contains all recommendations from the Azure Well-Architected Framework\u0026rsquo;s Reliability pillar.\nSummary\rRecommendation\rImpact\rCategory\rRE:01 Design your workload to align with business objectives\rMedium\rOtherBestPractices\rRE:02 Identify and rate user and system flows\rMedium\rHighAvailability\rRE:03 Use failure mode analysis to identify and prioritize potential failures\rMedium\rOtherBestPractices\rRE:04 Define reliability and recovery targets\rMedium\rHighAvailability\rRE:05 Design for redundancy\rMedium\rHighAvailability\rRE:05 Design for multi-region high availability\rMedium\rHighAvailability\rRE:05 Design for high availability with availability zones\rMedium\rHighAvailability\rRE:06 Design for data partitioning\rMedium\rHighAvailability\rRE:06 Design for reliable scaling\rMedium\rScalability\rRE:07 Use background jobs\rMedium\rOtherBestPractices\rRE:07 Implement self-preservation and self-healing measures\rMedium\rHighAvailability\rRE:07 Handle transient faults\rMedium\rHighAvailability\rRE:08 Design a reliability testing strategy\rMedium\rOtherBestPractices\rRE:09 Implement business continuity and disaster recovery plan\rMedium\rDisasterRecovery\rRE:10 Design a reliable monitoring and alerting strategy\rMedium\rMonitoringAndAlerting\rDetails\rRE:01 Design your workload to align with business objectives\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOtherBestPractices\rAPRL GUID:\u0026nbsp;\r8c0a0a4c-9e34-41af-9f6d-89d8dc00370e\rDescription:\rDesign your workload to align with business objectives and avoid unnecessary complexity or overhead. Use a practical and balanced approach to make design decisions that deliver the desired results. Contain your design to the necessities to reduce inefficiencies and potential problems. Potential Benefits:\rMeet business requirements\rLearn More:\rRE:01 Simplicity and efficiency\rRE:02 Identify and rate user and system flows\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r74415e66-7baf-43f3-8def-164bc7b48215\rDescription:\rIdentify and rate user and system flows. Use a criticality scale based on your business requirements to prioritize the flows. Potential Benefits:\rAlign architecture with reliability goals\rLearn More:\rRE:02 Critical flows\rRE:03 Use failure mode analysis to identify and prioritize potential failures\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOtherBestPractices\rAPRL GUID:\u0026nbsp;\rf5fbe3d4-7196-46b8-9b09-0e29e7cf43ac\rDescription:\rUse failure mode analysis (FMA) to identify and prioritize potential failures in your solution components. Perform FMA to help you assess the risk and effect of each failure mode. Determine how the workload responds and recovers. Potential Benefits:\rReduce risk of unpredicted behavior\rLearn More:\rRE:03 Failure mode analysis\rRE:04 Define reliability and recovery targets\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r2c41b97c-af27-47b5-aafb-81bbf95fe8ba\rDescription:\rDefine reliability and recovery targets for the components, the flows, and the overall solution. Use the defined targets to build the health model. The health model defines what healthy, degraded, and unhealthy states look like. Potential Benefits:\rCommunicate reliability expectations with stakeholders\rLearn More:\rRE:04 Target metrics\rRE:05 Design for redundancy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\re404ef3f-e427-4e43-a1df-09da987e744f\rDescription:\rAdd redundancy at different levels, especially for critical flows. Apply redundancy to the compute, data, network, and other infrastructure tiers in accordance with the identified reliability targets. Potential Benefits:\rOptimize for resiliency\rLearn More:\rRE:05 Redundancy\rRE:05 Design for multi-region high availability\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\rdf93ae26-260e-408f-860c-42cd189f8bf8\rDescription:\rHigh availability is a foundational tenet of designing for reliability. A highly available architecture can help you avoid downtime as much as possible and recover efficiently if downtime does occur. Potential Benefits:\rMinimize downtime from regional outages\rLearn More:\rRE:05 High-availability multi-region design\rRE:05 Design for high availability with availability zones\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r3d6adb0a-042f-47f7-a7ea-db2e360903d5\rDescription:\rHigh availability is a foundational tenet of designing for reliability. A highly available architecture can help you avoid downtime as much as possible and recover efficiently if downtime does occur. Potential Benefits:\rMinimize downtime from zonal outages\rLearn More:\rRegions and availability zones\rRE:06 Design for data partitioning\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r7f0b9ea3-0159-4ea7-b854-a4313fe76d7f\rDescription:\rPartitioning data improves scalability, reduces contention, and optimizes performance. Implement data partitioning to divide data by usage pattern. Potential Benefits:\rImprove data estate reliability\rLearn More:\rRE:06 Data partitioning\rRE:06 Design for reliable scaling\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r340fe5c3-d599-448a-8e52-15e96771a3f0\rDescription:\rImplement a timely and reliable scaling strategy at the application, data, and infrastructure levels. Potential Benefits:\rDynamically handle increased load\rLearn More:\rRE:06 Scaling\rRE:07 Use background jobs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOtherBestPractices\rAPRL GUID:\u0026nbsp;\r4e1094dd-2d85-4a1a-8ca8-1e6ea21206fb\rDescription:\rBackground jobs help minimize the load on the application UI, which improves availability and reduces interactive response time. Potential Benefits:\rMinimize application load\rLearn More:\rRE:07 Background jobs\rRE:07 Implement self-preservation and self-healing measures\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r7b5008cf-1853-44c4-827d-bca091678c3f\rDescription:\rStrengthen the resiliency and recoverability of your workload by implementing self-preservation and self-healing measures. Self-healing capabilities help you avoid downtime by building in failure detection and automatic corrective actions to respond to different failure types. Potential Benefits:\rReduce the likelihood of outages\rLearn More:\rRE:07 Self-preservation\rRE:07 Handle transient faults\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHighAvailability\rAPRL GUID:\u0026nbsp;\r66ae4a5c-7f58-4293-bed8-5caa4f9f34e2\rDescription:\rBuild capabilities into the solution by using infrastructure-based reliability patterns and software-based design patterns to handle component failures and transient errors. Potential Benefits:\rReduce the likelihood of outages\rLearn More:\rRE:07 Transient faults\rRE:08 Design a reliability testing strategy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOtherBestPractices\rAPRL GUID:\u0026nbsp;\r7db74a6a-4062-46a8-a0cd-18684fb0ec08\rDescription:\rTest resiliency and availability scenarios by applying the principles of chaos engineering in your test and production environments. Use testing to ensure that your graceful degradation implementation and scaling strategies are effective by performing active malfunction and simulated load testing. Potential Benefits:\rValidate and optimize workload reliability\rLearn More:\rRE:08 Testing\rRE:09 Implement business continuity and disaster recovery plan\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisasterRecovery\rAPRL GUID:\u0026nbsp;\r5f95df03-cae2-4761-90b7-7afd657ac124\rDescription:\rImplement structured, tested, and documented business continuity and disaster recovery (BCDR) plans that align with the recovery targets. Plans must cover all components and the system as a whole. Potential Benefits:\rReliable disaster recovery\rLearn More:\rRE:09 Disaster recovery\rRE:10 Design a reliable monitoring and alerting strategy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoringAndAlerting\rAPRL GUID:\u0026nbsp;\r90adebf7-bc90-4939-9aa8-119c46bee0fc\rDescription:\rMeasure and publish the solution\u0026#39;s health indicators. Continuously capture uptime and other reliability data from across the workload and also from individual components and key flows. Potential Benefits:\rObservability into workload health\rLearn More:\rRE:10 Monitoring and alerting\r","description":"This section contains all recommendations from the Azure Well-Architected Framework\u0026rsquo;s Reliability pillar.\nSummary\rRecommendation\rImpact\rCategory\rRE:01 Design your workload to align with business objectives\rMedium\rOtherBestPractices\rRE:02 Identify and rate user and system flows\rMedium\rHighAvailability\rRE:03 Use failure mode analysis to identify and prioritize potential failures\rMedium\rOtherBestPractices\rRE:04 Define reliability and recovery targets\rMedium\rHighAvailability\rRE:05 Design for redundancy\rMedium\rHighAvailability\rRE:05 Design for multi-region high availability\rMedium\rHighAvailability\rRE:05 Design for high availability with availability zones\rMedium\rHighAvailability\rRE:06 Design for data partitioning\rMedium\rHighAvailability\rRE:06 Design for reliable scaling\rMedium\rScalability\rRE:07 Use background jobs\rMedium\rOtherBestPractices\rRE:07 Implement self-preservation and self-healing measures\rMedium\rHighAvailability\rRE:07 Handle transient faults\rMedium\rHighAvailability\rRE:08 Design a reliability testing strategy\rMedium\rOtherBestPractices\rRE:09 Implement business continuity and disaster recovery plan\rMedium\rDisasterRecovery\rRE:10 Design a reliable monitoring and alerting strategy\rMedium\rMonitoringAndAlerting\rDetails\rRE:01 Design your workload to align with business objectives\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOtherBestPractices\rAPRL GUID:\u0026nbsp;\r8c0a0a4c-9e34-41af-9f6d-89d8dc00370e\rDescription:\rDesign your workload to align with business objectives and avoid unnecessary complexity or overhead."},{"id":17,"href":"/Azure-Proactive-Resiliency-Library-v2/privacy/","title":"Privacy","parent":"Azure Proactive Resiliency Library v2","content":" We partner with Microsoft Clarity to capture how you use and interact with our website through behavioral metrics, heatmaps, and session replay to improve the content and usage of the website. Website usage data is captured using first and third-party cookies and other tracking technologies and is used for site optimization. For more information about how Microsoft collects and uses your data, visit the Microsoft Privacy Statement.\n","description":"We partner with Microsoft Clarity to capture how you use and interact with our website through behavioral metrics, heatmaps, and session replay to improve the content and usage of the website. Website usage data is captured using first and third-party cookies and other tracking technologies and is used for site optimization. For more information about how Microsoft collects and uses your data, visit the Microsoft Privacy Statement."},{"id":18,"href":"/Azure-Proactive-Resiliency-Library-v2/tools/collector/runbooks/","title":"Runbooks","parent":"Collector Script","content":"\rOverview\rRunbooks are JSON files that allow extensive customization of KQL queries executed by WARA tooling and the resources these queries target. They also support the integration of custom KQL queries. Read on to learn more about using runbooks with WARA tooling.\nSelectors\rRunbooks use selectors to identify groups of Azure resources for specific checks. Selectors can be any valid KQL where condition.\nHere are a few examples of valid runbook selectors:\nPattern Example Notes By tag tags['app'] =~ 'my_app' Matches all resources tagged app: my_app By regex pattern name matches regex '^my_app\\d{2}$' Matches my_app01, my_app02, my_app03 \u0026hellip; By name name in~ ('my_app01', 'my_app02', 'my_app03') Matches only my_app01, my_app02, my_app03 By resource group resourceGroup =~ 'my_group' Matches all resources in the my_group resource group By subscription subscriptionId =~ '1235ec12-...' Matches all resources in subscription 1235ec12-... Each selector has a name (which can be referenced later in specific checks) and is defined in a runbook like this:\n{ \u0026#34;selectors\u0026#34;: { \u0026#34;my_app_resources\u0026#34;: \u0026#34;tags[\u0026#39;app\u0026#39;] =~ \u0026#39;my_app\u0026#39;\u0026#34;, \u0026#34;my_group_resources\u0026#34;: \u0026#34;resourceGroup =~ \u0026#39;my_group\u0026#39;\u0026#34;, \u0026#34;my_app_and_my_group\u0026#34;: \u0026#34;tags[\u0026#39;app\u0026#39;] =~ \u0026#39;my_app\u0026#39; and resourceGroup =~ \u0026#39;my_group\u0026#39;\u0026#34; } } Read on to learn how selectors and checks work together to run KQL queries against arbitrary groups of resources.\nWhen using selectors in this runbook, especially those that involve regex or string patterns, it is important to correctly escape backslashes due to the way Azure Resource Graph and JSON parsing handle these characters. Selectors are used to define groups of resources, and if you include patterns like regex within them, each backslash must be doubled for both JSON encoding and Azure Resource Graph interpretation. For instance, a single backslash (\\) in your regex pattern needs to be written as four (\\\\\\\\) when defined in a JSON-based selector. This ensures compatibility at all levels of parsing. Failure to do so can lead to errors and improperly matched resources, so it’s critical to review and verify the formatting of your selectors when working with these escape sequences.\nChecks\rChecks combine selectors with specific KQL queries to run precise checks on arbitrary sets of resources.\nHere\u0026rsquo;s an example using previously defined selectors:\n{ \u0026#34;selectors\u0026#34;: { \u0026#34;my_app_resources\u0026#34;: \u0026#34;tags[\u0026#39;app\u0026#39;] =~ \u0026#39;my_app\u0026#39;\u0026#34;, \u0026#34;my_group_resources\u0026#34;: \u0026#34;resourceGroup =~ \u0026#39;my_group\u0026#39;\u0026#34;, \u0026#34;my_app_and_my_group_resources\u0026#34;: \u0026#34;tags[\u0026#39;app\u0026#39;] =~ \u0026#39;my_app\u0026#39; and resourceGroup =~ \u0026#39;my_group\u0026#39;\u0026#34; }, \u0026#34;checks\u0026#34;: { \u0026#34;122d11d7-b91f-8747-a562-f56b79bcfbdc\u0026#34;: { \u0026#34;my_app_uses_managed_disks\u0026#34;: \u0026#34;my_app_resources\u0026#34;, \u0026#34;my_group_uses_managed_disks\u0026#34;: \u0026#34;my_group_resources\u0026#34;, \u0026#34;my_app_and_my_group_uses_managed_disks\u0026#34;: \u0026#34;my_app_and_my_group_resources\u0026#34; } } } Let\u0026rsquo;s break this down line by line:\nThe selectors from the previous section are included to be used in the checks section of the runbook. A single check configuration is provided, using an existing APRL KQL query to verify that VM resources are using managed disks (122d11d7-b91f-8747-a562-f56b79bcfbdc). Three checks are defined, each applying to different selectors: my_app_uses_managed_disks: Verifies that all resources with the tag app set to my_app use managed disks. my_group_uses_managed_disks: Verifies that all resources in the my_group resource group use managed disks. my_app_and_my_group_uses_managed_disks: Verifies that all resources in the my_group resource group with the tag app set to my_app use managed disks. How selectors are applied to KQL queries\rThere are two different ways in which selectors can be applied to KQL queries:\nExplicitly: Including a // selector comment in your KQL query will automatically inject the appropriate selector condition at runtime. For example, given the example selectors provided above, configuring a check to use the my_app_resources selector would automatically replace // selector with | where tags['app'] =~ 'my_app' at runtime. The best practice is to include // selector comments on their own line as, at runtime, they\u0026rsquo;re automatically piped in as a where condition. This approach helps ensure that the merged KQL query is easily readable. Setting the -Debugging switch will output all merged queries at runtime for you review. // selector is the \u0026ldquo;default selector\u0026rdquo;. You can also reference specific selectors in your KQL queries using this syntax: // selector:name where name is the name of a selector defined in the runbook (e.g., my_app_resource). This makes it easy to reference different selector-defined groups of resources within the same KQL query. Implicitly: Most KQL queries including the default set included in APRL v2 don\u0026rsquo;t include selector comments. Use the -UseImplicitRunbookSelectors script switch to automatically wrap every KQL query in an inner join that limits the scope of the query. By default, implicit selectors will not be applied due to constraints on the total number of joins that can be included in a resource graph query. To use implicit selectors, you have to include the -UseImplicitRunbookSelectors switch when running the script.\rBy combining checks and selectors, you can easily define complex WARA review configurations using a simple JSON-based syntax.\nParameters\rParameters offer a simple syntax for dynamically customizing selectors and KQL queries. Parameters are arbitrary key/value pairs that are included in the parameters section of a runbook like this:\n{ \u0026#34;parameters\u0026#34;: { \u0026#34;resource_group_name\u0026#34;: \u0026#34;my_resource_group\u0026#34;, \u0026#34;resource_tag_name\u0026#34;: \u0026#34;my_tag\u0026#34;, \u0026#34;resource_tag_value\u0026#34;: \u0026#34;my_value\u0026#34; } } Parameters can easily be included in selectors like this:\nresourceGroup =~ \u0026#39;{{resource_group_name}}\u0026#39; Parameters can also be included directly in queries like this:\nresources\r| where tags[\u0026#39;{{resource_tag_name}}\u0026#39;] =~ \u0026#39;{{resource_tag_value}}\u0026#39; Query overrides\rWhile the set of KQL queries included with APRL v2 is very comprehensive, sometimes you need to run a check that\u0026rsquo;s not included in APRL v2. For this reason, runbooks enable you to include additional catalogs of KQL queries in your review.\nQuery catalogs must follow this folder structure:\nresources |-- compute (resource provider name) |-- virtualmachines (resource name) |-- kql |-- 1fe03dbd-91e0-402c-a4f8-5611ae7b90b5.kql |-- 2bd0be95-a825-6f47-a8c6-3db1fb5eb387.kql |-- network |-- virtualnetworks |-- kql |-- bd24415f-2532-4943-8fe0-283abf1e2339.kql All queries must run the following properties:\nName Required Description recommendationId 🔴 A GUID that uniquely identifies the query id 🔴 If applicable, the ID of the resource under review; otherwise n/a name 🔴 If applicable, the name of the resource under review; otherwise n/a tags 🔴 If applicable, the tags on the resource under review; otherwise n/a param1 Additional information which will appear in the report param2 Additional information which will appear in the report param3 Additional information which will appear in the report param4 Additional information which will appear in the report param5 Additional information which will appear in the report You can define these query overrides in the runbook like this:\n{ \u0026#34;query_overrides\u0026#34;: [ \u0026#34;.\\\\some_queries\u0026#34;, \u0026#34;c:\\\\queries\\\\some_more_queries\u0026#34; ] } Given this configuration\u0026hellip;\nThe script will first load all the queries included in APRL v2. Next, the script will find all KQL files in .\\some_queries and add them to the run. If a new query has the same ID (recommendationId) as an existing query, the existing query will be overwritten. If there is no existing query, the new query will be added to the run. Next, the script will look for all queries in the c:\\queries\\some_more_queries and apply the same logic as before: if a query has already been loaded with the same ID, it will replace the existing query; otherwise, it will simply load the new query. Note that query paths can be absolute or relative to the location of the running script.\r","description":"Overview\rRunbooks are JSON files that allow extensive customization of KQL queries executed by WARA tooling and the resources these queries target. They also support the integration of custom KQL queries. Read on to learn more about using runbooks with WARA tooling.\nSelectors\rRunbooks use selectors to identify groups of Azure resources for specific checks. Selectors can be any valid KQL where condition.\nHere are a few examples of valid runbook selectors:"},{"id":19,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AAD/","title":"AAD","parent":"Azure Resources","content":"","description":""},{"id":20,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Bing/accounts/","title":"accounts","parent":"Bing","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":21,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/CognitiveServices/accounts/","title":"accounts","parent":"CognitiveServices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy a PAYG instance of the model with provisioned throughput to manage overflow effectively\rHigh\rHigh Availability\rNo\rNo\rEnsure that models are deployed using Global batch for large scale processing\rHigh\rScalability\rNo\rNo\rEnsure AOAI models are deployed using Data Zone Standard for data residency requirements\rHigh\rGovernance\rNo\rNo\rDetails\rDeploy a PAYG instance of the model with provisioned throughput to manage overflow effectively\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0c193899-da60-4a52-b4a0-77d75ac8c5c5\rDescription:\rProvisioned Throughput offers pre-allocated capacity for consistent workloads, while Pay-as-You-Go charges for actual usage, ideal for variable workloads. During overflow, the Pay-as-You-Go instance manages excess load, ensuring service efficiency Potential Benefits:\rPAYG model balances cost and performance and helps scale\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure that models are deployed using Global batch for large scale processing\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r8aa9744b-f302-4b05-9776-51d6dd3d0c3a\rDescription:\rGlobal batch efficiently handles large-scale tasks within 24 hours. Submit requests in a single file, with a separate quota to protect online workloads. Key uses: data processing, content generation, document review, customer support automation, data extraction, NLP tasks, and marketing Potential Benefits:\rCost effective faster turnaround for large-scale processing.\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure AOAI models are deployed using Data Zone Standard for data residency requirements\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rac3add17-013e-41a5-af91-9fefce794a00\rDescription:\rData zone deployments route customer traffic to the highest availability data center within the defined data zone, ensuring data at rest remains within the Azure OpenAI resource geography. This approach offers increased quota limits and ensures data processing occurs within the specified data zone Potential Benefits:\rEnforce data residency and compliance standards\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy a PAYG instance of the model with provisioned throughput to manage overflow effectively\rHigh\rHigh Availability\rNo\rNo\rEnsure that models are deployed using Global batch for large scale processing\rHigh\rScalability\rNo\rNo\rEnsure AOAI models are deployed using Data Zone Standard for data residency requirements\rHigh\rGovernance\rNo\rNo\rDetails\rDeploy a PAYG instance of the model with provisioned throughput to manage overflow effectively\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0c193899-da60-4a52-b4a0-77d75ac8c5c5\rDescription:\rProvisioned Throughput offers pre-allocated capacity for consistent workloads, while Pay-as-You-Go charges for actual usage, ideal for variable workloads."},{"id":22,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeAnalytics/accounts/","title":"accounts","parent":"DataLakeAnalytics","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":23,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeStore/accounts/","title":"accounts","parent":"DataLakeStore","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":24,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataShare/accounts/","title":"accounts","parent":"DataShare","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":25,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maps/accounts/","title":"accounts","parent":"Maps","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":26,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/accounts/","title":"accounts","parent":"Monitor","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":27,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Purview/accounts/","title":"accounts","parent":"Purview","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":28,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Singularity/accounts/","title":"accounts","parent":"Singularity","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":29,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VideoIndexer/accounts/","title":"accounts","parent":"VideoIndexer","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":30,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/actionGroups/","title":"actionGroups","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":31,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/actionRules/","title":"actionRules","parent":"AlertsManagement","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":32,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/activityLogAlerts/","title":"activityLogAlerts","parent":"Insights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Resource Health Alerts\rLow\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure Resource Health Alerts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rbe448849-0d7d-49ba-9c94-9573ee533d5d\rDescription:\rConfigure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status. Potential Benefits:\rStay informed on resource status\rLearn More:\rResource Health\rConfigure Resource Health alerts in the Azure portal\rAlerts Health\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Resource Health Alerts\rLow\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure Resource Health Alerts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rbe448849-0d7d-49ba-9c94-9573ee533d5d\rDescription:\rConfigure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status. Potential Benefits:\rStay informed on resource status\rLearn More:\rResource Health\rConfigure Resource Health alerts in the Azure portal\rAlerts Health\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":33,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/","title":"Advisor","parent":"Azure Resources","content":"","description":""},{"id":34,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/CognitiveServices/AIsearch/","title":"AiSearch","parent":"CognitiveServices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable AZ support in AI Search by configuring multiple replicas to your search service\rHigh\rBusiness Continuity\rYes\rNo\rEnable Multi Region deployments for AI Search\rMedium\rDisaster Recovery\rYes\rNo\rDetails\rEnable AZ support in AI Search by configuring multiple replicas to your search service\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\rb376281d-bfec-4695-8f90-9a44544fdfa4\rDescription:\rAvailability zones are utilized when you add two or more replicas to your search service. Each replica is assigned to a different availability zone within the region. If the number of replicas exceeds the available zones in the region, the replicas are distributed across the zones as evenly as possible. Potential Benefits:\rHigh availability\rLearn More:\rReliability in Azure AI Search\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of all deployments for AI search with less than two replicas resources | where type == \u0026#34;microsoft.search/searchservices\u0026#34; | extend properties[\u0026#39;replicaCount\u0026#39;] | where properties[\u0026#39;replicaCount\u0026#39;] \u0026lt; 2 | project name, location, resourceGroup, subscriptionId, properties_replicaCount Enable Multi Region deployments for AI Search\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rdff62efe-c3a3-4621-98b3-c877c65cb195\rDescription:\rAzure AI Search does not offer automatic failover in the event of an outage. To ensure application continuity, recovery, and improved response times for a global audience, you can deploy multiple search services across different regions. This can be achieved by creating several services and developing a data synchronization strategy, such as using indexers to update content across multiple services or leveraging REST APIs to push content updates to them. Additionally, you can use a resource like Azure Traffic Manager to manage request routing. Potential Benefits:\rHigh availability\rLearn More:\rReliability in Azure AI Search\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of AI search deployments resources | where type == \u0026#34;microsoft.search/searchservices\u0026#34; | summarize count() by name,location, resourceGroup, subscriptionId | project name, location, resourceGroup, subscriptionId ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable AZ support in AI Search by configuring multiple replicas to your search service\rHigh\rBusiness Continuity\rYes\rNo\rEnable Multi Region deployments for AI Search\rMedium\rDisaster Recovery\rYes\rNo\rDetails\rEnable AZ support in AI Search by configuring multiple replicas to your search service\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\rb376281d-bfec-4695-8f90-9a44544fdfa4\rDescription:\rAvailability zones are utilized when you add two or more replicas to your search service."},{"id":35,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/alertRules/","title":"alertRules","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":36,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/alerts/","title":"alerts","parent":"AlertsManagement","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":37,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/alertsManagement/","title":"alertsManagement","parent":"Monitor","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":38,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AlertsManagement/","title":"AlertsManagement","parent":"Azure Resources","content":"","description":""},{"id":39,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AnalysisServices/","title":"AnalysisServices","parent":"Azure Resources","content":"","description":""},{"id":40,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ApiManagement/","title":"ApiManagement","parent":"Azure Resources","content":"","description":""},{"id":41,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/","title":"App","parent":"Azure Resources","content":"","description":""},{"id":42,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppConfiguration/","title":"AppConfiguration","parent":"Azure Resources","content":"","description":""},{"id":43,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationGateways/","title":"applicationGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Autoscale feature has been enabled\rMedium\rScalability\rYes\rYes\rMigrate to Application Gateway v2\rHigh\rScalability\rYes\rYes\rMonitor and Log the configurations and traffic\rHigh\rMonitoring and Alerting\rNo\rNo\rUse Health Probes to detect backend availability\rHigh\rMonitoring and Alerting\rYes\rNo\rDeploy Application Gateway in a zone-redundant configuration\rHigh\rHigh Availability\rYes\rYes\rPlan for backend maintenance by using connection draining\rMedium\rHigh Availability\rYes\rNo\rEnsure Application Gateway Subnet is using a /24 subnet mask\rHigh\rOther Best Practices\rYes\rYes\rDetails\rEnsure Autoscale feature has been enabled\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r823b0cff-05c0-2e4e-a1e7-9965e1cfa16f\rDescription:\rAzure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default. Enabling autoscale ensures the service is not reliant on manual intervention for scaling. Potential Benefits:\rEnhances uptime and enables autoscaling\rLearn More:\rApplication Gateway Autoscaling Zone-Redundant\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Application Gateways that do not have autoscale enabled or have a min capacity of 1 resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where isnull(properties.autoscaleConfiguration) or properties.autoscaleConfiguration.minCapacity \u0026lt;= 1 | project recommendationId = \u0026#34;823b0cff-05c0-2e4e-a1e7-9965e1cfa16f\u0026#34;, name, id, tags, param1 = \u0026#34;autoScaleConfiguration: isNull or MinCapacity \u0026lt;= 1\u0026#34; | order by id asc Migrate to Application Gateway v2\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r7893f0b3-8622-1d47-beed-4b50a19f7895\rDescription:\rUse Application Gateway v2 for built-in features like autoscaling, static VIPs, Azure KeyVault integration for better traffic management and performance, unless v1 is necessary. Potential Benefits:\rBetter performance, autoscaling, more features\rLearn More:\rApplication Gateway Overview V2\rApplication Gateway Feature Comparison Between V1 and V2\rApplication Gateway V1 Retirement\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Get all Application Gateways, which are using the deprecated V1 SKU resources | where type =~ \u0026#39;microsoft.network/applicationgateways\u0026#39; | extend tier = properties.sku.tier | where tier == \u0026#39;Standard\u0026#39; or tier == \u0026#39;WAF\u0026#39; | project recommendationId = \u0026#34;7893f0b3-8622-1d47-beed-4b50a19f7895\u0026#34;, name, id, tags Monitor and Log the configurations and traffic\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r5d035919-898d-a047-8d5d-454e199692e5\rDescription:\rEnable logging in storage accounts, Log Analytics, and monitoring services for auditing and insights. Potential Benefits:\rEnhanced traffic insight and audit\rLearn More:\rApplication Gateway Metrics\rApplication Gateway Diagnostics\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Health Probes to detect backend availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r847a8d88-21c4-bc48-a94e-562206edd767\rDescription:\rUsing custom health probes enhances understanding of backend availability and facilitates monitoring of backend services for any impact. Potential Benefits:\rEnsures backend uptime monitoring.\rLearn More:\rApplication Gateway Probe Overview\rWell-Architected Framework Application Gateway Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Application Gateways are not using health probes to monitor the availability of the backend systems resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where array_length(properties.probes) == 0 | project recommendationId=\u0026#34;847a8d88-21c4-bc48-a94e-562206edd767\u0026#34;, name, id, tags, param1=\u0026#34;customHealthProbeUsed: false\u0026#34; Deploy Application Gateway in a zone-redundant configuration\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc9c00f2a-3888-714b-a72b-b4c9e8fcffb2\rDescription:\rDeploying Application Gateway in a zone-aware configuration ensures continued customer access to services even if a specific zone goes down, as services in other zones remain available. Potential Benefits:\rEnhanced uptime and customer access\rLearn More:\rWell-Architected Framework Application Gateway Reliability\rApplication Gateway V2 Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list Application Gateways that are not configured to use at least 2 Availability Zones resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend zoneValue = iff((isnull(zones)), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;c9c00f2a-3888-714b-a72b-b4c9e8fcffb2\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Zones value: \u0026#34;, zoneValue ) Plan for backend maintenance by using connection draining\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r10f02bc6-e2e7-004d-a2c2-f9bf9f16b915\rDescription:\rUsing connection draining for backend maintenance ensures graceful removal of backend pool members during updates or health issues. It\u0026#39;s enabled via Backend Setting and applies to all members during rule creation. Potential Benefits:\rSmooth updates, no dropped users\rLearn More:\rApplication Gateway Connection Draining\rApplication Gateway Connection Draining HTTP Settings\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will check if connection draining is enabled resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | mv-expand backendHttpSettings = properties.backendHttpSettingsCollection | extend connectionDrainingEnabled = backendHttpSettings.properties.connectionDraining.enabled | where connectionDrainingEnabled != true | extend backendPoolName = backendHttpSettings.name | project recommendationId = \u0026#34;10f02bc6-e2e7-004d-a2c2-f9bf9f16b915\u0026#34;, name, id, tags, param1 = \u0026#34;connectionDraining: Disabled\u0026#34;, param2 = strcat(\u0026#34;backendSettingsName: \u0026#34;, backendPoolName) Ensure Application Gateway Subnet is using a /24 subnet mask\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r8364fd0a-7c0e-e240-9d95-4bf965aec243\rDescription:\rApplication Gateway v2 (Standard_v2 or WAF_v2 SKU) can support up to 125 instances. A /24 subnet isn\u0026#39;t mandatory for deployment but is advised to provide enough space for autoscaling and maintenance upgrades. Potential Benefits:\rAllows autoscaling and maintenance\rLearn More:\rAzure Application Gateway infrastructure configuration | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will validate the subnet id for an appGW ends with a /24 resources | where type =~ \u0026#39;Microsoft.Network/applicationGateways\u0026#39; | extend subnetid = tostring(properties.gatewayIPConfigurations[0].properties.subnet.id) | join kind=leftouter(resources | where type == \u0026#34;microsoft.network/virtualnetworks\u0026#34; | mv-expand properties.subnets | extend subnetid = tostring(properties_subnets.id) | extend addressprefix = tostring(properties_subnets.properties.addressPrefix) | project subnetid, addressprefix) on subnetid | where addressprefix !endswith \u0026#39;/24\u0026#39; | project recommendationId = \u0026#34;8364fd0a-7c0e-e240-9d95-4bf965aec243\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;AppGW subnet prefix: \u0026#39;, addressprefix) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Autoscale feature has been enabled\rMedium\rScalability\rYes\rYes\rMigrate to Application Gateway v2\rHigh\rScalability\rYes\rYes\rMonitor and Log the configurations and traffic\rHigh\rMonitoring and Alerting\rNo\rNo\rUse Health Probes to detect backend availability\rHigh\rMonitoring and Alerting\rYes\rNo\rDeploy Application Gateway in a zone-redundant configuration\rHigh\rHigh Availability\rYes\rYes\rPlan for backend maintenance by using connection draining\rMedium\rHigh Availability\rYes\rNo\rEnsure Application Gateway Subnet is using a /24 subnet mask\rHigh\rOther Best Practices\rYes\rYes\rDetails\rEnsure Autoscale feature has been enabled\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r823b0cff-05c0-2e4e-a1e7-9965e1cfa16f\rDescription:\rAzure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default."},{"id":44,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationGatewayWebApplicationFirewallPolicies/","title":"applicationGatewayWebApplicationFirewallPolicies","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":45,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/applications/","title":"applications","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":46,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/applicationSecurityGroups/","title":"applicationSecurityGroups","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":47,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppPlatform/","title":"AppPlatform","parent":"Azure Resources","content":"","description":""},{"id":48,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/ai/","title":"Artificial Intelligence (GPT-RAG)","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts Deploy a PAYG instance of the model with provisioned throughput to manage overflow effectively CognitiveServices accounts Ensure that models are deployed using Global batch for large scale processing CognitiveServices accounts Ensure AOAI models are deployed using Data Zone Standard for data residency requirements CognitiveServices accounts General Workload Guidance\r","description":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts Deploy a PAYG instance of the model with provisioned throughput to manage overflow effectively CognitiveServices accounts Ensure that models are deployed using Global batch for large scale processing CognitiveServices accounts Ensure AOAI models are deployed using Data Zone Standard for data residency requirements CognitiveServices accounts General Workload Guidance\r"},{"id":49,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/","title":"Authorization","parent":"Azure Resources","content":"","description":""},{"id":50,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Automation/","title":"Automation","parent":"Azure Resources","content":"","description":""},{"id":51,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Automation/automationAccounts/","title":"automationAccounts","parent":"Automation","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rSet up disaster recovery of Automation accounts and its dependent resources\rHigh\rHigh Availability\rNo\rNo\rDetails\rSet up disaster recovery of Automation accounts and its dependent resources\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r67205887-0733-466e-b50e-b1cd7316c514\rDescription:\rSet up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures. A replica Automation account should be ready in a secondary region for failover. Potential Benefits:\rEnsures continuity during outages\rLearn More:\rDisaster recovery for Automation accounts\rDisaster recovery scenarios for cloud and hybrid jobs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rSet up disaster recovery of Automation accounts and its dependent resources\rHigh\rHigh Availability\rNo\rNo\rDetails\rSet up disaster recovery of Automation accounts and its dependent resources\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r67205887-0733-466e-b50e-b1cd7316c514\rDescription:\rSet up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures."},{"id":52,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/availabilitySets/","title":"availabilitySets","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":53,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AVS/","title":"AVS","parent":"Azure Resources","content":"","description":""},{"id":54,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/hpc/","title":"Azure High Performance Computing","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rHigh\rHigh Availability\rNo\rNo\rAutomatically grow and shrink HPC Pack cluster resources\rMedium\rScalability\rNo\rNo\rUse multiple head nodes for HPC Pack\rMedium\rHigh Availability\rNo\rNo\rUse HPC Pack Azure AD Integration or other highly available AD configuration\rHigh\rHigh Availability\rNo\rNo\rDetails\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4c78fab4-845a-495d-ab14-3ad51de53a2a\rDescription:\rCurrently in all HPC Pack ARM templates we create the cluster share on one of the head node which is not highly available. Potential Benefits:\rEnhances job metadata availability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatically grow and shrink HPC Pack cluster resources\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rb02b5a0e-3770-44da-a099-5dd4d9f8cd70\rDescription:\rBy deploying Azure \u0026#34;burst\u0026#34; nodes (both Windows and Linux) in your HPC Pack cluster or creating your HPC Pack cluster in Azure, you can automatically grow or shrink the cluster\u0026#39;s resources such as nodes or cores according to the workload on the cluster. Potential Benefits:\rEfficient, uninterrupted execution\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use multiple head nodes for HPC Pack\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra48b1be6-77a3-4e3c-8205-dda2ba010a99\rDescription:\rEstablish a cluster with a minimum of two head nodes. In the event of a head node failure, the active HPC Service will be automatically transferred from the affected head node to another functioning one. Potential Benefits:\rEnhanced reliability for HPC\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use HPC Pack Azure AD Integration or other highly available AD configuration\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r37eec891-7880-4759-b597-7cd925512fe3\rDescription:\rWhen HPC failed to connect to the Domain controller, admin and user will not be able to connect to the HPC Service thus not able to manage and submit jobs to the cluster. Potential Benefits:\rEnhanced reliability and job management\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor Batch account quota Batch batchAccounts Create an Azure Batch pool across Availability Zones Batch batchAccounts General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rHigh\rHigh Availability\rNo\rNo\rAutomatically grow and shrink HPC Pack cluster resources\rMedium\rScalability\rNo\rNo\rUse multiple head nodes for HPC Pack\rMedium\rHigh Availability\rNo\rNo\rUse HPC Pack Azure AD Integration or other highly available AD configuration\rHigh\rHigh Availability\rNo\rNo\rDetails\rEnsure File shares that stores jobs metadata are accessible from all head nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4c78fab4-845a-495d-ab14-3ad51de53a2a\rDescription:\rCurrently in all HPC Pack ARM templates we create the cluster share on one of the head node which is not highly available."},{"id":55,"href":"/Azure-Proactive-Resiliency-Library-v2/","title":"Azure Proactive Resiliency Library v2","parent":"","content":"","description":""},{"id":56,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/avd/","title":"Azure Virtual Desktop","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Create a validation host pool DesktopVirtualization hostPools Configure host pool scheduled agent updates DesktopVirtualization hostPools Ensure a unique OU is used when deploying host pools with domain joined session hosts DesktopVirtualization hostPools Create scaling plans per region DesktopVirtualization scalingPlans Replicate your image templates to a secondary region Compute virtualMachineImages Create image Versions replicas in secondary region Compute galleries Configure image version replica count per region Compute galleries A minimum of three replicas should be kept for production image versions Compute galleries Zone redundant storage should be used for image versions Compute galleries Deploy VMs across Availability Zones Compute virtualMachines Backup VMs with Azure Backup service Compute virtualMachines Mission Critical Workloads should consider using Premium or Ultra Disks Compute virtualMachines Configure diagnostic settings for all Azure Virtual Machines Compute virtualMachines Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes Network expressRouteCircuits Ensure ExpressRoute\u0026rsquo;s physical links connect to distinct network edge devices Network expressRouteCircuits Use Zone-redundant ExpressRoute gateway SKUs Network virtualNetworkGateways Ensure that storage accounts are zone or region redundant Storage storageAccounts Configure Service Health Alerts Subscription subscriptions General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure AVD Insights workbook\rHigh\rMonitoring and Alerting\rNo\rNo\rEnsure separate log analytics workspaces for Prod and DR\rLow\rDisaster Recovery\rNo\rNo\rOrganize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rLow\rGovernance\rNo\rNo\rMonitor and plan capacity for AVD resources\rLow\rDisaster Recovery\rNo\rNo\rEnsure DNS regions are replicated to avoid single point of failure\rHigh\rHigh Availability\rNo\rNo\rImplement a multi-region BCDR Plan\rHigh\rDisaster Recovery\rNo\rNo\rCreate only one FSLogix file share per Storage Account\rMedium\rScalability\rNo\rNo\rCreate a dedicated FSLogix file share and setup per host pool\rMedium\rScalability\rNo\rNo\rEnable Azure backup for FSLogix storage account file shares\rMedium\rHigh Availability\rNo\rNo\rImplement RDP shortpath for public or managed networks\rMedium\rOther Best Practices\rNo\rNo\rEnsure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rMedium\rGovernance\rNo\rNo\rEnsure secondary Entra ID connect synchronization server\rLow\rSecurity\rNo\rNo\rEnsure virtual networks have route tables/route server configured for all regions\rMedium\rHigh Availability\rNo\rNo\rEnsure virtual networks isolation with separate IP space and NSGs for Prod and DR\rMedium\rBusiness Continuity\rNo\rNo\rConfigure static routes for session hosts to directly access the AVD control plane subnet\rMedium\rOther Best Practices\rNo\rNo\rCreate updated image version and replace session hosts rather than updating host directly\rLow\rGovernance\rNo\rNo\rEnsure the standard FSLogix configuration is deployed\rMedium\rGovernance\rNo\rNo\rEnsure user permissions are set correctly on FSLogix SMB shares\rMedium\rSecurity\rNo\rNo\rConfigure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rMedium\rMonitoring and Alerting\rNo\rNo\rManually install FSLogix updates\rLow\rGovernance\rNo\rNo\rTurn on continuous availability for ANF\rMedium\rHigh Availability\rNo\rNo\rUse dedicated file share for App attach and include the storage in the disaster recovery plan\rMedium\rDisaster Recovery\rNo\rNo\rEnsure resilient deployment of key vaults for AVD Host Pools\rHigh\rDisaster Recovery\rNo\rNo\rDeploy multiple domain controllers across availability zones in each region with AVD session hosts.\rHigh\rDisaster Recovery\rNo\rNo\rDeploy two or more DNS servers across availability zones in each region with AVD session hosts.\rHigh\rHigh Availability\rNo\rNo\rDetails\rConfigure AVD Insights workbook\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r0cf72d91-644d-4591-9bb7-84ba3f705a41\rDescription:\rConfigure AVD insights workbook template to monitor and troubleshoot AVD workloads across metrics, logs, events, and more. Both Production and DR workloads should be enabled with AVD Insights. Potential Benefits:\rEnhanced AVD monitoring and troubleshooting\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure separate log analytics workspaces for Prod and DR\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r89b4d8f6-6345-4d66-9012-c3fc2aef94e8\rDescription:\rHaving separate Log Analytics ensures that your DR environment is fully operational for visibility of the metrics, performance, and other auditing tools your workload teams will rely on in the event of an incident. Potential Benefits:\rImproved DR visibility and operation\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Organize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r204b56b0-9710-4c16-b506-bafb5fb318ed\rDescription:\rFollow AVD Landing Zone best practices using multiple resource groups based on resource type and associated shared resources for AVD workloads. Potential Benefits:\rEnhanced organization and scalability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor and plan capacity for AVD resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\ref4b3561-c85f-47cf-8cb0-51fae9ddf929\rDescription:\rMonitor and plan for subscription limits and API throttling limits. Keep track of resource usage within your subscription. Consider scaling across multiple subscriptions if further scaling is required. To handle a large number of users, consider scaling horizontally by creating multiple host pools. Potential Benefits:\rAvoids limits, ensures smooth scaling\rLearn More:\rCapacity Planning\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure DNS regions are replicated to avoid single point of failure\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re1a34ac6-8761-4020-b537-d60c0be7514e\rDescription:\rActive Directory Domain Services (AD DS) integrated DNS/other should target Secondary/Tertiary customer DNS across multi-region zones. If using custom DNS, ensure there are redundant DNS servers to avoid a single point of failure. Potential Benefits:\rImproves uptime \u0026amp; resilience\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement a multi-region BCDR Plan\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r0714d039-535e-468d-9732-e32b5c094faa\rDescription:\rIt is recommended to adopt a multi-region deployment (active-active or active-passive) for AVD. Each region should contain at least identity, name resolution, AVD management resources, and session hosts in case of a primary region outage. Potential Benefits:\rEnhanced resilience and uptime\rLearn More:\rMulti-region BCDR\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create only one FSLogix file share per Storage Account\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\red1f0327-0914-49e8-9518-16acb0d6b8d6\rDescription:\rTo maximize capacity and performance scaling it is recommended to creat only one file share per Azure files storage account, with this approach the single file share will be able to grow to the maximum capacities of the storage account. Potential Benefits:\rEnhanced scaling and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a dedicated FSLogix file share and setup per host pool\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rff916698-7507-4519-b545-c94dd81d73c5\rDescription:\rTo maximize capacity and performance scaling of the file share service and avoid user\u0026#39;s profile contention, it is recommended to create one file share target and FSLogix setup per host pool. Potential Benefits:\rEnhanced performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Azure backup for FSLogix storage account file shares\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0025ed2e-41f4-4ada-93c1-12484cef8b0c\rDescription:\rIt is recommended to enable backup on the FSLogix Storage Account. Ensuring the user profiles are resilient will allow user data and experience to be consistent through outages. Potential Benefits:\rEnsures data resilience and consistency\rLearn More:\rFSLogix\rBackup Storage Account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement RDP shortpath for public or managed networks\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r3835b4b3-0479-4be8-9ffd-34ae29fa33b9\rDescription:\rRDP Shortpath establishes a direct UDP-based connection between a client and the session host. By default, RDP tries to use UDP and falls back to TCP if needed. UDP transport offers better connection reliability and consistent latency. Potential Benefits:\rBetter reliability and consistent latency\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\re718ac1a-ebab-4f75-9e4a-1a5ccef20d1f\rDescription:\rEnsure AVD session hosts can communicate with the AVD control plane and that UDP ports are open if used. Validate VM connectivity to the AVD Control Plane and confirm UDP TURN port accessibility. Whitelist global URLs and ensure UDP/TURN ports are open for smooth user connections. Potential Benefits:\rEnhanced performance \u0026amp; user experience\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure secondary Entra ID connect synchronization server\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\rd984eaf9-0fa1-4f8d-a326-bda751993c6f\rDescription:\rHybrid - Entra ID Connect best to run in Azure but can be hosted on-prem. Secondary or more VMs should be setup in staging mode in event of failover. Set up secondary server in staging mode for Entra Connect for syncing to Entra in case of primary server outage. Potential Benefits:\rImproved failover reliability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure virtual networks have route tables/route server configured for all regions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rdb1727d1-5c8e-4a01-a31e-f0d58cfd95b1\rDescription:\rFor high availability connections back to on-premises data centers should consider backup paths across the regions that have been utilized. Ensure redundancy in routing by having a secondary route table in the secondary region. Potential Benefits:\rEnhanced availability \u0026amp; routing\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure virtual networks isolation with separate IP space and NSGs for Prod and DR\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\r37d1091b-e599-4548-a067-a9286be16e45\rDescription:\rNSG and ASG per AVD persona and IP space per Prod/DR regions. Plan IP addressing to avoid overlaps between on-premises and Azure regions, preventing major contention challenges. Potential Benefits:\rEnhances security and prevents IP conflicts\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure static routes for session hosts to directly access the AVD control plane subnet\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r1c6c97d7-4d03-4f53-985d-fa239f715173\rDescription:\rEnsure Route Tables have static routes for session host traffic targeting the AVD control plane to go directly to the internet (next hop). This avoids delays from additional hops or inspections in trusted traffic communication. Potential Benefits:\rEnhanced performance and Disaster Recovery\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create updated image version and replace session hosts rather than updating host directly\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r2831dab9-6a43-44a1-8aec-90a8e84894bc\rDescription:\rEstablish a process for handling image updates in your AVD environment. Instead of updating session hosts directly, create a new version of the updated image. This involves creating and configuring a golden image with the necessary updates and configurations. Potential Benefits:\rEnsures consistency; minimizes drift\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the standard FSLogix configuration is deployed\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rc15b2b73-52a1-4db2-88dd-d592424ff4e4\rDescription:\rEnsure all session hosts have the standard FSLogix configuration deployed. Regularly validate settings for consistency and alignment with best practices. Potential Benefits:\rOptimized session reliability and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure user permissions are set correctly on FSLogix SMB shares\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\r7b170ddd-5770-4945-9bc3-cd1ccf5f8672\rDescription:\rVerify user permissions are correctly set on SMB shares so that users have appropriate access to only their own profile and not other user profiles, while administrators have full access at the root volume. Also ensure secondary storage path permissions are set in case of a DR event. Potential Benefits:\rEnhanced security \u0026amp; disaster recovery\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r483f5a00-84a0-49f7-903b-ef6f1fc0c389\rDescription:\rConfigure diagnostic settings on FSLogix storage and regularly monitor its metrics and logs for errors. While events can be reviewed locally on the Session Host, it is recommended to use AVD insights workbook to consolidate this information into a Log Analytics workspace. Potential Benefits:\rEnhanced AVD error tracking and resolution\rLearn More:\rLearn More\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Manually install FSLogix updates\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rd51e0a70-8b50-4be3-af8a-7c9065e47360\rDescription:\rEnsure a process to regularly check and update FSLogix agent. Upgrade to the latest version promptly to address bugs and meet support requirements. FSLogix releases hotfixes to resolve issues impacting deployments. Keeping FSLogix updated is crucial for support and reliability. Potential Benefits:\rEnhanced reliability \u0026amp; support\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Turn on continuous availability for ANF\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9b2301af-9cac-4f1a-871a-f17475d01812\rDescription:\rTurn on Continuous Availability if using Azure Netapp Files. Verify the number of users connecting to each file share to make sure the SMB path can handle the number of file connections. Potential Benefits:\rEnhanced stability \u0026amp; user limit checks\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use dedicated file share for App attach and include the storage in the disaster recovery plan\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r7d9c96a6-1ce5-4cf0-ad1b-638a37f753cb\rDescription:\rApp Attach packages should be on a separate share from profiles and backed up. Requirements vary based on the number of packaged applications. Test your applications to understand your needs. Ensure the file share is in the same Azure region as your session hosts. Potential Benefits:\rEnhances performance and scalability\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure resilient deployment of key vaults for AVD Host Pools\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1f57434f-f884-41f3-b818-129bbe3c5d3b\rDescription:\rTo ensure continuous availability and disaster recovery readiness, provision a secondary Key Vault in a secondary region. In case of a primary region failure, the secondary Key Vault will ensure critical secrets remain accessible for deployments in the secondary region. Potential Benefits:\rEnsures DR readiness and access\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy multiple domain controllers across availability zones in each region with AVD session hosts.\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rd61f6ee8-de1b-4fd9-9ce3-316cfe11ee05\rDescription:\rDeploy multiple domain controllers on Azure VMs across availability zones with AVD session hosts. This removes on-premises dependencies and improves performance with a shorter authentication path. This doesn\u0026#39;t apply to Microsoft Entra ID or Entra Domain Services joined session hosts. Potential Benefits:\rEnhanced identity resilience\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy two or more DNS servers across availability zones in each region with AVD session hosts.\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r99bf5c94-aa68-4bb3-8b7f-45d1c5f09b5d\rDescription:\rDeploy custom DNS servers on Azure VMs across availability zones in the same region as session hosts. This removes on-premises dependencies and improves performance by shortening the name resolution path. Potential Benefits:\rEnhanced reliability and performance\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Create a validation host pool DesktopVirtualization hostPools Configure host pool scheduled agent updates DesktopVirtualization hostPools Ensure a unique OU is used when deploying host pools with domain joined session hosts DesktopVirtualization hostPools Create scaling plans per region DesktopVirtualization scalingPlans Replicate your image templates to a secondary region Compute virtualMachineImages Create image Versions replicas in secondary region Compute galleries Configure image version replica count per region Compute galleries A minimum of three replicas should be kept for production image versions Compute galleries Zone redundant storage should be used for image versions Compute galleries Deploy VMs across Availability Zones Compute virtualMachines Backup VMs with Azure Backup service Compute virtualMachines Mission Critical Workloads should consider using Premium or Ultra Disks Compute virtualMachines Configure diagnostic settings for all Azure Virtual Machines Compute virtualMachines Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes Network expressRouteCircuits Ensure ExpressRoute\u0026rsquo;s physical links connect to distinct network edge devices Network expressRouteCircuits Use Zone-redundant ExpressRoute gateway SKUs Network virtualNetworkGateways Ensure that storage accounts are zone or region redundant Storage storageAccounts Configure Service Health Alerts Subscription subscriptions General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure AVD Insights workbook\rHigh\rMonitoring and Alerting\rNo\rNo\rEnsure separate log analytics workspaces for Prod and DR\rLow\rDisaster Recovery\rNo\rNo\rOrganize AVD resources using the AVD scale unit model described by the AVD landing zone methodology\rLow\rGovernance\rNo\rNo\rMonitor and plan capacity for AVD resources\rLow\rDisaster Recovery\rNo\rNo\rEnsure DNS regions are replicated to avoid single point of failure\rHigh\rHigh Availability\rNo\rNo\rImplement a multi-region BCDR Plan\rHigh\rDisaster Recovery\rNo\rNo\rCreate only one FSLogix file share per Storage Account\rMedium\rScalability\rNo\rNo\rCreate a dedicated FSLogix file share and setup per host pool\rMedium\rScalability\rNo\rNo\rEnable Azure backup for FSLogix storage account file shares\rMedium\rHigh Availability\rNo\rNo\rImplement RDP shortpath for public or managed networks\rMedium\rOther Best Practices\rNo\rNo\rEnsure AVD session hosts connect to control plane \u0026amp; allow UDP ports for RDP shortpath\rMedium\rGovernance\rNo\rNo\rEnsure secondary Entra ID connect synchronization server\rLow\rSecurity\rNo\rNo\rEnsure virtual networks have route tables/route server configured for all regions\rMedium\rHigh Availability\rNo\rNo\rEnsure virtual networks isolation with separate IP space and NSGs for Prod and DR\rMedium\rBusiness Continuity\rNo\rNo\rConfigure static routes for session hosts to directly access the AVD control plane subnet\rMedium\rOther Best Practices\rNo\rNo\rCreate updated image version and replace session hosts rather than updating host directly\rLow\rGovernance\rNo\rNo\rEnsure the standard FSLogix configuration is deployed\rMedium\rGovernance\rNo\rNo\rEnsure user permissions are set correctly on FSLogix SMB shares\rMedium\rSecurity\rNo\rNo\rConfigure Diagnostic Settings on FSLogix storage and capture session hosts FSLogix events\rMedium\rMonitoring and Alerting\rNo\rNo\rManually install FSLogix updates\rLow\rGovernance\rNo\rNo\rTurn on continuous availability for ANF\rMedium\rHigh Availability\rNo\rNo\rUse dedicated file share for App attach and include the storage in the disaster recovery plan\rMedium\rDisaster Recovery\rNo\rNo\rEnsure resilient deployment of key vaults for AVD Host Pools\rHigh\rDisaster Recovery\rNo\rNo\rDeploy multiple domain controllers across availability zones in each region with AVD session hosts."},{"id":57,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/avs/","title":"Azure VMware Solution","parent":"Specialized Workloads","content":"\rDependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit AVS privateClouds Monitor when Azure VMware Solution Cluster Size is approaching the host limit AVS privateClouds Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore AVS privateClouds Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization AVS privateClouds Configure Syslog in Diagnostic Settings for Azure VMware Solution AVS privateClouds Monitor CPU Utilization to ensure sufficient resources for workloads AVS privateClouds Monitor Memory Utilization to ensure sufficient resources for workloads AVS privateClouds Use key autorotation for vSAN datastore customer-managed keys AVS privateClouds Use multiple DNS servers per private FQDN zone AVS privateClouds For better data path performance enable FastPath on ExpressRoute Direct and Gateway Network connections Configure an Azure Resource Lock on connections to prevent accidental deletion Network connections Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Network virtualNetworkGateways Monitor gateway health Network virtualNetworkGateways Configure customer-controlled gateway maintenance Network virtualNetworkGateways General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rHigh\rHigh Availability\rNo\rNo\rIntegrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rHigh\rSecurity\rNo\rNo\rUse HCX Network Extension High Availability\rHigh\rHigh Availability\rNo\rNo\rVerify Management Networks are not extended with HCX Network Extension\rHigh\rOther Best Practices\rNo\rNo\rVerify vSAN FTT configuration aligns with the cluster size\rHigh\rHigh Availability\rNo\rNo\rAlign ExpressRoute configuration with best practices for circuit resilience\rHigh\rHigh Availability\rNo\rNo\rDeploy two or more circuits in different peering locations when using stretched clusters\rHigh\rHigh Availability\rNo\rNo\rDeploy dual Azure VMware Solution clouds in different regions for disaster recovery\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r726abfe3-adae-4a6d-8eb8-4b27a7214ca1\rDescription:\rUse the Interconnect feature for direct communication between private clouds in different availability zones, enabling connectivity between the private clouds management and workload networks. Potential Benefits:\rEnhanced private cloud connectivity\rLearn More:\rConnect Private Clouds in the same region\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Integrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\rc2794660-ffd7-4da3-96ba-5d546b70b1c6\rDescription:\rEnsure two external identity sources are configured for NSX and vCenter Server. The VMware vCenter Server and NSX Manager use these for authentication with external identities. Potential Benefits:\rContinuous login access during maintenances\rLearn More:\rSet an external identity source for vCenter\rSet an external identity for NSX-T\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use HCX Network Extension High Availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbce16eee-0933-4baa-ab4d-8d1bb5653fc2\rDescription:\rEnable Network Extension High Availability for appliance failure tolerance in HCX service. It pairs selected appliances for Active Standby configuration, ensuring high availability and quick recovery, keeping configurations in-service despite failures. Potential Benefits:\rImproves HCX service continuity\rLearn More:\rHCX Network extension high availability\rUnderstanding Network Extension High Availability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Verify Management Networks are not extended with HCX Network Extension\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r6be9a543-cf82-4926-82ea-7e1f1ffaad80\rDescription:\rDo not extend the network used by the HCX Management devices to ensure the network\u0026#39;s security and stability. Potential Benefits:\rEnhanced network safety and performance\rLearn More:\rRequirements for Network Extension\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Verify vSAN FTT configuration aligns with the cluster size\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0943aa90-e3db-4c61-aef1-782b6a6a3881\rDescription:\rThe Azure VMware Solution\u0026#39;s service SLA is influenced by vSAN storage policies, which change based on cluster size. For clusters over 6 hosts, an FTT-2 policy (RAID-1 or RAID-6) is advised. FTT refers to the Fault Tolerance feature. Potential Benefits:\rEnhanced cluster reliability\rLearn More:\rUse fault domains\rConfigure storage policy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Align ExpressRoute configuration with best practices for circuit resilience\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6f573d60-be93-4f18-8016-42e923e3c05e\rDescription:\rMicrosoft suggests using two or more ExpressRoute circuits at distinct peering locations for critical workloads. Connect these circuits and your Azure VMware Solutions private clouds using Global Reach. Potential Benefits:\rEnhanced circuit resilience for Azure VMware\rLearn More:\rAPRL guidance for ExpressRoute circuits\rCreate a new ExpressRoute circuit\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Deploy two or more circuits in different peering locations when using stretched clusters\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r91c84596-1c41-48fe-8d5e-3f817e6a273b\rDescription:\rAzure VMware Solution vSAN stretched clusters cover 2 Availability Zones plus a third for witness. Use ExpressRoute for added resilience by deploying two circuits in different locations. With Global Reach, create a mesh topology by connecting on-premises circuits to Azure\u0026#39;s managed circuits. Potential Benefits:\rEnhanced resilience and connectivity\rLearn More:\rDeploy vSAN streched cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Deploy dual Azure VMware Solution clouds in different regions for disaster recovery\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rbdac462a-2eda-4a67-887d-46d58f141afe\rDescription:\rTwo Azure VMware Solution private clouds can be deployed in different regions for business continuity, implementing a mesh network topology based on ExpressRoute Gateway Connections and Global Reach Connections. Potential Benefits:\rEnhanced disaster recovery\rLearn More:\rPrivate Clouds in two regions\rDual Region Network Topology\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Dependent Azure Resource Recommendations\rRecommendation Provider Namespace Resource Type Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit AVS privateClouds Monitor when Azure VMware Solution Cluster Size is approaching the host limit AVS privateClouds Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore AVS privateClouds Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization AVS privateClouds Configure Syslog in Diagnostic Settings for Azure VMware Solution AVS privateClouds Monitor CPU Utilization to ensure sufficient resources for workloads AVS privateClouds Monitor Memory Utilization to ensure sufficient resources for workloads AVS privateClouds Use key autorotation for vSAN datastore customer-managed keys AVS privateClouds Use multiple DNS servers per private FQDN zone AVS privateClouds For better data path performance enable FastPath on ExpressRoute Direct and Gateway Network connections Configure an Azure Resource Lock on connections to prevent accidental deletion Network connections Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Network virtualNetworkGateways Monitor gateway health Network virtualNetworkGateways Configure customer-controlled gateway maintenance Network virtualNetworkGateways General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rHigh\rHigh Availability\rNo\rNo\rIntegrate LDAPS Identity with dual sources for enhanced NSX and vCenter security\rHigh\rSecurity\rNo\rNo\rUse HCX Network Extension High Availability\rHigh\rHigh Availability\rNo\rNo\rVerify Management Networks are not extended with HCX Network Extension\rHigh\rOther Best Practices\rNo\rNo\rVerify vSAN FTT configuration aligns with the cluster size\rHigh\rHigh Availability\rNo\rNo\rAlign ExpressRoute configuration with best practices for circuit resilience\rHigh\rHigh Availability\rNo\rNo\rDeploy two or more circuits in different peering locations when using stretched clusters\rHigh\rHigh Availability\rNo\rNo\rDeploy dual Azure VMware Solution clouds in different regions for disaster recovery\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rUse the AVS Interconnect feature to connect private clouds in different availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r726abfe3-adae-4a6d-8eb8-4b27a7214ca1\rDescription:\rUse the Interconnect feature for direct communication between private clouds in different availability zones, enabling connectivity between the private clouds management and workload networks."},{"id":58,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/azureFirewalls/","title":"azureFirewalls","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy Azure Firewall across multiple availability zones\rHigh\rHigh Availability\rYes\rNo\rMonitor Azure Firewall metrics\rHigh\rMonitoring and Alerting\rYes\rNo\rConfigure 2-4 PIPs for SNAT Port utilization\rMedium\rHigh Availability\rNo\rNo\rMonitor \u0026#34;AZFW Latency Probe\u0026#34; metric\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rDeploy Azure Firewall across multiple availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc72b7fee-1fa0-5b4b-98e5-54bcae95bb74\rDescription:\rAzure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance. Potential Benefits:\rEnhanced SLA and reliability\rLearn More:\rAzure Well Architected Framework - Azure Firewall\rDeploy Azure Firewall across multiple availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Azure Firewalls that are not configured with multiple availability zones or deployed without a zone resources | where type == \u0026#39;microsoft.network/azurefirewalls\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where array_length(zones) \u0026lt;= 1 or isnull(zones) | where isempty(properties.virtualHub.id) or isnull(properties.virtualHub.id) | project recommendationId = \u0026#34;c72b7fee-1fa0-5b4b-98e5-54bcae95bb74\u0026#34;, name, id, tags, param1=\u0026#34;multipleZones:false\u0026#34; Monitor Azure Firewall metrics\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r3c8fa7c6-6b78-a24a-a63f-348a7c71acb9\rDescription:\rMonitor Azure Firewall for overall health, processed throughput, and outbound SNAT port usage. Get alerted before limits impact services. Consider NAT gateway integration with zonal deployments; note limitations with zone redundant firewalls and secure virtual hub networks. Potential Benefits:\rImprove health and performance monitoring\rLearn More:\rAzure Firewall metrics supported in Azure Monitor\rAzure Firewall performance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Azure Firewalls resources in-scope, along with any metrics associated to Azure Monitor alert rules, that are not fully configured. resources | where type == \u0026#34;microsoft.network/azurefirewalls\u0026#34; | project firewallId = tolower(id), name, tags | join kind = leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | where properties_scopes contains \u0026#34;azureFirewalls\u0026#34; | project metricId = tolower(properties_scopes), monitoredMetric = properties_criteria_allOf.metricName, tags | summarize monitoredMetrics = make_list(monitoredMetric) by tostring(metricId) | project metricId, monitoredMetrics, allAlertsConfigured = monitoredMetrics contains(\u0026#34;FirewallHealth\u0026#34;) and monitoredMetrics contains (\u0026#34;Throughput\u0026#34;) and monitoredMetrics contains (\u0026#34;SNATPortUtilization\u0026#34;) ) on $left.firewallId == $right.metricId | extend alertsNotFullyConfigured = isnull(allAlertsConfigured) or not(allAlertsConfigured) | where alertsNotFullyConfigured | project recommendationId = \u0026#34;c8fa7c6-6b78-a24a-a63f-348a7c71acb9\u0026#34;, name, id = firewallId, tags, param1 = strcat(\u0026#34;MetricsAlerts:\u0026#34;, monitoredMetrics) Configure 2-4 PIPs for SNAT Port utilization\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd2e4a38e-2307-4299-a217-4c0cebc9a7f6\rDescription:\rConfigure a minimum of two to four public IP addresses per Azure Firewall to avoid SNAT exhaustion. Azure Firewall offers SNAT for all outbound traffic to public IPs, providing 2,496 SNAT ports for each additional PIP. Potential Benefits:\rAvoids SNAT exhaustion.\rLearn More:\rAzure Well-Architected Framework review - Azure Firewall\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under development Monitor \u0026#34;AZFW Latency Probe\u0026#34; metric\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r8faace2d-a36e-425c-aa58-2ad99e3e0b7a\rDescription:\rUsing the Azure Firewall latency probe metric to monitor sustained latency over 30ms (accounting for normal spikes) can help identify when firewall instance CPU utilization is under stress, potentially indicating performance issues Potential Benefits:\rImproved CPU stress detection\rLearn More:\rAzure Well-Architected Framework review - Azure Firewall\rAzure Firewall metrics overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy Azure Firewall across multiple availability zones\rHigh\rHigh Availability\rYes\rNo\rMonitor Azure Firewall metrics\rHigh\rMonitoring and Alerting\rYes\rNo\rConfigure 2-4 PIPs for SNAT Port utilization\rMedium\rHigh Availability\rNo\rNo\rMonitor \u0026#34;AZFW Latency Probe\u0026#34; metric\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rDeploy Azure Firewall across multiple availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc72b7fee-1fa0-5b4b-98e5-54bcae95bb74\rDescription:\rAzure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance."},{"id":59,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/","title":"AzureLargeInstance","parent":"Azure Resources","content":"","description":""},{"id":60,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/azureLargeInstances/","title":"azureLargeInstances","parent":"AzureLargeInstance","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":61,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureLargeInstance/azureLargeStorageInstances/","title":"azureLargeStorageInstances","parent":"AzureLargeInstance","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":62,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/","title":"AzureStackHCI","parent":"Azure Resources","content":"","description":""},{"id":63,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/azureTrafficCollectors/","title":"azureTrafficCollectors","parent":"NetworkFunction","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure ExpressRoute Traffic Collector is enabled and configured for Direct or Provider circuits\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rEnsure ExpressRoute Traffic Collector is enabled and configured for Direct or Provider circuits\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1ceea4b5-1d8b-4be0-9bbe-9594557be51a\rDescription:\rExpressRoute Traffic Collector samples network flows over ExpressRoute Direct or Service-Provider based circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM. Potential Benefits:\rEnhanced network flow analysis and DR readiness\rLearn More:\rAzure ExpressRoute Traffic Collector\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure ExpressRoute Traffic Collector is enabled and configured for Direct or Provider circuits\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rEnsure ExpressRoute Traffic Collector is enabled and configured for Direct or Provider circuits\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1ceea4b5-1d8b-4be0-9bbe-9594557be51a\rDescription:\rExpressRoute Traffic Collector samples network flows over ExpressRoute Direct or Service-Provider based circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM."},{"id":64,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/","title":"BareMetalInfrastructure","parent":"Azure Resources","content":"","description":""},{"id":65,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/bareMetalInstances/","title":"bareMetalInstances","parent":"BareMetalInfrastructure","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":66,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/bareMetalMachines/","title":"bareMetalMachines","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":67,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BareMetalInfrastructure/bareMetalStorageInstances/","title":"bareMetalStorageInstances","parent":"BareMetalInfrastructure","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":68,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/bastionHosts/","title":"bastionHosts","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":69,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Batch/","title":"Batch","parent":"Azure Resources","content":"","description":""},{"id":70,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Batch/batchAccounts/","title":"batchAccounts","parent":"Batch","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Batch Account quota\rMedium\rMonitoring and Alerting\rNo\rNo\rCreate an Azure Batch pool across Availability Zones\rHigh\rHigh Availability\rNo\rNo\rDetails\rMonitor Batch Account quota\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r3464854d-6f75-4922-95e4-a2a308b53ce6\rDescription:\rTo ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits. Potential Benefits:\rEnsures business continuity\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create an Azure Batch pool across Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r71cfab8f-d588-4742-b175-b6e07ae48dbd\rDescription:\rWhen using Virtual Machine Configuration for Azure Batch pools, opting to distribute your pool across Availability Zones bolsters your compute nodes against Azure datacenter failures. Potential Benefits:\rEnhanced reliability and failure protection\rLearn More:\rLearn More\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Batch Account quota\rMedium\rMonitoring and Alerting\rNo\rNo\rCreate an Azure Batch pool across Availability Zones\rHigh\rHigh Availability\rNo\rNo\rDetails\rMonitor Batch Account quota\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r3464854d-6f75-4922-95e4-a2a308b53ce6\rDescription:\rTo ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits."},{"id":71,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Bing/","title":"Bing","parent":"Azure Resources","content":"","description":""},{"id":72,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BotService/","title":"BotService","parent":"Azure Resources","content":"","description":""},{"id":73,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/BotService/botServices/","title":"botServices","parent":"BotService","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":74,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/","title":"Cache","parent":"Azure Resources","content":"","description":""},{"id":75,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageCache/caches/","title":"caches","parent":"StorageCache","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":76,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Fabric/capacities/","title":"capacities","parent":"Fabric","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":77,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/PowerBIDedicated/capacities/","title":"capacities","parent":"PowerBIDedicated","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":78,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/capacityReservationGroups/","title":"capacityReservationGroups","parent":"MachineLearningServices","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":79,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/cassandraClusters/","title":"cassandraClusters","parent":"DocumentDB","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":80,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/","title":"Cdn","parent":"Azure Resources","content":"","description":""},{"id":81,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/CdnWebApplicationFirewallPolicies/","title":"CdnWebApplicationFirewallPolicies","parent":"Cdn","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":82,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ChangeAnalysis/","title":"ChangeAnalysis","parent":"Azure Resources","content":"","description":""},{"id":83,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ChangeAnalysis/changes/","title":"changes","parent":"ChangeAnalysis","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":84,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HardwareSecurityModules/cloudHsmClusters/","title":"cloudHsmClusters","parent":"HardwareSecurityModules","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":85,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/cloudServices/","title":"cloudServices","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":86,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/cloudServicesNetworks/","title":"cloudServicesNetworks","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":87,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/clusterManagers/","title":"clusterManagers","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":88,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/clusterPools/","title":"clusterPools","parent":"HDInsight","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":89,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/clusters/","title":"clusters","parent":"AzureStackHCI","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":90,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/clusters/","title":"clusters","parent":"EventHub","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":91,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/clusters/","title":"clusters","parent":"HDInsight","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":92,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Kusto/clusters/","title":"clusters","parent":"Kusto","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":93,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/clusters/","title":"clusters","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":94,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/clusters/","title":"clusters","parent":"ServiceFabric","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":95,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/clusters/","title":"clusters","parent":"StreamAnalytics","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":96,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/CognitiveServices/","title":"CognitiveServices","parent":"Azure Resources","content":"","description":""},{"id":97,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/components/","title":"components","parent":"Insights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConvert Classic Deployments\rMedium\rService Upgrade and Retirement\rYes\rNo\rDetails\rConvert Classic Deployments\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rAPRL GUID:\u0026nbsp;\rdac421ec-2832-4c37-839e-b6dc5a38f2fa\rDescription:\rClassic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024. Potential Benefits:\rAvoid service disruption post-Feb 2024\rLearn More:\rMigrate an Application Insights classic resource to a workspace-based resource\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Filters Application Insights resources with ‘Classic’ deployment type resources | where type =~ \u0026#34;microsoft.insights/components\u0026#34; | extend IngestionMode = properties.IngestionMode | where IngestionMode =~ \u0026#39;ApplicationInsights\u0026#39; | project recommendationId= \u0026#34;dac421ec-2832-4c37-839e-b6dc5a38f2fa\u0026#34;, name, id, tags, param1=\u0026#34;ApplicationInsightsDeploymentType: Classic\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConvert Classic Deployments\rMedium\rService Upgrade and Retirement\rYes\rNo\rDetails\rConvert Classic Deployments\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rAPRL GUID:\u0026nbsp;\rdac421ec-2832-4c37-839e-b6dc5a38f2fa\rDescription:\rClassic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024. Potential Benefits:\rAvoid service disruption post-Feb 2024\rLearn More:\rMigrate an Application Insights classic resource to a workspace-based resource\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":98,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/","title":"Compute","parent":"Azure Resources","content":"","description":""},{"id":99,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/configurations/","title":"configurations","parent":"Advisor","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":100,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppConfiguration/configurationStores/","title":"configurationStores","parent":"AppConfiguration","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Purge protection for Azure App Configuration\rLow\rGovernance\rYes\rNo\rUpgrade to App Configuration Standard tier\rHigh\rHigh Availability\rYes\rNo\rDetails\rEnable Purge protection for Azure App Configuration\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rbb4c8db4-f821-475b-b1ea-16e95358665e\rDescription:\rWith Purge protection enabled, soft deleted stores can\u0026#39;t be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires. Potential Benefits:\rPrevent accidental deletion of configuration stores.\rLearn More:\rPurge protection\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Purge protection should be enabled for App Configuration stores to prevent accidental deletion of configuration data. resources | where type =~ \u0026#34;Microsoft.AppConfiguration/configurationStores\u0026#34; | where sku.name \u0026lt;\u0026gt; \u0026#34;free\u0026#34; | where (properties.enablePurgeProtection \u0026lt;\u0026gt; true) or isnull(properties.enablePurgeProtection ) | project recommendationId = \u0026#34;bb4c8db4-f821-475b-b1ea-16e95358665e\u0026#34;, name, id, tags, param1 = \u0026#34;Enable purge protection\u0026#34; Upgrade to App Configuration Standard tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2102a57a-a056-4d5e-afe5-9df9f92177ca\rDescription:\rSLA is not available for Free tier. Upgrade to the Standard tier to get an SLA of 99.9% Potential Benefits:\rHigh availability, more storage, higher request quota.\rLearn More:\rChoose App Configuration tier\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Upgrade to App Configuration Standard tier resources | where type =~ \u0026#34;Microsoft.AppConfiguration/configurationStores\u0026#34; | where sku.name == \u0026#34;free\u0026#34; | project recommendationId = \u0026#34;2102a57a-a056-4d5e-afe5-9df9f92177ca\u0026#34;, name, id, tags, param1 = \u0026#34;Upgrade to Standard SKU\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Purge protection for Azure App Configuration\rLow\rGovernance\rYes\rNo\rUpgrade to App Configuration Standard tier\rHigh\rHigh Availability\rYes\rNo\rDetails\rEnable Purge protection for Azure App Configuration\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rbb4c8db4-f821-475b-b1ea-16e95358665e\rDescription:\rWith Purge protection enabled, soft deleted stores can\u0026#39;t be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires."},{"id":101,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/connectedEnvironments/","title":"connectedEnvironments","parent":"App","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":102,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/connections/","title":"connections","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rFor better data path performance enable FastPath on ExpressRoute Connections\rMedium\rScalability\rNo\rNo\rDetails\rFor better data path performance enable FastPath on ExpressRoute Connections\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rf6a14b32-a727-4ace-b5fa-7b1c6bdff402\rDescription:\rExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization. Potential Benefits:\rEnhances speed and resiliency\rLearn More:\rAbout ExpressRoute FastPath\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all ExpressRoute Connections that are connected to ErGw3AZ or UltraPerformance gateway sku that don\u0026#39;t have // FastPath enabled for both the Gateway Bypass or Private Endpoint/Link service. resources | where type == \u0026#34;microsoft.network/connections\u0026#34; | where properties.connectionType =~ \u0026#39;expressroute\u0026#39; | extend gatewayId = tostring(properties.virtualNetworkGateway1.id) | join kind=inner ( resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.sku.name in~ (\u0026#34;ErGw3AZ\u0026#34;, \u0026#34;UltraPerformance\u0026#34;) | extend gatewayId = tostring(id) ) on gatewayId | extend erGatewayBypass = tobool(properties.expressRouteGatewayBypass) | extend privateLinkFastPath = tobool(properties.enablePrivateLinkFastPath) | where not(erGatewayBypass) or not(privateLinkFastPath) | project recommendationId = \u0026#34;f6a14b32-a727-4ace-b5fa-7b1c6bdff402\u0026#34;, id, name, tags, param1 = iff(erGatewayBypass, \u0026#34;Enabled: Gateway Bypass\u0026#34;, \u0026#34;Disabled: Gateway Bypass\u0026#34;), param2 = iff(privateLinkFastPath, \u0026#34;Enabled: PE FastPath\u0026#34;, \u0026#34;Disabled: PE FastPath\u0026#34;) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rFor better data path performance enable FastPath on ExpressRoute Connections\rMedium\rScalability\rNo\rNo\rDetails\rFor better data path performance enable FastPath on ExpressRoute Connections\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rf6a14b32-a727-4ace-b5fa-7b1c6bdff402\rDescription:\rExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization."},{"id":103,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/containerApps/","title":"containerApps","parent":"App","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable container health probes\rLow\rHigh Availability\rNo\rNo\rDetails\rEnable container health probes\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r8dbcd94b-0948-4df3-b608-1946726c3abf\rDescription:\rEnable container health probes to monitor the health of your container apps and ensure that unhealthy containers are restarted automatically. Potential Benefits:\rEnhanced availability and resilience\rLearn More:\rHealth probes for Azure Container Apps\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable container health probes\rLow\rHigh Availability\rNo\rNo\rDetails\rEnable container health probes\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r8dbcd94b-0948-4df3-b608-1946726c3abf\rDescription:\rEnable container health probes to monitor the health of your container apps and ensure that unhealthy containers are restarted automatically. Potential Benefits:\rEnhanced availability and resilience\rLearn More:\rHealth probes for Azure Container Apps\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":104,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/containerApps/","title":"containerApps","parent":"Web","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":105,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerInstance/containerGroups/","title":"containerGroups","parent":"ContainerInstance","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":106,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerInstance/","title":"ContainerInstance","parent":"Azure Resources","content":"","description":""},{"id":107,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerRegistry/","title":"ContainerRegistry","parent":"Azure Resources","content":"","description":""},{"id":108,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/","title":"ContainerService","parent":"Azure Resources","content":"","description":""},{"id":109,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Dashboard/","title":"Dashboard","parent":"Azure Resources","content":"","description":""},{"id":110,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/databaseAccounts/","title":"databaseAccounts","parent":"DocumentDB","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure at least two regions for high availability\rHigh\rHigh Availability\rYes\rYes\rEnable service-managed failover for multi-region accounts with single write region\rHigh\rDisaster Recovery\rYes\rYes\rEnable availability zones\rHigh\rHigh Availability\rYes\rNo\rEvaluate multi-region write capability\rHigh\rHigh Availability\rYes\rNo\rConfigure continuous backup mode\rHigh\rDisaster Recovery\rYes\rYes\rMonitor Cosmos DB health and set up alerts\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure at least two regions for high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r43663217-a1d3-844b-80ea-571a2ce37c6c\rDescription:\rEnable a secondary region in Cosmos DB for higher SLA without downtime. Simple as pinning a location on a map. For Strong consistency, configure at least three regions for write availability in case of failure. Potential Benefits:\rEnhances SLA and resilience\rLearn More:\rDistribute data globally with Azure Cosmos DB\rTips for building highly available applications\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to find Azure Cosmos DB accounts that have less than 2 regions or less than 3 regions with strong consistency level Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026lt; 2 or (array_length(properties.locations) \u0026lt; 3 and properties.consistencyPolicy.defaultConsistencyLevel == \u0026#39;Strong\u0026#39;) | project recommendationId=\u0026#39;43663217-a1d3-844b-80ea-571a2ce37c6c\u0026#39;, name, id, tags Enable service-managed failover for multi-region accounts with single write region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r9cabded7-a1fc-6e4a-944b-d7dd98ea31a2\rDescription:\rCosmos DB boasts high uptime and resiliency. Even so, issues may arise. With Service-Managed failover, if a region is down, Cosmos DB automatically switches to the next available region, requiring no user action. Potential Benefits:\rAuto failover for high uptime\rLearn More:\rManage an Azure Cosmos DB account by using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all Azure Cosmos DB accounts that do not have multiple write locations or automatic failover enabled Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026gt; 1 and tobool(properties.enableAutomaticFailover) == false and tobool(properties.enableMultipleWriteLocations) == false | project recommendationId=\u0026#39;9cabded7-a1fc-6e4a-944b-d7dd98ea31a2\u0026#39;, name, id, tags Enable availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r921631f6-ed59-49a5-94c1-f0f3ececa580\rDescription:\rWhen availability zones are configured, Azure Cosmos DB intelligently distributes the 4 replicas of your data across all available zones. It ensures that your Azure Cosmos DB can withstand an outage in one availability zone and remain fully operational throughout. Potential Benefits:\rEnhances high availability\rLearn More:\rHigh availability in Azure Cosmos DB\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to find Azure Cosmos DB accounts that do not utilize availability zones and are deployed in availability-zone supported regions Resources | where type == \u0026#34;microsoft.documentdb/databaseaccounts\u0026#34; | where properties.capabilities !has_cs \u0026#39;EnableServerless\u0026#39; | project recommendationId=\u0026#39;921631f6-ed59-49a5-94c1-f0f3ececa580\u0026#39;, name, id, tags, locations=properties.locations | mv-expand locations | where not(locations.isZoneRedundant) //filter out already AZ enabled regions | extend location=tostring(locations.locationName) | project-away locations | where location in ( \u0026#39;Australia East\u0026#39;, \u0026#39;Brazil South\u0026#39;, \u0026#39;Canada Central\u0026#39;, \u0026#39;Central India\u0026#39;, \u0026#39;Central US\u0026#39;, \u0026#39;China North 3\u0026#39;, \u0026#39;East Asia\u0026#39;, \u0026#39;East US\u0026#39;, \u0026#39;East US 2\u0026#39;, \u0026#39;France Central\u0026#39;, \u0026#39;Germany West Central\u0026#39;, \u0026#39;Israel Central\u0026#39;, \u0026#39;Italy North\u0026#39;, \u0026#39;Japan East\u0026#39;, \u0026#39;Japan West\u0026#39;, \u0026#39;Korea Central\u0026#39;, \u0026#39;Mexico Central\u0026#39;, \u0026#39;New Zealand North\u0026#39;, \u0026#39;North Europe\u0026#39;, \u0026#39;Norway East\u0026#39;, \u0026#39;Poland Central\u0026#39;, \u0026#39;Qatar Central\u0026#39;, \u0026#39;South Africa North\u0026#39;, \u0026#39;South Central US\u0026#39;, \u0026#39;Southeast Asia\u0026#39;, \u0026#39;Spain Central\u0026#39;, \u0026#39;Sweden Central\u0026#39;, \u0026#39;Switzerland North\u0026#39;, \u0026#39;UAE North\u0026#39;, \u0026#39;UK South\u0026#39;, \u0026#39;US Gov Virginia\u0026#39;, \u0026#39;West Europe\u0026#39;, \u0026#39;West US 2\u0026#39;, \u0026#39;West US 3\u0026#39;) // filter out regions unsupported for AZs | project-rename param1=location Evaluate multi-region write capability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9ce78192-74a0-104c-b5bb-9a443f941649\rDescription:\rMulti-region write capability allows for designing applications that are highly available across multiple regions, though it demands careful attention to consistency requirements and conflict resolution. Improper setup may decrease availability and cause data corruption due to unhandled conflicts. Potential Benefits:\rEnhances high availability\rLearn More:\rDistribute data globally with Azure Cosmos DB\rConflict resolution types and resolution policies in Azure Cosmos DB\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to find Azure Cosmos DB accounts that have multiple read locations but do not have multiple write locations enabled Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026gt; 1 and properties.enableMultipleWriteLocations == false | project recommendationId=\u0026#39;9ce78192-74a0-104c-b5bb-9a443f941649\u0026#39;, name, id, tags Configure continuous backup mode\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re544520b-8505-7841-9e77-1f1974ee86ec\rDescription:\rCosmos DB\u0026#39;s backup is always on, offering protection against data mishaps. Continuous mode allows for self-serve restoration to a pre-mishap point, unlike periodic mode which requires contacting Microsoft support, leading to longer restore times. Potential Benefits:\rFaster self-serve data restore\rLearn More:\rContinuous backup with point in time restore feature in Azure Cosmos DB\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query all Azure Cosmos DB accounts that do not have continuous backup mode configured Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where properties.backupPolicy.type == \u0026#39;Periodic\u0026#39; and properties.enableMultipleWriteLocations == false and properties.enableAnalyticalStorage == false | project recommendationId=\u0026#39;e544520b-8505-7841-9e77-1f1974ee86ec\u0026#39;, name, id, tags Monitor Cosmos DB health and set up alerts\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rdeaea200-013c-414b-ac9f-bfa7a7fb13f0\rDescription:\rMonitoring the availability and responsiveness of Azure Cosmos DB resources and having alerts set up for your workload is a good practice. This ensures you stay proactive in handling unforeseen events. Potential Benefits:\rProactive issue management\rLearn More:\rCreate alerts for Azure Cosmos DB using Azure Monitor\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure at least two regions for high availability\rHigh\rHigh Availability\rYes\rYes\rEnable service-managed failover for multi-region accounts with single write region\rHigh\rDisaster Recovery\rYes\rYes\rEnable availability zones\rHigh\rHigh Availability\rYes\rNo\rEvaluate multi-region write capability\rHigh\rHigh Availability\rYes\rNo\rConfigure continuous backup mode\rHigh\rDisaster Recovery\rYes\rYes\rMonitor Cosmos DB health and set up alerts\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure at least two regions for high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r43663217-a1d3-844b-80ea-571a2ce37c6c\rDescription:\rEnable a secondary region in Cosmos DB for higher SLA without downtime."},{"id":111,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBox/","title":"DataBox","parent":"Azure Resources","content":"","description":""},{"id":112,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBoxEdge/","title":"DataBoxEdge","parent":"Azure Resources","content":"","description":""},{"id":113,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBoxEdge/dataBoxEdgeDevices/","title":"dataBoxEdgeDevices","parent":"DataBoxEdge","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":114,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Databricks/","title":"Databricks","parent":"Azure Resources","content":"","description":""},{"id":115,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataFactory/","title":"DataFactory","parent":"Azure Resources","content":"","description":""},{"id":116,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeAnalytics/","title":"DataLakeAnalytics","parent":"Azure Resources","content":"","description":""},{"id":117,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataLakeStore/","title":"DataLakeStore","parent":"Azure Resources","content":"","description":""},{"id":118,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataShare/","title":"DataShare","parent":"Azure Resources","content":"","description":""},{"id":119,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMariaDB/","title":"DBforMariaDB","parent":"Azure Resources","content":"","description":""},{"id":120,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/","title":"DBforMySQL","parent":"Azure Resources","content":"","description":""},{"id":121,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/","title":"DBforPostgreSQL","parent":"Azure Resources","content":"","description":""},{"id":122,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/ddosProtectionPlans/","title":"ddosProtectionPlans","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Azure DDoS Protection Plan metrics\rMedium\rSecurity\rNo\rNo\rDetails\rMonitor Azure DDoS Protection Plan metrics\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\rae054bf2-aefa-cf4a-8282-741194cef8da\rDescription:\rAzure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded). Potential Benefits:\rEnhanced security and traffic insight\rLearn More:\rMonitoring Azure DDoS Protection\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Azure DDoS Protection Plan metrics\rMedium\rSecurity\rNo\rNo\rDetails\rMonitor Azure DDoS Protection Plan metrics\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\rae054bf2-aefa-cf4a-8282-741194cef8da\rDescription:\rAzure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded). Potential Benefits:\rEnhanced security and traffic insight\rLearn More:\rMonitoring Azure DDoS Protection\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":123,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/deployments/","title":"deployments","parent":"Resources","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":124,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/","title":"DesktopVirtualization","parent":"Azure Resources","content":"","description":""},{"id":125,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevAI/","title":"DevAI","parent":"Azure Resources","content":"","description":""},{"id":126,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevCenter/","title":"DevCenter","parent":"Azure Resources","content":"","description":""},{"id":127,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevCenter/devCenters/","title":"devCenters","parent":"DevCenter","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":128,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Devices/","title":"Devices","parent":"Azure Resources","content":"","description":""},{"id":129,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevTestLab/","title":"DevTestLab","parent":"Azure Resources","content":"","description":""},{"id":130,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/diagnosticSettings/","title":"diagnosticSettings","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":131,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/disks/","title":"disks","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rShared disks should only be enabled in clustered servers\rMedium\rOther Best Practices\rYes\rNo\rUse Azure Disks with Zone Redundant Storage for higher resiliency and availability\rMedium\rHigh Availability\rYes\rYes\rDetails\rShared disks should only be enabled in clustered servers\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r3263a64a-c256-de48-9818-afd3cbc55c2a\rDescription:\rAzure shared disks let you attach a disk to multiple VMs at once for deploying or migrating clustered applications, suitable only when a disk is shared among VM cluster members. Potential Benefits:\rEnhances clustered server performance\rLearn More:\rAzure Shared Disk Introduction\rEnable Shared Disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Disks configured to be Shared. This is not an indication of an issue, but if a disk with this configuration is assigned to two or more VMs without a proper disk control mechanism (like a WSFC) it can lead to data loss resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where isnotnull(properties.maxShares) and properties.maxShares \u0026gt;= 2 | project id, name, tags, lowerCaseDiskId = tolower(id), diskState = tostring(properties.diskState) | join kind = leftouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id) | join kind = fullouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand dataDisks = properties.storageProfile.dataDisks | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id) ) on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName) ) on lowerCaseDiskId | summarize vmNames = make_set(vmName) by name, id, tostring(tags), diskState | extend param1 = strcat(\u0026#34;DiskState: \u0026#34;, diskState), param2 = iif(isempty(vmNames[0]), \u0026#34;VMName: n/a\u0026#34;, strcat(\u0026#34;VMName: \u0026#34;, strcat_array(vmNames, \u0026#34;, \u0026#34;))) | project recommendationId = \u0026#34;3263a64a-c256-de48-9818-afd3cbc55c2a\u0026#34;, name, id, tags, param1, param2 | order by id asc Use Azure Disks with Zone Redundant Storage for higher resiliency and availability\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rfa0cf4f5-0b21-47b7-89a9-ee936f193ce1\rDescription:\rAzure disks offers a zone-redundant storage (ZRS) option for workloads that need to be resilient to an entire zone being down. Due to the cross-zone data replication, ZRS disks have higher write latency when compared to the locally-redundant option (LRS), so make sure to benchmark your disks. Potential Benefits:\rEnhanced Disk resilience to failures\rLearn More:\rRedundancy options for managed disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find eligible Disks that are not zonal nor zone redundant resources | where type == \u0026#39;microsoft.compute/disks\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where sku has \u0026#34;Premium_LRS\u0026#34; or sku has \u0026#34;StandardSSD_LRS\u0026#34; | where sku.name has_cs \u0026#39;ZRS\u0026#39; or array_length(zones) \u0026gt; 0 | project recommendationId=\u0026#34;fa0cf4f5-0b21-47b7-89a9-ee936f193ce1\u0026#34;, name, id, tags, param1 = sku, param2 = sku.name ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rShared disks should only be enabled in clustered servers\rMedium\rOther Best Practices\rYes\rNo\rUse Azure Disks with Zone Redundant Storage for higher resiliency and availability\rMedium\rHigh Availability\rYes\rYes\rDetails\rShared disks should only be enabled in clustered servers\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r3263a64a-c256-de48-9818-afd3cbc55c2a\rDescription:\rAzure shared disks let you attach a disk to multiple VMs at once for deploying or migrating clustered applications, suitable only when a disk is shared among VM cluster members."},{"id":132,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsForwardingRulesets/","title":"dnsForwardingRulesets","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":133,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsResolvers/","title":"dnsResolvers","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":134,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/dnsZones/","title":"dnsZones","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r7d09523b-b3c0-403e-b104-d5d46240d683\rDescription:\rAzure DNS allows the Time-To-Live (TTL) for record sets in the zone to be set to a value between 1 and 2147483647 seconds. You should ensure that the TTL for the DNS record sets in your DNS Zones are set appropriately to meet your RPO targets. Potential Benefits:\rEnsures that no cached DNS records exist past RPO targets\rLearn More:\rReliability in Azure DNS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r7d09523b-b3c0-403e-b104-d5d46240d683\rDescription:\rAzure DNS allows the Time-To-Live (TTL) for record sets in the zone to be set to a value between 1 and 2147483647 seconds."},{"id":135,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/","title":"DocumentDB","parent":"Azure Resources","content":"","description":""},{"id":136,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/domains/","title":"domains","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":137,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AAD/domainServices/","title":"domainServices","parent":"AAD","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse at least the Enterprise SKU\rHigh\rHigh Availability\rYes\rNo\rUse replica sets for resiliency or geolocation in Microsoft Entra Domain Services\rHigh\rHigh Availability\rYes\rNo\rDetails\rUse at least the Enterprise SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e\rDescription:\rYou need to use a minimum of Enterprise SKU for your managed domain to support replica sets. Potential Benefits:\rThe Enterprise SKU enables creation of replica sets.\rLearn More:\rCreate and use replica sets for resiliency or geolocation in Microsoft Entra Domain Services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Gets Entry Domain Services that are using the Standard SKU resources | where type == \u0026#34;microsoft.aad/domainservices\u0026#34; | extend sku = properties.sku | where sku =~ \u0026#39;Standard\u0026#39; | project recommendationId=\u0026#39;bb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e\u0026#39;, name=name, id=id, tags=tags, param1=strcat(\u0026#39;SKU:\u0026#39;, sku) Use replica sets for resiliency or geolocation in Microsoft Entra Domain Services\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra3058909-fcf8-4450-88b5-499f57449178\rDescription:\rTo improve the resiliency of a Microsoft Entra Domain Services managed domain, or deploy to additional geographic locations close to your applications, you can use replica sets. You can add a replica set to any peered virtual network in any Azure region that supports Domain Services. Potential Benefits:\rThe replica sets provide geographical resiliency.\rLearn More:\rCreate and use replica sets for resiliency or geolocation in Microsoft Entra Domain Services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Gets Entry Domain Services that are using only one replicaSet resources | where type == \u0026#34;microsoft.aad/domainservices\u0026#34; | extend replicaSets = properties.replicaSets | where array_length(replicaSets) \u0026lt; 2 | project recommendationId=\u0026#39;a3058909-fcf8-4450-88b5-499f57449178\u0026#39;, name=name, id=id, tags=tags, param1=strcat(\u0026#39;replicaSetLocation:\u0026#39;, replicaSets[0].location) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse at least the Enterprise SKU\rHigh\rHigh Availability\rYes\rNo\rUse replica sets for resiliency or geolocation in Microsoft Entra Domain Services\rHigh\rHigh Availability\rYes\rNo\rDetails\rUse at least the Enterprise SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e\rDescription:\rYou need to use a minimum of Enterprise SKU for your managed domain to support replica sets."},{"id":138,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Easm/","title":"Easm","parent":"Azure Resources","content":"","description":""},{"id":139,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/edgeSites/","title":"edgeSites","parent":"Orbital","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":140,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Elastic/","title":"Elastic","parent":"Azure Resources","content":"","description":""},{"id":141,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ElasticSan/","title":"ElasticSan","parent":"Azure Resources","content":"","description":""},{"id":142,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ElasticSan/elasticSans/","title":"elasticSans","parent":"ElasticSan","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":143,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/","title":"EventGrid","parent":"Azure Resources","content":"","description":""},{"id":144,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/","title":"EventHub","parent":"Azure Resources","content":"","description":""},{"id":145,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/eventSubscriptions/","title":"eventSubscriptions","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":146,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteCircuits/","title":"expressRouteCircuits","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rHigh\rHigh Availability\rNo\rNo\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rNo\rEnsure both connections of an ExpressRoute are configured in active-active mode\rHigh\rHigh Availability\rNo\rNo\rActivate Bidirectional Forwarding Detection on edge devices for faster failover\rHigh\rHigh Availability\rNo\rNo\rConfigure monitoring and alerting for ExpressRoute circuits\rHigh\rMonitoring and Alerting\rNo\rNo\rImplement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rMedium\rScalability\rYes\rNo\rDetails\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4d703025-dafc-f840-a183-5dc440456134\rDescription:\rConnecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails. Potential Benefits:\rEnhanced reliability and redundancy\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0e19cc41-8274-1342-b0db-0e4146eacef8\rDescription:\rMicrosoft or the ExpressRoute provider always ensures physical redundancy in their services. It\u0026#39;s essential to maintain this level of physical redundancy (two devices, two links) from the ExpressRoute peering location to your network for optimal performance and reliability. Potential Benefits:\rEnhanced reliability and fault tolerance\rLearn More:\rDesigning for high availability with ExpressRoute\rAzure Well-Architected Framework review - Azure ExpressRoute - Design Checklist\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure both connections of an ExpressRoute are configured in active-active mode\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf06a2bbe-5839-d447-9f39-fc3d20562d88\rDescription:\rOperating both connections of an ExpressRoute circuit in active-active mode enhances high availability as the Microsoft network will load balance the traffic across the connections on a per-flow basis. Potential Benefits:\rImproved high availability and load balancing\rLearn More:\rDesigning for high availability with ExpressRoute - Active-active connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Activate Bidirectional Forwarding Detection on edge devices for faster failover\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2a5bf650-586d-db4c-a292-d922be7d3e0e\rDescription:\rEnabling BFD over ExpressRoute speeds up link failure detection between MSEE devices and routers configured for ExpressRoute (CE/PE), applicable over both customer and Partner Edge routing devices with managed Layer 3 service. Potential Benefits:\rFaster link failure detection\rLearn More:\rConfigure BFD over ExpressRoute\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure monitoring and alerting for ExpressRoute circuits\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r9771a435-d031-814e-9827-9b5fdafc0f87\rDescription:\rUse Network Insights for monitoring ExpressRoute circuit availability, QoS, and throughput. Set alerts based on Azure Monitor Baseline Alerts for availability, QoS metrics, and throughput metrics exceeding specific thresholds. Potential Benefits:\rEnhanced network performance and health\rLearn More:\rAzure Monitor Baseline Alerts - expressRouteCircuits\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Implement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rd40c769d-2f08-4980-8d8f-a386946276e6\rDescription:\rRate limiting controls traffic volume between on-premises networks and Azure via ExpressRoute Direct, applying to private or Microsoft peering. It distributes port bandwidth, ensures stability, and prevents congestion, with steps outlined for enabling on circuits. Potential Benefits:\rOptimizes network, prevents congestion\rLearn More:\rRate limiting for ExpressRoute Direct circuits (Preview)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all the ExpressRoute circuits (Direct Based) that have Direct Port Rate Limiting disabled resources | where type =~ \u0026#34;microsoft.network/expressroutecircuits\u0026#34; | where properties.expressRoutePort != \u0026#34;\u0026#34; or isnotnull(properties.expressRoutePort) | where properties.enableDirectPortRateLimit == false | project recommendationId = \u0026#34;d40c769d-2f08-4980-8d8f-a386946276e6\u0026#34;, name, id, tags, param1=strcat(\u0026#34;enableDirectPortRateLimit: \u0026#34;,properties.enableDirectPortRateLimit) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rHigh\rHigh Availability\rNo\rNo\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rNo\rEnsure both connections of an ExpressRoute are configured in active-active mode\rHigh\rHigh Availability\rNo\rNo\rActivate Bidirectional Forwarding Detection on edge devices for faster failover\rHigh\rHigh Availability\rNo\rNo\rConfigure monitoring and alerting for ExpressRoute circuits\rHigh\rMonitoring and Alerting\rNo\rNo\rImplement rate-limiting across ExpressRoute Direct Circuits to optimize network flow\rMedium\rScalability\rYes\rNo\rDetails\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4d703025-dafc-f840-a183-5dc440456134\rDescription:\rConnecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails."},{"id":147,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteCrossConnections/","title":"expressRouteCrossConnections","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":148,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteGateways/","title":"expressRouteGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect ExpressRoute gateway with circuits from diverse peering locations\rHigh\rHigh Availability\rNo\rNo\rMonitor health for ExpressRoute gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9987c813-d687-4163-a511-95f31bc5e536\rDescription:\rFor improved reliability, each ExpressRoute gateway should connect to at least two circuits, with each circuit sourced from a different peering location. This setup ensures diverse connectivity paths, enhancing resilience and minimizing service disruption risks. Potential Benefits:\rEnhanced resilience through diverse connectivity paths\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor health for ExpressRoute gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r17e8d380-e4b4-41a1-9b37-2e4df9fd5125\rDescription:\rSet up monitoring and alerts for ExpressRoute Gateway. Create alert rule for ensuring promptly response to critical events such as exceeding packets per second, exceeding BGP routes prefixes, Gateway overutilization and high frequency in route changes.\rPotential Benefits:\rDetection and mitigation to avoid disruptions.\rLearn More:\rVirtual WAN Monitoring Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect ExpressRoute gateway with circuits from diverse peering locations\rHigh\rHigh Availability\rNo\rNo\rMonitor health for ExpressRoute gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9987c813-d687-4163-a511-95f31bc5e536\rDescription:\rFor improved reliability, each ExpressRoute gateway should connect to at least two circuits, with each circuit sourced from a different peering location."},{"id":149,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRoutePorts/","title":"expressRoutePorts","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rHigh\rHigh Availability\rYes\rNo\rEnsure you do not over-subscribe an ExpressRoute Direct\rHigh\rScalability\rYes\rNo\rConfigure monitoring and alerting for ExpressRoute Ports\rHigh\rMonitoring and Alerting\rNo\rNo\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rHigh\rHigh Availability\rNo\rNo\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rNo\rEnsure both connections of an ExpressRoute are configured in active-active mode\rHigh\rHigh Availability\rNo\rNo\rDetails\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r60077378-7cb1-4b35-89bb-393884d9921d\rDescription:\rIn Azure ExpressRoute Direct, the \u0026#34;Admin State\u0026#34; indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off. Potential Benefits:\rEnsures optimal connectivity.\rLearn More:\rHow to configure ExpressRoute Direct Change Admin State of links\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Express Route Directs that do not have Admin State of both Links Enabled resources | where type == \u0026#34;microsoft.network/expressrouteports\u0026#34; | where properties[\u0026#39;links\u0026#39;][0][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;] == \u0026#34;Disabled\u0026#34; or properties[\u0026#39;links\u0026#39;][1][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;] == \u0026#34;Disabled\u0026#34; | project recommendationId = \u0026#34;60077378-7cb1-4b35-89bb-393884d9921d\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;Link1AdminState: \u0026#34;, properties[\u0026#39;links\u0026#39;][0][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;]), param2 = strcat(\u0026#34;Link2AdminState: \u0026#34;, properties[\u0026#39;links\u0026#39;][1][\u0026#39;properties\u0026#39;][\u0026#39;adminState\u0026#39;]) Ensure you do not over-subscribe an ExpressRoute Direct\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r0bee356b-7348-4799-8cab-0c71ffe13018\rDescription:\rProvisioning ExpressRoute circuits on a 10-Gbps or 100-Gbps ExpressRoute Direct resource up to 20-Gbps or 200-Gbps is possible but not recommended for resiliency. If an ExpressRoute Direct port fails, and circuits are using full capacity, the remaining port won\u0026#39;t handle the extra load. Potential Benefits:\rImproves resilience during port failures\rLearn More:\rAbout ExpressRoute Direct Circuit Sizes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Express Route Directs that are over subscribed resources | where type == \u0026#34;microsoft.network/expressrouteports\u0026#34; | where toint(properties[\u0026#39;provisionedBandwidthInGbps\u0026#39;]) \u0026gt; toint(properties[\u0026#39;bandwidthInGbps\u0026#39;]) | project recommendationId = \u0026#34;0bee356b-7348-4799-8cab-0c71ffe13018\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisionedBandwidthInGbps: \u0026#34;, properties[\u0026#39;provisionedBandwidthInGbps\u0026#39;]), param2 = strcat(\u0026#34;bandwidthInGbps: \u0026#34;, properties[\u0026#39;bandwidthInGbps\u0026#39;]) Configure monitoring and alerting for ExpressRoute Ports\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r55815823-d588-4cb7-a5b8-ae581837356e\rDescription:\rUse Network Insights for monitoring ExpressRoute Port light levels, bits per second in/out, and line protocol. Set alerts based on Azure Monitor Baseline Alerts for light levels, bits per second in/out, and line protocol exceeding specific thresholds. Potential Benefits:\rEnhanced network performance and health\rLearn More:\rAzure Monitor Baseline Alerts - expressRoutePorts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rcce3353a-f409-4559-9959-0ca0e3717114\rDescription:\rEnsure resilient connectivity by connecting on-premises networks to Azure through multiple ExpressRoutes, each originating from distinct peering locations, to provide alternate data paths in case of a peering location failure. Potential Benefits:\rEnhanced reliability and redundancy\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r222fbb78-be76-4855-a14f-a5e17ef1ccf5\rDescription:\rMicrosoft or the ExpressRoute provider always ensures physical redundancy in their services. It\u0026#39;s essential to maintain this level of physical redundancy (two devices, two links) from the ExpressRoute peering location to your network for optimal performance and reliability. Potential Benefits:\rEnhanced reliability and fault tolerance\rLearn More:\rDesigning for high availability with ExpressRoute\rAzure Well-Architected Framework review - Azure ExpressRoute - Design Checklist\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure both connections of an ExpressRoute are configured in active-active mode\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r859886df-3996-4eab-8439-c1a38c416e0e\rDescription:\rOperating both connections of an ExpressRoute circuit in active-active mode enhances high availability as the Microsoft network will load balance the traffic across the connections on a per-flow basis. Potential Benefits:\rImproved high availability and load balancing\rLearn More:\rDesigning for high availability with ExpressRoute - Active-active connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rHigh\rHigh Availability\rYes\rNo\rEnsure you do not over-subscribe an ExpressRoute Direct\rHigh\rScalability\rYes\rNo\rConfigure monitoring and alerting for ExpressRoute Ports\rHigh\rMonitoring and Alerting\rNo\rNo\rConnect on-prem networks to Azure critical workloads via multiple ExpressRoutes peering locations\rHigh\rHigh Availability\rNo\rNo\rEnsure ExpressRoute\u0026#39;s physical links connect to distinct network edge devices\rHigh\rHigh Availability\rNo\rNo\rEnsure both connections of an ExpressRoute are configured in active-active mode\rHigh\rHigh Availability\rNo\rNo\rDetails\rThe Admin State of both Links of an ExpressRoute Direct should be in Enabled state\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r60077378-7cb1-4b35-89bb-393884d9921d\rDescription:\rIn Azure ExpressRoute Direct, the \u0026#34;Admin State\u0026#34; indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off."},{"id":150,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/expressRouteProviderPorts/","title":"expressRouteProviderPorts","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":151,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Fabric/","title":"Fabric","parent":"Azure Resources","content":"","description":""},{"id":152,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataFactory/factories/","title":"factories","parent":"DataFactory","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":153,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/firewallPolicies/","title":"firewallPolicies","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":154,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/fleets/","title":"fleets","parent":"ContainerService","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":155,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/flexibleServers/","title":"flexibleServers","parent":"DBforMySQL","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rNo\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rNo\rConfigure geo redundant backup storage\rHigh\rDisaster Recovery\rYes\rNo\rConfigure one or more read replicas\rHigh\rDisaster Recovery\rYes\rNo\rConfigure storage auto-grow\rHigh\rScalability\rYes\rNo\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r88856605-53d8-4bbd-a75b-4a7b14939d32\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rHigh availability concepts in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;88856605-53d8-4bbd-a75b-4a7b14939d32\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; Enable custom maintenance schedule\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r82a9a0f2-24ee-496f-9ad2-25f81710942d\rDescription:\rUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied. Potential Benefits:\rControl update timings\rLearn More:\rScheduled maintenance in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that do not have a custom maintenance window resources | where type =~ \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;82a9a0f2-24ee-496f-9ad2-25f81710942d\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;]) Configure geo redundant backup storage\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r5c96afc3-7d2e-46ff-a4c7-9c32850c441b\rDescription:\rConfigure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters. Potential Benefits:\rRecover from regional failure and/or disaster\rLearn More:\rBackup and restore in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that do not have geo redundant backup storage enabled resources | where type =~ \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.backup.geoRedundantBackup != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;5c96afc3-7d2e-46ff-a4c7-9c32850c441b\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;geoRedundantBackup:\u0026#34;, properties[\u0026#39;backup\u0026#39;][\u0026#39;geoRedundantBackup\u0026#39;]) Configure one or more read replicas\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rb49a8653-cc43-48c9-8513-a2d2e3f14dd1\rDescription:\rConfigure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters. Potential Benefits:\rRecover from regional failure and/or disaster\rLearn More:\rRead replicas in Azure Database for MySQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that do not have a read replica configured resources | where type =~ \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.replicationRole == \u0026#34;None\u0026#34; | project recommendationId = \u0026#34;b49a8653-cc43-48c9-8513-a2d2e3f14dd1\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;replicationRole:\u0026#34;, properties[\u0026#39;replicationRole\u0026#39;]) Configure storage auto-grow\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r8176a79d-8645-4e52-96be-a10fc0204fe5\rDescription:\rConfigure storage auto-grow to prevent the server from running out of storage and becoming read-only. Potential Benefits:\rScale storage automatically to meet increasing demand\rLearn More:\rAzure Database for MySQL - Flexible Server service tiers - Storage auto grow\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for MySQL instances that do not have a storage auto-grow resources | where type =~ \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.storage.autoGrow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;8176a79d-8645-4e52-96be-a10fc0204fe5\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;autoGrow:\u0026#34;, properties[\u0026#39;storage\u0026#39;][\u0026#39;autoGrow\u0026#39;]) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rNo\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rNo\rConfigure geo redundant backup storage\rHigh\rDisaster Recovery\rYes\rNo\rConfigure one or more read replicas\rHigh\rDisaster Recovery\rYes\rNo\rConfigure storage auto-grow\rHigh\rScalability\rYes\rNo\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r88856605-53d8-4bbd-a75b-4a7b14939d32\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery."},{"id":156,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/flexibleServers/","title":"flexibleServers","parent":"DBforPostgreSQL","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rNo\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rNo\rConfigure geo redundant backup storage\rHigh\rDisaster Recovery\rYes\rNo\rConfigure one or more read replicas\rHigh\rDisaster Recovery\rYes\rNo\rConfigure storage auto-grow\rHigh\rScalability\rNo\rNo\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rca87914f-aac4-4783-ab67-82a6f936f194\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery. Potential Benefits:\rEnhanced uptime and data protection\rLearn More:\rOverview of high availability with Azure Database for PostgreSQL\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;ca87914f-aac4-4783-ab67-82a6f936f194\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; Enable custom maintenance schedule\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rb2bad57d-7e03-4c0f-9024-597c9eb295bb\rDescription:\rUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied. Potential Benefits:\rControl update timings\rLearn More:\rScheduled maintenance in Azure Database for PostgreSQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that do not have a custom maintenance window resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;b2bad57d-7e03-4c0f-9024-597c9eb295bb\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;]) Configure geo redundant backup storage\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r31f4ac4b-29cb-4588-8de2-d8fe6f13ceb3\rDescription:\rConfigure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters. Potential Benefits:\rRecover from regional failure and/or disaster\rLearn More:\rBackup and restore in Azure Database for PostgreSQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that do not have geo redundant backup storage configured resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.backup.geoRedundantBackup != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;31f4ac4b-29cb-4588-8de2-d8fe6f13ceb3\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;geoRedundantBackup:\u0026#34;, properties[\u0026#39;backup\u0026#39;][\u0026#39;geoRedundantBackup\u0026#39;]) Configure one or more read replicas\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r2ab85a67-26be-4ed2-a0bb-101b2513ec63\rDescription:\rConfigure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters. Potential Benefits:\rRecover from regional failure and/or disaster\rLearn More:\rRead replicas in Azure Database for PostgreSQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Database for PostgreSQL instances that do not have read replicas resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; and properties.replicationRole == \u0026#34;AsyncReplica\u0026#34; | project replicaServerId = id, id = tostring(properties.sourceServerResourceId) | join kind=fullouter (resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; and properties.replicationRole != \u0026#34;AsyncReplica\u0026#34;) on id | where isempty(replicaServerId) | project recommendationId = \u0026#34;2ab85a67-26be-4ed2-a0bb-101b2513ec63\u0026#34;, name, id = id1, tags, param1 = strcat(\u0026#34;replicationRole:\u0026#34;, properties[\u0026#39;replicationRole\u0026#39;]) Configure storage auto-grow\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r6293a3cc-6b4a-4c0f-9ea7-b8ae8d7dd3d5\rDescription:\rConfigure storage auto-grow to prevent the server from running out of storage and becoming read-only. Potential Benefits:\rScale storage automatically to meet increasing demand\rLearn More:\rStorage autogrow using Azure portal in Azure Database for PostgreSQL - Flexible Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable HA with zone redundancy\rHigh\rHigh Availability\rYes\rNo\rEnable custom maintenance schedule\rHigh\rScalability\rYes\rNo\rConfigure geo redundant backup storage\rHigh\rDisaster Recovery\rYes\rNo\rConfigure one or more read replicas\rHigh\rDisaster Recovery\rYes\rNo\rConfigure storage auto-grow\rHigh\rScalability\rNo\rNo\rDetails\rEnable HA with zone redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rca87914f-aac4-4783-ab67-82a6f936f194\rDescription:\rEnable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery."},{"id":157,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FluidRelay/","title":"FluidRelay","parent":"Azure Resources","content":"","description":""},{"id":158,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FluidRelay/fluidRelayServers/","title":"fluidRelayServers","parent":"FluidRelay","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":159,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/frontDoors/","title":"frontDoors","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":160,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/frontDoorWebApplicationFirewallPolicies/","title":"frontDoorWebApplicationFirewallPolicies","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Web Application Firewall\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor Web Application Firewall\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r5357ae22-0f52-1a49-9fd4-1f00ace6add0\rDescription:\rMonitoring the health of your Web Application Firewall and the applications it protects is crucial. This can be achieved through integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs, ensuring optimal performance and security. Potential Benefits:\rEnhanced security and health insight\rLearn More:\rWAF monitoring\rAzure Monitor Workbook for WAF\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Web Application Firewall\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor Web Application Firewall\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r5357ae22-0f52-1a49-9fd4-1f00ace6add0\rDescription:\rMonitoring the health of your Web Application Firewall and the applications it protects is crucial. This can be achieved through integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs, ensuring optimal performance and security."},{"id":161,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/FullPath/","title":"FullPath","parent":"Azure Resources","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":162,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/galleries/","title":"galleries","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rA minimum of three replicas should be kept for production image versions\rMedium\rHigh Availability\rYes\rNo\rZone redundant storage should be used for image versions\rMedium\rHigh Availability\rYes\rNo\rCreate Image Versions replicas in secondary region\rMedium\rDisaster Recovery\rNo\rNo\rConfigure Image version replica count per region.\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rA minimum of three replicas should be kept for production image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb49a39fd-f431-4b61-9062-f2157849d845\rDescription:\rKeeping a minimum of 3 replicas for production images in Azure\u0026#39;s Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas. This reduces the risk of overloading a single replica. Potential Benefits:\rEnhances scalability and avoids throttling\rLearn More:\rCompute Gallery best practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all image versions,its associated image name and version replica configurations per region in a compute gallery whose version replicas is less than 3 resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | mv-expand VersionReplicas = properties.publishingProfile.targetRegions | project RecommendationId=\u0026#34;b49a39fd-f431-4b61-9062-f2157849d845\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;VersionReplicaRegionName: \u0026#34;,VersionReplicas.name),param4=strcat(\u0026#34;VersionReplicationCount: \u0026#34;,VersionReplicas.regionalReplicaCount),rc=toint(VersionReplicas.regionalReplicaCount) | where rc \u0026lt; 3 | project-away rc Zone redundant storage should be used for image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r488dcc8b-f2e3-40ce-bf95-73deb2db095f\rDescription:\rUse ZRS for high availability when creating image/VM versions in Azure Compute Gallery, offering resilience against Availability Zone failures. ZRS accounts are advisable in regions with Availability Zones, with the choice of Standard_ZRS recommended over Standard_LRS for these regions. Potential Benefits:\rEnhances image version availability\rLearn More:\rCompute Gallery best practices\rZone-redundant storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Query to list all image versions and its associated image and gallery name whose Storage account type is not using ZRS resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | extend StorageAccountType = tostring(properties.publishingProfile.storageAccountType) | where StorageAccountType !has \u0026#34;ZRS\u0026#34; | project RecommendationId=\u0026#34;488dcc8b-f2e3-40ce-bf95-73deb2db095f\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;StorageAccountType: \u0026#34;,StorageAccountType) Create Image Versions replicas in secondary region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rb14ee8ed-7d27-447b-b6fb-6472cb5f4b75\rDescription:\rOn multi-region deployments, replicate Image Versions to a secondary region to ensure disaster recovery capability. This ensures that the Image Versions are available in the secondary region in case of a disaster in the primary region. Potential Benefits:\rEnhances disaster recovery capability\rLearn More:\rCompute Gallery Replication\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure Image version replica count per region.\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rb3c3ba1d-7de6-442d-8c50-023330fbf765\rDescription:\rYou can set a different replica count in each target region, based on the scale needs for the region. For every 20 VMs that you create concurrently, we recommend you keep one replica. Potential Benefits:\rEnhances disaster recovery capability\rLearn More:\rCompute Gallery Scaling\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rA minimum of three replicas should be kept for production image versions\rMedium\rHigh Availability\rYes\rNo\rZone redundant storage should be used for image versions\rMedium\rHigh Availability\rYes\rNo\rCreate Image Versions replicas in secondary region\rMedium\rDisaster Recovery\rNo\rNo\rConfigure Image version replica count per region.\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rA minimum of three replicas should be kept for production image versions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb49a39fd-f431-4b61-9062-f2157849d845\rDescription:\rKeeping a minimum of 3 replicas for production images in Azure\u0026#39;s Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas."},{"id":163,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/gateways/","title":"gateways","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":164,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/globalCommunicationsSites/","title":"globalCommunicationsSites","parent":"Orbital","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":165,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Dashboard/grafana/","title":"grafana","parent":"Dashboard","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy in Managed Grafana\rMedium\rHigh Availability\rYes\rNo\rDetails\rEnable zone redundancy in Managed Grafana\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6cd57b65-ef84-4088-9ada-c0d8de74c2f7\rDescription:\rManaged Grafana Standard tier is hosted on a dedicated set of VMs to provide redundancy. With zone redundancy enabled, VMs are spread across availability zones (AZ). Related resources are also configured for AZ. Zone redundancy can only be enabled when creating the Azure Managed Grafana instance. Potential Benefits:\rEnhanced Managed Grafana resilience to failures\rLearn More:\rAzure Managed Grafana service reliability\rEnable zone redundancy in Azure Managed Grafana\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Managed Grafana resources that do not zone redundancy enabled. resources | where type =~ \u0026#34;Microsoft.Dashboard/grafana\u0026#34; | extend zoneRedundancy = properties.zoneRedundancy | where zoneRedundancy !~ \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;6cd57b65-ef84-4088-9ada-c0d8de74c2f7\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;location: \u0026#34;, location), param2 = strcat(\u0026#34;sku: \u0026#34;, sku.name), param3 = strcat(\u0026#34;zoneRedundancy: \u0026#34;, zoneRedundancy) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy in Managed Grafana\rMedium\rHigh Availability\rYes\rNo\rDetails\rEnable zone redundancy in Managed Grafana\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6cd57b65-ef84-4088-9ada-c0d8de74c2f7\rDescription:\rManaged Grafana Standard tier is hosted on a dedicated set of VMs to provide redundancy. With zone redundancy enabled, VMs are spread across availability zones (AZ). Related resources are also configured for AZ. Zone redundancy can only be enabled when creating the Azure Managed Grafana instance."},{"id":166,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/groundStations/","title":"groundStations","parent":"Orbital","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":167,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HanaOnAzure/hanaInstances/","title":"hanaInstances","parent":"HanaOnAzure","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":168,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HanaOnAzure/","title":"HanaOnAzure","parent":"Azure Resources","content":"","description":""},{"id":169,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HardwareSecurityModules/","title":"HardwareSecurityModules","parent":"Azure Resources","content":"","description":""},{"id":170,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HDInsight/","title":"HDInsight","parent":"Azure Resources","content":"","description":""},{"id":171,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthBot/","title":"HealthBot","parent":"Azure Resources","content":"","description":""},{"id":172,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthBot/healthBots/","title":"healthBots","parent":"HealthBot","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":173,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/","title":"HealthcareApis","parent":"Azure Resources","content":"","description":""},{"id":174,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/hostGroups/","title":"hostGroups","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":175,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/hostingEnvironments/","title":"hostingEnvironments","parent":"Web","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":176,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/hostPools/","title":"hostPools","parent":"DesktopVirtualization","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rCreate a validation host pool\rMedium\rGovernance\rNo\rNo\rConfigure host pool scheduled agent updates\rMedium\rGovernance\rNo\rNo\rEnsure a unique OU is used when deploying host pools with domain joined session hosts\rMedium\rGovernance\rNo\rNo\rDetails\rCreate a validation host pool\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r013ac34e-7c4b-425f-9e0c-216f0cc06181\rDescription:\rValidation host pools let you monitor service updates before the service applies them to your standard or non-validation environment. Potential Benefits:\rEnhanced environment stability\rLearn More:\rConfigure a host pool as a validation environment\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure host pool scheduled agent updates\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7\rDescription:\rCreate up to two maintenance windows for the Azure Virtual Desktop agent, side-by-side stack, and Geneva Monitoring agent to get updated so that updates don\u0026#39;t happen during peak business hours. Potential Benefits:\rEnhanced environment stability\rLearn More:\rScheduled Agent Updates for Azure Virtual Desktop host pools\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all AVD host pools that does not have scheduled agent updates configured resources | where type =~ \u0026#34;Microsoft.DesktopVirtualization/hostpools\u0026#34; | where isnull(properties.agentUpdate) | project recommendationId = \u0026#34;979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7\u0026#34;, name, id, tags, param1 = \u0026#39;No scheduled agent updates\u0026#39; Ensure a unique OU is used when deploying host pools with domain joined session hosts\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r939cb85c-102a-4e0a-ab82-5c92116d3778\rDescription:\rPlace domain joined session hosts VMs in unique OUs. Segregate Prod and DR units for environment-specific settings. This ensures targeted configurations for session hosts, including FSLogix, session controls, etc. Potential Benefits:\rImproved AVD hostpool config \u0026amp; segmentation\rLearn More:\rConfigure the VMs and install Active Directory Domain Services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rCreate a validation host pool\rMedium\rGovernance\rNo\rNo\rConfigure host pool scheduled agent updates\rMedium\rGovernance\rNo\rNo\rEnsure a unique OU is used when deploying host pools with domain joined session hosts\rMedium\rGovernance\rNo\rNo\rDetails\rCreate a validation host pool\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r013ac34e-7c4b-425f-9e0c-216f0cc06181\rDescription:\rValidation host pools let you monitor service updates before the service applies them to your standard or non-validation environment."},{"id":177,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/images/","title":"images","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":178,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VirtualMachineImages/imageTemplates/","title":"imageTemplates","parent":"VirtualMachineImages","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Generation 2 virtual machine source image\rLow\rHigh Availability\rNo\rNo\rReplicate your Image Templates to a secondary region\rLow\rDisaster Recovery\rYes\rNo\rDetails\rUse Generation 2 virtual machine source image\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r19b6df57-f6b5-3e4f-843a-273daa087cb0\rDescription:\rWhen building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports \u0026gt;2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1\u0026#39;s BIOS-based architecture. Potential Benefits:\rMore memory, supports \u0026gt;2TB disks, faster boot\rLearn More:\rGeneration 1 vs generation 2 virtual machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Replicate your Image Templates to a secondary region\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r21fb841b-ba70-1f4e-a460-1f72fb41aa51\rDescription:\rThe Azure Image Builder service lacks availability zones support. Replicating Image Templates to a secondary region will enable the build of new images in secondary region. Potential Benefits:\rEnhances disaster recovery capability\rLearn More:\rImage Template resiliency\rAzure Image Builder Supported Regions\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List all Image Templates that are not replicated to another region resources | where type =~ \u0026#34;microsoft.virtualmachineimages/imagetemplates\u0026#34; | mv-expand distribution=properties.distribute | where array_length(parse_json(distribution).replicationRegions) == 1 | project recommendationId = \u0026#34;21fb841b-ba70-1f4e-a460-1f72fb41aa51\u0026#34;, name, id, param1=strcat(\u0026#34;replicationRegions:\u0026#34;,parse_json(distribution).replicationRegions) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Generation 2 virtual machine source image\rLow\rHigh Availability\rNo\rNo\rReplicate your Image Templates to a secondary region\rLow\rDisaster Recovery\rYes\rNo\rDetails\rUse Generation 2 virtual machine source image\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r19b6df57-f6b5-3e4f-843a-273daa087cb0\rDescription:\rWhen building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports \u0026gt;2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1\u0026#39;s BIOS-based architecture."},{"id":179,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/insights/","title":"insights","parent":"Monitor","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":180,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/","title":"Insights","parent":"Azure Resources","content":"","description":""},{"id":181,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/instancePools/","title":"instancePools","parent":"Sql","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":182,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevAI/instances/","title":"instances","parent":"DevAI","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":183,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/integrationServiceEnvironments/","title":"integrationServiceEnvironments","parent":"Logic","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":184,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/IntegrationSpaces/","title":"IntegrationSpaces","parent":"Azure Resources","content":"","description":""},{"id":185,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Devices/iotHubs/","title":"iotHubs","parent":"Devices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDevice Identities are exported to a secondary region\rHigh\rDisaster Recovery\rNo\rNo\rDo not use free tier\rHigh\rHigh Availability\rYes\rNo\rUse Availability Zones\rHigh\rHigh Availability\rNo\rNo\rUse Device Provisioning Service\rHigh\rScalability\rYes\rNo\rDefine Failover Guidelines\rHigh\rHigh Availability\rNo\rNo\rDisabled Fallback Route\rLow\rMonitoring and Alerting\rYes\rNo\rDetails\rDevice Identities are exported to a secondary region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r783c6c18-760b-4867-9ced-3010a0bc5aa3\rDescription:\rDevice Identities should be copied to the failover region IoT Hub for all IoT devices to ensure connectivity in case of a failover. Manual Failover to another region is quicker (RTO), suitable for mission critical workloads. Potential Benefits:\rFaster failover; Ensures device connectivity\rLearn More:\rImport and export IoT Hub device identities in bulk\rIoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Do not use free tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\reeba3a49-fef0-481f-a471-7ff01139b474\rDescription:\rIn a production scenario, the IoT Hub tier should not be Free because the Free tier does not provide the necessary Service Level Agreement. Potential Benefits:\rEnsures SLA for production\rLearn More:\rChoose the right IoT Hub tier and size for your solution\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that are using the Free tier resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; and tostring(sku.tier) =~ \u0026#39;Free\u0026#39; | project recommendationId=\u0026#34;eeba3a49-fef0-481f-a471-7ff01139b474\u0026#34;, name, id, tags, param1=strcat(\u0026#34;tier:\u0026#34;, tostring(sku.tier)) Use Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r214cbc46-747e-4354-af6e-6bf0054196a5\rDescription:\rIn regions supporting Availability Zones for IoT Hub, using these zones boosts availability. They\u0026#39;re automatically activated for new IoT Hubs in supported areas. Potential Benefits:\rBoosts IoT Hub availability\rLearn More:\rAzure IoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Device Provisioning Service\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rb1e1378d-4572-4414-bebd-b8872a6d4d1c\rDescription:\rDevice Provisioning Service (DPS) enables easy redistribution of IoT devices for scaling and availability, allowing devices to be reassigned and not bound to specific IoT Hub instances. Devices in IoT Hubs using DPS should be verified for DPS utilization. Potential Benefits:\rEnhances scalability and availability\rLearn More:\rIoT Hub Device Provisioning Service (DPS) terminology\rBest practices for large-scale IoT device deployments\rIoT Hub Device Provisioning Service high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that do not have a linked IoT Hub Device Provisioning Service (DPS) resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; | project id, iotHubName=tostring(properties.hostName), tags, resourceGroup | join kind=fullouter ( resources | where type == \u0026#34;microsoft.devices/provisioningservices\u0026#34; | mv-expand iotHubs=properties.iotHubs | project iotHubName = tostring(iotHubs.name), dpsName = name, name=iotHubs.name ) on iotHubName | where dpsName == \u0026#39;\u0026#39; | project recommendationId=\u0026#34;b1e1378d-4572-4414-bebd-b8872a6d4d1c\u0026#34;, name=iotHubName, id, tags, param1=\u0026#39;DPS:none\u0026#39; Define Failover Guidelines\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r02568a5d-335e-4e51-9f7c-fe2ada977300\rDescription:\rIn case of a regional failure, an IoT Hub can failover to a second region, automatically or manually, to ensure your application continues working. Potential Benefits:\rEnsures business continuity\rLearn More:\rIoT Hub high availability and disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Disabled Fallback Route\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\re7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e\rDescription:\rUsing message routing for custom endpoints in IoT Hub, messages might not reach these destinations if specific conditions are unmet. A default route ensures all messages are received, but disabling this safety net risks leaving some messages undelivered. Potential Benefits:\rPrevents undelivered messages\rLearn More:\rUse message routing - Fallback route\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // list all IoT Hubs that have the fallback route disabled resources | where type == \u0026#34;microsoft.devices/iothubs\u0026#34; | extend fallbackEnabled=properties.routing.fallbackRoute.isEnabled | where fallbackEnabled == false | project recommendationId=\u0026#34;e7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e\u0026#34;, name, id, tags, param1=\u0026#39;FallbackRouteEnabled:false\u0026#39; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDevice Identities are exported to a secondary region\rHigh\rDisaster Recovery\rNo\rNo\rDo not use free tier\rHigh\rHigh Availability\rYes\rNo\rUse Availability Zones\rHigh\rHigh Availability\rNo\rNo\rUse Device Provisioning Service\rHigh\rScalability\rYes\rNo\rDefine Failover Guidelines\rHigh\rHigh Availability\rNo\rNo\rDisabled Fallback Route\rLow\rMonitoring and Alerting\rYes\rNo\rDetails\rDevice Identities are exported to a secondary region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r783c6c18-760b-4867-9ced-3010a0bc5aa3\rDescription:\rDevice Identities should be copied to the failover region IoT Hub for all IoT devices to ensure connectivity in case of a failover."},{"id":186,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DataBox/jobs/","title":"jobs","parent":"DataBox","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":187,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/","title":"KeyVault","parent":"Azure Resources","content":"","description":""},{"id":188,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/kubernetesClusters/","title":"kubernetesClusters","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":189,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Kusto/","title":"Kusto","parent":"Azure Resources","content":"","description":""},{"id":190,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/l2Connections/","title":"l2Connections","parent":"Orbital","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":191,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/l3Networks/","title":"l3Networks","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":192,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DevTestLab/labs/","title":"labs","parent":"DevTestLab","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":193,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/loadBalancers/","title":"loadBalancers","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Standard Load Balancer SKU\rHigh\rHigh Availability\rYes\rNo\rEnsure the Backend Pool contains at least two instances\rHigh\rHigh Availability\rYes\rNo\rUse NAT Gateway instead of Outbound Rules for Production Workloads\rMedium\rHigh Availability\rYes\rNo\rEnsure Standard Load Balancer is zone-redundant\rHigh\rHigh Availability\rYes\rNo\rUse Health Probes to detect backend instances availability\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rUse Standard Load Balancer SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r38c3bca1-97a1-eb42-8cd3-838b243f35ba\rDescription:\rSelecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures. Unlike Basic, it supports global load balancing and offers an SLA. Potential Benefits:\rEnhanced reliability and SLA support\rLearn More:\rReliability and Azure Load Balancer\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers using Basic SKU resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | where sku.name == \u0026#39;Basic\u0026#39; | project recommendationId = \u0026#34;38c3bca1-97a1-eb42-8cd3-838b243f35ba\u0026#34;, name, id, tags, Param1=strcat(\u0026#34;sku-tier: basic\u0026#34;) Ensure the Backend Pool contains at least two instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6d82d042-6d61-ad49-86f0-6a5455398081\rDescription:\rDeploying Azure Load Balancers with at least two instances in the backend prevents a single point of failure and supports scalability. Pairing with Virtual Machine Scale Sets is advised for optimal scale building. Potential Benefits:\rEnhances reliability and scalability\rLearn More:\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers which only have 1 backend pool defined or only 1 VM in the backend pool resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend bep = properties.backendAddressPools | extend BackEndPools = array_length(bep) | where BackEndPools == 0 | project recommendationId = \u0026#34;6d82d042-6d61-ad49-86f0-6a5455398081\u0026#34;, name, id, Param1=\u0026#34;backendPools\u0026#34;, Param2=toint(0), tags | union (resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | where sku.name == \u0026#34;Standard\u0026#34; | extend bep = properties.backendAddressPools | extend BackEndPools = toint(array_length(bep)) | mv-expand bip = properties.backendAddressPools | extend BackendAddresses = array_length(bip.properties.loadBalancerBackendAddresses) | where toint(BackendAddresses) \u0026lt;= 1 | project recommendationId = \u0026#34;6d82d042-6d61-ad49-86f0-6a5455398081\u0026#34;, name, id, tags, Param1=\u0026#34;backendAddresses\u0026#34;, Param2=toint(BackendAddresses)) | union ( resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | where sku.name == \u0026#34;Basic\u0026#34; | mv-expand properties.backendAddressPools | extend backendPoolId = properties_backendAddressPools.id | project id, name, tags, tostring(backendPoolId), recommendationId = \u0026#34;6d82d042-6d61-ad49-86f0-6a5455398081\u0026#34;, Param1=\u0026#34;BackEndPools\u0026#34; | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Network/networkInterfaces\u0026#34; | mv-expand properties.ipConfigurations | mv-expand properties_ipConfigurations.properties.loadBalancerBackendAddressPools | extend backendPoolId = tostring(properties_ipConfigurations_properties_loadBalancerBackendAddressPools.id) | summarize poolMembers = count() by backendPoolId | project tostring(backendPoolId), poolMembers ) on backendPoolId | where toint(poolMembers) \u0026lt;= 1 | extend BackendAddresses = poolMembers | project id, name, tags, recommendationId, Param1=\u0026#34;backendAddresses\u0026#34;, Param2=toint(BackendAddresses)) Use NAT Gateway instead of Outbound Rules for Production Workloads\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r8d319a05-677b-944f-b9b4-ca0fb42e883c\rDescription:\rOutbound rules for Standard Public Load Balancer involve manual port allocation for backend pools, limiting scalability and risk of SNAT port exhaustion. NAT Gateway is recommended for its dynamic scaling and secure internet connectivity. Potential Benefits:\rEnhanced scalability and reliability\rLearn More:\rResiliency checklist for specific Azure services- Azure Load Balancer\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers with Outbound rules configured resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend outboundRules = array_length(properties.outboundRules) | where outboundRules \u0026gt; 0 | project recommendationId = \u0026#34;8d319a05-677b-944f-b9b4-ca0fb42e883c\u0026#34;, name, id, tags, Param1 = \u0026#34;outboundRules: \u0026gt;=1\u0026#34; Ensure Standard Load Balancer is zone-redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r621dbc78-3745-4d32-8eac-9e65b27b7512\rDescription:\rIn regions with Availability Zones, assigning a zone-redundant frontend IP to a Standard Load Balancer ensures continuous traffic distribution even if one availability zone fails, provided other healthy zones and backend instances are available to receive the traffic. Potential Benefits:\rEnhances uptime and resilience\rLearn More:\rLoad Balancer and Availability Zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all LoadBalancers with with regional or zonal public IP Addresses resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PrivateSubnetId = toupper(feIPconfigs.properties.subnet.id), PrivateIPZones = feIPconfigs.zones, PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PrivateSubnetId) | where isnull(PrivateIPZones) or array_length(PrivateIPZones) \u0026lt; 2 | project name, feConfigName, id | union (resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PIPid) | join kind=innerunique ( resources | where type == \u0026#34;microsoft.network/publicipaddresses\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend LBid = toupper(substring(properties.ipConfiguration.id, 0, indexof(properties.ipConfiguration.id, \u0026#39;/frontendIPConfigurations\u0026#39;))), InnerID = toupper(id) ) on $left.PIPid == $right.InnerID) | project recommendationId = \u0026#34;621dbc78-3745-4d32-8eac-9e65b27b7512\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Frontend IP Configuration:\u0026#34;, \u0026#34; \u0026#34;, feConfigName) Use Health Probes to detect backend instances availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\re5f5fcea-f925-4578-8599-9a391e888a60\rDescription:\rHealth probes are used by Azure Load Balancers to determine the status of backend endpoints. Using custom health probes that are aligned with vendor recommendations enhances understanding of backend availability and facilitates monitoring of backend services for any impact. Potential Benefits:\rEnsures backend uptime monitoring.\rLearn More:\rLoad Balancer Health Probe Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // List the load balancers which don\u0026#39;t have health probe configured resources | where type =~ \u0026#34;microsoft.network/loadbalancers\u0026#34; | where array_length(properties.probes) == 0 | project recommendationId=\u0026#34;e5f5fcea-f925-4578-8599-9a391e888a60\u0026#34;, name, id, tags, param1=\u0026#34;customHealthProbeUsed: false\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Standard Load Balancer SKU\rHigh\rHigh Availability\rYes\rNo\rEnsure the Backend Pool contains at least two instances\rHigh\rHigh Availability\rYes\rNo\rUse NAT Gateway instead of Outbound Rules for Production Workloads\rMedium\rHigh Availability\rYes\rNo\rEnsure Standard Load Balancer is zone-redundant\rHigh\rHigh Availability\rYes\rNo\rUse Health Probes to detect backend instances availability\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rUse Standard Load Balancer SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r38c3bca1-97a1-eb42-8cd3-838b243f35ba\rDescription:\rSelecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures."},{"id":194,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/localNetworkGateways/","title":"localNetworkGateways","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":195,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/locks/","title":"locks","parent":"Authorization","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":196,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/","title":"Logic","parent":"Azure Resources","content":"","description":""},{"id":197,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/","title":"MachineLearning","parent":"Azure Resources","content":"","description":""},{"id":198,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/","title":"MachineLearningServices","parent":"Azure Resources","content":"","description":""},{"id":199,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maintenance/","title":"Maintenance","parent":"Azure Resources","content":"","description":""},{"id":200,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maintenance/maintenanceConfigurations/","title":"maintenanceConfigurations","parent":"Maintenance","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":201,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerService/managedClusters/","title":"managedClusters","parent":"ContainerService","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy AKS cluster across availability zones\rHigh\rHigh Availability\rYes\rNo\rIsolate system and application pods\rHigh\rHigh Availability\rYes\rNo\rConfigure Azure CNI networking for dynamic allocation of IPs or use CNI overlay\rMedium\rScalability\rYes\rNo\rEnable the cluster auto-scaler on an existing cluster\rHigh\rScalability\rYes\rNo\rBack up Azure Kubernetes Service\rLow\rDisaster Recovery\rYes\rNo\rUse zone-redundant storage for persistent volumes when running multi-zone AKS\rMedium\rHigh Availability\rNo\rNo\rUpgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rHigh\rGovernance\rNo\rNo\rUpdate AKS tier to Standard or Premium\rHigh\rHigh Availability\rYes\rNo\rEnable AKS Monitoring\rHigh\rMonitoring and Alerting\rYes\rNo\rUse Ephemeral OS disks on AKS clusters\rMedium\rScalability\rYes\rNo\rEnable and remediate Azure Policies configured for AKS\rLow\rGovernance\rYes\rNo\rUse pod topology spread constraints to ensure that pods are spread across different nodes or zones\rHigh\rHigh Availability\rNo\rNo\rConfigures Pods Liveness, Readiness, and Startup Probes\rHigh\rHigh Availability\rNo\rNo\rUse deployments with multiple replicas in production applications to guarantee availability\rHigh\rHigh Availability\rNo\rNo\rConfigure system nodepool count\rHigh\rHigh Availability\rYes\rNo\rConfigure user nodepool count\rHigh\rHigh Availability\rYes\rNo\rConfigure pod disruption budgets (PDBs)\rMedium\rHigh Availability\rNo\rNo\rNodepool subnet size needs to accommodate maximum auto-scale settings\rHigh\rHigh Availability\rYes\rNo\rSubscription core quota should be increased if Node pool auto-scale settings exceed the quota\rHigh\rHigh Availability\rNo\rNo\rUse Azure Linux for Linux nodepools\rHigh\rHigh Availability\rYes\rNo\rDetails\rDeploy AKS cluster across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4f63619f-5001-439c-bacb-8de891287727\rDescription:\rAzure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures. Potential Benefits:\rEnhanced fault tolerance for AKS\rLearn More:\rAKS Availability Zones\rZone Balancing\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns AKS clusters that do not have any availability zones enabled or only use a single zone resources | where type =~ \u0026#34;Microsoft.ContainerService/managedClusters\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | project id, name, tags, location, pools = properties.agentPoolProfiles | mv-expand pool = pools | extend numOfAvailabilityZones = iif(isnull(pool.availabilityZones), 0, array_length(pool.availabilityZones)) | where numOfAvailabilityZones \u0026lt; 2 | project recommendationId = \u0026#34;4f63619f-5001-439c-bacb-8de891287727\u0026#34;, id, name, tags, param1 = strcat(\u0026#34;NodePoolName: \u0026#34;, pool.name), param2 = strcat(\u0026#34;Mode: \u0026#34;, pool.mode), param3 = strcat(\u0026#34;AvailabilityZones: \u0026#34;, iif(numOfAvailabilityZones == 0, \u0026#34;None\u0026#34;, strcat(\u0026#34;Zone \u0026#34;, strcat_array(pool.availabilityZones, \u0026#34;, \u0026#34;)))), param4 = strcat(\u0026#34;Location: \u0026#34;, location) Isolate system and application pods\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5ee083cd-6ac3-4a83-8913-9549dd36cf56\rDescription:\rAKS assigns the kubernetes.azure.com/mode: system label to nodes in system node pools signaling the preference for system pods should be scheduled there. The CriticalAddonsOnly=true:NoSchedule taint can be added to your system nodes to prohibit application pods from being scheduled on them. Potential Benefits:\rEnhanced reliability via pod isolation\rLearn More:\rSystem and user node pools\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that do not have system pods labelled with CriticalAddonsOnly resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | where agentPoolProfile.mode =~ \u0026#39;System\u0026#39; // system node pools | extend taint = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend hasCriticalAddonsTaint = agentPoolProfile.kubeletConfig has \u0026#39;CriticalAddonsOnly\u0026#39; | extend hasNodeLabel = agentPoolProfile.customNodeLabels has \u0026#39;CriticalAddonsOnly\u0026#39; | extend hasCriticalAddonsOnly = hasCriticalAddonsTaint or hasNodeLabel or isempty(taint) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where hasCriticalAddonsOnly | project recommendationId=\u0026#34;5ee083cd-6ac3-4a83-8913-9549dd36cf56\u0026#34;, id, name, tags, param1=strcat(\u0026#34;nodepoolName: \u0026#34;, nodePool) Configure Azure CNI networking for dynamic allocation of IPs or use CNI overlay\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rc22db132-399b-4e7c-995d-577a60881be8\rDescription:\rAzure CNI enhances cluster IP and network management, allowing dynamic IP allocation, scalable subnets, direct pod-VNET connectivity, and supports diverse network policies for pods and nodes with Azure Network Policies and Calico, optimizing network efficiency and security Potential Benefits:\rDynamic IP allocation, scalable subnets, direct VNET access\rLearn More:\rConfigure Azure CNI networking\rConfigure Azure CNI Overlay networking\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Check AKS Clusters using kubenet network profile resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend networkProfile = tostring (parse_json(properties.networkProfile.networkPlugin)) | where networkProfile ==\u0026#34;kubenet\u0026#34; | project recommendationId=\u0026#34;c22db132-399b-4e7c-995d-577a60881be8\u0026#34;, name, id, tags, param1=strcat(\u0026#34;networkProfile :\u0026#34;,networkProfile) Enable the cluster auto-scaler on an existing cluster\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r902c82ff-4910-4b61-942d-0d6ef7f39b67\rDescription:\rThe cluster auto-scaler in AKS adjusts node counts based on pod resource needs and available capacity, enabling scaling as per demand to prevent outages. Potential Benefits:\rOptimizes scaling and prevents outages\rLearn More:\rUse the Cluster Autoscaler on AKS\rBest practices for advanced scheduler features\rNode pool scaling considerations and best practices\rBest practices for basic scheduler features\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find AKS clusters with auto-scaling disabled Resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend autoScaling = tostring (parse_json(properties.agentPoolProfiles.[0].enableAutoScaling)) | where autoScaling == \u0026#34;false\u0026#34; | project recommendationId=\u0026#34;902c82ff-4910-4b61-942d-0d6ef7f39b67\u0026#34;, name, id, tags, param1=strcat(\u0026#34;autoScaling :\u0026#34;, autoScaling) Back up Azure Kubernetes Service\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r269a9f1a-6675-460a-831e-b05a887a8c4b\rDescription:\rAKS, popular for stateful apps needing backups, can now use Azure Backup to secure clusters and attached volumes through an installed Backup Extension, enabling backup and restore operations via a Backup Vault. Potential Benefits:\rEnsures data safety for AKS\rLearn More:\rAKS Backups\rBest Practices for AKS Backups\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find AKS clusters that do not have backup enabled resources | where type =~ \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | extend lname = tolower(name) | join kind=leftouter(recoveryservicesresources | where type =~ \u0026#39;microsoft.dataprotection/backupvaults/backupinstances\u0026#39; | extend lname = tolower(tostring(split(properties.dataSourceInfo.resourceID, \u0026#39;/\u0026#39;)[8])) | extend protectionState = properties.currentProtectionState | project lname, protectionState) on lname | where protectionState != \u0026#39;ProtectionConfigured\u0026#39; | extend param1 = iif(isnull(protectionState), \u0026#39;Protection Not Configured\u0026#39;, strcat(\u0026#39;Protection State: \u0026#39;, protectionState)) | project recommendationId = \u0026#34;269a9f1a-6675-460a-831e-b05a887a8c4b\u0026#34;, name, id, tags, param1 Use zone-redundant storage for persistent volumes when running multi-zone AKS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd3111036-355d-431b-ab49-8ddad042800b\rDescription:\rZRS ensures data replication across three zones, protecting against zonal outages. It\u0026#39;s available for Azure Disks, Container Storage, Files, and Blob by setting the SKU to ZRS in storage classes, enhancing multi-zone AKS clusters from v1.29. Potential Benefits:\rIncreases data durability and availability\rLearn More:\rAvailability zones overview\rZone-redundant storage\rZRS disks\rConvert a disk from LRS to ZRS\rEnable multi-zone storage redundancy in Azure Container Storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Upgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rb002c030-72e6-4a37-8217-1cb276c43169\rDescription:\rFrom Kubernetes 1.26, Azure Disk and Azure File in-tree drivers are deprecated in favor of CSI drivers. Existing deployments remain operational but untested; users should switch to CSI drivers for new features and SKUs. Potential Benefits:\rEnsures future compatibility\rLearn More:\rCSI Storage Drivers\rCSI Migrate in Tree Volumes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Update AKS tier to Standard or Premium\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r0611251f-e70f-4243-8ddd-cfe894bec2e7\rDescription:\rProduction AKS clusters require the Standard or Premium tier for a financially backed SLA and enhanced node scalability, as the free service lacks these features. Use the Premium tier for mission-critical workloads. Potential Benefits:\rSLA guarantee and better scalability\rLearn More:\rPricing Tiers\rAKS Baseline Architecture\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns all AKS clusters not running on the Standard tier or the Premium tier. resources | where type =~ \u0026#34;Microsoft.ContainerService/managedClusters\u0026#34; | where sku.tier !in~ (\u0026#34;Standard\u0026#34;, \u0026#34;Premium\u0026#34;) | project recommendationId = \u0026#34;0611251f-e70f-4243-8ddd-cfe894bec2e7\u0026#34;, id, name, tags, param1 = strcat(\u0026#34;skuName: \u0026#34;, sku.name), param2 = strcat(\u0026#34;skuTier: \u0026#34;, sku.tier) Enable AKS Monitoring\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rdcaf8128-94bd-4d53-9235-3a0371df6b74\rDescription:\rAzure Monitor enables real-time health and performance insights for AKS by collecting events, capturing container logs, and gathering CPU/Memory data from the Metrics API. It allows data visualization using Azure Monitor Container Insights, Prometheus, Grafana, or others. Potential Benefits:\rReal-time AKS health/performance insights\rLearn More:\rMonitor AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns AKS clusters where either Azure Monitor is not enabled and/or Container Insights is not enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend azureMonitor = tostring(parse_json(properties.azureMonitorProfile.metrics.enabled)) | extend insights = tostring(parse_json(properties.addonProfiles.omsagent.enabled)) | where isempty(azureMonitor) or isempty(insights) | project recommendationId=\u0026#34;dcaf8128-94bd-4d53-9235-3a0371df6b74\u0026#34;,id, name, tags, param1=strcat(\u0026#34;azureMonitorProfileEnabled: \u0026#34;, iff(isempty(azureMonitor), \u0026#34;false\u0026#34;, azureMonitor)), param2=strcat(\u0026#34;containerInsightsEnabled: \u0026#34;, iff(isempty(insights), \u0026#34;false\u0026#34;, insights)) Use Ephemeral OS disks on AKS clusters\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\ra7bfcc18-b0d8-4d37-81f3-8131ed8bead5\rDescription:\rEphemeral OS disks on AKS offer lower read/write latency due to local attachment, eliminating the need for replication seen with managed disks. This enhances performance and speeds up cluster operations such as scaling or upgrading due to quicker re-imaging and boot times. Potential Benefits:\rLower latency, faster re-imaging and booting\rLearn More:\rEphemeral OS disk\rConfigure an AKS cluster\rEverything you want to know about ephemeral OS disks and AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns any AKS cluster nodepools that do not have Ephemeral Disks resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend type = tostring(agentPoolProfile.osDiskType) | where type != \u0026#39;Ephemeral\u0026#39; | project recommendationId=\u0026#34;a7bfcc18-b0d8-4d37-81f3-8131ed8bead5\u0026#34;, name, id, param1=strcat(\u0026#34;osDiskType: \u0026#34;, type) Enable and remediate Azure Policies configured for AKS\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r26ebaf1f-c70d-4ebd-8641-4b60a0ce0094\rDescription:\rAzure Policies in AKS clusters help enforce governance best practices concerning security, authentication, provisioning, networking, and more, ensuring a robust and secure environment for operations. Potential Benefits:\rEnhanced AKS governance and security\rLearn More:\rAKS Baseline - Policy Management\rBuilt-in Policy Definitions for AKS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns a count of non-compliant policy items per AKS cluster PolicyResources | where type =~ \u0026#39;Microsoft.PolicyInsights/PolicyStates\u0026#39; | extend complianceState = tostring(properties.complianceState) | where complianceState == \u0026#39;NonCompliant\u0026#39; | where properties.resourceType =~ \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | extend id = tostring(properties.resourceId) | summarize count() by id | join kind=inner ( resources | where type =~ \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | project id, name ) on id | project recommendationId=\u0026#34;26ebaf1f-c70d-4ebd-8641-4b60a0ce0094\u0026#34;, id, name, param1=strcat(\u0026#34;numNonCompliantAlerts: \u0026#34;, count_) Use pod topology spread constraints to ensure that pods are spread across different nodes or zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r928fcc6f-5e9a-42d9-9bd4-260af42de2e5\rDescription:\rEnhance availability and reliability by using pod topology spread constraints to control pod distribution based on node or zone topology, ensuring pods are spread across your cluster. Potential Benefits:\rEnsures high availability and efficient use\rLearn More:\rTopology Spread Constraints\rAssign Pod Node\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configures Pods Liveness, Readiness, and Startup Probes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rcd6791b1-c60e-4b37-ac98-9897b1e6f4b8\rDescription:\rAKS kubelet controller uses liveness probes to validate containers and applications health, ensuring the system knows when to restart a container based on its health status. Potential Benefits:\rEnhances container health monitoring\rLearn More:\rConfigure probes\rAssign Pod Node\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use deployments with multiple replicas in production applications to guarantee availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbcfe71f1-ebed-49e5-a84a-193b81ad5d27\rDescription:\rConfiguring multiple replicas in Pod or Deployment manifests stabilizes the number of replica Pods, ensuring that a specified number of identical Pods are always available, thereby guaranteeing their availability. Potential Benefits:\rEnsures stable pod availability\rLearn More:\rReplica Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure system nodepool count\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r7f7ae535-a5ba-4665-b7e0-c451dbdda01f\rDescription:\rThe system node pool should be configured with a minimum node count of two to ensure critical system pods are resilient to node outages. Potential Benefits:\rEnsures pod resilience\rLearn More:\rSystem nodepools\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have system nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationId=\u0026#34;7f7ae535-a5ba-4665-b7e0-c451dbdda01f\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) Configure user nodepool count\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r005ccbbd-aeab-46ef-80bd-9bd4479412ec\rDescription:\rConfiguring the user node pool with at least two nodes is essential for applications needing high availability, ensuring they remain operational and accessible without interruption. Potential Benefits:\rEnsures high app availability\rLearn More:\rAzure Well-Architected Framework review for Azure Kubernetes Service (AKS)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have user nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints !has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationId=\u0026#34;005ccbbd-aeab-46ef-80bd-9bd4479412ec\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) Configure pod disruption budgets (PDBs)\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra08a06a0-e41a-4b99-83bb-69ce8bca54cb\rDescription:\rA Pod Disruption Budget is a Kubernetes resource configuring the minimum number or percentage of pods that should remain available during disruptions like maintenance or scaling, ensuring a minimum number of pods are always available in the cluster. Potential Benefits:\rEnsures cluster resiliency during disruptions\rLearn More:\rConfigure PDBs\rPlan availability using PDBs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Nodepool subnet size needs to accommodate maximum auto-scale settings\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re620fa98-7a40-41a0-bfc9-b4407297fb58\rDescription:\rNodepool subnets sized for max auto-scale settings enable AKS to efficiently scale out nodes, meeting increased demand while reducing resource constraints and potential service disruptions. Potential Benefits:\rEfficient scaling, reduced disruptions\rLearn More:\rAzure CNI Dynamic IP Allocation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have user nodepools with a subnetmask that does not match autoscale configured max-nodes // Subtracting the network address, broadcast address, and default 3 addresses Azure reserves within each subnet resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend nodePools = properties[\u0026#39;agentPoolProfiles\u0026#39;] | mv-expand nodePools = properties.agentPoolProfiles | where nodePools.enableAutoScaling == true | extend nodePoolName=nodePools.name, maxNodes = nodePools.maxCount, subnetId = tostring(nodePools.vnetSubnetID) | project clusterId = id, clusterName=name, nodePoolName=nodePools.name, toint(maxNodes), subnetId | join kind = leftouter ( resources | where type == \u0026#39;microsoft.network/virtualnetworks\u0026#39; | extend subnets = properties.subnets | mv-expand subnets | project id = tostring(subnets.id), addressPrefix = tostring(subnets.properties[\u0026#39;addressPrefix\u0026#39;]) | extend subnetmask = toint(substring(addressPrefix, indexof(addressPrefix, \u0026#39;/\u0026#39;)+1, string_size(addressPrefix))) | extend possibleMaxNodeCount = toint(exp2(32-subnetmask) - 5) ) on $left.subnetId == $right.id | project-away id, subnetmask | where possibleMaxNodeCount \u0026lt;= maxNodes | extend param1 = strcat(nodePoolName, \u0026#34; autoscaler upper limit: \u0026#34;, maxNodes) | extend param2 = strcat(\u0026#34;ip addresses on subnet: \u0026#34;, possibleMaxNodeCount) | project recommendationId=\u0026#34;e620fa98-7a40-41a0-bfc9-b4407297fb58\u0026#34;, name=clusterName, id=clusterId, param1, param2 Subscription core quota should be increased if Node pool auto-scale settings exceed the quota\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra01afc4c-7439-4919-b2da-3565992ea2a7\rDescription:\rNode pool settings should not exceed the subscription core quota to ensure AKS can scale out nodes efficiently, meeting increased demand while reducing resource constraints and potential service disruptions. Potential Benefits:\rReduced disruptions\rLearn More:\rAzure Quotas\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Azure Linux for Linux nodepools\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf46b0d1d-56ef-4795-b98a-f6ee00cb341a\rDescription:\rAzure Linux on AKS boosts resiliency with a native image using validated, source-built components. It\u0026#39;s lightweight, reducing the attack surface and maintenance. A Microsoft-hardened kernel, optimized for Azure, enhances stability and security for container workloads. Potential Benefits:\rReduced disruptions\rLearn More:\rAzure Linux\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Returns each AKS cluster with nodepools that have Linux nodepools not using Azure Linux resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | where agentPoolProfile.osType == \u0026#39;Linux\u0026#39; and agentPoolProfile.osSKU != \u0026#39;AzureLinux\u0026#39; | project recommendationid=\u0026#34;f46b0d1d-56ef-4795-b98a-f6ee00cb341a\u0026#34;, name, id, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, agentPoolProfile.name) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy AKS cluster across availability zones\rHigh\rHigh Availability\rYes\rNo\rIsolate system and application pods\rHigh\rHigh Availability\rYes\rNo\rConfigure Azure CNI networking for dynamic allocation of IPs or use CNI overlay\rMedium\rScalability\rYes\rNo\rEnable the cluster auto-scaler on an existing cluster\rHigh\rScalability\rYes\rNo\rBack up Azure Kubernetes Service\rLow\rDisaster Recovery\rYes\rNo\rUse zone-redundant storage for persistent volumes when running multi-zone AKS\rMedium\rHigh Availability\rNo\rNo\rUpgrade Persistent Volumes using in-tree drivers to Azure CSI drivers\rHigh\rGovernance\rNo\rNo\rUpdate AKS tier to Standard or Premium\rHigh\rHigh Availability\rYes\rNo\rEnable AKS Monitoring\rHigh\rMonitoring and Alerting\rYes\rNo\rUse Ephemeral OS disks on AKS clusters\rMedium\rScalability\rYes\rNo\rEnable and remediate Azure Policies configured for AKS\rLow\rGovernance\rYes\rNo\rUse pod topology spread constraints to ensure that pods are spread across different nodes or zones\rHigh\rHigh Availability\rNo\rNo\rConfigures Pods Liveness, Readiness, and Startup Probes\rHigh\rHigh Availability\rNo\rNo\rUse deployments with multiple replicas in production applications to guarantee availability\rHigh\rHigh Availability\rNo\rNo\rConfigure system nodepool count\rHigh\rHigh Availability\rYes\rNo\rConfigure user nodepool count\rHigh\rHigh Availability\rYes\rNo\rConfigure pod disruption budgets (PDBs)\rMedium\rHigh Availability\rNo\rNo\rNodepool subnet size needs to accommodate maximum auto-scale settings\rHigh\rHigh Availability\rYes\rNo\rSubscription core quota should be increased if Node pool auto-scale settings exceed the quota\rHigh\rHigh Availability\rNo\rNo\rUse Azure Linux for Linux nodepools\rHigh\rHigh Availability\rYes\rNo\rDetails\rDeploy AKS cluster across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4f63619f-5001-439c-bacb-8de891287727\rDescription:\rAzure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures."},{"id":202,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/managedClusters/","title":"managedClusters","parent":"ServiceFabric","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":203,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/App/managedEnvironments/","title":"managedEnvironments","parent":"App","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy zone redundant Container app environments\rHigh\rHigh Availability\rYes\rNo\rDetails\rDeploy zone redundant Container app environments\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf4201965-a88d-449d-b3b4-021394719eb2\rDescription:\rTo take advantage of availability zones, you must enable zone redundancy when you create a Container Apps environment. The environment must include a virtual network with an available subnet. To ensure proper distribution of replicas, set your app\u0026#39;s minimum replica count to three. Potential Benefits:\rEnhances app resiliency and reliability\rLearn More:\rReliability in Azure Container Apps\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // The query filters the qualified Container app environments that do not have Zone Redundancy enabled. resources | where type =~ \u0026#34;microsoft.app/managedenvironments\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where tobool(properties.zoneRedundant) == false | project recommendationId = \u0026#34;f4201965-a88d-449d-b3b4-021394719eb2\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy zone redundant Container app environments\rHigh\rHigh Availability\rYes\rNo\rDetails\rDeploy zone redundant Container app environments\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf4201965-a88d-449d-b3b4-021394719eb2\rDescription:\rTo take advantage of availability zones, you must enable zone redundancy when you create a Container Apps environment. The environment must include a virtual network with an available subnet. To ensure proper distribution of replicas, set your app\u0026#39;s minimum replica count to three."},{"id":204,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/managedHSMs/","title":"managedHSMs","parent":"KeyVault","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":205,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/managedInstances/","title":"managedInstances","parent":"Sql","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for Azure SQL Managed Instance to improve high availability and resiliency\rHigh\rHigh Availability\rYes\rNo\rUse Zone-redundant or Geo-zone-redundant Backup storage redundancy\rHigh\rDisaster Recovery\rYes\rNo\rUse Redirect connection type to accelerate application access\rMedium\rScalability\rYes\rNo\rConfigure a secondary instance and a Failover group to enable failover to another region\rHigh\rDisaster Recovery\rNo\rNo\rMonitor your Azure SQL MI Managed Instance in near-real time to detect reliability incidents\rMedium\rMonitoring and Alerting\rNo\rNo\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rEnable zone redundancy for Azure SQL Managed Instance to improve high availability and resiliency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf8f834a9-c761-4e84-b2cb-ac55494d0c37\rDescription:\rAzure SQL Managed Instance offers built-in availability by deploying multiple replicas in the same zone. For higher availability, use a zone-redundant configuration that spreads replicas across three Azure availability zones, each with independent power, cooling, and networking. Potential Benefits:\rEnhanced availability and reliability\rLearn More:\rHigh availability through zone-redundancy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Managed Instance zone redundancy check – any server that is not configured for ZR resources | where type =~ \u0026#39;Microsoft.Sql/managedInstances\u0026#39; | extend InstanceName = properties.fullyQualifiedDomainName | extend ServiceTier = sku.tier | extend zoneRedundant=properties.zoneRedundant | where zoneRedundant == \u0026#39;false\u0026#39; | project recommendationId=\u0026#39;f8f834a9-c761-4e84-b2cb-ac55494d0c37\u0026#39;, name, id, tags, param1=strcat(\u0026#39;Service Tier:\u0026#39;, ServiceTier), param2=strcat(\u0026#39;Zone Redundant:\u0026#39;, zoneRedundant) Use Zone-redundant or Geo-zone-redundant Backup storage redundancy\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r15e2712c-f3ea-4a8d-9081-11e822b1ccfb\rDescription:\rConfiguring zone redundancy option for backups copies your backup file synchronously across three Azure availability zones in the primary region. If Geo is selected, then it copies your data asynchronously three times to a single physical location in the paired secondary region. Potential Benefits:\rEnhanced availability and reliability\rLearn More:\rBackup storage redundancy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Managed Instance storage backup redundancy check – any server that is not configured for GZRS resources | where type =~ \u0026#39;Microsoft.Sql/managedInstances\u0026#39; | extend backupredundancy=properties.storageAccountType | extend ServiceTier = sku.tier | where backupredundancy != \u0026#39;GeoZone\u0026#39; | project recommendationId=\u0026#39;15e2712c-f3ea-4a8d-9081-11e822b1ccfb\u0026#39;, name, id, param1=strcat(\u0026#39;Service Tier:\u0026#39;, ServiceTier), param2=strcat(\u0026#39;Backup Redundancy:\u0026#39;, backupredundancy) Use Redirect connection type to accelerate application access\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rc14de326-2729-4be7-a91f-4ea185d24b10\rDescription:\rRedirect mode enables direct connectivity to the instance bypassing the local gateway component and resulting in improved latency and throughput. Redirect mode applies to the VNet-local endpoint only, while the public and private endpoint will always operate in Proxy connection mode. Potential Benefits:\rImproved latency and throughput\rLearn More:\rConnection types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Use Redirect connection type to accelerate application access resources | where type =~ \u0026#39;Microsoft.Sql/managedInstances\u0026#39; | extend connectionpolicy=properties.proxyOverride | where connectionpolicy != \u0026#39;Redirect\u0026#39; | project recommendationId=\u0026#39;c14de326-2729-4be7-a91f-4ea185d24b10\u0026#39;, name, id, tags, param1=strcat(\u0026#39;Connection Policy:\u0026#39;, connectionpolicy) Configure a secondary instance and a Failover group to enable failover to another region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r257cd903-700f-4a79-bd37-7dce2b511df4\rDescription:\rDuring an outage on the managed instance, use the failover group to switch all databases to a secondary region, either manually or automatically. Route connections to the failover group’s listener instead of the primary instance to avoid changing the connection string after geo-failover. Potential Benefits:\rEnsure seamless service with cross-region failover\rLearn More:\rFailover groups overview and best practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor your Azure SQL MI Managed Instance in near-real time to detect reliability incidents\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rc9afeb1e-e706-4809-be4e-75d9fac708f2\rDescription:\rMonitoring and alerting are an important part of database operations. When working with Azure SQL Managed Instance, make use of Azure Monitor and Database watcher to ensure that you capture relevant database metrics. Potential Benefits:\rQuick incident detection and response\rLearn More:\rAzure SQL Managed Instance monitoring options\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Back Up Your Keys\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r9fad5392-b852-4807-9b6d-3f700ff9771a\rDescription:\rIt is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up and stored in a secure manner. Potential Benefits:\rEnhanced security and data recovery\rLearn More:\rOverview of Always Encrypted\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for Azure SQL Managed Instance to improve high availability and resiliency\rHigh\rHigh Availability\rYes\rNo\rUse Zone-redundant or Geo-zone-redundant Backup storage redundancy\rHigh\rDisaster Recovery\rYes\rNo\rUse Redirect connection type to accelerate application access\rMedium\rScalability\rYes\rNo\rConfigure a secondary instance and a Failover group to enable failover to another region\rHigh\rDisaster Recovery\rNo\rNo\rMonitor your Azure SQL MI Managed Instance in near-real time to detect reliability incidents\rMedium\rMonitoring and Alerting\rNo\rNo\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rEnable zone redundancy for Azure SQL Managed Instance to improve high availability and resiliency\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf8f834a9-c761-4e84-b2cb-ac55494d0c37\rDescription:\rAzure SQL Managed Instance offers built-in availability by deploying multiple replicas in the same zone."},{"id":206,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/","title":"Management","parent":"Azure Resources","content":"","description":""},{"id":207,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/managementGroups/","title":"managementGroups","parent":"Management","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":208,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Maps/","title":"Maps","parent":"Azure Resources","content":"","description":""},{"id":209,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Media/","title":"Media","parent":"Azure Resources","content":"","description":""},{"id":210,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Media/mediaServices/","title":"mediaServices","parent":"Media","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":211,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/meshVpns/","title":"meshVpns","parent":"NetworkFunction","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":212,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/metricAlerts/","title":"metricAlerts","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":213,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/","title":"MixedReality","parent":"Azure Resources","content":"","description":""},{"id":214,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DocumentDB/mongoClusters/","title":"mongoClusters","parent":"DocumentDB","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":215,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Monitor/","title":"Monitor","parent":"Azure Resources","content":"","description":""},{"id":216,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Elastic/monitors/","title":"monitors","parent":"Elastic","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":217,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/namespaces/","title":"namespaces","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":218,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventHub/namespaces/","title":"namespaces","parent":"EventHub","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure zone redundancy is enabled in supported regions\rHigh\rHigh Availability\rYes\rNo\rEnable auto-inflate on Event Hub Standard tier\rHigh\rScalability\rYes\rNo\rDetails\rEnsure zone redundancy is enabled in supported regions\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r84636c6c-b317-4722-b603-7b1ffc16384b\rDescription:\rWhen using the Azure portal, zone redundancy is automatically enabled. However, some Infrastructure as Code (IaC) tools may default this to false. To ensure replication of metadata and events across data centers in an availability zone, always verify that zone redundancy is enabled. Potential Benefits:\rEnhanced fault tolerance for Event Hub\rLearn More:\rAzure Event Hubs - Geo-disaster recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Event Hub namespace instances that are not zone redundant resources | where type == \u0026#34;microsoft.eventhub/namespaces\u0026#34; | where properties.zoneRedundant == false | project recommendationId = \u0026#34;84636c6c-b317-4722-b603-7b1ffc16384b\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; | order by id asc Enable auto-inflate on Event Hub Standard tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rfbfef3df-04a5-41b2-a8fd-b8541eb04956\rDescription:\rEnable auto-inflate on Event Hub Standard tier namespaces to automatically scale up throughput units (TUs), meeting usage needs and preventing data ingress or egress throttle scenarios by adjusting to allowed rates. Potential Benefits:\rPrevents throttling by autoscaling TUs\rLearn More:\rAzure Event Hubs - Automatically scale throughput units\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Event Hub namespace instances that are Standard tier and do not have Auto Inflate enabled resources | where type == \u0026#34;microsoft.eventhub/namespaces\u0026#34; | where sku.tier == \u0026#34;Standard\u0026#34; | where properties.isAutoInflateEnabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;fbfef3df-04a5-41b2-a8fd-b8541eb04956\u0026#34;, name, id, tags, param1 = \u0026#34;AutoInflateEnabled: False\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure zone redundancy is enabled in supported regions\rHigh\rHigh Availability\rYes\rNo\rEnable auto-inflate on Event Hub Standard tier\rHigh\rScalability\rYes\rNo\rDetails\rEnsure zone redundancy is enabled in supported regions\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r84636c6c-b317-4722-b603-7b1ffc16384b\rDescription:\rWhen using the Azure portal, zone redundancy is automatically enabled. However, some Infrastructure as Code (IaC) tools may default this to false."},{"id":219,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NotificationHubs/namespaces/","title":"namespaces","parent":"NotificationHubs","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":220,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Relay/namespaces/","title":"namespaces","parent":"Relay","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":221,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceBus/namespaces/","title":"namespaces","parent":"ServiceBus","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Availability Zones for Service Bus namespaces\rHigh\rHigh Availability\rNo\rNo\rEnable auto-scale for production workloads on Service Bus namespaces\rHigh\rHigh Availability\rNo\rNo\rConfigure the minimum TLS version for Service Bus namespaces to TLS v1.2 or higher\rHigh\rService Upgrade and Retirement\rYes\rNo\rDetails\rEnable Availability Zones for Service Bus namespaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r20057905-262c-49fe-a9be-49f423afb359\rDescription:\rAvailability zones are now enabled by default on new namespaces where possible. Existing namespaces are being migrated to availability zones where possible. The property zoneRedundant might still show as false, even when availability zones has been enabled. Potential Benefits:\rEnhances fault tolerance and uptime\rLearn More:\rService Bus and reliability\rAzure Service Bus Geo-disaster recovery\rInsulate Azure Service Bus applications against outages and disasters\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable auto-scale for production workloads on Service Bus namespaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd810e3a8-600f-4be1-895b-1a93e61d37fd\rDescription:\rUse Service Bus with auto-scale for high availability. The Premium SKU supports auto-scale, ensuring that the resources are automatically scaled based on the load. Potential Benefits:\rEnsures high availability and performance\rLearn More:\rService Bus auto-scaling\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Configure the minimum TLS version for Service Bus namespaces to TLS v1.2 or higher\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rAPRL GUID:\u0026nbsp;\rf075a1bd-de9e-4819-9a1d-1ac41037a74f\rDescription:\rAs of 31 October 2024, TLS 1.0 and TLS 1.1 will no longer be supported on Azure including Service Bus to enhance security and provide best-in-class encryption for your data. Change the minimum TLS version for your Service Bus namespace to TLS v1.2 or higher. Potential Benefits:\rAvoids service disruption\rLearn More:\rAzure support for TLS 1.0 and TLS 1.1 will end by 31 October 2024\rConfigure the minimum TLS version for a Service Bus namespace\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Service Bus Namespace resources that have the lower minimum TLS version. resources | where type =~ \u0026#34;Microsoft.ServiceBus/namespaces\u0026#34; | where properties.minimumTlsVersion in (\u0026#34;1.0\u0026#34;, \u0026#34;1.1\u0026#34;) | project recommendationId = \u0026#34;f075a1bd-de9e-4819-9a1d-1ac41037a74f\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;minimumTlsVersion: \u0026#34;, properties.minimumTlsVersion) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Availability Zones for Service Bus namespaces\rHigh\rHigh Availability\rNo\rNo\rEnable auto-scale for production workloads on Service Bus namespaces\rHigh\rHigh Availability\rNo\rNo\rConfigure the minimum TLS version for Service Bus namespaces to TLS v1.2 or higher\rHigh\rService Upgrade and Retirement\rYes\rNo\rDetails\rEnable Availability Zones for Service Bus namespaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r20057905-262c-49fe-a9be-49f423afb359\rDescription:\rAvailability zones are now enabled by default on new namespaces where possible."},{"id":222,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/natGateways/","title":"natGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure monitoring and alerting for NAT gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure monitoring and alerting for NAT gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rbabf75d6-6407-4d90-b01e-5a1768e621f5\rDescription:\rUse Network Insights for monitoring and alerting on your NAT gateway.Use Total SNAT connection count metric to determine if you\u0026#39;re nearing the connection limit of NAT gateway. Set alerts based on Azure Monitor Baseline Alerts (AMBA) thresholds for NAT Gateway Potential Benefits:\rEnhanced network performance and health\rLearn More:\rWhat is Azure NAT Gateway metrics and alerts?\rAMBA - NAT Gateway\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure monitoring and alerting for NAT gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rConfigure monitoring and alerting for NAT gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rbabf75d6-6407-4d90-b01e-5a1768e621f5\rDescription:\rUse Network Insights for monitoring and alerting on your NAT gateway.Use Total SNAT connection count metric to determine if you\u0026#39;re nearing the connection limit of NAT gateway. Set alerts based on Azure Monitor Baseline Alerts (AMBA) thresholds for NAT Gateway Potential Benefits:\rEnhanced network performance and health\rLearn More:\rWhat is Azure NAT Gateway metrics and alerts?"},{"id":223,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetApp/","title":"NetApp","parent":"Azure Resources","content":"","description":""},{"id":224,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetApp/netAppAccounts/","title":"netAppAccounts","parent":"NetApp","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse standard network features for production in Azure NetApp Files\rHigh\rScalability\rYes\rNo\rUse availability zones for high availability in Azure NetApp Files\rHigh\rHigh Availability\rYes\rNo\rDeploy ANF volumes in the same availability zone with Azure compute and other services\rHigh\rOther Best Practices\rNo\rNo\rUse snapshots for data protection in Azure NetApp Files\rHigh\rHigh Availability\rYes\rNo\rEnable backup for data protection in Azure NetApp Files\rHigh\rDisaster Recovery\rYes\rNo\rEnable Cross-region replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rNo\rEnable Cross-zone replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rNo\rMonitor Azure NetApp Files metrics to better understand usage pattern and performance\rMedium\rMonitoring and Alerting\rNo\rNo\rMake use of SMB continuous availability for supported applications\rHigh\rHigh Availability\rNo\rYes\rEnsure application resilience for service maintenance events\rMedium\rHigh Availability\rNo\rNo\rDetails\rUse standard network features for production in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rab984130-c57b-6c4a-8d04-6723b4e1bdb6\rDescription:\rStandard network feature in Azure NetApp Files enhances IP limits and VNet capabilities, including network security groups, user-defined routes on subnets, and diverse connectivity options. Potential Benefits:\rEnhanced connectivity and security\rLearn More:\rGuidelines for Azure NetApp Files network planning | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without standard network features. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.networkFeatures != \u0026#34;Standard\u0026#34; | project recommendationId = \u0026#34;ab984130-c57b-6c4a-8d04-6723b4e1bdb6\u0026#34;, name, id, tags Use availability zones for high availability in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r47d100a5-7f85-5742-967a-67eb5081240a\rDescription:\rAvailability zones are distinct locations within an Azure region to withstand local failures. Deploy your workload in multiple availability zones and use application-based replication or Azure NetApp Files cross-zone replication to achieve high availability. Note that failover is a manual process. Potential Benefits:\rHigh Availability across availability zones\rLearn More:\rUse availability zones for high availability in Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without an availability zone defined. Resources | where type =~ \u0026#34;Microsoft.NetApp/netAppAccounts/capacityPools/volumes\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where array_length(zones) == 0 or isnull(zones) | project recommendationId = \u0026#34;47d100a5-7f85-5742-967a-67eb5081240a\u0026#34;, name, id, tags Deploy ANF volumes in the same availability zone with Azure compute and other services\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r8bb690e8-64d5-4838-8703-9ee3dbac688f\rDescription:\rAzure NetApp Files\u0026#39; availability zone (AZ) volume placement feature lets you deploy volumes in the same AZ with Azure compute and other services to have within AZ latency and share the same AZ failure domain. Potential Benefits:\rWithin AZ latency and tolerate failure of other AZ\rLearn More:\rManage availability zone volume placement for Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use snapshots for data protection in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r72827434-c773-4345-9493-34848ddf5803\rDescription:\rAzure NetApp Files snapshot technology ensures stability, scalability, and swift data recoverability without affecting performance. It supports automatic snapshot creation via policies for Azure NetApp Files data. Potential Benefits:\rStable, scalable, swift recovery, no perf impact\rLearn More:\rHow Azure NetApp Files snapshots work | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without a snapshot policy defined. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.dataProtection.snapshot.snapshotPolicyId == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;72827434-c773-4345-9493-34848ddf5803\u0026#34;, name, id, tags Enable backup for data protection in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rb2fb3e60-97ec-e34d-af29-b16a0d61c2ac\rDescription:\rAzure NetApp Files offers a fully managed backup solution enhancing long-term recovery, archiving, and compliance. Potential Benefits:\rEnhances data recovery and compliance\rLearn More:\rUnderstand Azure NetApp Files backup | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without a backup policy defined. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.dataProtection.backup.backupPolicyId == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;b2fb3e60-97ec-e34d-af29-b16a0d61c2ac\u0026#34;, name, id, tags Enable Cross-region replication of Azure NetApp Files volumes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re30317d2-c502-4dfe-a2d3-0a737cc79545\rDescription:\rAzure NetApp Files replication offers data protection by allowing asynchronous cross-region volume replication for application failover in case of regional outages. Volumes can be replicated across regions, not concurrently with cross-zone replication. Note that failover is a manual process. Potential Benefits:\rEnhanced data protection and disaster recovery\rLearn More:\rCross-region replication of Azure NetApp Files volumes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without cross-region replication. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend remoteVolumeRegion = properties.dataProtection.replication.remoteVolumeRegion | extend volumeType = properties.volumeType | extend replicationType = iff((remoteVolumeRegion == location), \u0026#34;CZR\u0026#34;, iff((remoteVolumeRegion == \u0026#34;\u0026#34;),\u0026#34;n/a\u0026#34;,\u0026#34;CRR\u0026#34;)) | where replicationType != \u0026#34;CRR\u0026#34; and volumeType != \u0026#34;DataProtection\u0026#34; | project recommendationId = \u0026#34;e30317d2-c502-4dfe-a2d3-0a737cc79545\u0026#34;, name, id, tags Enable Cross-zone replication of Azure NetApp Files volumes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re3d742e1-dacd-9b48-b6b1-510ec9f87c96\rDescription:\rThe cross-zone replication (CZR) feature enables asynchronous data replication between Azure NetApp Files volumes across different availability zones, ensuring data protection and critical application failover in case of zone-wide disasters. Note that failover is a manual process. Potential Benefits:\rEnhances disaster recovery across availability zones\rLearn More:\rCross-zone replication of Azure NetApp Files volumes | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Azure NetApp Files volumes without cross-zone replication. resources | where type == \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | extend remoteVolumeRegion = properties.dataProtection.replication.remoteVolumeRegion | extend volumeType = properties.volumeType | extend replicationType = iff((remoteVolumeRegion == location), \u0026#34;CZR\u0026#34;, iff((remoteVolumeRegion == \u0026#34;\u0026#34;),\u0026#34;n/a\u0026#34;,\u0026#34;CRR\u0026#34;)) | where replicationType != \u0026#34;CZR\u0026#34; and volumeType != \u0026#34;DataProtection\u0026#34; | project recommendationId = \u0026#34;e3d742e1-dacd-9b48-b6b1-510ec9f87c96\u0026#34;, name, id, tags Monitor Azure NetApp Files metrics to better understand usage pattern and performance\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r2f579fc9-e599-0d44-8b97-254f50ae04d8\rDescription:\rAzure NetApp Files offers metrics like allocated storage, actual usage, volume IOPS, and latency, enabling a better understanding of usage patterns and volume performance for NetApp accounts. Potential Benefits:\rOptimize usage and performance\rLearn More:\rWays to monitor Azure NetApp Files | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Make use of SMB continuous availability for supported applications\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd1e7ccc3-e6c1-40e9-a36e-fd134711c808\rDescription:\rCertain SMB applications need SMB Transparent Failover for maintenance without interrupting server connectivity. Azure NetApp Files provides this through SMB Continuous Availability for applications like Citrix App Layering, FSLogix user/profile containers, Microsoft SQL Server, MSIX app attach. Potential Benefits:\rZero downtime for SMB apps\rLearn More:\rDo I need to take special precautions for SMB-based applications? | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure application resilience for service maintenance events\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r60f36f9b-fac9-4160-bbf5-57af04da4f53\rDescription:\rAzure NetApp Files might undergo occasional planned maintenance such as platform updates or service and software upgrades. It\u0026#39;s important to be aware of the application\u0026#39;s resiliency settings to cope with these storage service maintenance events. Potential Benefits:\rMinimizes downtime during maintenance\rLearn More:\rWhat do you recommend for handling potential application disruptions due to storage service maintenance events? | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse standard network features for production in Azure NetApp Files\rHigh\rScalability\rYes\rNo\rUse availability zones for high availability in Azure NetApp Files\rHigh\rHigh Availability\rYes\rNo\rDeploy ANF volumes in the same availability zone with Azure compute and other services\rHigh\rOther Best Practices\rNo\rNo\rUse snapshots for data protection in Azure NetApp Files\rHigh\rHigh Availability\rYes\rNo\rEnable backup for data protection in Azure NetApp Files\rHigh\rDisaster Recovery\rYes\rNo\rEnable Cross-region replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rNo\rEnable Cross-zone replication of Azure NetApp Files volumes\rHigh\rDisaster Recovery\rYes\rNo\rMonitor Azure NetApp Files metrics to better understand usage pattern and performance\rMedium\rMonitoring and Alerting\rNo\rNo\rMake use of SMB continuous availability for supported applications\rHigh\rHigh Availability\rNo\rYes\rEnsure application resilience for service maintenance events\rMedium\rHigh Availability\rNo\rNo\rDetails\rUse standard network features for production in Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rab984130-c57b-6c4a-8d04-6723b4e1bdb6\rDescription:\rStandard network feature in Azure NetApp Files enhances IP limits and VNet capabilities, including network security groups, user-defined routes on subnets, and diverse connectivity options."},{"id":225,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/","title":"Network","parent":"Azure Resources","content":"","description":""},{"id":226,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/","title":"NetworkCloud","parent":"Azure Resources","content":"","description":""},{"id":227,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkFunction/","title":"NetworkFunction","parent":"Azure Resources","content":"","description":""},{"id":228,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkManagers/","title":"networkManagers","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":229,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/networks/","title":"networks","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":230,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkSecurityGroups/","title":"networkSecurityGroups","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Diagnostic Settings for all network security groups\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor changes in Network Security Groups with Azure Monitor\rLow\rMonitoring and Alerting\rYes\rNo\rDetails\rConfigure Diagnostic Settings for all network security groups\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rd2976d3e-294b-4b49-a1f0-c42566a3758f\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations. Potential Benefits:\rEnhanced monitoring and security insights\rLearn More:\rDiagnostic settings in Azure Monitor\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor changes in Network Security Groups with Azure Monitor\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r8bb4a57b-55e4-d24e-9c19-2679d8bc779f\rDescription:\rCreate Alerts with Azure Monitor for operations like creating or updating Network Security Group rules to catch unauthorized/undesired changes to resources and spot attempts to bypass firewalls or access resources from the outside. Potential Benefits:\rEnhanced security and change monitoring\rLearn More:\rAzure Monitor activity log\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Network Security Groups without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project name, id, tags, lowerCaseNsgId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Network Security Group (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39;) or // All administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/join/action\u0026#34;\u0026#39;) ) | project lowerCaseNsgIdOfScope = tolower(scope) ) on $left.lowerCaseNsgId == $right.lowerCaseNsgIdOfScope | where isempty(lowerCaseNsgIdOfScope) | project recommendationId = \u0026#34;8bb4a57b-55e4-d24e-9c19-2679d8bc779f\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Diagnostic Settings for all network security groups\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor changes in Network Security Groups with Azure Monitor\rLow\rMonitoring and Alerting\rYes\rNo\rDetails\rConfigure Diagnostic Settings for all network security groups\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rd2976d3e-294b-4b49-a1f0-c42566a3758f\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations."},{"id":231,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkVirtualAppliances/","title":"networkVirtualAppliances","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":232,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkVirtualApplianceSkus/","title":"networkVirtualApplianceSkus","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":233,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/networkWatchers/","title":"networkWatchers","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy Network Watcher in all regions where you have networking services\rLow\rMonitoring and Alerting\rNo\rNo\rFix Flow Log configurations in Failed state or Disabled Status\rLow\rMonitoring and Alerting\rYes\rNo\rConfigure Network Watcher Connection monitor\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable Network Security Group and Virtual Network Flow Logs\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable traffic analytics in Network Security Group and Virtual Network Flow Logs configuration.\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rDeploy Network Watcher in all regions where you have networking services\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r4e133bd0-8762-bc40-a95b-b29142427d73\rDescription:\rAzure Network Watcher offers tools for monitoring, diagnosing, viewing metrics, and managing logs for IaaS resources. It helps maintain the health of VMs, VNets, application gateways, load balancers, but not for PaaS or Web analytics. Potential Benefits:\rEnhanced monitoring and diagnostics for Azure IaaS\rLearn More:\rWhat is Azure Network Watcher?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Fix Flow Log configurations in Failed state or Disabled Status\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r22a769ed-0ecb-8b49-bafe-8f52e6373d9c\rDescription:\rNetwork security group flow logging is a feature of Azure Network Watcher that logs IP traffic info through a network security group. If in Failed state, monitoring data from the associated resource is not collected. Potential Benefits:\rEnsures IP traffic logging\rLearn More:\rManage NSG flow logs using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Network Watcher Flow Logs that are not enabled or in a succeeded state resources | where type =~ \u0026#34;microsoft.network/networkwatchers/flowlogs\u0026#34; and isnotnull(properties) | extend targetResourceId = tostring(properties.targetResourceId) | extend status = iff(properties.enabled =~ \u0026#39;true\u0026#39;, \u0026#34;Enabled\u0026#34;, \u0026#34;Disabled\u0026#34;) | extend provisioningState = tostring(properties.provisioningState) | extend flowLogType = iff(properties.targetResourceId contains \u0026#34;Microsoft.Network/virtualNetworks\u0026#34;, \u0026#39;Virtual network\u0026#39;, \u0026#39;Network security group\u0026#39;) | where provisioningState != \u0026#34;Succeeded\u0026#34; or status != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;22a769ed-0ecb-8b49-bafe-8f52e6373d9c\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState:\u0026#34;, provisioningState), param2=strcat(\u0026#34;Status:\u0026#34;, status), param3=strcat(\u0026#34;targetResourceId:\u0026#34;,targetResourceId), param4=strcat(\u0026#34;flowLogType:\u0026#34;,flowLogType) Configure Network Watcher Connection monitor\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1e28bbc1-1eb7-486f-8d7f-93943f40219c\rDescription:\rImproves monitoring for Azure and Hybrid connectivity Potential Benefits:\rImproves monitoring for Azure and Hybrid connectivity\rLearn More:\rConnection monitor overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Network Security Group and Virtual Network Flow Logs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\ra1317a0b-402d-4604-be40-a25a004ba171\rDescription:\rImproves monitoring and security for Azure and Hybrid connectivity Potential Benefits:\rImproves monitoring and security for Azure connectivity\rLearn More:\rFlow logging for network security groups\rVirtual network flow logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable traffic analytics in Network Security Group and Virtual Network Flow Logs configuration.\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rbf0b7dbd-016d-458c-af99-70fcb03ad451\rDescription:\rImproves monitoring, security and troubleshooting for Azure and Hybrid connectivity Potential Benefits:\rImproves monitoring, security and troubleshooting.\rLearn More:\rNetwork Watcher traffic analytics\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy Network Watcher in all regions where you have networking services\rLow\rMonitoring and Alerting\rNo\rNo\rFix Flow Log configurations in Failed state or Disabled Status\rLow\rMonitoring and Alerting\rYes\rNo\rConfigure Network Watcher Connection monitor\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable Network Security Group and Virtual Network Flow Logs\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable traffic analytics in Network Security Group and Virtual Network Flow Logs configuration."},{"id":234,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NotificationHubs/","title":"NotificationHubs","parent":"Azure Resources","content":"","description":""},{"id":235,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/objectAnchorsAccounts/","title":"objectAnchorsAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":236,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RedHatOpenShift/openShiftClusters/","title":"openShiftClusters","parent":"RedHatOpenShift","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":237,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/OperationalInsights/","title":"OperationalInsights","parent":"Azure Resources","content":"","description":""},{"id":238,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/","title":"Orbital","parent":"Azure Resources","content":"","description":""},{"id":239,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/p2sVpnGateways/","title":"p2sVpnGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor health for v-Hub\u0026#39;s Point-to-Site VPN gateways\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor health for v-Hub\u0026#39;s Point-to-Site VPN gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rfd43ea32-2ccf-49a8-ada4-9a78794e3ff1\rDescription:\rSet up monitoring and alerts for Point-to-Site VPN gateways. Create alert rule for ensuring promptly response to critical events such as Gateway overutilization, connection count limits and User VPN route limits.\rPotential Benefits:\rDetection and mitigation to avoid disruptions.\rLearn More:\rVirtual WAN Monitoring Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor health for v-Hub\u0026#39;s Point-to-Site VPN gateways\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor health for v-Hub\u0026#39;s Point-to-Site VPN gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rfd43ea32-2ccf-49a8-ada4-9a78794e3ff1\rDescription:\rSet up monitoring and alerts for Point-to-Site VPN gateways. Create alert rule for ensuring promptly response to critical events such as Gateway overutilization, connection count limits and User VPN route limits."},{"id":240,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/partnerNamespaces/","title":"partnerNamespaces","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":241,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/partnerTopics/","title":"partnerTopics","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":242,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Peering/","title":"Peering","parent":"Azure Resources","content":"","description":""},{"id":243,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Peering/peerings/","title":"peerings","parent":"Peering","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":244,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/policies/","title":"policies","parent":"Subscription","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":245,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Authorization/policyDefinitions/","title":"policyDefinitions","parent":"Authorization","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":246,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/PowerBIDedicated/","title":"PowerBIDedicated","parent":"Azure Resources","content":"","description":""},{"id":247,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AVS/privateClouds/","title":"privateClouds","parent":"AVS","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor when Azure VMware Solution Cluster Size is approaching the host limit\rMedium\rMonitoring and Alerting\rNo\rNo\rEnable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rLow\rHigh Availability\rYes\rNo\rConfigure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rHigh\rMonitoring and Alerting\rYes\rNo\rConfigure Syslog in Diagnostic Settings for Azure VMware Solution\rHigh\rMonitoring and Alerting\rNo\rNo\rMonitor CPU Utilization to ensure sufficient resources for workloads\rHigh\rMonitoring and Alerting\rYes\rNo\rMonitor Memory Utilization to ensure sufficient resources for workloads\rHigh\rMonitoring and Alerting\rYes\rNo\rUse key autorotation for vSAN datastore customer-managed keys\rHigh\rSecurity\rNo\rNo\rUse multiple DNS servers per private FQDN zone\rHigh\rHigh Availability\rNo\rNo\rDetails\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r29d7a115-dfb6-4df1-9205-04824109548f\rDescription:\rSet an alert for when the node count in Azure VMware Solution Private Cloud hits or exceeds 90 hosts, enabling timely planning for a new private cloud. Potential Benefits:\rProactive capacity planning\rLearn More:\rConfigure and streamline alerts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor when Azure VMware Solution Cluster Size is approaching the host limit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rf86355e3-de7c-4dad-8080-1b0b411e66c8\rDescription:\rAlert when the cluster size reaches 14 hosts. Set up periodic alerts for planning new clusters or datastores due to growth, especially from storage needs. Beyond 14 hosts, trigger alerts for each new host addition for proactive resource monitoring. Potential Benefits:\rProactive resource management\rLearn More:\rConfigure and streamline alerts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9ec5b4c8-3dd8-473a-86ee-3273290331b9\rDescription:\rFor Azure VMware Solution, enabling Stretched Clusters offers 99.99% SLA, synchronous storage replication (RPO=0), and spreads vSAN datastore across two AZs. Must be done at initial setup, needing double quota due to extension across AZs. Potential Benefits:\r99.99% SLA, 0 RPO, Multi-AZ\rLearn More:\rImplement high availability\rStretched Clusters\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that aren\u0026#39;t configured as stretched clusters and in supported regions. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend avsproperties = todynamic(properties) | where avsproperties.availability.strategy != \u0026#34;DualZone\u0026#34; | where location in (\u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;australiaeast\u0026#34;) | project recommendationId = \u0026#34;9ec5b4c8-3dd8-473a-86ee-3273290331b9\u0026#34;, name, id, tags, param1 = \u0026#34;stretchClusters: Disabled\u0026#34; Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r4232eb32-3241-4049-9e14-9b8005817b56\rDescription:\rEnsure VMware vSAN datastore slack space is maintained for SLA by monitoring storage utilization and setting alerts at 70% and 75% utilization to allow for capacity planning. To expand, add hosts or external storage like Azure Elastic SAN, Azure NetApp Files, if CPU and RAM requirements are met. Potential Benefits:\rOptimized capacity planning for vSAN\rLearn More:\rSupported metrics and activities\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a vSAN capacity critical alert with a threshold of 75% or a warning capacity of 70%. ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 75 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4232eb32-3241-4049-9e14-9b8005817b56\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityCriticalAlert: isNull or threshold != 75\u0026#34; ) | union ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 70 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4232eb32-3241-4049-9e14-9b8005817b56\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityWarningAlert: isNull or threshold != 70\u0026#34; ) Configure Syslog in Diagnostic Settings for Azure VMware Solution\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rfa4ab927-bced-429a-971a-53350de7f14b\rDescription:\rEnsure Diagnostic Settings are configured for each private cloud to send syslogs to external sources for analysis and/or archiving. Azure VMware Solution Syslogs contain data for troubleshooting and performance, aiding quicker issue resolution and early detection of issues. Potential Benefits:\rFaster issue resolution, early detection\rLearn More:\rManage logs and archives\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor CPU Utilization to ensure sufficient resources for workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r4ee5d535-c47b-470a-9557-4a3dd297d62f\rDescription:\rEnsure sufficient compute resources to avoid host resource exhaustion in Azure VMware Solution, which utilizes vSphere DRS and HA for dynamic workload resource management. However, sustained CPU utilization over 95% may increase CPU Ready times, impacting workloads. Potential Benefits:\rAvoids resource exhaustion, optimizes performance\rLearn More:\rConfigure and streamline alerts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a Cluster CPU capacity critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;EffectiveCpuAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;4ee5d535-c47b-470a-9557-4a3dd297d62f\u0026#34;, name, id, tags, param1 = \u0026#34;hostCpuCriticalAlert: isNull or threshold != 95\u0026#34; Monitor Memory Utilization to ensure sufficient resources for workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r029208c8-5186-4a76-8ee8-6e3445fef4dd\rDescription:\rEnsure sufficient memory resources to prevent host resource exhaustion in Azure VMware Solution. It uses vSphere DRS and vSphere HA for dynamic workload management. Yet, continuous memory use over 95% leads to disk swapping, affecting workloads. Potential Benefits:\rAvoids host exhaustion and swapping\rLearn More:\rConfigure and streamline alerts\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a cluster host memory critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tolower(tostring(id)) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tolower(tostring(alertProperties_scopes)) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;UsageAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;029208c8-5186-4a76-8ee8-6e3445fef4dd\u0026#34;, name, id, tags, param1 = \u0026#34;hostMemoryCriticalAlert: isNull or threshold != 95\u0026#34; Use key autorotation for vSAN datastore customer-managed keys\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\re0ac2f57-c8c0-4b8c-a7c8-19e5797828b5\rDescription:\rWhen using customer-managed keys for encrypting vSAN datastores, leveraging Azure Key Vault for central management and accessing them via a managed identity linked to the private cloud is advised. The expiration of these keys can render the vSAN datastore and its associated workloads inaccessible. Potential Benefits:\rAvoid outages with key auto-rotation\rLearn More:\rConfigure Customer Managed Keys\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use multiple DNS servers per private FQDN zone\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rfcc2e257-23af-4c68-aac8-9cc03033c939\rDescription:\rAzure VMware Solution private clouds support up to three DNS servers for a single FQDN, preventing a single DNS server from becoming a point of failure. It\u0026#39;s crucial to use multiple DNS servers for on-premises FQDN resolution from each private cloud. Potential Benefits:\rEnhances reliability and avoids failure\rLearn More:\rConfigure DNS forwarder\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor when Azure VMware Solution Cluster Size is approaching the host limit\rMedium\rMonitoring and Alerting\rNo\rNo\rEnable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore\rLow\rHigh Availability\rYes\rNo\rConfigure Azure Monitor Alert warning thresholds for vSAN datastore utilization\rHigh\rMonitoring and Alerting\rYes\rNo\rConfigure Syslog in Diagnostic Settings for Azure VMware Solution\rHigh\rMonitoring and Alerting\rNo\rNo\rMonitor CPU Utilization to ensure sufficient resources for workloads\rHigh\rMonitoring and Alerting\rYes\rNo\rMonitor Memory Utilization to ensure sufficient resources for workloads\rHigh\rMonitoring and Alerting\rYes\rNo\rUse key autorotation for vSAN datastore customer-managed keys\rHigh\rSecurity\rNo\rNo\rUse multiple DNS servers per private FQDN zone\rHigh\rHigh Availability\rNo\rNo\rDetails\rMonitor when Azure VMware Solution Private Cloud is reaching the capacity limit\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r29d7a115-dfb6-4df1-9205-04824109548f\rDescription:\rSet an alert for when the node count in Azure VMware Solution Private Cloud hits or exceeds 90 hosts, enabling timely planning for a new private cloud."},{"id":248,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateDnsZones/","title":"privateDnsZones","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Private DNS Zones health and set up alerts\rHigh\rMonitoring and Alerting\rNo\rNo\rUse regional Private DNS Zones when there is a low recovery time objective (RTO) requirement\rMedium\rDisaster Recovery\rNo\rNo\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rMonitor Private DNS Zones health and set up alerts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rab896e8c-49b9-2c44-adec-98339aff7821\rDescription:\rUse Azure Monitor to monitor Private DNS Zone query volume, record set count, and capacity metrics for Record Set, Virtual Network Link, and Virtual Network Link with auto-registration. Create alerts based on Azure Monitor Baseline Alerts for these metrics that exceed specific thresholds. Potential Benefits:\rEnhanced DNS reliability and alerting\rLearn More:\rAzure Monitor Baseline Alerts - privateDnsZones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use regional Private DNS Zones when there is a low recovery time objective (RTO) requirement\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1e02335c-1f90-fd4e-a5a5-d359c7b22d70\rDescription:\rFor business continuity scenarios with a low recovery time objective (RTO), ensure that distinct regional production and disaster recovery (DR) Private DNS Zones are configured and have identical workload and resource DNS entries. This keeps DNS resolution consistent across both zones. Potential Benefits:\rEnsures seamless failover for DNS during a regional outage\rLearn More:\rPrivate Link and DNS integration at scale\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r3538aa48-c40b-455b-a93b-269fe6e65be2\rDescription:\rAzure Private DNS allows the Time-To-Live (TTL) for record sets in the zone to be set to a value between 1 and 2147483647 seconds. You should ensure that the TTL for the DNS record sets in your DNS Zones are set appropriately to meet your RPO targets. Potential Benefits:\rEnsures that no cached DNS records exist past RPO targets\rLearn More:\rReliability in Azure DNS\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor Private DNS Zones health and set up alerts\rHigh\rMonitoring and Alerting\rNo\rNo\rUse regional Private DNS Zones when there is a low recovery time objective (RTO) requirement\rMedium\rDisaster Recovery\rNo\rNo\rEnsure Time-To-Live (TTL) is set appropriately to ensure RPOs can be met\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rMonitor Private DNS Zones health and set up alerts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rab896e8c-49b9-2c44-adec-98339aff7821\rDescription:\rUse Azure Monitor to monitor Private DNS Zone query volume, record set count, and capacity metrics for Record Set, Virtual Network Link, and Virtual Network Link with auto-registration."},{"id":249,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateEndpoints/","title":"privateEndpoints","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rResolve issues with Private Endpoints in non Succeeded connection state\rMedium\rHigh Availability\rYes\rNo\rDetails\rResolve issues with Private Endpoints in non Succeeded connection state\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb89c9acc-0aba-fb44-9ff2-3dbfcf97dce7\rDescription:\rA private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource. Potential Benefits:\rEnsure connection availability\rLearn More:\rPrivate endpoint connections\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all Private Endpoints that are not in a Succeeded state resources | where type =~ \u0026#34;microsoft.network/privateendpoints\u0026#34; | where (properties.provisioningState =~ \u0026#34;Succeeded\u0026#34; and (properties.privateLinkServiceConnections[0].properties.provisioningState =~ \u0026#34;Succeeded\u0026#34; or properties.manualPrivateLinkServiceConnections[0].properties.provisioningState =~ \u0026#34;Succeeded\u0026#34;)) == false | project recommendationId = \u0026#34;b89c9acc-0aba-fb44-9ff2-3dbfcf97dce7\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.provisioningState)), param2 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.privateLinkServiceConnections[0].properties.provisioningState)), param3 = strcat(\u0026#34;manualProvisioningState: \u0026#34;, tostring(properties.manualPrivateLinkServiceConnections[0].properties.provisioningState)) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rResolve issues with Private Endpoints in non Succeeded connection state\rMedium\rHigh Availability\rYes\rNo\rDetails\rResolve issues with Private Endpoints in non Succeeded connection state\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb89c9acc-0aba-fb44-9ff2-3dbfcf97dce7\rDescription:\rA private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource."},{"id":250,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/privateLinkScopes/","title":"privateLinkScopes","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":251,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/privateLinkServices/","title":"privateLinkServices","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":252,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cdn/profiles/","title":"profiles","parent":"Cdn","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRestrict traffic to your origins\rHigh\rSecurity\rNo\rNo\rUse the latest API version and SDK version\rMedium\rScalability\rNo\rYes\rConfigure logs\rMedium\rMonitoring and Alerting\rNo\rNo\rDisable health probes when there is only one origin in an origin group\rLow\rHigh Availability\rYes\rNo\rSelect good health probe endpoints\rMedium\rHigh Availability\rNo\rNo\rUse HEAD health probes\rMedium\rScalability\rNo\rNo\rAvoid using Classic Azure Front Door\rHigh\rService Upgrade and Retirement\rNo\rNo\rDetails\rRestrict traffic to your origins\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\r6c40b7ae-2bea-5748-be1a-9e9e3b834649\rDescription:\rFront Door\u0026#39;s features perform optimally when traffic exclusively comes through Front Door. It\u0026#39;s advised to set up your origin to deny access to traffic that bypasses Front Door. Potential Benefits:\rEnhances security and performance\rLearn More:\rSecure traffic to Azure Front Door origins\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use the latest API version and SDK version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r52bc9a7b-23c8-bc4c-9d2a-7bc43b50104a\rDescription:\rWhen working with Azure Front Door through APIs, ARM templates, Bicep, or SDKs, using the latest API or SDK version is crucial. Updates bring new functions, important security patches, and bug fixes. Potential Benefits:\rEnhanced security and features\rLearn More:\rREST API Reference\rClient library for Java\rSDK for Python\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure logs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1ad74c3c-e3d7-0046-b83f-a2199974ef15\rDescription:\rFront Door logs offer comprehensive telemetry on each request, crucial for understanding your solution\u0026#39;s performance and responses, especially when caching is enabled, as origin servers might not receive every request. Potential Benefits:\rEnhanced insights and solution monitoring\rLearn More:\rMonitor metrics and logs in Azure Front Door\rWAF logs\rConfigure Azure Front Door logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Disable health probes when there is only one origin in an origin group\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r38f3d542-6de6-a44b-86c6-97e3be690281\rDescription:\rFront Door health probes help detect unavailable or unhealthy origins, directing traffic to alternate origins if needed. Potential Benefits:\rReduces unnecessary origin traffic\rLearn More:\rHealth probes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Disable health probes when there is only one origin in an origin group cdnresources | where type =~ \u0026#34;microsoft.cdn/profiles/origingroups\u0026#34; | extend healthprobe=tostring(properties.healthProbeSettings) | project origingroupname=name, id, tags, resourceGroup, subscriptionId, healthprobe | join ( cdnresources | where type =~ \u0026#34;microsoft.cdn/profiles/origingroups/Origins\u0026#34; | extend origingroupname = tostring(properties.originGroupName) ) on origingroupname | summarize origincount=count(), enabledhealthprobecount=countif(healthprobe != \u0026#34;\u0026#34;) by origingroupname, id, tostring(tags), resourceGroup, subscriptionId | where origincount == 1 and enabledhealthprobecount != 0 | project recommendationId = \u0026#34;38f3d542-6de6-a44b-86c6-97e3be690281\u0026#34;, name=origingroupname, id, todynamic(tags), param1 = strcat(\u0026#34;origincount:\u0026#34;, origincount), param2 = strcat(\u0026#34;enabledhealthprobecount:\u0026#34;, enabledhealthprobecount) Select good health probe endpoints\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5225bba3-28ec-1e43-8986-7eedfd466d65\rDescription:\rConsider selecting a webpage or location specifically designed for health monitoring as the endpoint for Azure Front Door\u0026#39;s health probes. This should encompass the status of critical components like application servers, databases, and caches to serve production traffic efficiently. Potential Benefits:\rImproves traffic routing and uptime\rLearn More:\rHealth Endpoint Monitoring pattern\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use HEAD health probes\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r5783defe-b49e-d947-84f7-d8677593f324\rDescription:\rHealth probes in Azure Front Door can use GET or HEAD HTTP methods. Using the HEAD method for health probes is a recommended practice because it reduces the traffic load on your origins, being less resource-intensive. Potential Benefits:\rReduces traffic load on origins\rLearn More:\rSupported HTTP methods for health probes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Avoid using Classic Azure Front Door\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rService Upgrade and Retirement\rAPRL GUID:\u0026nbsp;\r82fa3cff-74bd-4063-b726-834f160592fa\rDescription:\rAzure Front Door standard is ~45% cheaper then AFD classic and has many additional benefits. Classic is also scheduled to be retired on March 31, 2027. Potential Benefits:\rCosts savings and additional supported features\rLearn More:\rCompare pricing between Azure Front Door tiers\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r//under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRestrict traffic to your origins\rHigh\rSecurity\rNo\rNo\rUse the latest API version and SDK version\rMedium\rScalability\rNo\rYes\rConfigure logs\rMedium\rMonitoring and Alerting\rNo\rNo\rDisable health probes when there is only one origin in an origin group\rLow\rHigh Availability\rYes\rNo\rSelect good health probe endpoints\rMedium\rHigh Availability\rNo\rNo\rUse HEAD health probes\rMedium\rScalability\rNo\rNo\rAvoid using Classic Azure Front Door\rHigh\rService Upgrade and Retirement\rNo\rNo\rDetails\rRestrict traffic to your origins\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\r6c40b7ae-2bea-5748-be1a-9e9e3b834649\rDescription:\rFront Door\u0026#39;s features perform optimally when traffic exclusively comes through Front Door."},{"id":253,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/proximityPlacementGroups/","title":"proximityPlacementGroups","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":254,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/publicIPAddresses/","title":"publicIPAddresses","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Standard SKU and Zone-Redundant IPs when applicable\rHigh\rHigh Availability\rYes\rNo\rUse NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rMedium\rHigh Availability\rYes\rNo\rUpgrade Basic SKU public IP addresses to Standard SKU\rMedium\rHigh Availability\rYes\rNo\rPublic IP addresses should have DDoS protection enabled\rMedium\rSecurity\rYes\rNo\rDetails\rUse Standard SKU and Zone-Redundant IPs when applicable\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc63b81fb-7afc-894c-a840-91bb8a8dcfaf\rDescription:\rPublic IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant. Zone-redundant IPs are accessible across all zones, resisting any single zone failure, thereby providing higher resilience. Potential Benefits:\rEnhanced resilience with zone redundancy\rLearn More:\rPublic IP addresses - Availability Zones\rUpgrading a basic public IP address to Standard SKU\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // List public IP addresses that are not Zone-Redundant Resources | where type =~ \u0026#34;Microsoft.Network/publicIPAddresses\u0026#34; and sku.tier =~ \u0026#34;Regional\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where isempty(zones) or array_length(zones) \u0026lt;= 1 | extend az = case(isempty(zones), \u0026#34;Non-zonal\u0026#34;, array_length(zones) \u0026lt;= 1, strcat(\u0026#34;Zonal (\u0026#34;, strcat_array(zones, \u0026#34;,\u0026#34;), \u0026#34;)\u0026#34;), zones) | project recommendationId = \u0026#34;c63b81fb-7afc-894c-a840-91bb8a8dcfaf\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name), param2 = strcat(\u0026#34;availabilityZone: \u0026#34;, az) Use NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r1adba190-5c4c-e646-8527-dd1b2a6d8b15\rDescription:\rPrevent connectivity failures due to SNAT port exhaustion by employing NAT gateway for outbound traffic from virtual networks, ensuring dynamic scaling and secure internet connections. Potential Benefits:\rAvoids SNAT port exhaustion risks\rLearn More:\rUse NAT GW for outbound connectivity\rTCP and SNAT Ports\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Lists VMs with PIPs resources | where type =~ \u0026#39;Microsoft.Network/publicIPAddresses\u0026#39; | where tostring(properties.ipConfiguration.id) contains \u0026#34;microsoft.network/networkinterfaces\u0026#34; | project recommendationId=\u0026#34;1adba190-5c4c-e646-8527-dd1b2a6d8b15\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Migrate from instance IP to NAT Gateway\u0026#34;) Upgrade Basic SKU public IP addresses to Standard SKU\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5cea1501-6fe4-4ec4-ac8f-f72320eb18d3\rDescription:\rBasic SKU public IP addresses will be retired on September 30, 2025. Users are advised to upgrade to Standard SKU public IP addresses before this date to avoid service disruptions. Potential Benefits:\rAvoids service disruption\rLearn More:\rUpgrading a basic public IP address to Standard SKU - Guidance\rUpgrade to Standard SKU public IP addresses in Azure by 30 September 2025 as Basic SKU will be retired\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // List Basic SKU public IP addresses Resources | where type =~ \u0026#34;Microsoft.Network/publicIPAddresses\u0026#34; | where sku.name =~ \u0026#34;Basic\u0026#34; | project recommendationId = \u0026#34;5cea1501-6fe4-4ec4-ac8f-f72320eb18d3\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name) Public IP addresses should have DDoS protection enabled\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\rc4254c66-b8a5-47aa-82f6-e7d7fb418f47\rDescription:\rDDoS attacks can be targeted at any endpoint that is publicly reachable through the internet. Potential Benefits:\rAvoids service disruption\rLearn More:\rAzure DDoS Protection\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph query // Public IP addresses should have DDoS protection enabled resources | where type =~ \u0026#39;Microsoft.Network/publicIPAddresses\u0026#39; | where properties.ddosSettings.protectionMode !in~ (\u0026#34;Enabled\u0026#34;, \u0026#34;VirtualNetworkInherited\u0026#34;) | project recommendationId=\u0026#34;c4254c66-b8a5-47aa-82f6-e7d7fb418f47\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Apply either DDoS Network protection or DDoS IP Protrection to the public IP address.\u0026#34;) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Standard SKU and Zone-Redundant IPs when applicable\rHigh\rHigh Availability\rYes\rNo\rUse NAT gateway for outbound connectivity to avoid SNAT Exhaustion\rMedium\rHigh Availability\rYes\rNo\rUpgrade Basic SKU public IP addresses to Standard SKU\rMedium\rHigh Availability\rYes\rNo\rPublic IP addresses should have DDoS protection enabled\rMedium\rSecurity\rYes\rNo\rDetails\rUse Standard SKU and Zone-Redundant IPs when applicable\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc63b81fb-7afc-894c-a840-91bb8a8dcfaf\rDescription:\rPublic IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant."},{"id":255,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/publicIPPrefixes/","title":"publicIPPrefixes","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":256,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Purview/","title":"Purview","parent":"Azure Resources","content":"","description":""},{"id":257,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quantum/","title":"Quantum","parent":"Azure Resources","content":"","description":""},{"id":258,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/","title":"Quota","parent":"Azure Resources","content":"","description":""},{"id":259,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/quotas/","title":"quotas","parent":"Quota","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":260,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/racks/","title":"racks","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":261,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RecoveryServices/","title":"RecoveryServices","parent":"Azure Resources","content":"","description":""},{"id":262,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RedHatOpenShift/","title":"RedHatOpenShift","parent":"Azure Resources","content":"","description":""},{"id":263,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/Redis/","title":"Redis","parent":"Cache","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for Azure Cache for Redis\rHigh\rHigh Availability\rYes\rNo\rSchedule updates by setting a maintenance window\rMedium\rHigh Availability\rNo\rNo\rDetails\rEnable zone redundancy for Azure Cache for Redis\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8\rDescription:\rAzure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability. Potential Benefits:\rHigher resilience and availability\rLearn More:\rEnable zone redundancy for Azure Cache for Redis\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find Cache for Redis instances with one or no Zones selected resources | where type =~ \u0026#34;microsoft.cache/redis\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc Schedule updates by setting a maintenance window\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rcabc1f98-c8a7-44f7-ab24-977982ef3f70\rDescription:\rAzure Cache for Redis allows for specifying maintenance windows. A maintenance window allows you to control the days and times of a week during which the VMs hosting your cache can be updated. Potential Benefits:\rHigher resilience and availability\rLearn More:\rSchedule Redis Updates\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for Azure Cache for Redis\rHigh\rHigh Availability\rYes\rNo\rSchedule updates by setting a maintenance window\rMedium\rHigh Availability\rNo\rNo\rDetails\rEnable zone redundancy for Azure Cache for Redis\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8\rDescription:\rAzure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability."},{"id":264,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Cache/redisEnterprise/","title":"redisEnterprise","parent":"Cache","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":265,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ContainerRegistry/registries/","title":"registries","parent":"ContainerRegistry","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Premium tier for critical production workloads\rHigh\rScalability\rYes\rNo\rEnable zone redundancy\rMedium\rHigh Availability\rYes\rNo\rCreate container registries with geo-replication enabled\rHigh\rDisaster Recovery\rYes\rNo\rUse Repository namespaces\rMedium\rSecurity\rNo\rNo\rDisable anonymous pull access\rMedium\rSecurity\rYes\rNo\rConfigure Diagnostic Settings for all Azure Container Registries\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor Azure Container Registry with Azure Monitor\rMedium\rMonitoring and Alerting\rNo\rNo\rEnable soft delete policy\rLow\rDisaster Recovery\rYes\rNo\rDetails\rUse Premium tier for critical production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\reb005943-40a8-194b-9db2-474d430046b7\rDescription:\rChoose a service tier of Azure Container Registry to meet your performance needs. Premium offers the most bandwidth and highest rate of read and write operations for high-volume deployments. Use Basic to start, Standard for production, and Premium for hyper-scale performance and geo-replication. Potential Benefits:\rHigh-volume support and geo-replication\rLearn More:\rContainer Registry Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that are not using the Premium tier resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where sku.name != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;eb005943-40a8-194b-9db2-474d430046b7\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SkuName: \u0026#34;, tostring(sku.name)) | order by id asc Enable zone redundancy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r63491f70-22e4-3b4a-8b0c-845450e46fac\rDescription:\rAzure Container Registry\u0026#39;s optional zone redundancy enhances resiliency and high availability for registries or replication resources in a specific region by distributing resources across multiple zones. Potential Benefits:\rEnhances resiliency and high availability\rLearn More:\rRegistry best practices - Enable zone redundancy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that do not have zone redundancy enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where properties.zoneRedundancy != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;63491f70-22e4-3b4a-8b0c-845450e46fac\u0026#34;, name, id, tags, param1=strcat(\u0026#34;zoneRedundancy: \u0026#34;, tostring(properties.zoneRedundancy)) | order by id asc Create container registries with geo-replication enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r36ea6c09-ef6e-d743-9cfb-bd0c928a430b\rDescription:\rUse Azure Container Registry\u0026#39;s geo-replication for multi-region deployments to simplify registry management and minimize latency. It enables serving global customers from local data centers and supports distributed development teams. Regional webhooks can notify of events in replicas. Potential Benefits:\rSimplifies management, reduces latency\rLearn More:\rRegistry best practices - Enable geo-replication\rGeo-Replicate Container Registry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that do not have geo-replication enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | project registryName = name, registryId = id, tags, primaryRegion = location | join kind=leftouter ( Resources | where type =~ \u0026#34;microsoft.containerregistry/registries/replications\u0026#34; | project replicationRegion=name, replicationId = id | extend registryId=strcat_array(array_slice(split(replicationId, \u0026#39;/\u0026#39;), 0, -3), \u0026#39;/\u0026#39;) ) on registryId | project-away registryId1, replicationId | where isempty(replicationRegion) | project recommendationId = \u0026#34;36ea6c09-ef6e-d743-9cfb-bd0c928a430b\u0026#34;, name=registryName, id=registryId, tags | order by id asc Use Repository namespaces\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\ra5a0101a-a240-8742-90ba-81dbde9a0c0c\rDescription:\rUsing repository namespaces allows a single registry to be shared across multiple groups and deployments within an organization, supporting nested namespaces for group isolation. However, repositories are managed independently, not hierarchically. Potential Benefits:\rEnables sharing and group isolation\rLearn More:\rRegistry best practices - use repository namespaces\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Disable anonymous pull access\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\r03f4a7d8-c5b4-7842-8e6e-14997a34842b\rDescription:\rBy default, Azure container registry requires authentication for pull/push actions. Enabling anonymous pull access exposes all content for public read actions. This applies to all repositories, potentially allowing unrestricted access if repository-scoped tokens are used. Potential Benefits:\rEnhanced security and controlled access\rLearn More:\rEnable anonymous pull access\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Container Registries that have anonymous pull access enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.anonymousPullEnabled == \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;03f4a7d8-c5b4-7842-8e6e-14997a34842b\u0026#34;, name, id, tags | order by id asc Configure Diagnostic Settings for all Azure Container Registries\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r44107155-7a32-9348-89f3-d5aa7e7c5a1d\rDescription:\rResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations. Potential Benefits:\rEnhanced tracking and debugging\rLearn More:\rMonitoring Azure Container Registry data reference - Resource Logs\rMonitor Azure Container Registry - Enable diagnostic logs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor Azure Container Registry with Azure Monitor\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rd594cde6-4116-d143-a64a-25f63289a2f8\rDescription:\rMonitoring Azure resources using Azure Monitor enhances their availability, performance, and operation. Azure Container Registry, a full-stack monitoring service, provides features for Azure and other cloud and on-premises resources. Potential Benefits:\rEnhanced monitoring and operation\rLearn More:\rMonitoring Azure Container Registry data reference\rMonitor Azure Container Registry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable soft delete policy\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re7f0fd54-fba0-054e-9ab8-e676f2851f88\rDescription:\rEnabling soft delete preview feature in Azure Container Registry (ACR) allows for the management of deleted artifacts with a specified retention period. Users can list, filter, and restore these artifacts until automatically purged post-retention. Potential Benefits:\rRecovery of deleted artifacts\rLearn More:\rEnable soft delete policy\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Container Registry resources that do not have soft delete enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.policies.softDeletePolicy.status == \u0026#34;disabled\u0026#34; | project recommendationId = \u0026#34;e7f0fd54-fba0-054e-9ab8-e676f2851f88\u0026#34;, name, id, tags | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Premium tier for critical production workloads\rHigh\rScalability\rYes\rNo\rEnable zone redundancy\rMedium\rHigh Availability\rYes\rNo\rCreate container registries with geo-replication enabled\rHigh\rDisaster Recovery\rYes\rNo\rUse Repository namespaces\rMedium\rSecurity\rNo\rNo\rDisable anonymous pull access\rMedium\rSecurity\rYes\rNo\rConfigure Diagnostic Settings for all Azure Container Registries\rMedium\rMonitoring and Alerting\rNo\rNo\rMonitor Azure Container Registry with Azure Monitor\rMedium\rMonitoring and Alerting\rNo\rNo\rEnable soft delete policy\rLow\rDisaster Recovery\rYes\rNo\rDetails\rUse Premium tier for critical production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\reb005943-40a8-194b-9db2-474d430046b7\rDescription:\rChoose a service tier of Azure Container Registry to meet your performance needs."},{"id":266,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Relay/","title":"Relay","parent":"Azure Resources","content":"","description":""},{"id":267,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/remoteRenderingAccounts/","title":"remoteRenderingAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":268,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/resourceGroups/","title":"resourceGroups","parent":"Resources","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":269,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Management/resources/","title":"resources","parent":"Management","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":270,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/","title":"Resources","parent":"Azure Resources","content":"","description":""},{"id":271,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/routeFilters/","title":"routeFilters","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":272,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/routeTables/","title":"routeTables","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor changes in Route Tables with Azure Monitor\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rMonitor changes in Route Tables with Azure Monitor\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r23b2dfc7-7e5d-9443-9f62-980ca621b561\rDescription:\rCreate Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources. This setup aids in identifying improper routing changes, including efforts to evade firewalls or access resources from outside. Potential Benefits:\rEnhanced security and change detection\rLearn More:\rAzure activity log - Azure Monitor | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Route Tables without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/routeTables\u0026#34; | project name, id, tags, lowerCaseRouteTableId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/routeTables\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Route Table (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39;) or // All Administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/join/action\u0026#34;\u0026#39;) ) | project lowerCaseRouteTableIdOfScope = tolower(scope) ) on $left.lowerCaseRouteTableId == $right.lowerCaseRouteTableIdOfScope | where isempty(lowerCaseRouteTableIdOfScope) | project recommendationId = \u0026#34;23b2dfc7-7e5d-9443-9f62-980ca621b561\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor changes in Route Tables with Azure Monitor\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rMonitor changes in Route Tables with Azure Monitor\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r23b2dfc7-7e5d-9443-9f62-980ca621b561\rDescription:\rCreate Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources. This setup aids in identifying improper routing changes, including efforts to evade firewalls or access resources from outside."},{"id":273,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/sap/","title":"SAP on Azure","parent":"Specialized Workloads","content":"Refer to:\nAzure Center for SAP Solutions Opensource Quality Checks Openssource Inventory Checks General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure that each SAP production system is designed for high availability across availability zones\rHigh\rHigh Availability\rNo\rNo\rRun SAP application servers on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rNo\rNo\rIf using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rHigh\rHigh Availability\rYes\rYes\rEnsure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rHigh\rHigh Availability\rNo\rNo\rDesign SAP shared file systems for high availability, utilizing availability zones when possible\rHigh\rHigh Availability\rNo\rNo\rTest high availability solutions thoroughly to ensure fail overs work as expected\rHigh\rHigh Availability\rNo\rNo\rRemove unwanted location constraints from Linux Pacemaker clusters\rHigh\rHigh Availability\rNo\rNo\rSecure compute resource capacity for critical VM roles in DR region\rMedium\rDisaster Recovery\rNo\rNo\rReplicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rHigh\rDisaster Recovery\rNo\rNo\rSAP components are backed up to DR location using an appropriate backup tool or ASR\rHigh\rDisaster Recovery\rNo\rNo\rSAP shared files systems are replicated or backed up to DR location\rHigh\rDisaster Recovery\rNo\rNo\rAutomate DR infrastructure build or pre-deploy DR resources\rMedium\rDisaster Recovery\rNo\rNo\rDocument and test DR procedure ensure it meets RPO and RTO targets\rMedium\rDisaster Recovery\rNo\rNo\rEnsure there is a robust monitoring and alerting solution in place for the entire DR solution\rMedium\rDisaster Recovery\rNo\rNo\rConfigure scheduled events notification\rHigh\rMonitoring and Alerting\rNo\rNo\rConfigure a Pacemaker cluster for SAP ASCS high availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the load balancer is configured correctly for SAP ASCS High availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the Pacemaker cluster has been setup for SAP HANA DB high availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the load balancer is configured correctly for SAP HANA DB High availability\rHigh\rHigh Availability\rNo\rNo\rReview SAP configuration for timeout values used with Azure NetApp Files\rHigh\rHigh Availability\rNo\rNo\rProvision recommended storage configuration on database VMs\rHigh\rScalability\rNo\rNo\rDetails\rEnsure that each SAP production system is designed for high availability across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra9b649a5-2bfe-40ca-9b8f-34f9c71dfa12\rDescription:\rUse Azure Availability Zones to protect SAP systems against data center failures. Ensure high availability by deploying across multiple zones. If deployment across zones isn\u0026#39;t possible, refer to Microsoft\u0026#39;s guidance for high availability options for SAP workloads. Potential Benefits:\rHigh availability for SAP systems\rLearn More:\rSAP ACSS Quality Insights\rOpenSource Inventory Checks\rOpenSource Quality Checks\rMove Regional SAP HA to Zonal\rHigh Availability Deployment Options for SAP\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Run SAP application servers on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r49bd34ab-d117-4b0e-99f8-34cc8a5394bc\rDescription:\rUse VMSS Flex to distribute VMs across zones and fault domains. Follow Microsoft\u0026#39;s SAP workload recommendations for settings. If not using VMSS Flex or Availability Sets, consider migrating to VMSS Flex for improved resiliency. Refer to the provided blog post for migration details. Potential Benefits:\rEnhanced resiliency for SAP on Azure\rLearn More:\rOpenSource Inventory Checks\rVirtual machine Scale Set SAP Deployment Guide\rConsiderations for Flexible VM Scale Sets for SAP\rMigrate existing SAP system VMs to VMSS Flex\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development If using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb60ae773-9917-4bca-8a42-7cb45365a917\rDescription:\rFor single-instance VMs, both OS and data disks must be either Premium SSD or Ultra Disk to achieve the single-instance SLA of 99.9% availability. Potential Benefits:\rHigher SLA of 99.9% with SSDs\rLearn More:\rSAP ACSS Insights\rOpenSource Inventory Checks\rOpenSource Quality Checks\rVM SLA\rSAP Storage Planning Guide\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all single instance VMs that have an attached disk that is not in the Premium or Ultra sku tier. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.virtualMachineScaleSet.id) | where isnotnull(properties.availabilitySet) | extend lname = tolower(name) | join kind=leftouter(resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where not(sku.tier =~ \u0026#39;Premium\u0026#39;) and not(sku.tier =~ \u0026#39;Ultra\u0026#39;) | extend lname = tolower(tostring(split(managedBy, \u0026#39;/\u0026#39;)[8])) | project lname, name | summarize disks = make_list(name) by lname) on lname | where isnotnull(disks) | project recommendationId = \u0026#34;b60ae773-9917-4bca-8a42-7cb45365a917\u0026#34;, name, id, tags, param1=strcat(\u0026#34;AffectedDisks: \u0026#34;, disks) Ensure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r094400a5-f112-408d-a334-afd68873ff0f\rDescription:\rHigh availability for databases should be implemented using database native replication technologies and the data should be replicated synchronously that is in SYNC mode from primary database to a stand-by node. Potential Benefits:\rEnsures high availability for SAP data\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Design SAP shared file systems for high availability, utilizing availability zones when possible\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re09ca960-20b7-4831-b85b-83ec84c1390e\rDescription:\rSAP shared file systems such as /sapmnt, /usr/trans, interfaces should be made highly available. In case of Azure File Shares, we recommend that you use ZRS (Zone-redundant storage) and for Azure NetApp Files use Zonal replication for your volumes. Potential Benefits:\rEnhanced data availability for SAP\rLearn More:\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Test high availability solutions thoroughly to ensure fail overs work as expected\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5663a808-56be-49ea-8d5c-c5dfc6925f76\rDescription:\rTest high availability solutions thoroughly, including kernel panic in Linux VMs and fail-back. Ensure zonal failure scenarios for each SAP layer (database, central services, application servers, shared file systems) are zone redundant, meet RPO = 0, and fail over automatically within your RTO. Potential Benefits:\rEnsures SAP Azure\u0026#39;s failover reliability\rLearn More:\rTest Cases\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Remove unwanted location constraints from Linux Pacemaker clusters\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r1b8a3051-dfd4-4780-bfb7-446296774029\rDescription:\rUse the migrate command in a Linux Pacemaker cluster to create a temporary \u0026#34;prefer\u0026#34; location constraint, moving a resource to a specified node for maintenance or testing. This constraint is temporary and should be removed after the task to revert to the original cluster configuration. Potential Benefits:\rEnhanced maintenance and failover handling\rLearn More:\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Secure compute resource capacity for critical VM roles in DR region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r820b4c0c-8a74-442a-8ba7-b0cb840cd983\rDescription:\rEnsure compute resource availability for critical VM roles in a DR region using a warm standby approach or Azure\u0026#39;s On-demand Capacity Reservation. Warm standby keeps VMs running in the DR region, while On-demand Capacity Reservation reserves compute capacity without running VMs. Potential Benefits:\rGuarantees DR region availability\rLearn More:\rCapacity Reservation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Replicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rfb8bdcee-d88f-408d-8572-a76a4aaa733b\rDescription:\rReplicate production databases (ASYNC) to the DR location using the database vendor\u0026#39;s replication technology. Potential Benefits:\rEnhanced DR resilience\rLearn More:\rSAP Disaster Recovery Guide\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development SAP components are backed up to DR location using an appropriate backup tool or ASR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r41f0d88e-7866-4444-aac4-ef5fee3e6874\rDescription:\rSAP components such as (A)SCS, application servers, WebDispatchers, etc are backed up to DR location using an appropriate backup tool or ASR. Potential Benefits:\rEnsures SAP data safety and recovery\rLearn More:\rSAP ACSS Insights\rOpenSource Inventory Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development SAP shared files systems are replicated or backed up to DR location\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\ree4dc309-00a1-49fe-92fa-1724baf5f103\rDescription:\rImplement robust monitoring and alerting for DR in SAP on Azure to cover its complex, multi-layer architecture. This is crucial for databases, services, applications, and shared systems. Potential Benefits:\rEnhances SAP DR oversight\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automate DR infrastructure build or pre-deploy DR resources\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r0fabc52e-cdbb-4acd-8626-c4c637061e2d\rDescription:\rAutomate the build of disaster recovery (DR) infrastructure (or pre-deploy DR resources) and streamline SAP service recovery as much as possible. Potential Benefits:\rFaster SAP recovery, reduced downtime\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Document and test DR procedure ensure it meets RPO and RTO targets\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rc300e949-528d-4ac9-889b-cacf8b4a6e90\rDescription:\rDocument DR procedures for each SAP layer: database, central services, application servers, and shared file systems. Include configuration, failover mechanisms, and recovery steps. Test various failure scenarios to ensure the DR strategy meets RPO/RTO targets and provides seamless failover. Potential Benefits:\rEnsures robust DR, meets RPO/RTO\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure there is a robust monitoring and alerting solution in place for the entire DR solution\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rc27134b7-6917-4852-8276-3dbef5c71578\rDescription:\rImplement robust monitoring and alerting for SAP on Azure, covering DR for databases, central services, applications, and shared file systems. Given SAP\u0026#39;s complexity, a comprehensive monitoring strategy is crucial for effective DR replication and rapid issue response. Potential Benefits:\rImproved DR oversight and rapid issue response\rLearn More:\rDR Guidance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure scheduled events notification\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r6b589ce6-c847-4cee-af35-f6e8eb1cf983\rDescription:\rScheduled events notify about upcoming maintenance (e.g., reboot) to limit disruption. Configure for all critical Azure VMs. Use the azure-events-az resource agent in Pacemaker clusters to monitor and react to events like Reboot and Redeploy, ensuring high availability. Potential Benefits:\rProactive maintenance awareness\rLearn More:\rVM Scheduled Events\rConfigure Pacemaker for Azure Scheduled Events\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure a Pacemaker cluster for SAP ASCS high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9d8f6678-694c-4da4-8384-415201f65194\rDescription:\rFor the ASCS-Pacemaker (Central Server Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability. Potential Benefits:\rEnhances SAP ASCS uptime\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rASCS-Pacemaker - Central Server Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the load balancer is configured correctly for SAP ASCS High availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5c2e52d0-25be-4b1c-833c-b98b5ef1a26b\rDescription:\rFor the ASCS-LB (Central Server Instance), ensure that the load balancer is configured correctly for SAP ASCS high availability. Potential Benefits:\rEnhanced HA for SAP ASCS\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rASCS-LB - Central Server Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6648fe61-880d-4a96-8d2d-190a23d5580b\rDescription:\rFor the DBHANA-Pacemaker (Database Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP HANA database high availability. Potential Benefits:\rEnhances SAP HANA DB uptime\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rDBHANA-Pacemaker - Database Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Ensure the load balancer is configured correctly for SAP HANA DB High availability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2e4c2171-a83f-4238-a8e3-b51c90d86a99\rDescription:\rFor the DBHANA-LB (Database Instance), make sure the load balancer is configured correctly for SAP HANA database high availability. Potential Benefits:\rEnhanced DB availability\rLearn More:\rSAP ACSS Insights\rOpenSource Quality Checks\rDBHANA-LB- Database Instance\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Review SAP configuration for timeout values used with Azure NetApp Files\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4884cada-b9c7-42d5-8153-3853e4a6f6c4\rDescription:\rEnsure high availability of SAP with Azure NetApp Files by setting proper timeout values to prevent disruptions. Review the documentation to confirm your configuration meets the recommended timeout values. Potential Benefits:\rImprove resiliency and performance of SAP on Azure\rLearn More:\rSAP on Azure NetApp Planning Guide\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Provision recommended storage configuration on database VMs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r697deb1d-d398-4989-9734-9e6c18f7e0ad\rDescription:\rEnsure optimal disk types and configurations for data and log volumes, meeting IOPS and throughput requirements. Follow Microsoft\u0026#39;s recommendations for disk caching, WriteAccelerator, stripe size, and Linux I/O Scheduler. Use SAP on Azure QualityCheck tool to identify deviations. Potential Benefits:\rImprove reliability, performance and optimize costs\rLearn More:\rHigh-availability SAP NetWeaver with simple mount and NFS on SLES for SAP Applications VMs\rHigh availability for SAP NetWeaver on Azure VMs on SUSE Linux Enterprise Server with Azure NetApp Files for SAP applications\rHigh availability of SAP HANA scale-up with Azure NetApp Files on SUSE Enterprise Linux\rAzure Virtual Machines HA for SAP NetWeaver on RHEL with Azure NetApp Files for SAP applications\rHigh availability of SAP HANA scale-up with Azure NetApp Files on RHEL\rOpenSource Quality Checks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Refer to:\nAzure Center for SAP Solutions Opensource Quality Checks Openssource Inventory Checks General Workload Guidance\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure that each SAP production system is designed for high availability across availability zones\rHigh\rHigh Availability\rNo\rNo\rRun SAP application servers on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rNo\rNo\rIf using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk\rHigh\rHigh Availability\rYes\rYes\rEnsure synchronous data replication (SYNC mode) between primary and secondary VM nodes\rHigh\rHigh Availability\rNo\rNo\rDesign SAP shared file systems for high availability, utilizing availability zones when possible\rHigh\rHigh Availability\rNo\rNo\rTest high availability solutions thoroughly to ensure fail overs work as expected\rHigh\rHigh Availability\rNo\rNo\rRemove unwanted location constraints from Linux Pacemaker clusters\rHigh\rHigh Availability\rNo\rNo\rSecure compute resource capacity for critical VM roles in DR region\rMedium\rDisaster Recovery\rNo\rNo\rReplicate production databases to DR location (ASYNC) using the vendor\u0026#39;s replication technology\rHigh\rDisaster Recovery\rNo\rNo\rSAP components are backed up to DR location using an appropriate backup tool or ASR\rHigh\rDisaster Recovery\rNo\rNo\rSAP shared files systems are replicated or backed up to DR location\rHigh\rDisaster Recovery\rNo\rNo\rAutomate DR infrastructure build or pre-deploy DR resources\rMedium\rDisaster Recovery\rNo\rNo\rDocument and test DR procedure ensure it meets RPO and RTO targets\rMedium\rDisaster Recovery\rNo\rNo\rEnsure there is a robust monitoring and alerting solution in place for the entire DR solution\rMedium\rDisaster Recovery\rNo\rNo\rConfigure scheduled events notification\rHigh\rMonitoring and Alerting\rNo\rNo\rConfigure a Pacemaker cluster for SAP ASCS high availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the load balancer is configured correctly for SAP ASCS High availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the Pacemaker cluster has been setup for SAP HANA DB high availability\rHigh\rHigh Availability\rNo\rNo\rEnsure the load balancer is configured correctly for SAP HANA DB High availability\rHigh\rHigh Availability\rNo\rNo\rReview SAP configuration for timeout values used with Azure NetApp Files\rHigh\rHigh Availability\rNo\rNo\rProvision recommended storage configuration on database VMs\rHigh\rScalability\rNo\rNo\rDetails\rEnsure that each SAP production system is designed for high availability across availability zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra9b649a5-2bfe-40ca-9b8f-34f9c71dfa12\rDescription:\rUse Azure Availability Zones to protect SAP systems against data center failures."},{"id":274,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/scalingPlans/","title":"scalingPlans","parent":"DesktopVirtualization","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rCreate scaling plans per region\rMedium\rScalability\rNo\rNo\rDetails\rCreate scaling plans per region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r499769ae-67c9-492e-9ca5-cfd4cece5209\rDescription:\rScaling plans can only be assigned to host pools in the same region, on multi-region deployment scenario each region should has its own scaling plan. Potential Benefits:\rEnhanced scaling\rLearn More:\rCreate and assign an autoscale scaling plan\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rCreate scaling plans per region\rMedium\rScalability\rNo\rNo\rDetails\rCreate scaling plans per region\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r499769ae-67c9-492e-9ca5-cfd4cece5209\rDescription:\rScaling plans can only be assigned to host pools in the same region, on multi-region deployment scenario each region should has its own scaling plan. Potential Benefits:\rEnhanced scaling\rLearn More:\rCreate and assign an autoscale scaling plan\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":275,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Insights/scheduledQueryRules/","title":"scheduledQueryRules","parent":"Insights","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":276,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Search/","title":"Search","parent":"Azure Resources","content":"","description":""},{"id":277,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Search/searchServices/","title":"searchServices","parent":"Search","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":278,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/secrets/","title":"secrets","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":279,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/serverFarms/","title":"serverFarms","parent":"Web","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMigrate App Service to availability Zone Support\rHigh\rHigh Availability\rYes\rNo\rUse Standard or Premium tier\rHigh\rHigh Availability\rYes\rNo\rCreate separate App Service plans for production and test\rHigh\rGovernance\rNo\rNo\rEnable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rMedium\rScalability\rNo\rNo\rSet minimum instance count to 2 for app service\rHigh\rScalability\rYes\rNo\rDetails\rMigrate App Service to availability Zone Support\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r88cb90c2-3b99-814b-9820-821a63f600dd\rDescription:\rAzure\u0026#39;s feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services. Potential Benefits:\rEnhances app resiliency and reliability\rLearn More:\rMigrate App Service to availability zone support\rHigh availability enterprise deployment using App Service Environment\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // The query filters the qualified App Service Plans that do not have Zone Redundancy enabled. // Its important to check regions that support availability zones for Azure App Services running on multi-tenant and App Service Environments https://learn.microsoft.com/en-us/azure/reliability/reliability-app-service?tabs=graph%2Ccli#:~:text=The%20following%20regions%20support%20Azure%20App%20Services%20running%20on%20multi%2Dtenant%20environments%3A resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | extend zoneRedundant = tobool(properties.zoneRedundant) | extend sku_tier = tostring(sku.tier) | where (tolower(sku_tier) contains \u0026#34;isolated\u0026#34; or tolower(sku_tier) contains \u0026#34;premium\u0026#34;) and zoneRedundant == false | project recommendationId=\u0026#34;88cb90c2-3b99-814b-9820-821a63f600dd\u0026#34;, name, id, tags, param1=sku_tier, param2=\u0026#34;Not Zone Redundant\u0026#34; Use Standard or Premium tier\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb2113023-a553-2e41-9789-597e2fb54c31\rDescription:\rChoose Standard/Premium Azure App Service Plan for robust apps with advanced scaling, high availability, better performance, and multiple slots, ensuring resilience and continuous operation. Potential Benefits:\rEnhanced scaling and reliability\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure App Service Plans that are not in the \u0026#34;Standard\u0026#34;, \u0026#34;Premium\u0026#34;, or \u0026#34;IsolatedV2\u0026#34; SKU tiers. resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | extend sku_tier = tostring(sku.tier) | where tolower(sku_tier) !contains \u0026#34;standard\u0026#34; and tolower(sku_tier) !contains \u0026#34;premium\u0026#34; and tolower(sku_tier) !contains \u0026#34;isolatedv2\u0026#34; | project recommendationId=\u0026#34;b2113023-a553-2e41-9789-597e2fb54c31\u0026#34;, name, id, tags, param1= strcat(\u0026#34;SKU=\u0026#34;,sku_tier) Create separate App Service plans for production and test\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rdbe3fd66-fb2a-9d46-b162-1791e21da236\rDescription:\rIt is strongly recommended to create separate App Service plans for production and test environments to avoid using slots within your production deployment for testing purposes. Potential Benefits:\rProtects prod performance; avoids test impact\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Enable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r6320abf6-f917-1843-b2ae-4779c35985ae\rDescription:\rEnabling Autoscale/Automatic Scaling for your Azure App Service ensures sufficient resources for incoming requests. Autoscaling is rule-based, whereas Automatic Scaling, a newer feature, automatically adjusts resources based on HTTP traffic. Potential Benefits:\rOptimizes resources for traffic\rLearn More:\rAutomatic scaling in Azure App Service\rAuto Scale Web Apps\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Set minimum instance count to 2 for app service\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r855ca19a-6518-4f2e-9e5a-01796fbca9f8\rDescription:\rApp Service should be configured with a minimum of two instances for production workloads. If apps have a longer warmup time a minimum of three instances should be used. Potential Benefits:\rImproves app performance\rLearn More:\rUltimate guide to running healthy apps in the cloud\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of App services that do not have minimum instance count of 2 resources | where type == \u0026#34;microsoft.web/serverfarms\u0026#34; | where sku.capacity \u0026lt; 2 | project recommendationId = \u0026#34;855ca19a-6518-4f2e-9e5a-01796fbca9f8\u0026#34;, name, id, tags, param1 = \u0026#34;Instance count is less than 2\u0026#34; ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMigrate App Service to availability Zone Support\rHigh\rHigh Availability\rYes\rNo\rUse Standard or Premium tier\rHigh\rHigh Availability\rYes\rNo\rCreate separate App Service plans for production and test\rHigh\rGovernance\rNo\rNo\rEnable Autoscale/Automatic scaling to ensure adequate resources are available to service requests\rMedium\rScalability\rNo\rNo\rSet minimum instance count to 2 for app service\rHigh\rScalability\rYes\rNo\rDetails\rMigrate App Service to availability Zone Support\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r88cb90c2-3b99-814b-9820-821a63f600dd\rDescription:\rAzure\u0026#39;s feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services."},{"id":280,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/serverGroupsv2/","title":"serverGroupsv2","parent":"DBforPostgreSQL","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":281,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AnalysisServices/servers/","title":"servers","parent":"AnalysisServices","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":282,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMariaDB/servers/","title":"servers","parent":"DBforMariaDB","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":283,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforMySQL/servers/","title":"servers","parent":"DBforMySQL","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":284,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DBforPostgreSQL/servers/","title":"servers","parent":"DBforPostgreSQL","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":285,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/servers/","title":"servers","parent":"Sql","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rHigh\rDisaster Recovery\rYes\rYes\rAuto Failover Groups can encompass one or multiple databases, usually used by the same app.\rHigh\rDisaster Recovery\rYes\rNo\rEnable zone redundancy for Azure SQL Database to achieve high availability and resiliency\rMedium\rHigh Availability\rYes\rYes\rMonitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rHigh\rMonitoring and Alerting\rYes\rNo\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rNo\rUse Failover Group endpoints for database connections\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r74c2491d-048b-0041-a140-935960220e20\rDescription:\rActive Geo Replication ensures business continuity by utilizing readable secondary database replicas. In case of primary database failure, manually failover to secondary database. Secondaries, up to four, can be in same/different regions, used for read-only access. Potential Benefits:\rEnhanced disaster recovery and read scalability\rLearn More:\rActive Geo Replication\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not part of Geo Replication. resources | where type == \u0026#34;microsoft.sql/servers/databases\u0026#34; and name != \u0026#34;master\u0026#34; | summarize secondaryTypeCount = countif(isnotempty(properties.secondaryType)) by name | where secondaryTypeCount == 0 | join kind=inner ( resources | where type == \u0026#34;microsoft.sql/servers/databases\u0026#34; and name != \u0026#34;master\u0026#34; ) on name | extend param1 = \u0026#34;Not part of Geo Replication\u0026#34; | project recommendationId = \u0026#34;74c2491d-048b-0041-a140-935960220e20\u0026#34;, name, id, tags, param1 Auto Failover Groups can encompass one or multiple databases, usually used by the same app.\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r943c168a-2ec2-a94c-8015-85732a1b4859\rDescription:\rFailover Groups facilitate disaster recovery by configuring databases on one logical server to replicate to another region\u0026#39;s logical server. This streamlines geo-replicated database management, offering a single endpoint for connection routing to replicated databases if the primary server fails. Potential Benefits:\rImproves load balancing and disaster recovery\rLearn More:\rAutoFailover Groups\rDR Design\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not configured to use a failover-group. resources | where type =~\u0026#39;microsoft.sql/servers/databases\u0026#39; and name !~ \u0026#34;master\u0026#34; | where isnull(properties[\u0026#39;failoverGroupId\u0026#39;]) | project recommendationId = \u0026#34;943c168a-2ec2-a94c-8015-85732a1b4859\u0026#34;, name, id, tags, param1= strcat(\u0026#34;databaseId=\u0026#34;, properties[\u0026#39;databaseId\u0026#39;]) Enable zone redundancy for Azure SQL Database to achieve high availability and resiliency\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc0085c32-84c0-c247-bfa9-e70977cbf108\rDescription:\rBy default, Azure SQL Database premium tier provisions multiple copies within the same region. For geo redundancy, databases can be set as Zone Redundant, distributing copies across Azure Availability Zones to maintain availability during regional outages. Potential Benefits:\rEnhanced reliability, no extra cost\rLearn More:\rZone Redundant Databases\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Finds non-zone redundant SQL databases and lists them Resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where tolower(tostring(properties.zoneRedundant))=~\u0026#39;false\u0026#39; |project recommendationId = \u0026#34;c0085c32-84c0-c247-bfa9-e70977cbf108\u0026#34;, name, id, tags Monitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r7e7daec9-6a81-3546-a4cc-9aef72fec1f7\rDescription:\rMonitoring and alerting are an important part of database operations. When working with Azure SQL Database, make use of Azure Monitor and SQL Insights to ensure that you capture relevant database metrics. Potential Benefits:\rQuick incident detection and response\rLearn More:\rAzure Monitor\rAzure SQL Database Monitoring\rMonitoring SQL Database Reference\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of SQL databases that are not configured for monitoring. resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | project databaseid = properties_scopes, monitoredMetric = properties_criteria_allOf.metricName | where databaseid contains \u0026#39;databases\u0026#39; | summarize monitoredMetrics=make_list(monitoredMetric) by databaseid=tolower(tostring(databaseid)) | join kind=fullouter ( resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | project databaseid = tolower(id), name, tags ) on databaseid | where isnull(monitoredMetrics) | project recommendationId = \u0026#34;7e7daec9-6a81-3546-a4cc-9aef72fec1f7\u0026#34;, name, id=databaseid1, tags, param1=strcat(\u0026#34;MonitoringMetrics=false\u0026#34; ) Back Up Your Keys\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rd6ef87aa-574e-584e-a955-3e6bb8b5425b\rDescription:\rIt is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up and stored in a secure manner. Potential Benefits:\rEnhanced security and data recovery\rLearn More:\rAzure Key Vault\rGetting Started with Always Encrypted\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Use Failover Group endpoints for database connections\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rde266d8a-a9f3-4cb9-be95-9306001fceea\rDescription:\rWhen using Failover Groups, it is recommended to connect to the Failover Group endpoint instead of individual database endpoints. This allows for automatic redirection to the secondary database in case of a failover, ensuring high availability. Potential Benefits:\rEnhanced disaster recovery\rLearn More:\rFailover Group endpoint redirection\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rHigh\rDisaster Recovery\rYes\rYes\rAuto Failover Groups can encompass one or multiple databases, usually used by the same app.\rHigh\rDisaster Recovery\rYes\rNo\rEnable zone redundancy for Azure SQL Database to achieve high availability and resiliency\rMedium\rHigh Availability\rYes\rYes\rMonitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents\rHigh\rMonitoring and Alerting\rYes\rNo\rBack Up Your Keys\rMedium\rDisaster Recovery\rNo\rNo\rUse Failover Group endpoints for database connections\rHigh\rDisaster Recovery\rNo\rNo\rDetails\rUse Active Geo Replication to Create a Readable Secondary in Another Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r74c2491d-048b-0041-a140-935960220e20\rDescription:\rActive Geo Replication ensures business continuity by utilizing readable secondary database replicas."},{"id":286,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ApiManagement/service/","title":"service","parent":"ApiManagement","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMigrate API Management services to Premium SKU to support Availability Zones\rHigh\rHigh Availability\rYes\rNo\rEnable Availability Zones on Premium API Management instances\rHigh\rHigh Availability\rYes\rNo\rAzure API Management platform version should be stv2\rHigh\rHigh Availability\rYes\rYes\rEnable auto-scale for production workloads on API Management services\rLow\rHigh Availability\rNo\rNo\rDetails\rMigrate API Management services to Premium SKU to support Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbaf3bfc0-32a2-4c0c-926d-c9bf0b49808e\rDescription:\rUpgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions. Potential Benefits:\rEnhanced availability and resilience\rLearn More:\rChange your API Management service tier\rMigrate Azure API Management to availability zone support\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all API Management instances that aren\u0026#39;t Premium resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend skuName = sku.name | where tolower(skuName) != tolower(\u0026#39;premium\u0026#39;) | project recommendationId = \u0026#34;baf3bfc0-32a2-4c0c-926d-c9bf0b49808e\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SKU: \u0026#34;, skuName) Enable Availability Zones on Premium API Management instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r740f2c1c-8857-4648-80eb-47d2c56d5a50\rDescription:\rZone redundancy for APIM instances ensures the gateway and control plane (Management API, developer portal, Git configuration) are replicated across datacenters in physically separated zones, boosting resilience to zone failures. Potential Benefits:\rImproved resilience to zone failures\rLearn More:\rEnsure API Management availability and reliability\rMigrate Azure API Management to availability zone support\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Premium API Management instances that aren\u0026#39;t zone redundant resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | extend skuName = sku.name | where tolower(skuName) == tolower(\u0026#39;premium\u0026#39;) | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend zoneValue = iff((isnull(zones)), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;740f2c1c-8857-4648-80eb-47d2c56d5a50\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Zones value: \u0026#34;, zoneValue ) Azure API Management platform version should be stv2\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re35cf148-8eee-49d1-a1c9-956160f99e0b\rDescription:\rstv1 instances were deprecated on August 31, 2024. If not migrated to stv2 by then, auto-migration will occur. In some cases, due to technical limitations, services may be shut down in March 2025. Potential Benefits:\rEnsures service continuity\rLearn More:\rAzure API Management - stv1 platform retirement (August 2024)\rAzure API Management compute platform\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all API Management instances that aren\u0026#39;t upgraded to platform version stv2 resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend plat_version = properties.platformVersion | extend skuName = sku.name | where tolower(plat_version) != tolower(\u0026#39;stv2\u0026#39;) | project recommendationId = \u0026#34;e35cf148-8eee-49d1-a1c9-956160f99e0b\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Platform Version: \u0026#34;, plat_version) , param2=strcat(\u0026#34;SKU: \u0026#34;, skuName) Enable auto-scale for production workloads on API Management services\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc79680ea-de85-44fa-a596-f31fa17a952f\rDescription:\rUse API Management with auto-scale for high availability in workloads that experience variable traffic patterns. There are several limitations with auto-scale, so review the documentation to ensure it meets your requirements. Potential Benefits:\rEnhanced availability and resilience\rLearn More:\rSetting up auto-scale for Azure API Management\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMigrate API Management services to Premium SKU to support Availability Zones\rHigh\rHigh Availability\rYes\rNo\rEnable Availability Zones on Premium API Management instances\rHigh\rHigh Availability\rYes\rNo\rAzure API Management platform version should be stv2\rHigh\rHigh Availability\rYes\rYes\rEnable auto-scale for production workloads on API Management services\rLow\rHigh Availability\rNo\rNo\rDetails\rMigrate API Management services to Premium SKU to support Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbaf3bfc0-32a2-4c0c-926d-c9bf0b49808e\rDescription:\rUpgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions."},{"id":287,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceBus/","title":"ServiceBus","parent":"Azure Resources","content":"","description":""},{"id":288,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabric/","title":"ServiceFabric","parent":"Azure Resources","content":"","description":""},{"id":289,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/","title":"ServiceFabricMesh","parent":"Azure Resources","content":"","description":""},{"id":290,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceNetworking/","title":"ServiceNetworking","parent":"Azure Resources","content":"","description":""},{"id":291,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/services/","title":"services","parent":"HealthcareApis","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":292,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServicesHub/","title":"ServicesHub","parent":"Azure Resources","content":"","description":""},{"id":293,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/signalR/","title":"signalR","parent":"SignalRService","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for SignalR\rHigh\rHigh Availability\rYes\rNo\rDetails\rEnable zone redundancy for SignalR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6a8b3db9-5773-413a-a127-4f7032f34bbd\rDescription:\rUse SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime. Potential Benefits:\rEnhances reliability and uptime\rLearn More:\rAvailability zones support in Azure SignalR Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find SignalR instances that are not configured with the Premium tier resources | where type == \u0026#34;microsoft.signalrservice/signalr\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where sku.tier != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;6a8b3db9-5773-413a-a127-4f7032f34bbd\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable zone redundancy for SignalR\rHigh\rHigh Availability\rYes\rNo\rDetails\rEnable zone redundancy for SignalR\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r6a8b3db9-5773-413a-a127-4f7032f34bbd\rDescription:\rUse SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime. Potential Benefits:\rEnhances reliability and uptime\rLearn More:\rAvailability zones support in Azure SignalR Service\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":294,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/","title":"SignalRService","parent":"Azure Resources","content":"","description":""},{"id":295,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Singularity/","title":"Singularity","parent":"Azure Resources","content":"","description":""},{"id":296,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/sites/","title":"sites","parent":"Web","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable diagnostics logging\rLow\rMonitoring and Alerting\rNo\rNo\rMonitor Performance\rHigh\rMonitoring and Alerting\rNo\rNo\rSeparate web apps from web APIs\rLow\rScalability\rNo\rNo\rCreate a separate storage account for logs\rMedium\rScalability\rNo\rNo\rDeploy to a staging slot\rLow\rGovernance\rYes\rYes\rStore configuration as app settings\rMedium\rOther Best Practices\rYes\rNo\rEnable Health check for App Services\rHigh\rOther Best Practices\rYes\rNo\rEnable auto heal for Functions App\rLow\rHigh Availability\rYes\rNo\rNo warmup trigger added to Function App\rMedium\rMonitoring and Alerting\rNo\rNo\rEnsure unique hostid set for Function App\rLow\rGovernance\rNo\rNo\rEnsure Function App runs a supported version\rMedium\rGovernance\rNo\rNo\rEnsure FUNCTIONS_WORKER_RUNTIME is set properly\rMedium\rGovernance\rNo\rNo\rDetails\rEnable diagnostics logging\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r493f6079-3bb6-4a56-96ba-ab3248474cb1\rDescription:\rEnabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging. Potential Benefits:\rMonitoring and Alerting\rLearn More:\rEnable diagnostics logging for apps in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Monitor Performance\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\ra7e8bb3d-8ceb-442d-b26f-007cd63f9ffc\rDescription:\rUse Application Insights to monitor app performance and load behavior, offering real-time insights, issue diagnosis, and root-cause analysis. It supports ASP.NET, ASP.NET Core, Java, and Node.js on Azure App Service, now with built-in monitoring. Potential Benefits:\rReal-time insights and issue diagnosis\rLearn More:\rApplication Insights\rApplication monitoring for Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Separate web apps from web APIs\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r78a5c033-ff51-4332-8a71-83464c34494b\rDescription:\rIf your solution includes both a web front end and a web API, decomposing them into separate App Service apps facilitates solution decomposition by workload, allowing for independent scaling. Initially, you can deploy both in the same plan and separate them for independent scaling when necessary. Potential Benefits:\rIndependent scaling, easier management\rLearn More:\rResiliency checklist for specific Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a separate storage account for logs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r3f9ddb59-0bb3-4acb-9c9b-99aa1776f0ab\rDescription:\rCreating a separate storage account for logs and not using the same one for application data prevents logging activities from reducing application performance by ensuring that the resources dedicated to handling application data are not burdened by logging processes. Potential Benefits:\rImproves app performance\rLearn More:\rResiliency checklist\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Deploy to a staging slot\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\ra1d91661-32d4-430b-b3b6-5adeb0975df7\rDescription:\rCreate a deployment slot for staging to deploy updates, verify them, and ensure all instances are warmed up before production swap, reducing bad update chances. An LKG slot allows easy rollback to a previous good deployment if issues arise later, enhancing reliability. Potential Benefits:\rSafer updates and easy rollback\rLearn More:\rSet up staging environments in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Display App Service with the count of deployment slots for Apps under eligible App service plans and it shows if deployment slot is enabled or not resources | where type =~ \u0026#39;microsoft.web/sites\u0026#39; or type =~ \u0026#39;microsoft.web/sites/slots\u0026#39; | extend isSlot = iff(type =~ \u0026#39;microsoft.web/sites/slots\u0026#39;, 1, 0) | extend AspName = iff(isSlot == 1, split(name, \u0026#39;/\u0026#39;)[0], name) | extend Sku = tostring(properties.sku) | where tolower(Sku) contains \u0026#34;standard\u0026#34; or tolower(Sku) contains \u0026#34;premium\u0026#34; or tolower(Sku) contains \u0026#34;isolatedv2\u0026#34; | project id, name, AspName, isSlot, Sku | summarize Slots = countif(isSlot == 1) by id, name, AspName, Sku | extend DeploymentSlotEnabled = iff(Slots \u0026gt; 1, true, false) | where DeploymentSlotEnabled = false | project recommendationId=\u0026#34;a1d91661-32d4-430b-b3b6-5adeb0975df7\u0026#34;, name, id, tags=\u0026#34;\u0026#34;, param1=Sku, param2=Slots, param3=\u0026#34;DeploymentSlotEnabled=false\u0026#34; Store configuration as app settings\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r0b80b67c-afbe-4988-ad58-a85a146b681e\rDescription:\rUse app settings for configuration and define them in Resource Manager templates or via PowerShell to facilitate part of an automated deployment/update process for improved reliability. Potential Benefits:\rEnhanced reliability via automation\rLearn More:\rConfigure web apps in Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure App Service resources that don\u0026#39;t have App Settings configured appserviceresources | where type == \u0026#34;microsoft.web/sites/config\u0026#34; | extend AppSettings = iif(isempty(properties.AppSettings), true, false) | where AppSettings == false | extend id = replace(@\u0026#34;/config/web$\u0026#34;, \u0026#34;\u0026#34;, id) | project recommendationId=\u0026#34;0b80b67c-afbe-4988-ad58-a85a146b681e\u0026#34;, id, name, tags=\u0026#34;\u0026#34;, param1=\u0026#34;AppSettings is not configured\u0026#34; Enable Health check for App Services\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\rfd049c28-ae6d-48f0-a641-cc3ba1a3fe1d\rDescription:\rUse Health Check for production workloads. Health check increases your application\u0026#39;s availability by rerouting requests away from unhealthy instances, and replacing instances if they remain unhealthy. The Health check path should check critical components of your application. Potential Benefits:\rEnhanced reliability via automation\rLearn More:\rMonitor the health of App Service instances\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Check if Health Check is enabled for App Service resources | where type =~ \u0026#39;microsoft.web/sites\u0026#39; | where properties.kind has \u0026#39;app\u0026#39; | join kind = inner ( appserviceresources | where isnull(properties.HealthCheckPath) == true | project name ) on name | project recommendationId = \u0026#34;fd049c28-ae6d-48f0-a641-cc3ba1a3fe1d\u0026#34;, name, id, tags, param1 = \u0026#34;Healthcheckpath = not set\u0026#34; Enable auto heal for Functions App\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rc6c4b962-5af4-447a-9d74-7b9c53a5dff5\rDescription:\rAuto Heal allows you to mitigate your apps when it runs into unexpected situations like HTTP server errors, resource exhaustion, etc. You can configure different triggers based on your need and choose to recycle the app to recover it from a bad state. Potential Benefits:\rImproved app availability\rLearn More:\rAnnouncing the New Auto Healing Experience in App Service Diagnostics - Azure App Service\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Function App resources that do not have auto heal enabled Resources | where type =~ \u0026#39;microsoft.web/sites\u0026#39; | where properties.kind contains \u0026#39;functionapp\u0026#39; | join kind=inner (appserviceresources | where type == \u0026#34;microsoft.web/sites/config\u0026#34; | where properties.AutoHealEnabled == \u0026#39;false\u0026#39; | project id, name, tenantId, location, resourceGroup, properties.AutoHealEnabled ) on name | project recommendationID = \u0026#34;c6c4b962-5af4-447a-9d74-7b9c53a5dff5\u0026#34;, name, id, type, kind, param1=\u0026#34;AutoHealEnabled =false\u0026#34; No warmup trigger added to Function App\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r52f368ee-1d77-4b34-92db-64be269642d0\rDescription:\rAdd a warmup trigger to pre-load custom dependencies during the pre-warming process so that your functions are ready to start processing requests immediately. Potential Benefits:\rImproved app availability\rLearn More:\rAzure Functions Warmup Trigger\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure unique hostid set for Function App\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r0b06a688-0dd6-4d73-9f72-6666ff853ca9\rDescription:\rA host ID must be between 1 and 32 characters, contain only lowercase letters, numbers, and dashes, not start or end with a dash, and not contain consecutive dashes. The host ID value should be unique for all apps/slots you\u0026#39;re running. Potential Benefits:\rEasier management\rLearn More:\rResource naming restrictions - Azure Resource Manager\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure Function App runs a supported version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rc9a278b7-024b-454b-bd54-41587c512b74\rDescription:\rBeginning on December 13, 2022, function apps running on versions 2.x and 3.x of the Azure Functions runtime have reached the end of life (EOL) of extended support. We highly recommend you migrating your function apps to version 4.x of the Functions runtime. Potential Benefits:\rBetter governance\rLearn More:\rMigrate version 3.x to 4.x\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Ensure FUNCTIONS_WORKER_RUNTIME is set properly\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r7c608f46-46b2-4cc0-bbd6-1d457c16671c\rDescription:\rThe FUNCTIONS_WORKER_RUNTIME setting in the Function App configuration should be set to the appropriate value based on the language you are using. This setting is used to determine the language worker that will be used to execute your functions. Potential Benefits:\rBetter governance\rLearn More:\rFUNCTIONS_WORKER_RUNTIME\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable diagnostics logging\rLow\rMonitoring and Alerting\rNo\rNo\rMonitor Performance\rHigh\rMonitoring and Alerting\rNo\rNo\rSeparate web apps from web APIs\rLow\rScalability\rNo\rNo\rCreate a separate storage account for logs\rMedium\rScalability\rNo\rNo\rDeploy to a staging slot\rLow\rGovernance\rYes\rYes\rStore configuration as app settings\rMedium\rOther Best Practices\rYes\rNo\rEnable Health check for App Services\rHigh\rOther Best Practices\rYes\rNo\rEnable auto heal for Functions App\rLow\rHigh Availability\rYes\rNo\rNo warmup trigger added to Function App\rMedium\rMonitoring and Alerting\rNo\rNo\rEnsure unique hostid set for Function App\rLow\rGovernance\rNo\rNo\rEnsure Function App runs a supported version\rMedium\rGovernance\rNo\rNo\rEnsure FUNCTIONS_WORKER_RUNTIME is set properly\rMedium\rGovernance\rNo\rNo\rDetails\rEnable diagnostics logging\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r493f6079-3bb6-4a56-96ba-ab3248474cb1\rDescription:\rEnabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging."},{"id":297,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/snapshots/","title":"snapshots","parent":"Compute","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":298,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Orbital/spacecrafts/","title":"spacecrafts","parent":"Orbital","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":299,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/IntegrationSpaces/spaces/","title":"spaces","parent":"IntegrationSpaces","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":300,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MixedReality/spatialAnchorsAccounts/","title":"spatialAnchorsAccounts","parent":"MixedReality","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":301,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AppPlatform/Spring/","title":"Spring","parent":"AppPlatform","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":302,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/","title":"Sql","parent":"Azure Resources","content":"","description":""},{"id":303,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/","title":"SqlVirtualMachine","parent":"Azure Resources","content":"","description":""},{"id":304,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/sqlVirtualMachineGroups/","title":"sqlVirtualMachineGroups","parent":"SqlVirtualMachine","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":305,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SqlVirtualMachine/sqlVirtualMachines/","title":"sqlVirtualMachines","parent":"SqlVirtualMachine","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":306,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/staticSites/","title":"staticSites","parent":"Web","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":307,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Storage/","title":"Storage","parent":"Azure Resources","content":"","description":""},{"id":308,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Storage/storageAccounts/","title":"storageAccounts","parent":"Storage","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure that storage accounts are zone or region redundant\rHigh\rHigh Availability\rYes\rNo\rEnable Soft Delete to protect your data\rMedium\rDisaster Recovery\rNo\rYes\rEnable versioning for accidental modification and keep the number of versions below 1000\rLow\rDisaster Recovery\rNo\rNo\rEnable point-in-time restore for GPv2 accounts to safeguard against data loss\rLow\rDisaster Recovery\rNo\rNo\rMonitor all blob storage accounts\rLow\rMonitoring and Alerting\rNo\rNo\rConsider upgrading legacy storage accounts to v2 storage accounts\rLow\rScalability\rYes\rNo\rDetails\rEnsure that storage accounts are zone or region redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re6c7e1cc-2f47-264d-aa50-1da421314472\rDescription:\rRedundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability. Locally redundant storage offers the least durability at the lowest cost. Potential Benefits:\rHigh availability and durability for storage\rLearn More:\rAzure Storage redundancy\rChange the redundancy configuration for a storage account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This query will return all storage accounts that are not using Zone or Region replication Resources | where type =~ \u0026#34;Microsoft.Storage/storageAccounts\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where sku.name in~ (\u0026#34;Standard_LRS\u0026#34;, \u0026#34;Premium_LRS\u0026#34;) | project recommendationId = \u0026#34;e6c7e1cc-2f47-264d-aa50-1da421314472\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;sku: \u0026#34;, sku.name) Enable Soft Delete to protect your data\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r03263c57-c869-3841-9e0a-3dbb9ef3e28d\rDescription:\rThe soft delete option enables data recovery if mistakenly deleted, while the Lock feature prevents the accidental deletion of the storage account itself, ensuring additional security and data integrity measures. Potential Benefits:\rPrevents accidental data/account loss\rLearn More:\rSoft delete detail docs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable versioning for accidental modification and keep the number of versions below 1000\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r8ebda7c0-e0e1-ed45-af59-2d7ea9a1c05d\rDescription:\rConsider enabling versioning for Azure Storage Accounts to recover from accidental modifications or deletions and manage blob operation latency. Microsoft advises maintaining fewer than 1000 versions per blob to optimize performance. Lifecycle management can help delete old versions automatically. Potential Benefits:\rRecover data, manage latency\rLearn More:\rBlob versioning\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable point-in-time restore for GPv2 accounts to safeguard against data loss\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1b965cb9-7629-214e-b682-6bf6e450a100\rDescription:\rConsider enabling point-in-time restore for standard general purpose v2 accounts with flat namespace to protect against accidental deletion or corruption by restoring block blob data to an earlier state. Potential Benefits:\rProtects data from loss/corruption\rLearn More:\rPoint-in-time restore for block blobs\rPerform a point-in-time restore on block blob data\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor all blob storage accounts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r96cb8331-6b06-8242-8ce8-4e2f665dc679\rDescription:\rFor critical applications and business processes relying on Azure, monitoring and alerts are crucial. Resource logs are only stored after creating a diagnostic setting to route logs to specified locations, requiring selection of log categories to collect. Potential Benefits:\rEnhanced alerting and log analysis\rLearn More:\rMonitor Azure Blob Storage\rBest practices for monitoring Azure Blob Storage\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Consider upgrading legacy storage accounts to v2 storage accounts\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r2ad78dec-5a4d-4a30-8fd1-8584335ad781\rDescription:\rGeneral-purpose v2 accounts are recommended for most storage scenarios offering the latest features or the lowest per-gigabyte pricing. Legacy accounts like Standard general-purpose v1 and Blob Storage aren\u0026#39;t advised by Microsoft but may fit specific scenarios. Potential Benefits:\rLatest features, lowest cost\rLearn More:\rLegacy storage account types\rUpgrade to a general-purpose v2 storage account\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Storage Accounts, that upgradeable to General purpose v2. Resources | where type =~ \u0026#34;Microsoft.Storage/storageAccounts\u0026#34; and kind in~ (\u0026#34;Storage\u0026#34;, \u0026#34;BlobStorage\u0026#34;) | extend param1 = strcat(\u0026#34;AccountKind: \u0026#34;, case(kind =~ \u0026#34;Storage\u0026#34;, \u0026#34;Storage (general purpose v1)\u0026#34;, kind =~ \u0026#34;BlobStorage\u0026#34;, \u0026#34;BlobStorage\u0026#34;, kind)), param2 = strcat(\u0026#34;Performance: \u0026#34;, sku.tier), param3 = strcat(\u0026#34;Replication: \u0026#34;, sku.name) | project recommendationId = \u0026#34;2ad78dec-5a4d-4a30-8fd1-8584335ad781\u0026#34;, name, id, tags, param1, param2, param3 ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure that storage accounts are zone or region redundant\rHigh\rHigh Availability\rYes\rNo\rEnable Soft Delete to protect your data\rMedium\rDisaster Recovery\rNo\rYes\rEnable versioning for accidental modification and keep the number of versions below 1000\rLow\rDisaster Recovery\rNo\rNo\rEnable point-in-time restore for GPv2 accounts to safeguard against data loss\rLow\rDisaster Recovery\rNo\rNo\rMonitor all blob storage accounts\rLow\rMonitoring and Alerting\rNo\rNo\rConsider upgrading legacy storage accounts to v2 storage accounts\rLow\rScalability\rYes\rNo\rDetails\rEnsure that storage accounts are zone or region redundant\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\re6c7e1cc-2f47-264d-aa50-1da421314472\rDescription:\rRedundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability."},{"id":309,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/storageAppliances/","title":"storageAppliances","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":310,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageCache/","title":"StorageCache","parent":"Azure Resources","content":"","description":""},{"id":311,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageSync/","title":"StorageSync","parent":"Azure Resources","content":"","description":""},{"id":312,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StorageSync/storageSyncServices/","title":"storageSyncServices","parent":"StorageSync","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":313,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/","title":"StreamAnalytics","parent":"Azure Resources","content":"","description":""},{"id":314,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/StreamAnalytics/streamingJobs/","title":"streamingJobs","parent":"StreamAnalytics","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRun jobs in your own dedicated Stream Analytics cluster for increased reliability and security\rMedium\rScalability\rYes\rNo\rMigrate Stream Analytics jobs to StandardV2 SKU\rHigh\rHigh Availability\rYes\rNo\rDetails\rRun jobs in your own dedicated Stream Analytics cluster for increased reliability and security\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\re48a7227-5ec7-463a-b955-ee7cb598ded4\rDescription:\rStream Analytics cluster (dedicated) offers more reliable performance guarantees. All the jobs running on your cluster belong only to you. You can also have access to important features like private endpoints, Auto-Scaling, Vnet Support, etc. Potential Benefits:\rEnhanced reliability and security\rLearn More:\rOverview of Azure Stream Analytics Cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Stream Analytics jobs that are not associated with a dedicated cluster resources | where type =~ \u0026#34;Microsoft.StreamAnalytics/streamingjobs\u0026#34; | where isnull(properties.cluster.id) | project recommendationId = \u0026#34;e48a7227-5ec7-463a-b955-ee7cb598ded4\u0026#34;, name, id, tags Migrate Stream Analytics jobs to StandardV2 SKU\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5d40d3d4-179d-4cf5-ac24-901210f512e7\rDescription:\rConfigure Autoscale to allow your job to dynamically change the allocated number of Streaming Units (SU) based on load, metrics, and/or schedule. Potential Benefits:\rEnhanced reliability and security\rLearn More:\rUnderstand and adjust streaming units\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Stream Analytics jobs that are not using the latest version of the service. resources | where type =~ \u0026#34;Microsoft.StreamAnalytics/streamingjobs\u0026#34; | where properties.sku.name !~ \u0026#34;StandardV2\u0026#34; | project recommendationId = \u0026#34;5d40d3d4-179d-4cf5-ac24-901210f512e7\u0026#34;, name, id, tags ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRun jobs in your own dedicated Stream Analytics cluster for increased reliability and security\rMedium\rScalability\rYes\rNo\rMigrate Stream Analytics jobs to StandardV2 SKU\rHigh\rHigh Availability\rYes\rNo\rDetails\rRun jobs in your own dedicated Stream Analytics cluster for increased reliability and security\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\re48a7227-5ec7-463a-b955-ee7cb598ded4\rDescription:\rStream Analytics cluster (dedicated) offers more reliable performance guarantees."},{"id":315,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/","title":"Subscription","parent":"Azure Resources","content":"","description":""},{"id":316,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/subscriptions/","title":"subscriptions","parent":"Resources","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Resource Group and its Resources are located in the same Region\rHigh\rDisaster Recovery\rYes\rNo\rDetails\rEnsure Resource Group and its Resources are located in the same Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r98bd7098-49d6-491b-86f1-b143d6b1a0ff\rDescription:\rEnsure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only. Potential Benefits:\rImproves outage management\rLearn More:\rAzure Resource Manager Overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Azure Resource Groups that have resources deployed in a region different than the Resource Group region resourcecontainers | where type =~ \u0026#34;Microsoft.Resources/subscriptions/resourceGroups\u0026#34; | project resourceGroupId = tolower(id), resourceGroupLocation = location | join kind = inner ( resources | where location !~ \u0026#34;Global\u0026#34; and // Exclude global resources resourceGroup !~ \u0026#34;NetworkWatcherRG\u0026#34; and // Exclude resources in the NetworkWatcherRG id has \u0026#34;/resourceGroups/\u0026#34; // Exclude resources not in a resource group | project id, name, tags, resourceGroup, location, resourceGroupId = tolower(strcat_array(array_slice(split(id, \u0026#34;/\u0026#34;), 0, 4), \u0026#34;/\u0026#34;)) ) on resourceGroupId | where resourceGroupLocation !~ location | project recommendationId = \u0026#34;98bd7098-49d6-491b-86f1-b143d6b1a0ff\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;resourceLocation: \u0026#34;, location), param2 = strcat(\u0026#34;resourceGroupLocation: \u0026#34;, resourceGroupLocation), param3 = strcat(\u0026#34;resourceGroup: \u0026#34;, resourceGroup) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure Resource Group and its Resources are located in the same Region\rHigh\rDisaster Recovery\rYes\rNo\rDetails\rEnsure Resource Group and its Resources are located in the same Region\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r98bd7098-49d6-491b-86f1-b143d6b1a0ff\rDescription:\rEnsure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only."},{"id":317,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Subscription/subscriptions/","title":"subscriptions","parent":"Subscription","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDo not create more than 2000 Citrix VDA servers per subscription\rHigh\rGovernance\rYes\rNo\rConfigure Service Health Alerts\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rDo not create more than 2000 Citrix VDA servers per subscription\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rc041d596-6c97-4c5f-b4b3-9cd37628f2e2\rDescription:\rA Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors. When close to the limit, signaled by a dashboard notification, and with sufficient licenses, request another subscription. Can\u0026#39;t exceed the given limits for catalogs. Potential Benefits:\rAvoids hitting limit, ensures reliability\rLearn More:\rCitrix Limits\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Count VM instances with a tag that contains \u0026#34;Citrix VDA\u0026#34; and create output if that count is \u0026gt;2000 for each subscription. // The Citrix published limit is 2500. This query runs an 80% check. resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | where tags contains \u0026#39;Citrix VDA\u0026#39; | summarize VMs=count() by subscriptionId | where VMs \u0026gt; 2000 | join (resourcecontainers| where type ==\u0026#39;microsoft.resources/subscriptions\u0026#39; | project subname=name, subscriptionId) on subscriptionId | project recommendationId=\u0026#39;c041d596-6c97-4c5f-b4b3-9cd37628f2e2\u0026#39;, name= subname, id = subscriptionId, param1=\u0026#39;Too many instances.\u0026#39;, param2= VMs Configure Service Health Alerts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r9729c89d-8118-41b4-a39b-e12468fa872b\rDescription:\rService health gives a personalized health view of Azure services and regions used, offering the best place for notifications on outages, planned maintenance, and health advisories by knowing the services used. Potential Benefits:\rProactive outage and maintenance alerts\rLearn More:\rWhat is Azure Service Health?\rConfigure alerts for service health events\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all subscriptions without Service Health alerts configured AND subscriptions with Service Health alerts only configured with specific configuration (which requires manual verification regarding the scope being covered by this rule) resourcecontainers | where type == \u0026#39;microsoft.resources/subscriptions\u0026#39; | project subscriptionId = id, subscriptionName = name, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/activitylogalerts\u0026#34; and properties.condition contains \u0026#34;ServiceHealth\u0026#34; | extend shaRuleType = iff(array_length(properties.condition.allOf) \u0026gt; 1, \u0026#39;Explicit\u0026#39;,\u0026#39;All\u0026#39;) | project subscriptionId = strcat(\u0026#39;/subscriptions/\u0026#39;,subscriptionId), name, shaRuleType | summarize shaAllRuleCount = countif(shaRuleType == \u0026#39;All\u0026#39;), shaExplicitRuleCount = countif(shaRuleType == \u0026#39;Explicit\u0026#39;) by subscriptionId ) on subscriptionId | extend shaStatus = iff(isnull(shaAllRuleCount) and isnull(shaExplicitRuleCount), \u0026#39;Not configured\u0026#39;,iff(shaAllRuleCount \u0026gt;= 1, \u0026#39;Configured\u0026#39;, \u0026#39;Explicit\u0026#39;)) | where shaStatus != \u0026#39;Configured\u0026#39; | project recommendationId = \u0026#34;9729c89d-8118-41b4-a39b-e12468fa872b\u0026#34;, name = subscriptionName, id= subscriptionId, tags, param1 = iff(shaStatus == \u0026#39;Explicit\u0026#39;, \u0026#39;Explicit only Service Health Alert Rule(s) found. Please verify that the expected scope is covered by these rule(s).\u0026#39;,\u0026#39;No Service Health Alert Rule found.\u0026#39;) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDo not create more than 2000 Citrix VDA servers per subscription\rHigh\rGovernance\rYes\rNo\rConfigure Service Health Alerts\rHigh\rMonitoring and Alerting\rYes\rNo\rDetails\rDo not create more than 2000 Citrix VDA servers per subscription\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rc041d596-6c97-4c5f-b4b3-9cd37628f2e2\rDescription:\rA Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors."},{"id":318,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Synapse/","title":"Synapse","parent":"Azure Resources","content":"","description":""},{"id":319,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/systemTopics/","title":"systemTopics","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":320,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Resources/tags/","title":"tags","parent":"Resources","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":321,"href":"/Azure-Proactive-Resiliency-Library-v2/tags/","title":"Tags","parent":"Azure Proactive Resiliency Library v2","content":"","description":""},{"id":322,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/TestBase/","title":"TestBase","parent":"Azure Resources","content":"","description":""},{"id":323,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/TestBase/testBaseAccounts/","title":"testBaseAccounts","parent":"TestBase","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":324,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/topics/","title":"topics","parent":"EventGrid","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Diagnostic Settings for all Azure Event Grid resources\rLow\rMonitoring and Alerting\rNo\rNo\rConfigure Dead-letter to save events that cannot be delivered\rLow\rPersonalized\rNo\rNo\rDetails\rConfigure Diagnostic Settings for all Azure Event Grid resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r54c3191b-b535-1946-bba9-b754f44060f6\rDescription:\rEnabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively. Potential Benefits:\rEnhanced troubleshooting for Event Grid\rLearn More:\rAzure Event Grid - Enable diagnostic logs for Event Grid resources\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure Dead-letter to save events that cannot be delivered\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rPersonalized\rAPRL GUID:\u0026nbsp;\r92162eb5-4323-3145-8a6c-525ce2f0700e\rDescription:\rEvent Grid may not deliver an event within a specific time or after several attempts, leading to dead-lettering where undelivered events are sent to a storage account. Potential Benefits:\rSaves undelivered events\rLearn More:\rAzure Event Grid delivery and retry\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConfigure Diagnostic Settings for all Azure Event Grid resources\rLow\rMonitoring and Alerting\rNo\rNo\rConfigure Dead-letter to save events that cannot be delivered\rLow\rPersonalized\rNo\rNo\rDetails\rConfigure Diagnostic Settings for all Azure Event Grid resources\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r54c3191b-b535-1946-bba9-b754f44060f6\rDescription:\rEnabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively."},{"id":325,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/EventGrid/topicTypes/","title":"topicTypes","parent":"EventGrid","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":326,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceNetworking/trafficControllers/","title":"trafficControllers","parent":"ServiceNetworking","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":327,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/trafficManagerProfiles/","title":"trafficManagerProfiles","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rTraffic Manager Monitor Status Should be Online\rHigh\rHigh Availability\rYes\rNo\rTraffic manager profiles should have more than one endpoint\rMedium\rHigh Availability\rYes\rYes\rEnsure endpoint configured to (All World) for geographic profiles\rHigh\rDisaster Recovery\rYes\rYes\rAvoid combining Traffic Manager and Front Door\rHigh\rBusiness Continuity\rYes\rNo\rDetails\rTraffic Manager Monitor Status Should be Online\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf05a3e6d-49db-2740-88e2-2b13706c1f67\rDescription:\rMonitor status should be online to ensure failover for application workload. If Traffic Manager\u0026#39;s health shows Degraded, one or more endpoints may also be Degraded. Potential Benefits:\rEnsures failover functionality\rLearn More:\rAzure Traffic Manager endpoint monitoring\rEnable or disable health checks\rTroubleshooting degraded state on Azure Traffic Manager\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find traffic manager profiles that have an endpoint monitor status of not \u0026#39;Online\u0026#39; resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | mv-expand properties.endpoints | where properties_endpoints.properties.endpointMonitorStatus != \u0026#34;Online\u0026#34; | project recommendationId = \u0026#34;f05a3e6d-49db-2740-88e2-2b13706c1f67\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;Profile name: \u0026#39;,properties_endpoints.name), param2 = strcat(\u0026#39;endpointMonitorStatus: \u0026#39;, properties_endpoints.properties.endpointMonitorStatus) Traffic manager profiles should have more than one endpoint\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5b422a7f-8caa-3d48-becb-511599e5bba9\rDescription:\rWhen configuring the Azure traffic manager, provision at least two endpoints to ensure workloads can fail-over to another instance, enhancing reliability and availability. Potential Benefits:\rEnhances failover capabilities\rLearn More:\rTraffic Manager Endpoint Types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find traffic manager profiles that have less than 2 endpoints resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | where array_length(properties.endpoints) \u0026lt; 2 | project recommendationId = \u0026#34;5b422a7f-8caa-3d48-becb-511599e5bba9\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;EndpointCount: \u0026#39;, array_length(properties.endpoints)) Ensure endpoint configured to (All World) for geographic profiles\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rc31f76a0-48cd-9f44-aa43-99ee904db9bc\rDescription:\rFor geographic routing, traffic is directed to endpoints based on specific regions. If a region fails, without a predefined failover, configuring an endpoint to \u0026#34;All (World)\u0026#34; for geographic profiles can prevent traffic black holes, ensuring service remains available. Potential Benefits:\rAvoids traffic black holing, ensures availability\rLearn More:\rAdd an endpoint configured to \u0026#34;All (World)\u0026#34;\rTraffic Manager profile - GeographicProfile (Add an endpoint configured to \u0026#34;\u0026#34;All (World)\u0026#34;\u0026#34;).\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of Traffic Manager resources that are not confirgured for all-World access Resources | where type == \u0026#39;microsoft.network/trafficmanagerprofiles\u0026#39; | where properties.trafficRoutingMethod =~ \u0026#34;Geographic\u0026#34; | extend endpoints = properties.endpoints | mv-expand endpoint = endpoints | where endpoint.properties.geoMapping !contains \u0026#34;WORLD\u0026#34; | extend endpointName = endpoint.name | project recommendationId=\u0026#34;c31f76a0-48cd-9f44-aa43-99ee904db9bc\u0026#34;, name, id, tags, param1=strcat(\u0026#34;endpointName:\u0026#34;,endpointName), param2=strcat(\u0026#34;GeoMapping:\u0026#34;, tostring(endpoint.properties.geoMapping)) Avoid combining Traffic Manager and Front Door\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\r9437634c-d69e-2747-b13e-631c13182150\rDescription:\rFor most solutions, choose either Azure Front Door for content caching, CDN, TLS termination, and WAF, or Traffic Manager for simple global load balancing. Potential Benefits:\rOptimized network routing and security\rLearn More:\rAzure Load Balancing Options\rAzure Traffic Manager\rAzure Front Door\rMission-critical global content delivery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Avoid combining Traffic Manager and Front Door resources | where type == \u0026#34;microsoft.network/trafficmanagerprofiles\u0026#34; | mvexpand(properties.endpoints) | extend endpoint=tostring(properties_endpoints.properties.target) | project name, trafficmanager=id, matchname=endpoint, tags | join ( resources | where type =~ \u0026#34;microsoft.cdn/profiles/afdendpoints\u0026#34; | extend matchname= tostring(properties.hostName) | extend splitid=split(id, \u0026#34;/\u0026#34;) | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \u0026#34;/\u0026#34;)) | project name, id, matchname, frontdoorid, type | union (cdnresources | where type =~ \u0026#34;Microsoft.Cdn/Profiles/CustomDomains\u0026#34; | extend matchname= tostring(properties.hostName) | extend splitid=split(id, \u0026#34;/\u0026#34;) | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \u0026#34;/\u0026#34;)) | project name, id, matchname, frontdoorid, type) ) on matchname | project recommendationId = \u0026#34;9437634c-d69e-2747-b13e-631c13182150\u0026#34;, name=split(trafficmanager, \u0026#34;/\u0026#34;)[-1], id=trafficmanager, tags, param1=strcat(\u0026#34;hostname:\u0026#34;, matchname), param2=strcat(\u0026#34;frontdoorid:\u0026#34;, frontdoorid) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rTraffic Manager Monitor Status Should be Online\rHigh\rHigh Availability\rYes\rNo\rTraffic manager profiles should have more than one endpoint\rMedium\rHigh Availability\rYes\rYes\rEnsure endpoint configured to (All World) for geographic profiles\rHigh\rDisaster Recovery\rYes\rYes\rAvoid combining Traffic Manager and Front Door\rHigh\rBusiness Continuity\rYes\rNo\rDetails\rTraffic Manager Monitor Status Should be Online\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rf05a3e6d-49db-2740-88e2-2b13706c1f67\rDescription:\rMonitor status should be online to ensure failover for application workload."},{"id":328,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/trunkedNetworks/","title":"trunkedNetworks","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":329,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quota/usages/","title":"usages","parent":"Quota","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":330,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/KeyVault/vaults/","title":"vaults","parent":"KeyVault","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rKey vaults should have soft delete enabled\rHigh\rDisaster Recovery\rYes\rYes\rKey vaults should have purge protection enabled\rMedium\rDisaster Recovery\rYes\rYes\rDiagnostic logs in Key Vault should be enabled\rLow\rMonitoring and Alerting\rNo\rYes\rDetails\rKey vaults should have soft delete enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1cca00d2-d9ab-8e42-a788-5d40f49405cb\rDescription:\rKey Vault\u0026#39;s soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates. When enabled, marked resources are retained for 90 days, allowing for their recovery, essentially undoing deletion. Potential Benefits:\rEnables recovery of deleted items\rLearn More:\rAzure Key Vault soft-delete overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This Resource Graph query will return all Key Vaults that do not have soft delete enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enableSoftDelete) or properties.enableSoftDelete != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;1cca00d2-d9ab-8e42-a788-5d40f49405cb\u0026#34;, name, id, tags, param1 = \u0026#34;EnableSoftDelete: Disabled\u0026#34; Key vaults should have purge protection enabled\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r70fcfe6d-00e9-5544-a63a-fff42b9f2edb\rDescription:\rPurge protection secures against malicious deletions by enforcing a retention period for soft deleted key vaults, ensuring no one, not even insiders or Microsoft, can purge your key vaults during this period, preventing permanent data loss. Potential Benefits:\rProtects from insider attacks, avoids data loss\rLearn More:\rAzure Key Vault purge-protection overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // This resource graph query will return all Key Vaults that do not have Purge Protection enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enablePurgeProtection) or properties.enablePurgeProtection != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;70fcfe6d-00e9-5544-a63a-fff42b9f2edb\u0026#34;, name, id, tags, param1 = \u0026#34;EnablePurgeProtection: Disabled\u0026#34; Diagnostic logs in Key Vault should be enabled\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1dc0821d-4f14-7644-bab4-ba208ff5f7fa\rDescription:\rEnable logs, set up alerts, and adhere to retention requirements for improved monitoring and security of Key Vault access, detailing the frequency and identity of users. Potential Benefits:\rEnhanced monitoring and security compliance\rLearn More:\rAzure Key Vault logging overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rKey vaults should have soft delete enabled\rHigh\rDisaster Recovery\rYes\rYes\rKey vaults should have purge protection enabled\rMedium\rDisaster Recovery\rYes\rYes\rDiagnostic logs in Key Vault should be enabled\rLow\rMonitoring and Alerting\rNo\rYes\rDetails\rKey vaults should have soft delete enabled\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1cca00d2-d9ab-8e42-a788-5d40f49405cb\rDescription:\rKey Vault\u0026#39;s soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates."},{"id":331,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/RecoveryServices/vaults/","title":"vaults","parent":"RecoveryServices","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rHigh\rDisaster Recovery\rNo\rNo\rValidate VM functionality with a Site Recovery test failover to check performance at target\rHigh\rDisaster Recovery\rYes\rNo\rMigrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rMedium\rMonitoring and Alerting\rNo\rYes\rEnable Cross Region Restore for your GRS Recovery Services Vault\rMedium\rDisaster Recovery\rYes\rYes\rEnable Soft Delete for Recovery Services Vaults in Azure Backup\rMedium\rDisaster Recovery\rYes\rNo\rDetails\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re93bb813-b356-48f3-9bdf-a06a0a6ba039\rDescription:\rEnsure VM failover settings\u0026#39; static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it\u0026#39;s available or the next available IP otherwise. IP adjustments can be made in VM Network settings. Potential Benefits:\rSmooth failover IP management\rLearn More:\rSetup network mapping for site recovery\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Validate VM functionality with a Site Recovery test failover to check performance at target\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r17e877f7-3a89-4205-8a24-0670de54ddcd\rDescription:\rPerform a test failover to validate your BCDR strategy and ensure that your applications are functioning correctly in the target region without impacting your production environment. Test your Disaster Recovery plan periodically without any data loss or downtime, using test failovers. Potential Benefits:\rEnsures BCDR plan accuracy and VM performance\rLearn More:\rRun a test failover\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs where replication has been enabled but Test Failover was never performed recoveryservicesresources | where type == \u0026#34;microsoft.recoveryservices/vaults/replicationfabrics/replicationprotectioncontainers/replicationprotecteditems\u0026#34; | where properties.providerSpecificDetails.dataSourceInfo.datasourceType == \u0026#39;AzureVm\u0026#39; and isnull(properties.lastSuccessfulTestFailoverTime) | project recommendationId=\u0026#34;17e877f7-3a89-4205-8a24-0670de54ddcd\u0026#34; , name = properties.providerSpecificDetails.recoveryAzureVMName, id=properties.providerSpecificDetails.dataSourceInfo.resourceId Migrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r2912472d-0198-4bdc-aa90-37f145790edc\rDescription:\rClassic alerts for Recovery Services vaults in Azure Backup will be retired on 31 March 2026. Potential Benefits:\rEnhanced, scalable, and consistent alerting.\rLearn More:\rMove to Azure monitor Alerts\rClassic alerts retirement announcement\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Cross Region Restore for your GRS Recovery Services Vault\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1549b91f-2ea0-4d4f-ba2a-4596becbe3de\rDescription:\rCross Region Restore enables the restoration of Azure VMs in a secondary, Azure paired region, facilitating drills for audit or compliance and allowing recovery of VMs or disks in the event of a primary region disaster. It is an opt-in feature available exclusively for GRS vaults. Potential Benefits:\rEnhances disaster recovery capabilities\rLearn More:\rSet Cross Region Restore\rAzure Backup Best Practices\rMinimum Role Requirements for Cross Region Restore\rRecovery Services Vault\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Displays all recovery services vaults that do not have cross region restore enabled resources | where type =~ \u0026#34;Microsoft.RecoveryServices/vaults\u0026#34; and properties.redundancySettings.standardTierStorageRedundancy =~ \u0026#34;GeoRedundant\u0026#34; and properties.redundancySettings.crossRegionRestore !~ \u0026#34;Enabled\u0026#34; | extend param1 = strcat(\u0026#34;CrossRegionRestore: \u0026#34;, properties.redundancySettings.crossRegionRestore), param2 = strcat(\u0026#34;StorageReplicationType: \u0026#34;, properties.redundancySettings.standardTierStorageRedundancy) | project recommendationId = \u0026#34;1549b91f-2ea0-4d4f-ba2a-4596becbe3de\u0026#34;, name, id, tags, param1, param2 Enable Soft Delete for Recovery Services Vaults in Azure Backup\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r9e39919b-78af-4a0b-b70f-c548dae97c25\rDescription:\rWith soft delete, if backup data is deleted, the backup data is retained for 14 additional days, allowing the recovery of that backup item with no data loss with no cost to you. Soft delete is enabled by default. Disabling this feature isn\u0026#39;t recommended. Potential Benefits:\rEnhances disaster recovery capabilities\rLearn More:\rSoft Delete for Azure Backup\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Azure Recovery Services vaults that do not have soft delete enabled resources | where type == \u0026#34;microsoft.recoveryservices/vaults\u0026#34; | mv-expand issoftDelete=properties.securitySettings.softDeleteSettings.softDeleteState | where issoftDelete == \u0026#39;Disabled\u0026#39; | project recommendationId = \u0026#34;9e39919b-78af-4a0b-b70f-c548dae97c25\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Soft Delete: \u0026#34;,issoftDelete) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rHigh\rDisaster Recovery\rNo\rNo\rValidate VM functionality with a Site Recovery test failover to check performance at target\rHigh\rDisaster Recovery\rYes\rNo\rMigrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults\rMedium\rMonitoring and Alerting\rNo\rYes\rEnable Cross Region Restore for your GRS Recovery Services Vault\rMedium\rDisaster Recovery\rYes\rYes\rEnable Soft Delete for Recovery Services Vaults in Azure Backup\rMedium\rDisaster Recovery\rYes\rNo\rDetails\rEnsure static IP addresses in Site Recovery VM failover settings are available in failover subnet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\re93bb813-b356-48f3-9bdf-a06a0a6ba039\rDescription:\rEnsure VM failover settings\u0026#39; static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it\u0026#39;s available or the next available IP otherwise."},{"id":332,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VideoIndexer/","title":"VideoIndexer","parent":"Azure Resources","content":"","description":""},{"id":333,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Sql/virtualClusters/","title":"virtualClusters","parent":"Sql","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":334,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualHubs/","title":"virtualHubs","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor health for v-Hubs\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor health for v-Hubs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r30ec8a5e-46de-4323-87e9-a7c56b72813b\rDescription:\rSet up monitoring and alerts for v-Hubs. Create alert rule for ensuring promptly response to changes in BGP status and Data processed by v-Hubs.\rPotential Benefits:\rDetection and mitigation to avoid disruptions.\rLearn More:\rVirtual WAN Monitoring Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor health for v-Hubs\rMedium\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor health for v-Hubs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r30ec8a5e-46de-4323-87e9-a7c56b72813b\rDescription:\rSet up monitoring and alerts for v-Hubs. Create alert rule for ensuring promptly response to changes in BGP status and Data processed by v-Hubs.\rPotential Benefits:\rDetection and mitigation to avoid disruptions.\rLearn More:\rVirtual WAN Monitoring Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query"},{"id":335,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/VirtualMachineImages/","title":"VirtualMachineImages","parent":"Azure Resources","content":"","description":""},{"id":336,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/virtualMachineInstances/","title":"virtualMachineInstances","parent":"AzureStackHCI","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":337,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/AzureStackHCI/virtualMachines/","title":"virtualMachines","parent":"AzureStackHCI","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":338,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/virtualMachines/","title":"virtualMachines","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRun production workloads on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rDeploy VMs across Availability Zones\rHigh\rHigh Availability\rYes\rYes\rMigrate VMs using availability sets to VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rReplicate VMs using Azure Site Recovery\rMedium\rDisaster Recovery\rYes\rYes\rUse Managed Disks for VM disks\rHigh\rHigh Availability\rYes\rYes\rBackup VMs with Azure Backup service\rMedium\rDisaster Recovery\rYes\rYes\rEnable Accelerated Networking (AccelNet)\rMedium\rScalability\rYes\rYes\rWhen AccelNet is enabled, you must manually update the GuestOS NIC driver\rLow\rGovernance\rNo\rNo\rIP Forwarding should only be enabled for Network Virtual Appliances\rMedium\rSecurity\rYes\rYes\rEnable VM Insights\rLow\rMonitoring and Alerting\rYes\rNo\rConfigure monitoring for all Azure Virtual Machines\rLow\rMonitoring and Alerting\rYes\rNo\rUse maintenance configurations for the VMs\rHigh\rHigh Availability\rYes\rNo\rDon\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rHigh\rScalability\rYes\rNo\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rYes\rUse Azure Boost VMs for Maintenance sensitive workload\rMedium\rHigh Availability\rNo\rNo\rEnable Scheduled Events for Maintenance sensitive workload VMs\rMedium\rHigh Availability\rNo\rNo\rReserve Compute Capacity for critical workloads\rHigh\rHigh Availability\rYes\rNo\rReserve Compute Capacity in Disaster Recovery Regions\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rRun production workloads on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r273f6b30-68e0-4241-85ea-acf15ffb60bf\rDescription:\rProduction VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates. Potential Benefits:\rEnhanced fault/update resilience\rLearn More:\rWhat has changed with Flexible orchestration mode\rAttach or detach a Virtual Machine to or from a Virtual Machine Scale Set\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not associated with a VMSS Flex instance resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.virtualMachineScaleSet.id) | project recommendationId=\u0026#34;273f6b30-68e0-4241-85ea-acf15ffb60bf\u0026#34;, name, id, tags Deploy VMs across Availability Zones\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2bd0be95-a825-6f47-a8c6-3db1fb5eb387\rDescription:\rAzure Availability Zones, within each Azure region, are tolerant to local failures, protecting applications and data against unlikely Datacenter failures by being physically separate. Potential Benefits:\rEnhanced VM resilience to failures\rLearn More:\rCreate virtual machines in an availability zone using the Azure portal\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not assigned to a Zone Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where isnull(zones) | project recommendationId=\u0026#34;2bd0be95-a825-6f47-a8c6-3db1fb5eb387\u0026#34;, name, id, tags, param1=\u0026#34;No Zone\u0026#34; Migrate VMs using availability sets to VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\ra8d25876-7951-b646-b4e8-880c9031596b\rDescription:\rWhile availability sets are not scheduled for immediate deprecation, they are planned to be deprecated in the future. Migrate workloads from VMs to VMSS Flex for deployment across zones or within the same zone across different fault domains (FDs) for better reliability. Potential Benefits:\rEnhances reliability and future-proofs VMs\rLearn More:\rMigrate deployments and resources to Virtual Machine Scale Sets in Flexible orchestration\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs using Availability Sets resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.availabilitySet) | project recommendationId = \u0026#34;a8d25876-7951-b646-b4e8-880c9031596b\u0026#34;, name, id, tags, param1=strcat(\u0026#34;availabilitySet: \u0026#34;,properties.availabilitySet.id) Replicate VMs using Azure Site Recovery\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rcfe22a65-b1db-fd41-9e8e-d573922709ae\rDescription:\rReplicating Azure VMs via Site Recovery entails continuous, asynchronous disk replication to a target region. Recovery points are generated every few minutes, ensuring a Recovery Point Objective (RPO) in minutes. Potential Benefits:\rMinimize downtime in disasters\rLearn More:\rResiliency checklist for Virtual Machines\rRun a test failover (disaster recovery drill) to Azure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have replication with ASR enabled resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | extend securityType = iif(isnull(properties.securityProfile.securityType), \u0026#34;Standard\u0026#34;, properties.securityProfile.securityType) | where securityType !in~ (\u0026#34;TrustedLaunch\u0026#34;, \u0026#34;ConfidentialVM\u0026#34;) | project id, vmIdForJoin = tolower(id), name, tags | join kind = leftouter ( recoveryservicesresources | where type =~ \u0026#34;Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems\u0026#34; and properties.providerSpecificDetails.dataSourceInfo.datasourceType =~ \u0026#34;AzureVm\u0026#34; | project vmResourceId = tolower(properties.providerSpecificDetails.dataSourceInfo.resourceId) ) on $left.vmIdForJoin == $right.vmResourceId | where isempty(vmResourceId) | project recommendationId = \u0026#34;cfe22a65-b1db-fd41-9e8e-d573922709ae\u0026#34;, name, id, tags Use Managed Disks for VM disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r122d11d7-b91f-8747-a562-f56b79bcfbdc\rDescription:\rAzure is retiring unmanaged disks on September 30, 2025. Users should plan the migration to avoid disruptions and maintain service reliability. Potential Benefits:\rAvoid retirement disruption, enhance reliability\rLearn More:\rMigrate your Azure unmanaged disks by Sep 30, 2025\rMigrate Windows VM from unmanaged disks to managed disks\rMigrate Linux VM from unmanaged disks to managed disks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that are not using Managed Disks Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.storageProfile.osDisk.managedDisk) | project recommendationId = \u0026#34;122d11d7-b91f-8747-a562-f56b79bcfbdc\u0026#34;, name, id, tags Backup VMs with Azure Backup service\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r1981f704-97b9-b645-9c57-33f8ded9261a\rDescription:\rEnable backups for your virtual machines with Azure Backup to secure and quickly recover your data. This service offers simple, secure, and cost-effective solutions for backing up and recovering data from the Microsoft Azure cloud. Potential Benefits:\rSecure data recovery and backup\rLearn More:\rWhat is the Azure Backup service?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have Backup enabled // Run query to see results. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project name, id, tags | join kind=leftouter ( recoveryservicesresources | where type =~ \u0026#39;Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\u0026#39; | where properties.dataSourceInfo.datasourceType =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project idBackupEnabled=properties.sourceResourceId | extend name=strcat_array(array_slice(split(idBackupEnabled, \u0026#39;/\u0026#39;), 8, -1), \u0026#39;/\u0026#39;) ) on name | where isnull(idBackupEnabled) | project-away idBackupEnabled | project-away name1 | project recommendationId = \u0026#34;1981f704-97b9-b645-9c57-33f8ded9261a\u0026#34;, name, id, tags | order by id asc Enable Accelerated Networking (AccelNet)\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rdfedbeb1-1519-fc47-86a5-52f96cf07105\rDescription:\rAccelerated networking enables SR-IOV to a VM, greatly improving its networking performance by bypassing the host from the data path, which reduces latency, jitter, and CPU utilization for demanding network workloads on supported VM types. Potential Benefits:\rReduces latency, jitter and CPU use\rLearn More:\rAccelerated Networking (AccelNet) overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VM NICs that do not have Accelerated Networking enabled resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand nic = properties.networkProfile.networkInterfaces | project name, id, tags, lowerCaseNicId = tolower(nic.id), vmSize = tostring(properties.hardwareProfile.vmSize) | join kind = inner ( resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableAcceleratedNetworking == false | project nicName = split(id, \u0026#34;/\u0026#34;)[8], lowerCaseNicId = tolower(id) ) on lowerCaseNicId | summarize nicNames = make_set(nicName) by name, id, tostring(tags), vmSize | extend param1 = strcat(\u0026#34;NicName: \u0026#34;, strcat_array(nicNames, \u0026#34;, \u0026#34;)), param2 = strcat(\u0026#34;VMSize: \u0026#34;, vmSize) | project recommendationId = \u0026#34;dfedbeb1-1519-fc47-86a5-52f96cf07105\u0026#34;, name, id, tags, param1, param2 | order by id asc When AccelNet is enabled, you must manually update the GuestOS NIC driver\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r73d1bb04-7d3e-0d47-bc0d-63afe773b5fe\rDescription:\rWhen Accelerated Networking is enabled, the default Azure VNet interface in GuestOS is swapped for a Mellanox, and its driver comes from a 3rd party. Marketplace images have the latest Mellanox drivers, but post-deployment, updating the driver is the user\u0026#39;s responsibility. Potential Benefits:\rEnhanced VM network efficiency\rLearn More:\rAccelerated Networking (AccelNet) overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg IP Forwarding should only be enabled for Network Virtual Appliances\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rSecurity\rAPRL GUID:\u0026nbsp;\r41a22a5e-5e08-9647-92d0-2ffe9ef1bdad\rDescription:\rIP forwarding allows a virtual machine network interface to receive and send network traffic not destined for or originating from its assigned IP addresses. Potential Benefits:\rEnhances network appliance function\rLearn More:\rEnable or disable IP forwarding\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VM NICs that have IPForwarding enabled. This feature is usually only required for Network Virtual Appliances Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableIPForwarding == true | project nicId = tostring(id) ) on nicId | project recommendationId = \u0026#34;41a22a5e-5e08-9647-92d0-2ffe9ef1bdad\u0026#34;, name, id, tags | order by id asc Enable VM Insights\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rb72214bb-e879-5f4b-b9cd-642db84f36f4\rDescription:\rVM Insights monitors VM and scale set performance, health, running processes, and dependencies. It enhances the predictability of application performance and availability by pinpointing performance bottlenecks and network issues, and it clarifies if problems are related to other dependencies. Potential Benefits:\rImproves VM performance and health\rLearn More:\rOverview of VM insights\rDid the extension install properly?\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Check for VMs without Azure Monitoring Agent extension installed, missing Data Collection Rule or Data Collection Rule without performance enabled. Resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | project idVm = tolower(id), name, tags | join kind=leftouter ( InsightsResources | where type =~ \u0026#34;Microsoft.Insights/dataCollectionRuleAssociations\u0026#34; and id has \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | project idDcr = tolower(properties.dataCollectionRuleId), idVmDcr = tolower(substring(id, 0, indexof(id, \u0026#34;/providers/Microsoft.Insights/dataCollectionRuleAssociations/\u0026#34;)))) on $left.idVm == $right.idVmDcr | join kind=leftouter ( Resources | where type =~ \u0026#34;Microsoft.Insights/dataCollectionRules\u0026#34; | extend isPerformanceEnabled = iif(properties.dataSources.performanceCounters contains \u0026#34;Microsoft-InsightsMetrics\u0026#34; and properties.dataFlows contains \u0026#34;Microsoft-InsightsMetrics\u0026#34;, true, false), isMapEnabled = iif(properties.dataSources.extensions contains \u0026#34;Microsoft-ServiceMap\u0026#34; and properties.dataSources.extensions contains \u0026#34;DependencyAgent\u0026#34; and properties.dataFlows contains \u0026#34;Microsoft-ServiceMap\u0026#34;, true, false)//, | where isPerformanceEnabled or isMapEnabled | project dcrName = name, isPerformanceEnabled, isMapEnabled, idDcr = tolower(id)) on $left.idDcr == $right.idDcr | join kind=leftouter ( Resources | where type == \u0026#39;microsoft.compute/virtualmachines/extensions\u0026#39; and (name contains \u0026#39;AzureMonitorWindowsAgent\u0026#39; or name contains \u0026#39;AzureMonitorLinuxAgent\u0026#39;) | extend idVmExtension = tolower(substring(id, 0, indexof(id, \u0026#39;/extensions\u0026#39;))), extensionName = name) on $left.idVm == $right.idVmExtension | where isPerformanceEnabled != 1 or (extensionName != \u0026#39;AzureMonitorWindowsAgent\u0026#39; and extensionName != \u0026#39;AzureMonitorLinuxAgent\u0026#39;) | project recommendationId = \u0026#34;b72214bb-e879-5f4b-b9cd-642db84f36f4\u0026#34;, name, id = idVm, tags, param1 = strcat(\u0026#39;MonitoringExtension:\u0026#39;, extensionName), param2 = strcat(\u0026#39;DataCollectionRuleId:\u0026#39;, idDcr), param3 = strcat(\u0026#39;isPerformanceEnabled:\u0026#39;, isPerformanceEnabled) Configure monitoring for all Azure Virtual Machines\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r4a9d8973-6dba-0042-b3aa-07924877ebd5\rDescription:\rAzure Monitor Metrics automatically receives platform metrics, but platform logs, which offer detailed diagnostics and auditing for resources and their Azure platform, need to be manually routed for collection. Potential Benefits:\rEnhanced diagnostics and auditing capability\rLearn More:\rAzure Monitor Agent overview\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Virtual Machines without diagnostic settings enabled/with diagnostic settings enabled but not configured both performance counters and event logs/syslogs. resources | where type =~ \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project name, id, tags, lowerCaseVmId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines/extensions\u0026#34; and properties.publisher =~ \u0026#34;Microsoft.Azure.Diagnostics\u0026#34; | project lowerCaseVmIdOfExtension = tolower(substring(id, 0, indexof(id, \u0026#34;/extensions/\u0026#34;))), extensionType = properties.type, provisioningState = properties.provisioningState, storageAccount = properties.settings.StorageAccount, // Windows wadPerfCounters = properties.settings.WadCfg.DiagnosticMonitorConfiguration.PerformanceCounters.PerformanceCounterConfiguration, wadEventLogs = properties.settings.WadCfg.DiagnosticMonitorConfiguration.WindowsEventLog, // Linux ladPerfCounters = properties.settings.ladCfg.diagnosticMonitorConfiguration.performanceCounters.performanceCounterConfiguration, ladSyslog = properties.settings.ladCfg.diagnosticMonitorConfiguration.syslogEvents | extend // Windows isWadPerfCountersConfigured = iif(array_length(wadPerfCounters) \u0026gt; 0, true, false), isWadEventLogsConfigured = iif(isnotnull(wadEventLogs) and array_length(wadEventLogs.DataSource) \u0026gt; 0, true, false), // Linux isLadPerfCountersConfigured = iif(array_length(ladPerfCounters) \u0026gt; 0, true, false), isLadSyslogConfigured = isnotnull(ladSyslog) | project lowerCaseVmIdOfExtension, extensionType, provisioningState, storageAccount, isPerfCountersConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadPerfCountersConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadPerfCountersConfigured, false), isEventLogsConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadEventLogsConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadSyslogConfigured, false) ) on $left.lowerCaseVmId == $right.lowerCaseVmIdOfExtension | where isempty(lowerCaseVmIdOfExtension) or provisioningState !~ \u0026#34;Succeeded\u0026#34; or not(isPerfCountersConfigured and isEventLogsConfigured) | extend param1 = strcat(\u0026#34;DiagnosticSetting: \u0026#34;, iif(isnotnull(extensionType), strcat(\u0026#34;Enabled, partially configured (\u0026#34;, extensionType, \u0026#34;)\u0026#34;), \u0026#34;Not enabled\u0026#34;)), param2 = strcat(\u0026#34;ProvisioningState: \u0026#34;, iif(isnotnull(provisioningState), provisioningState, \u0026#34;n/a\u0026#34;)), param3 = strcat(\u0026#34;storageAccount: \u0026#34;, iif(isnotnull(storageAccount), storageAccount, \u0026#34;n/a\u0026#34;)), param4 = strcat(\u0026#34;PerformanceCounters: \u0026#34;, case(isnull(isPerfCountersConfigured), \u0026#34;n/a\u0026#34;, isPerfCountersConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)), param5 = strcat(\u0026#34;EventLogs/Syslogs: \u0026#34;, case(isnull(isEventLogsConfigured), \u0026#34;n/a\u0026#34;, isEventLogsConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)) | project recommendationId = \u0026#34;4a9d8973-6dba-0042-b3aa-07924877ebd5\u0026#34;, name, id, tags, param1, param2, param3, param4, param5 Use maintenance configurations for the VMs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r52ab9e5c-eec0-3148-8bd7-b6dd9e1be870\rDescription:\rThe maintenance configuration settings let users schedule and manage updates, making sure the updates or interruptions on the VM are performed within a planned timeframe. Potential Benefits:\rScheduled updates for VMs\rLearn More:\rUse maintenance configurations to control and manage the VM updates\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMS that do not have maintenance configuration assigned Resources | extend resourceId = tolower(id) | project name, location, type, id, tags, resourceId, properties | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | join kind=leftouter ( maintenanceresources | where type =~ \u0026#34;microsoft.maintenance/configurationassignments\u0026#34; | project planName = name, type, maintenanceProps = properties | extend resourceId = tostring(maintenanceProps.resourceId) ) on resourceId | where isnull(maintenanceProps) | project recommendationId = \u0026#34;52ab9e5c-eec0-3148-8bd7-b6dd9e1be870\u0026#34;,name, id, tags | order by id asc Don\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r3201dba8-d1da-4826-98a4-104066545170\rDescription:\rA-series VMs are tailored for entry-level workloads like development and testing, including use cases such as development and test servers, low traffic web servers, and small to medium databases. Potential Benefits:\rEnsures full CPU usage for heavy tasks\rLearn More:\rB-series burstable virtual machine sizes\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs using A or B series families resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | where properties.hardwareProfile.vmSize contains \u0026#34;Standard_B\u0026#34; or properties.hardwareProfile.vmSize contains \u0026#34;Standard_A\u0026#34; | project recommendationId = \u0026#34;3201dba8-d1da-4826-98a4-104066545170\u0026#34;, name, id, tags, param1=strcat(\u0026#34;vmSku: \u0026#34; , properties.hardwareProfile.vmSize) Mission Critical Workloads should consider using Premium or Ultra Disks\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rdf0ff862-814d-45a3-95e4-4fad5a244ba6\rDescription:\rCompared to Standard HDD and SSD, Premium SSD, SSD v2, and Ultra Disks offer improved performance, configurability, and higher single-instance VM uptime SLAs. The lowest SLA of all disks on a VM applies, so it is best to use Premium or Ultra Disks for the highest uptime SLA. Potential Benefits:\rEnhanced performance, cost efficiency, and uptime SLA\rLearn More:\rDisk type comparison and decision tree\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that have an attached disk that is not in the Premium or Ultra sku tier. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | extend lname = tolower(name) | join kind=leftouter(resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where not(sku.tier =~ \u0026#39;Premium\u0026#39;) and not(sku.tier =~ \u0026#39;Ultra\u0026#39;) | extend lname = tolower(tostring(split(managedBy, \u0026#39;/\u0026#39;)[8])) | project lname, name | summarize disks = make_list(name) by lname) on lname | where isnotnull(disks) | project recommendationId = \u0026#34;df0ff862-814d-45a3-95e4-4fad5a244ba6\u0026#34;, name, id, tags, param1=strcat(\u0026#34;AffectedDisks: \u0026#34;, disks) Use Azure Boost VMs for Maintenance sensitive workload\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r9ab499d8-8844-424d-a2d4-8f53690eb8f8\rDescription:\rIf the workload is Maintenance sensitive, consider Azure Boost compatible VMs. Azure Boost is designed to lessen the impact on customers when Azure maintenance activities occur on the host. Potential Benefits:\rLess maintenance impact\rLearn More:\rMicrosoft Azure Boost\rAnnouncing the general availability of Azure Boost\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Scheduled Events for Maintenance sensitive workload VMs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2de8fa5e-14f4-4c4c-857f-1520f87a629f\rDescription:\rIf your workload is Maintenance sensitive, enable Scheduled Events. This Azure Metadata Service lets your app prepare for virtual machine maintenance by providing information on upcoming events like reboots, reducing disruptions. Potential Benefits:\rMinimize downtime for VMs\rLearn More:\rMonitor scheduled events for your Azure VMs\rAzure Metadata Service Scheduled Events for Linux VMs\rAzure Metadata Service Scheduled Events for Windows VMs\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Reserve Compute Capacity for critical workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r302fda08-ee65-4fbe-a916-6dc0b33169c4\rDescription:\rAzure Capacity Reservations ensure high availability for virtual machines by reserving compute capacity in advance within a specific region or availability zone. This guarantees that VMs will have the necessary resources during peak demand or maintenance events, enhancing reliability and uptime. Potential Benefits:\rGuaranteed capacity in constrained regions/zones\rLearn More:\rOn-demand Capacity Reservation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Virtual Machines not associated with a Capacity Reservation, and provide details for Capacity Reservation like vmSize, location, and zone. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.capacityReservation) | extend zoneValue = iff(isnull(zones), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;302fda08-ee65-4fbe-a916-6dc0b33169c4\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;VmSize: \u0026#34;, properties.hardwareProfile.vmSize), param2 = strcat(\u0026#34;Location: \u0026#34;, location), param3 = strcat(\u0026#34;Zone: \u0026#34;, zoneValue) Reserve Compute Capacity in Disaster Recovery Regions\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r587ca3e4-113b-4c4f-b4e0-92cd8d2065b6\rDescription:\rOn-Demand Capacity Reservations ensure recovery of virtual machines in the event of a natural disaster by reserving compute capacity in advance within a specific region or zone. This guarantees that VMs have the necessary resources during disaster recovery failover events thus reducing downtime. Potential Benefits:\rGuaranteed capacity in disaster recovery regions\rLearn More:\rOn-demand Capacity Reservation\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rRun production workloads on two or more VMs using VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rDeploy VMs across Availability Zones\rHigh\rHigh Availability\rYes\rYes\rMigrate VMs using availability sets to VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rReplicate VMs using Azure Site Recovery\rMedium\rDisaster Recovery\rYes\rYes\rUse Managed Disks for VM disks\rHigh\rHigh Availability\rYes\rYes\rBackup VMs with Azure Backup service\rMedium\rDisaster Recovery\rYes\rYes\rEnable Accelerated Networking (AccelNet)\rMedium\rScalability\rYes\rYes\rWhen AccelNet is enabled, you must manually update the GuestOS NIC driver\rLow\rGovernance\rNo\rNo\rIP Forwarding should only be enabled for Network Virtual Appliances\rMedium\rSecurity\rYes\rYes\rEnable VM Insights\rLow\rMonitoring and Alerting\rYes\rNo\rConfigure monitoring for all Azure Virtual Machines\rLow\rMonitoring and Alerting\rYes\rNo\rUse maintenance configurations for the VMs\rHigh\rHigh Availability\rYes\rNo\rDon\u0026#39;t use A or B-Series VMs for production needing constant full CPU performance\rHigh\rScalability\rYes\rNo\rMission Critical Workloads should consider using Premium or Ultra Disks\rHigh\rScalability\rYes\rYes\rUse Azure Boost VMs for Maintenance sensitive workload\rMedium\rHigh Availability\rNo\rNo\rEnable Scheduled Events for Maintenance sensitive workload VMs\rMedium\rHigh Availability\rNo\rNo\rReserve Compute Capacity for critical workloads\rHigh\rHigh Availability\rYes\rNo\rReserve Compute Capacity in Disaster Recovery Regions\rMedium\rDisaster Recovery\rNo\rNo\rDetails\rRun production workloads on two or more VMs using VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r273f6b30-68e0-4241-85ea-acf15ffb60bf\rDescription:\rProduction VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates."},{"id":339,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/virtualMachines/","title":"virtualMachines","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":340,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Compute/virtualMachineScaleSets/","title":"virtualMachineScaleSets","parent":"Compute","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy VMSS with Flex orchestration mode instead of Uniform\rMedium\rScalability\rYes\rNo\rEnable Azure Virtual Machine Scale Set Application Health Monitoring\rMedium\rMonitoring and Alerting\rYes\rYes\rEnable Automatic Repair Policy on Azure Virtual Machine Scale Sets\rHigh\rHigh Availability\rYes\rYes\rConfigure VMSS Autoscale to custom and configure the scaling metrics\rHigh\rScalability\rYes\rNo\rEnable Predictive autoscale and configure at least for Forecast Only\rLow\rScalability\rYes\rNo\rDisable Force strictly even balance across zones to avoid scale in and out fail attempts\rHigh\rHigh Availability\rYes\rNo\rDeploy VMSS across availability zones with VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rUpgrade VMSS Image versions scheduled to be deprecated or already retired\rHigh\rGovernance\rNo\rYes\rDetails\rDeploy VMSS with Flex orchestration mode instead of Uniform\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\re7495e1c-0c75-0946-b266-b429b5c7f3bf\rDescription:\rDeploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability. This mode guarantees high availability (up to 1000 VMs) by distributing VMs across fault domains in a region or within an Availability Zone. Potential Benefits:\rHigher scalability and availability\rLearn More:\rWhen to use VMSS instead of VMs\rAzure Well-Architected Framework review - Virtual Machines and Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all zonal VMs that are NOT deployed with Flex orchestration mode resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode != \u0026#34;Flexible\u0026#34; | project recommendationId = \u0026#34;e7495e1c-0c75-0946-b266-b429b5c7f3bf\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;orchestrationMode: \u0026#34;, tostring(properties.orchestrationMode)) Enable Azure Virtual Machine Scale Set Application Health Monitoring\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r94794d2a-eff0-2345-9b67-6f9349d0a627\rDescription:\rMonitoring application health in Azure Virtual Machine Scale Sets is crucial for deployment management. It supports rolling upgrades such as automatic OS-image upgrades and VM guest patching, leveraging health monitoring for upgrading. Potential Benefits:\rEnhances deployment management and upgrades\rLearn More:\rUsing Application Health extension with Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have health monitoring enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=leftouter ( resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | mv-expand extension=properties.virtualMachineProfile.extensionProfile.extensions | where extension.properties.type in ( \u0026#34;ApplicationHealthWindows\u0026#34;, \u0026#34;ApplicationHealthLinux\u0026#34; ) | project id ) on id | where id1 == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;94794d2a-eff0-2345-9b67-6f9349d0a627\u0026#34;, name, id, tags, param1 = \u0026#34;extension: null\u0026#34; Enable Automatic Repair Policy on Azure Virtual Machine Scale Sets\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r820f4743-1f94-e946-ae0b-45efafd87962\rDescription:\rEnabling automatic instance repairs in Azure Virtual Machine Scale Sets enhances application availability through a continuous health check and maintenance process. Potential Benefits:\rBoosts app availability by auto-repair\rLearn More:\rAutomatic instance repairs for Azure Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all VMs that do NOT have automatic repair policy enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.automaticRepairsPolicy.enabled == false | project recommendationId = \u0026#34;820f4743-1f94-e946-ae0b-45efafd87962\u0026#34;, name, id, tags, param1 = \u0026#34;automaticRepairsPolicy: Disabled\u0026#34; Configure VMSS Autoscale to custom and configure the scaling metrics\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\ree66ff65-9aa3-2345-93c1-25827cf79f44\rDescription:\rUse custom autoscale for VMSS based on metrics and schedules to improve performance and cost effectiveness, adjusting instances as demand changes. Potential Benefits:\rEnhances performance and cost-efficiency\rLearn More:\rGet started with autoscale in Azure\rOverview of autoscale in Azure\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when autoscale is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where isnull(autoscalesettings) or autoscalesettings.enabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;ee66ff65-9aa3-2345-93c1-25827cf79f44\u0026#34;, name, id, tags, param1 = \u0026#34;autoscalesettings: Disabled\u0026#34; | order by id asc Enable Predictive autoscale and configure at least for Forecast Only\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r3f85a51c-e286-9f44-b4dc-51d00768696c\rDescription:\rPredictive autoscale utilizes machine learning to efficiently manage and scale Azure Virtual Machine Scale Sets by forecasting CPU load through historical usage analysis, ensuring timely scale-out to meet demand. Potential Benefits:\rOptimizes scaling with ML predictions\rLearn More:\rUse predictive autoscale to scale out before load demands in virtual machine scale sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when predictiveAutoscalePolicy_scaleMode is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where autoscalesettings.enabled == \u0026#34;true\u0026#34; and autoscalesettings.predictiveAutoscalePolicy.scaleMode == \u0026#34;Disabled\u0026#34; | project recommendationId = \u0026#34;3f85a51c-e286-9f44-b4dc-51d00768696c\u0026#34;, name, id, tags, param1 = \u0026#34;predictiveAutoscalePolicy_scaleMode: Disabled\u0026#34; | order by id asc Disable Force strictly even balance across zones to avoid scale in and out fail attempts\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb5a63aa0-c58e-244f-b8a6-cbba0560a6db\rDescription:\rMicrosoft advises disabling strictly even VM instance distribution across Availability Zones in VMSS to improve scalability and flexibility, noting that uneven distribution may better serve application load demands despite the potential trade-off in resilience. Potential Benefits:\rImproves scaling, reduces fail attempts\rLearn More:\rUse scale-in policies with Azure Virtual Machine Scale Sets\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances where strictly zoneBalance is set to True resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode == \u0026#34;Uniform\u0026#34; and properties.zoneBalance == true | project recommendationId = \u0026#34;b5a63aa0-c58e-244f-b8a6-cbba0560a6db\u0026#34;, name, id, tags, param1 = \u0026#34;strictly zoneBalance: Enabled\u0026#34; | order by id asc Deploy VMSS across availability zones with VMSS Flex\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r1422c567-782c-7148-ac7c-5fc14cf45adc\rDescription:\rWhen creating VMSS, implement availability zones as a protection measure for your applications and data against the rare event of datacenter failure. Potential Benefits:\rEnhances disaster resilience\rLearn More:\rCreate a Virtual Machine Scale Set that uses Availability Zones\rUpdate scale set to add availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find VMSS instances with one or no Zones selected resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;1422c567-782c-7148-ac7c-5fc14cf45adc\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc Upgrade VMSS Image versions scheduled to be deprecated or already retired\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r83d61669-7bd6-9642-a305-175db8adcdf4\rDescription:\rEnsure current versions of images are in use to avoid disruption after image deprecation. Please review the publisher, offer, sku information of the VM to ensure you are running on a supported image. Enable Auto Guest Patching or Image Upgrades, to get notifications about image deprecation. Potential Benefits:\rAvoid disruptions by updating VMSS images.\rLearn More:\rDeprecated Azure Marketplace images\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r//cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDeploy VMSS with Flex orchestration mode instead of Uniform\rMedium\rScalability\rYes\rNo\rEnable Azure Virtual Machine Scale Set Application Health Monitoring\rMedium\rMonitoring and Alerting\rYes\rYes\rEnable Automatic Repair Policy on Azure Virtual Machine Scale Sets\rHigh\rHigh Availability\rYes\rYes\rConfigure VMSS Autoscale to custom and configure the scaling metrics\rHigh\rScalability\rYes\rNo\rEnable Predictive autoscale and configure at least for Forecast Only\rLow\rScalability\rYes\rNo\rDisable Force strictly even balance across zones to avoid scale in and out fail attempts\rHigh\rHigh Availability\rYes\rNo\rDeploy VMSS across availability zones with VMSS Flex\rHigh\rHigh Availability\rYes\rNo\rUpgrade VMSS Image versions scheduled to be deprecated or already retired\rHigh\rGovernance\rNo\rYes\rDetails\rDeploy VMSS with Flex orchestration mode instead of Uniform\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\re7495e1c-0c75-0946-b266-b429b5c7f3bf\rDescription:\rDeploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability."},{"id":341,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworkGateways/","title":"virtualNetworkGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect ExpressRoute gateway with circuits from diverse peering locations\rHigh\rHigh Availability\rYes\rYes\rUse Zone-redundant ExpressRoute gateway SKUs\rHigh\rHigh Availability\rYes\rYes\rMonitor health for ExpressRoute gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rAvoid using ExpressRoute circuits for VNet to VNet communication\rMedium\rHigh Availability\rNo\rNo\rConfigure customer-controlled ExpressRoute gateway maintenance\rHigh\rHigh Availability\rYes\rNo\rChoose a Zone-redundant VPN gateway\rHigh\rHigh Availability\rYes\rNo\rEnable Active-Active VPN Gateways for redundancy\rMedium\rHigh Availability\rYes\rYes\rDeploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rHigh\rDisaster Recovery\rNo\rNo\rMonitor VPN gateway connections and health\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable VPN gateway service health\rHigh\rMonitoring and Alerting\rNo\rNo\rDeploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rHigh\rHigh Availability\rYes\rNo\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd37db635-157f-584d-9bce-4f6fc8c65ce5\rDescription:\rFor improved reliability, each ExpressRoute gateway should connect to at least two circuits, with each circuit sourced from a different peering location. This setup ensures diverse connectivity paths, enhancing resilience and minimizing service disruption risks. Potential Benefits:\rEnhanced resilience through diverse connectivity paths\rLearn More:\rDesigning for disaster recovery with ExpressRoute private peering\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of ExpressRoute Gateways that are not connected to two or more ExpressRoute Circuits. Baremetal circuits are excluded from consideration //This query assumes that the running entity has visibilty to the gateway, connection, and circuit scopes. //Start with a full list of gateways (resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=inner( resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=leftouter( //connections joined with circuit peer info resources | where type == \u0026#34;microsoft.network/connections\u0026#34; | extend connectionType = properties.connectionType | extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id)) | extend peerId = tolower(tostring(properties.peer.id)) | extend connectionId = tolower(tostring(id)) | where connectionType == \u0026#34;ExpressRoute\u0026#34; | join kind=leftouter( resources | where type == \u0026#34;microsoft.network/expressroutecircuits\u0026#34; //should this be location instead of peeringLocation | extend circuitId = tolower(tostring(id)) | extend peeringLocation = tostring(properties.serviceProviderProperties.peeringLocation) | extend peerId = tolower(id) ) on peerId ) on exrGatewayId //remove bare metal services connections/circuits | where not(isnotnull(connectionId) and isnull(sku1)) //group by gateway ID\u0026#39;s and peering locations | summarize by exrGatewayId, peeringLocation //summarize to connections with fewer than two unique connections | summarize connCount = count() by exrGatewayId | where connCount \u0026lt; 2) on exrGatewayId | project recommendationId = \u0026#34;d37db635-157f-584d-9bce-4f6fc8c65ce5\u0026#34;, name, id, tags, param1 = \u0026#34;twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\u0026#34;) | union ( resources | where type == \u0026#34;microsoft.network/virtualnetworkgateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | extend exrGatewayId = tolower(tostring(id)) | join kind=leftouter( //connections joined with circuit peer info resources | where type == \u0026#34;microsoft.network/connections\u0026#34; | extend connectionType = properties.connectionType | extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id)) | extend peerId = tolower(tostring(properties.peer.id)) | extend connectionId = tolower(tostring(id)) | where connectionType == \u0026#34;ExpressRoute\u0026#34;) on exrGatewayId | where isnull(connectionType) | project recommendationId = \u0026#34;d37db635-157f-584d-9bce-4f6fc8c65ce5\u0026#34;, name, id, tags, param1 = \u0026#34;twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\u0026#34;, param2 = \u0026#34;noConnectionsOnGateway: true\u0026#34; ) Use Zone-redundant ExpressRoute gateway SKUs\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rbbe668b7-eb5c-c746-8b82-70afdedf0cae\rDescription:\rAzure ExpressRoute gateway offers variable SLAs based on deployment in single or multiple availability zones. To deploy virtual network gateways across zones automatically, use zone-redundant gateways for accessing critical, scalable services with increased resilience. Potential Benefits:\rEnhanced SLA and resilience\rLearn More:\rAbout ExpressRoute virtual network gateways - Zone-redundant gateway SKUs\rAbout zone-redundant virtual network gateway in Azure availability zones\rCreate a zone-redundant virtual network gateway in Azure Availability Zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // For all VNGs of type ExpressRoute, show all that are not zone redundant (Zonal or Regional) advisorresources | where properties.recommendationTypeId =~ \u0026#39;c9af1ef6-55bc-48af-bfe4-2c80490159f8\u0026#39; // RecommendationID from Advisor | mv-expand resId = properties.resourceMetadata.resourceId | extend resId = tostring(resId) | project recId = properties.recommendationTypeId, resId | join kind=leftouter ( resources | extend id = tostring(id) | project id, name, tags, location, properties ) on $left.resId == $right.id | project recommendationId = \u0026#34;bbe668b7-eb5c-c746-8b82-70afdedf0cae\u0026#34;, name , resId, tags, param1 = strcat(\u0026#34;sku-tier: \u0026#34;, properties.sku.tier), param2 = location,param3 = \u0026#34;Non Zone-Redundant GW\u0026#34; Monitor health for ExpressRoute gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r1c34faa8-8b99-974c-adbf-71922eae943c\rDescription:\rUse Network Insights for monitoring ExpressRoute Gateway\u0026#39;s health, including availability, performance, and scalability. Potential Benefits:\rEnhanced monitoring and alerting\rLearn More:\rExpressRoute monitoring, metrics, and alerts | ExpressRoute gateways\rAzure ExpressRoute Insights using Network Insights\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Avoid using ExpressRoute circuits for VNet to VNet communication\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r194c14ac-0d7a-5a48-ae32-75fa450ee564\rDescription:\rWhile multiple VNets can connect via the same ExpressRoute gateway, Microsoft recommends using alternatives like VNet peering, Azure Firewall, NVA, Azure Route Server, site-to-site VPN, virtual WAN, or SD-WAN for VNet-to-VNet communication to optimize network performance and management. Potential Benefits:\rEnhanced VNet integration efficiency\rLearn More:\rAbout ExpressRoute virtual network gateways - VNet-to-VNet connectivity\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure customer-controlled ExpressRoute gateway maintenance\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r3e115044-a3aa-433e-be01-ce17d67e50da\rDescription:\rExpressRoute gateways are updated for improved functionality, reliability, performance, and security. Customer-controlled maintenance configuration and scheduling minimize update impact and align with your maintenance windows. Potential Benefits:\rMinimizes update impact\rLearn More:\rConfigure customer-controlled maintenance for your virtual network gateway - ExpressRoute | Microsoft Learn\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Find all Virtual Network Gateways without Maintenance Configurations resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | extend resourceId = tolower(id) | join kind=leftouter ( maintenanceresources | where type =~ \u0026#34;Microsoft.Maintenance/configurationAssignments\u0026#34; | project JsonData = parse_json(properties) | extend maintenanceConfigurationId = tolower(tostring(JsonData.maintenanceConfigurationId)) | join kind=inner ( resources | where type =~ \u0026#34;Microsoft.Maintenance/maintenanceConfigurations\u0026#34; | project maintenanceConfigurationId=tolower(id) ) on maintenanceConfigurationId | project maintenanceConfigurationId, resourceId=tolower(tostring(JsonData.resourceId)) ) on resourceId | where isempty(maintenanceConfigurationId) | project recommendationId = \u0026#34;3e115044-a3aa-433e-be01-ce17d67e50da\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location Choose a Zone-redundant VPN gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r5b1933a6-90e4-f642-a01f-e58594e5aab2\rDescription:\rAzure VPN gateway offers variable SLAs based on deployment in one or two availability zones. Deploying zone-redundant virtual network gateways across availability zones ensures zone-resiliency, improving access to mission-critical, scalable services on Azure. Potential Benefits:\rEnhanced reliability and scalability\rLearn More:\rZone redundant Virtual network gateway in availability zone\rGateway SKU\rSLA summary for Azure services\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // For all VNGs of type Vpn, show any that do not have AZ in the SKU tier resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where properties.gatewayType == \u0026#34;Vpn\u0026#34; | where properties.sku.tier !contains \u0026#39;AZ\u0026#39; | project recommendationId = \u0026#34;5b1933a6-90e4-f642-a01f-e58594e5aab2\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location | order by id asc Enable Active-Active VPN Gateways for redundancy\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r281a2713-c0e0-3c48-b596-19f590c46671\rDescription:\rThe active-active mode is available for all SKUs except Basic, allowing for two Gateway IP configurations and two public IP addresses, enhancing redundancy and traffic handling. Potential Benefits:\rEnhanced reliability and network capacity\rLearn More:\rActive-active VPN gateway\rGateway SKU\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Identifies non-active-active VPN type virtual network gateways resources | where type =~ \u0026#39;Microsoft.Network/virtualNetworkGateways\u0026#39; | where properties.gatewayType =~ \u0026#34;vpn\u0026#34; | extend gatewayType = properties.gatewayType, vpnType = properties.vpnType, connections = properties.connections, activeactive=properties.activeActive | where activeactive == false | project recommendationId = \u0026#34;281a2713-c0e0-3c48-b596-19f590c46671\u0026#34;, name, id, tags Deploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\raf11fc4c-c06c-4f4c-b98d-6eee6d5c4c70\rDescription:\rDeploying active-active VPN concentrators and Azure VPN Gateways maximizes resilience and availability using a fully-meshed topology with four IPSec tunnels. Potential Benefits:\rMaximizes resilience and availability\rLearn More:\rDual-redundancy active-active VPN gateways for both Azure and on-premises networks\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor VPN gateway connections and health\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r9eab120e-f6d3-ee49-ba0d-766562ce7df1\rDescription:\rSet up monitoring and alerts for Virtual Network Gateway health to utilize a variety of metrics for ensuring operational efficiency and prompt response to any disruptions. Potential Benefits:\rImproved uptime and issue awareness\rLearn More:\rVPN gateway data reference\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable VPN gateway service health\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r9186dae0-7ddc-8f4b-bea5-55538cea4893\rDescription:\rVPN gateway leverages service health to inform users about both planned and unplanned maintenance, ensuring they are notified about modifications to their VPN connectivity. Potential Benefits:\rImproves VPN maintenance alerts\rLearn More:\rGetting started with Azure Metrics Explorer\rMonitor VPN gateway\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r4bae5a28-5cf4-40d9-bcf1-623d28f6d917\rDescription:\rFor zone-redundant VPN gateways, always use zone-redundant Standard SKU public IPs to avoid deploying all instances in one zone. This ensures the gateway\u0026#39;s reliability, applying to both active-passive (single IP) and active-active (dual IP) setups. Potential Benefits:\rEnhanced reliability and disaster recovery\rLearn More:\rAbout zone-redundant virtual network gateway in Azure availability zones\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// Azure Resource Graph Query // Provides a list of zone-redundant Azure VPN gateways associated with non-zone-redundant Public IPs resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where properties.gatewayType == \u0026#34;Vpn\u0026#34; | where properties.sku.tier contains \u0026#39;AZ\u0026#39; | mv-expand ipconfig = properties.ipConfigurations | extend pipId = tostring(ipconfig.properties.publicIPAddress.id) | join kind=inner ( resources | where location in~ (\u0026#34;australiaeast\u0026#34;, \u0026#34;brazilsouth\u0026#34;, \u0026#34;canadacentral\u0026#34;, \u0026#34;centralindia\u0026#34;, \u0026#34;centralus\u0026#34;, \u0026#34;eastasia\u0026#34;, \u0026#34;eastus\u0026#34;, \u0026#34;eastus2\u0026#34;, \u0026#34;francecentral\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;israelcentral\u0026#34;, \u0026#34;italynorth\u0026#34;, \u0026#34;japaneast\u0026#34;, \u0026#34;japanwest\u0026#34;, \u0026#34;koreacentral\u0026#34;, \u0026#34;mexicocentral\u0026#34;, \u0026#34;newzealandnorth\u0026#34;, \u0026#34;northeurope\u0026#34;, \u0026#34;norwayeast\u0026#34;, \u0026#34;polandcentral\u0026#34;, \u0026#34;qatarcentral\u0026#34;, \u0026#34;southafricanorth\u0026#34;, \u0026#34;southcentralus\u0026#34;, \u0026#34;southeastasia\u0026#34;, \u0026#34;spaincentral\u0026#34;, \u0026#34;swedencentral\u0026#34;, \u0026#34;switzerlandnorth\u0026#34;, \u0026#34;uaenorth\u0026#34;, \u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;westus2\u0026#34;, \u0026#34;westus3\u0026#34;, \u0026#34;usgovvirginia\u0026#34;, \u0026#34;chinanorth3\u0026#34;) | where type == \u0026#34;microsoft.network/publicipaddresses\u0026#34; | where isnull(zones) or array_length(zones) \u0026lt; 3 ) on $left.pipId == $right.id | project recommendationId = \u0026#34;4bae5a28-5cf4-40d9-bcf1-623d28f6d917\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;PublicIpAddressName: \u0026#34;, name1), param2 = strcat (\u0026#34;PublicIpAddressId: \u0026#34;,id1), param3 = strcat (\u0026#34;PublicIpAddressTags: \u0026#34;,tags1) ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rConnect ExpressRoute gateway with circuits from diverse peering locations\rHigh\rHigh Availability\rYes\rYes\rUse Zone-redundant ExpressRoute gateway SKUs\rHigh\rHigh Availability\rYes\rYes\rMonitor health for ExpressRoute gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rAvoid using ExpressRoute circuits for VNet to VNet communication\rMedium\rHigh Availability\rNo\rNo\rConfigure customer-controlled ExpressRoute gateway maintenance\rHigh\rHigh Availability\rYes\rNo\rChoose a Zone-redundant VPN gateway\rHigh\rHigh Availability\rYes\rNo\rEnable Active-Active VPN Gateways for redundancy\rMedium\rHigh Availability\rYes\rYes\rDeploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways\rHigh\rDisaster Recovery\rNo\rNo\rMonitor VPN gateway connections and health\rHigh\rMonitoring and Alerting\rNo\rNo\rEnable VPN gateway service health\rHigh\rMonitoring and Alerting\rNo\rNo\rDeploy zone-redundant VPN gateways with zone-redundant Public IP(s)\rHigh\rHigh Availability\rYes\rNo\rDetails\rConnect ExpressRoute gateway with circuits from diverse peering locations\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rd37db635-157f-584d-9bce-4f6fc8c65ce5\rDescription:\rFor improved reliability, each ExpressRoute gateway should connect to at least two circuits, with each circuit sourced from a different peering location."},{"id":342,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworks/","title":"virtualNetworks","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDetails\r","description":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDetails\r"},{"id":343,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualNetworkTaps/","title":"virtualNetworkTaps","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":344,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualRouters/","title":"virtualRouters","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rPeer two NVA instances with both Azure Route Server instances\rHigh\rHigh Availability\rNo\rNo\rMonitor and create alerting for Azure Route Server\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rPeer two NVA instances with both Azure Route Server instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2226d069-de5b-4ec1-ad26-3249f4ab1741\rDescription:\rTo ensure that routes are successfully advertised to Route Server and to configure high availability, peer two NVA instances with both instances of Route Server. Advertise the same routes to both Route Server instances. Potential Benefits:\rConnectivity will remain active during maintenance events\rLearn More:\rAzure Route Server frequently asked questions (FAQ)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Monitor and create alerting for Azure Route Server\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rb8ff662a-ab74-4b6a-8301-d4dae002bc14\rDescription:\rMonitor Azure Route Server for BGP Peer Status, Count of Routes Advertised to Peer, and Count of Routes Learned from Peer. Create alerts for these metrics to ensure that you are notified of any issues. Potential Benefits:\rBe alerted to connectivity issues with Azure Route Server\rLearn More:\rMonitor Azure Route Server\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rPeer two NVA instances with both Azure Route Server instances\rHigh\rHigh Availability\rNo\rNo\rMonitor and create alerting for Azure Route Server\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rPeer two NVA instances with both Azure Route Server instances\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r2226d069-de5b-4ec1-ad26-3249f4ab1741\rDescription:\rTo ensure that routes are successfully advertised to Route Server and to configure high availability, peer two NVA instances with both instances of Route Server."},{"id":345,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/virtualWans/","title":"virtualWans","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":346,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/NetworkCloud/volumes/","title":"volumes","parent":"NetworkCloud","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":347,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServiceFabricMesh/volumes/","title":"volumes","parent":"ServiceFabricMesh","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":348,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnGateways/","title":"vpnGateways","parent":"Network","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor gateway for Site-to-site v-Hub\u0026#39;s VPN gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor gateway for Site-to-site v-Hub\u0026#39;s VPN gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rf0d4f766-ac19-48c4-b228-4601cc038baa\rDescription:\rSet up monitoring and alerts for v-Hub\u0026#39;s VPN Gateway. Create alert rule for ensuring promptly response to critical events such as packet drop counts, BGP status, Gateway overutilization.\rPotential Benefits:\rDetection and mitigation to avoid disruptions.\rLearn More:\rVirtual WAN Monitoring Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rMonitor gateway for Site-to-site v-Hub\u0026#39;s VPN gateway\rHigh\rMonitoring and Alerting\rNo\rNo\rDetails\rMonitor gateway for Site-to-site v-Hub\u0026#39;s VPN gateway\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\rf0d4f766-ac19-48c4-b228-4601cc038baa\rDescription:\rSet up monitoring and alerts for v-Hub\u0026#39;s VPN Gateway. Create alert rule for ensuring promptly response to critical events such as packet drop counts, BGP status, Gateway overutilization.\rPotential Benefits:\rDetection and mitigation to avoid disruptions."},{"id":349,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnServerConfigurations/","title":"vpnServerConfigurations","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":350,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Network/vpnSites/","title":"vpnSites","parent":"Network","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":351,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Web/","title":"Web","parent":"Azure Resources","content":"","description":""},{"id":352,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/SignalRService/webPubSub/","title":"webPubSub","parent":"SignalRService","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":353,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/webServices/","title":"webServices","parent":"MachineLearning","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":354,"href":"/Azure-Proactive-Resiliency-Library-v2/welcome/","title":"Welcome","parent":"Azure Proactive Resiliency Library v2","content":" Welcome to the home of the Azure Proactive Resiliency Library v2 (APRL). The purpose of this site is to provide a curated catalog of resiliency recommendations for workloads running in Azure. Many of the recommendations contain supporting Azure Resource Graph (ARG) queries to help identify non-compliant resources.\nThe site content is organized into four main sections:\nAzure Resources: This section provides recommendations for individual Azure resources. Recommendations are organized by Azure resource provider and resource type.\nSpecialized Workloads: This section provides recommendations for popular workload types. The recommendations cover multiple resource types and include workload specific guidance.\nWell-Architected Framework: This section provides resiliency recommendations from the Azure Well-Architected Framework\nTools: This section provides automation scripts for workload evaluation. The scripts execute the ARG queries and create documents for analysis, reporting, and triage.\nGet Started\rTo get started head over to the Azure Resources section and then navigate to your chosen resource provider and resource type. Each of the listed resource types will provide recommendations, supporting documentation, and, when available, ARG queries.\nYou can also use the basic search functionality provided by this site to locate the Azure resource you are looking for.\rContributing\rPlease see the contribution guide here.\n","description":"Welcome to the home of the Azure Proactive Resiliency Library v2 (APRL). The purpose of this site is to provide a curated catalog of resiliency recommendations for workloads running in Azure. Many of the recommendations contain supporting Azure Resource Graph (ARG) queries to help identify non-compliant resources.\nThe site content is organized into four main sections:\nAzure Resources: This section provides recommendations for individual Azure resources. Recommendations are organized by Azure resource provider and resource type."},{"id":355,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Logic/workflows/","title":"workflows","parent":"Logic","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":356,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Advisor/workloads/","title":"workloads","parent":"Advisor","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":357,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Databricks/workspaces/","title":"workspaces","parent":"Databricks","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDatabricks runtime version is not latest or is not LTS version\rMedium\rGovernance\rNo\rNo\rUse SSD backed VMs for Worker VM Type and Driver type\rMedium\rScalability\rNo\rNo\rEnable autoscaling for batch workloads\rHigh\rScalability\rNo\rNo\rEnable autoscaling for SQL warehouse\rHigh\rScalability\rNo\rNo\rUse Delta Live Tables enhanced autoscaling\rMedium\rScalability\rNo\rNo\rAutomatic Job Termination is enabled, ensure there are no user-defined local processes\rMedium\rHigh Availability\rNo\rNo\rEnable Logging-Cluster log delivery\rMedium\rMonitoring and Alerting\rNo\rNo\rUse Delta Lake for higher reliability\rHigh\rHigh Availability\rNo\rNo\rAutomatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rLow\rBusiness Continuity\rNo\rNo\rConfigure jobs for automatic retries and termination\rHigh\rHigh Availability\rNo\rNo\rUse a scalable and production-grade model serving infrastructure\rHigh\rScalability\rNo\rNo\rUse a layered storage architecture\rMedium\rHigh Availability\rNo\rNo\rImprove data integrity by reducing data redundancy\rLow\rBusiness Continuity\rNo\rNo\rActively manage schemas\rMedium\rOther Best Practices\rNo\rNo\rUse constraints and data expectations\rLow\rBusiness Continuity\rNo\rNo\rCreate regular backups\rLow\rDisaster Recovery\rNo\rNo\rRecover from Structured Streaming query failures\rHigh\rHigh Availability\rNo\rNo\rRecover ETL jobs based on Delta time travel\rMedium\rDisaster Recovery\rNo\rNo\rUse Databricks Workflows and built-in recovery\rLow\rDisaster Recovery\rNo\rNo\rConfigure a disaster recovery pattern\rHigh\rDisaster Recovery\rNo\rNo\rAutomate deployments and workloads\rHigh\rOther Best Practices\rNo\rNo\rSet up monitoring, alerting, and logging\rHigh\rMonitoring and Alerting\rNo\rNo\rDeploy workspaces in separate Subscriptions\rHigh\rScalability\rNo\rNo\rIsolate each workspace in its own VNet\rHigh\rScalability\rNo\rNo\rDo not Store any Production Data in Default DBFS Folders\rHigh\rHigh Availability\rNo\rNo\rDo not use Azure Spot VMs for critical Production workloads\rHigh\rHigh Availability\rNo\rNo\rEvaluate regional isolation for workspaces\rHigh\rHigh Availability\rNo\rNo\rDefine alternate VM SKUs\rMedium\rPersonalized\rNo\rNo\rUse managed services where possible\rHigh\rScalability\rNo\rNo\rDetails\rDatabricks runtime version is not latest or is not LTS version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r0e835cc2-2551-a247-b1f1-3c5f25c9cb70\rDescription:\rDatabricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support. If on Runtime 11.3 LTS or above, move directly to the latest 12.x version. If below, first migrate to 11.3 LTS, then to the latest 12.x version as per the migration guide. Potential Benefits:\rEnhanced stability and support\rLearn More:\rDatabricks runtime support lifecycles\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use SSD backed VMs for Worker VM Type and Driver type\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r5877a510-8444-7a4c-8412-a8dab8662f7e\rDescription:\rUpgrade HDDs in premium VMs to SSDs for better speed and reliability. Premium SSDs boost IO-heavy apps; Standard SSDs balance cost and performance. Ideal for critical workloads, upgrading improves connectivity with brief reboot. Consider for vital VMs Potential Benefits:\rFaster, reliable VM performance\rLearn More:\rAzure managed disk types\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable autoscaling for batch workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r5c72f0d6-55ec-d941-be84-36c194fa78c0\rDescription:\rAutoscaling adjusts cluster sizes automatically based on workload demands, offering benefits for many use cases in terms of costs and performance. It includes guidance on when and how to best utilize Autoscaling. For streaming, Delta Live Tables with autoscaling is advised. Potential Benefits:\rCost and performance optimization\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable autoscaling for SQL warehouse\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r362ad2b6-b92c-414f-980a-0cf69467ccce\rDescription:\rThe scaling parameter of a SQL warehouse defines the min and max number of clusters for distributing queries. By default, it\u0026#39;s set to one. Increasing the cluster count can accommodate more concurrent users effectively. Potential Benefits:\rImproves concurrency and efficiency\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Delta Live Tables enhanced autoscaling\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\rcd77db98-9b13-6e4b-bd2b-74c2cb538628\rDescription:\rDatabricks enhanced autoscaling optimizes cluster utilization by automatically allocating cluster resources based on workload volume, with minimal impact on the data processing latency of your pipelines. Potential Benefits:\rOptimized resource use and minimal latency\rLearn More:\rBest practices for reliability\rDatabricks enhanced autoscaling\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatic Job Termination is enabled, ensure there are no user-defined local processes\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r3d3e53b5-ebd1-db42-b43b-d4fad74824ec\rDescription:\rTo conserve cluster resources, you can terminate a cluster to store its configuration for future reuse or autostart jobs. Clusters can auto-terminate after inactivity, but this only tracks Spark jobs, not local processes, which might still be running even after Spark jobs end. Potential Benefits:\rSaves cluster resources, avoids idle use\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Enable Logging-Cluster log delivery\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r7fb90127-5364-bb4d-86fa-30778ed713fb\rDescription:\rWhen creating a Databricks cluster, you can set a log delivery location for the Spark driver, worker nodes, and events. Logs are delivered every 5 mins and archived hourly. Upon cluster termination, all generated logs until that point are guaranteed to be delivered. Potential Benefits:\rImproved troubleshooting and audit\rLearn More:\rCreate a cluster\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Delta Lake for higher reliability\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rda4ea916-4df3-8c4d-8060-17b49da45977\rDescription:\rDelta Lake is an open source storage format enhancing data lakes\u0026#39; reliability with ACID transactions, schema enforcement, and scalable metadata handling. Potential Benefits:\rEnhances data reliability and processing\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\r7e52d64d-8cc0-8548-a593-eb49ab45630d\rDescription:\rInvalid or nonconforming data can crash workloads dependent on specific data formats. Best practices recommend filtering such data at ingestion to improve end-to-end resilience, ensuring no data is lost or missed. Potential Benefits:\rEnhanced data resilience and integrity\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure jobs for automatic retries and termination\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r84e44da6-8cd7-b349-b02c-c8bf72cf587c\rDescription:\rUse Databricks and MLflow for deploying models as Spark UDFs for job scheduling, retries, autoscaling. Model serving offers scalable infrastructure, processes models using MLflow, and serves them via REST API using serverless compute managed in Databricks cloud. Potential Benefits:\rEnhanced reliability and autoscaling\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use a scalable and production-grade model serving infrastructure\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r4cbb7744-ff3d-0447-badb-baf068c95696\rDescription:\rUse Databricks and MLflow for deploying models as Apache Spark UDFs, benefiting from job scheduling, retries, autoscaling, etc. Potential Benefits:\rEnhances scalability and reliability\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use a layered storage architecture\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r1b0d0893-bf0e-8f4c-9dc6-f18f145c1ecf\rDescription:\rCurate data by creating a layered architecture to increase data quality across layers. Start with a raw layer for ingested source data, continue with a curated layer for cleansed and refined data, and finish with a final layer catered to business needs, focusing on security and performance. Potential Benefits:\rEnhances data quality and trust\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Improve data integrity by reducing data redundancy\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\re93fe702-e385-d741-ba37-1f1656482ecd\rDescription:\rCopying data leads to redundancy, lost integrity, lineage, and access issues, affecting lakehouse data quality. Temporary copies are useful for agility and innovation but can become problematic operational data silos, questioning data\u0026#39;s master status and currency. Potential Benefits:\rEnhanced data integrity and quality\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Actively manage schemas\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\rb7e1d13f-54c9-1648-8a52-34c0abe8ce16\rDescription:\rUncontrolled schema changes can lead to invalid data and failing jobs. Databricks validates and enforces schema through Delta Lake, which prevents bad records during ingestion, and Auto Loader, which detects new columns and supports schema evolution to maintain data integrity. Potential Benefits:\rPrevents invalid data and job failures\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use constraints and data expectations\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rBusiness Continuity\rAPRL GUID:\u0026nbsp;\ra42297c4-7e4f-8b41-8d4b-114033263f0e\rDescription:\rDelta tables verify data quality automatically with SQL constraints, triggering an error for violations. Delta Live Tables enhance this by defining expectations for data quality, utilizing Python or SQL, to manage actions for record failures, ensuring data integrity and compliance. Potential Benefits:\rEnsures data quality and integrity\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Create regular backups\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r932d45d6-b46d-e341-abfb-d97bce832f1f\rDescription:\rTo recover from a failure, regular backups are needed. The Databricks Labs project migrate lets admins create backups by exporting workspace assets using the Databricks CLI/API. These backups help in restoring or migrating workspaces. Potential Benefits:\rEnsures data recovery and migration\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Recover from Structured Streaming query failures\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r12e9d852-5cdc-2743-bffe-ee21f2ef7781\rDescription:\rStructured Streaming ensures fault-tolerance and data consistency in streaming queries. With Azure Databricks workflows, you can set up your queries to automatically restart after failure, picking up precisely where they left off. Potential Benefits:\rFault-tolerance and auto-restart for queries\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Recover ETL jobs based on Delta time travel\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\ra18d60f8-c98c-ba4e-ad6e-2fac72879df1\rDescription:\rDespite thorough testing, a production job can fail or yield unexpected data. Sometimes, repairs are done by adding jobs post-issue identification and pipeline correction. Potential Benefits:\rEasy rollback and fix for ETL jobs\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use Databricks Workflows and built-in recovery\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\rc0e22580-3819-444d-8546-a80e4ed85c83\rDescription:\rDatabricks Workflows enable efficient error recovery in multi-task jobs by offering a matrix view for issue examination. Fixes can be applied to initiate repair runs targeting only failed and dependent tasks, preserving successful outcomes and thereby saving time and money. Potential Benefits:\rSaves time and money with smart recovery\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Configure a disaster recovery pattern\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rDisaster Recovery\rAPRL GUID:\u0026nbsp;\r4fdb7112-4531-6f48-b60e-c917a6068d9b\rDescription:\rImplementing a disaster recovery pattern is vital for Azure Databricks, ensuring data teams\u0026#39; access even during rare regional outages. It is important to note that the Azure Databricks service is not entirely zone redudant and does support zonal failover. Potential Benefits:\rEnsures service continuity during disasters\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Automate deployments and workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rOther Best Practices\rAPRL GUID:\u0026nbsp;\r42aedaa8-6151-424d-b782-b8666c779969\rDescription:\rThe Databricks Terraform provider manages Azure Databricks workspaces and cloud infrastructure flexibly and powerfully. Potential Benefits:\rEfficient, reliable automation\rLearn More:\rBest practices for operational excellence\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Set up monitoring, alerting, and logging\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r20193ff9-dbcd-a74e-b197-71d7d9d3c1e6\rDescription:\rThe Databricks Terraform provider is a flexible, powerful tool for managing Azure Databricks workspaces and cloud infrastructure. Potential Benefits:\rEnhanced reliability and automation\rLearn More:\rBest practices for operational excellence\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Deploy workspaces in separate Subscriptions\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r397cdebb-9d6e-ab4f-83a1-8c481de0a3a7\rDescription:\rCustomers often naturally divide workspaces by teams or departments. However, it\u0026#39;s crucial to also consider Azure Subscription and Azure Databricks (ADB) Workspace limits when partitioning. Potential Benefits:\rEnhanced limits management, team separation\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Isolate each workspace in its own VNet\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\r5e722c4f-415a-9b4c-bd4c-96b74dce29ad\rDescription:\rDeploying only one Databricks Workspace per VNet aligns with Azure Databricks\u0026#39; isolation model. Potential Benefits:\rEnhanced security and resource isolation\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Do not Store any Production Data in Default DBFS Folders\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r14310ba6-77ad-3641-a2db-57a2218b9bc7\rDescription:\rDriven by security and data availability concerns, each Azure Databricks Workspace comes with a default DBFS designed for system-level artifacts like libraries and Init scripts, not for production data. Potential Benefits:\rEnhanced security, data protection\rLearn More:\rAzure Databricks Best Practices\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Do not use Azure Spot VMs for critical Production workloads\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\rb5af7e26-3939-1b48-8fba-f8d4a475c67a\rDescription:\rAzure Spot VMs are not suitable for critical production workloads needing high availability and reliability. They are meant for fault-tolerant tasks and can be evicted with 30-seconds notice if Azure needs the capacity, with no SLA guarantees. Potential Benefits:\rEnsures high reliability for production\rLearn More:\rUse Azure Spot Virtual Machines\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Evaluate regional isolation for workspaces\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rHigh Availability\rAPRL GUID:\u0026nbsp;\r8aa63c34-dd9d-49bd-9582-21ec310dfbdd\rDescription:\rMove workspaces to in-region control plane for increased regional isolation. Identify current control plane region using the workspace URL and nslookup. When region from CNAME differs from workspace region and an in-region control is available, consider migration using tools provided below. Potential Benefits:\rImproves resilience and data sovereignty\rLearn More:\rAzure Databricks control plane addresses\rMigrate - maintained by Databricks Inc.\rDatabricks Terraform Exporter - maintained by Databricks Inc. (Experimental)\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Define alternate VM SKUs\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rPersonalized\rAPRL GUID:\u0026nbsp;\r028593be-956e-4736-bccf-074cb10b92f4\rDescription:\rAzure Databricks planning should include VM SKU swap strategies for capacity issues. VMs are regional, and allocation failures may occur, shown by a \u0026#34;CLOUD PROVIDER\u0026#34; error. Potential Benefits:\rEnsures service availability\rLearn More:\rCompute configuration best practices\rGPU-enabled compute\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// under-development Use managed services where possible\rImpact:\u0026nbsp;\rHigh\rCategory:\u0026nbsp;\rScalability\rAPRL GUID:\u0026nbsp;\re94da1f8-33e7-48a6-b301-72f19a53bc29\rDescription:\rWhere possible Leverage managed services (serverless compute) from the Databricks Data Intelligence Platform, such as:serverless SQL warehouses, model serving, serverless jobs, serverless compute for notebooks. Potential Benefits:\rImprove resiliency and scalability at no additional cost\rLearn More:\rBest practices for reliability\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rDatabricks runtime version is not latest or is not LTS version\rMedium\rGovernance\rNo\rNo\rUse SSD backed VMs for Worker VM Type and Driver type\rMedium\rScalability\rNo\rNo\rEnable autoscaling for batch workloads\rHigh\rScalability\rNo\rNo\rEnable autoscaling for SQL warehouse\rHigh\rScalability\rNo\rNo\rUse Delta Live Tables enhanced autoscaling\rMedium\rScalability\rNo\rNo\rAutomatic Job Termination is enabled, ensure there are no user-defined local processes\rMedium\rHigh Availability\rNo\rNo\rEnable Logging-Cluster log delivery\rMedium\rMonitoring and Alerting\rNo\rNo\rUse Delta Lake for higher reliability\rHigh\rHigh Availability\rNo\rNo\rAutomatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables\rLow\rBusiness Continuity\rNo\rNo\rConfigure jobs for automatic retries and termination\rHigh\rHigh Availability\rNo\rNo\rUse a scalable and production-grade model serving infrastructure\rHigh\rScalability\rNo\rNo\rUse a layered storage architecture\rMedium\rHigh Availability\rNo\rNo\rImprove data integrity by reducing data redundancy\rLow\rBusiness Continuity\rNo\rNo\rActively manage schemas\rMedium\rOther Best Practices\rNo\rNo\rUse constraints and data expectations\rLow\rBusiness Continuity\rNo\rNo\rCreate regular backups\rLow\rDisaster Recovery\rNo\rNo\rRecover from Structured Streaming query failures\rHigh\rHigh Availability\rNo\rNo\rRecover ETL jobs based on Delta time travel\rMedium\rDisaster Recovery\rNo\rNo\rUse Databricks Workflows and built-in recovery\rLow\rDisaster Recovery\rNo\rNo\rConfigure a disaster recovery pattern\rHigh\rDisaster Recovery\rNo\rNo\rAutomate deployments and workloads\rHigh\rOther Best Practices\rNo\rNo\rSet up monitoring, alerting, and logging\rHigh\rMonitoring and Alerting\rNo\rNo\rDeploy workspaces in separate Subscriptions\rHigh\rScalability\rNo\rNo\rIsolate each workspace in its own VNet\rHigh\rScalability\rNo\rNo\rDo not Store any Production Data in Default DBFS Folders\rHigh\rHigh Availability\rNo\rNo\rDo not use Azure Spot VMs for critical Production workloads\rHigh\rHigh Availability\rNo\rNo\rEvaluate regional isolation for workspaces\rHigh\rHigh Availability\rNo\rNo\rDefine alternate VM SKUs\rMedium\rPersonalized\rNo\rNo\rUse managed services where possible\rHigh\rScalability\rNo\rNo\rDetails\rDatabricks runtime version is not latest or is not LTS version\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\r0e835cc2-2551-a247-b1f1-3c5f25c9cb70\rDescription:\rDatabricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support."},{"id":358,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/DesktopVirtualization/workspaces/","title":"workspaces","parent":"DesktopVirtualization","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":359,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Easm/workspaces/","title":"workspaces","parent":"Easm","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":360,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/HealthcareApis/workspaces/","title":"workspaces","parent":"HealthcareApis","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":361,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearning/workspaces/","title":"workspaces","parent":"MachineLearning","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":362,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/MachineLearningServices/workspaces/","title":"workspaces","parent":"MachineLearningServices","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":363,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/OperationalInsights/workspaces/","title":"workspaces","parent":"OperationalInsights","content":"\rSummary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Log Analytics data export to GRS or GZRS\rMedium\rGovernance\rNo\rNo\rCreate a health status alert rule for your Log Analytics workspace\rLow\rMonitoring and Alerting\rNo\rNo\rDetails\rEnable Log Analytics data export to GRS or GZRS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rb36fd2ac-dd83-664a-ab48-ff7b8d3b189d\rDescription:\rData export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools. Potential Benefits:\rEnhances compliance and regional fault tolerance\rLearn More:\rLog Analytics workspace data export in Azure Monitor\rAzure Monitor configuration recommendations\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg Create a health status alert rule for your Log Analytics workspace\rImpact:\u0026nbsp;\rLow\rCategory:\u0026nbsp;\rMonitoring and Alerting\rAPRL GUID:\u0026nbsp;\r4b77191c-cc3c-8c4e-844b-0f56d0927890\rDescription:\rA health status alert will proactively notify you if a workspace becomes unavailable because of a datacenter or regional failure. Potential Benefits:\rEarly alert for workspace failure\rLearn More:\rMonitor Log Analytics workspace health\rAzure Monitor configuration recommendations\rARG Query:\rClick the Azure Resource Graph tab to view the query\nAzure Resource Graph\r// cannot-be-validated-with-arg ","description":"Summary\rRecommendation\rImpact\rCategory\rAutomation Available\rIn Azure Advisor\rEnable Log Analytics data export to GRS or GZRS\rMedium\rGovernance\rNo\rNo\rCreate a health status alert rule for your Log Analytics workspace\rLow\rMonitoring and Alerting\rNo\rNo\rDetails\rEnable Log Analytics data export to GRS or GZRS\rImpact:\u0026nbsp;\rMedium\rCategory:\u0026nbsp;\rGovernance\rAPRL GUID:\u0026nbsp;\rb36fd2ac-dd83-664a-ab48-ff7b8d3b189d\rDescription:\rData export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools."},{"id":364,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Quantum/workspaces/","title":"workspaces","parent":"Quantum","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":365,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/ServicesHub/workspaces/","title":"workspaces","parent":"ServicesHub","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""},{"id":366,"href":"/Azure-Proactive-Resiliency-Library-v2/azure-resources/Synapse/workspaces/","title":"workspaces","parent":"Synapse","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n","description":""}]