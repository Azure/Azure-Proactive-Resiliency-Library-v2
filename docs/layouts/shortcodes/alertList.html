<!--
Recommendation List
-->

<!-- Get resouce type and category from page path -->
{{ $pageDir := path.Dir $.Page.File.Path }}
{{ $parentDir := path.Dir $pageDir }}
{{ $category := path.BaseName $parentDir }}
{{ $type := path.BaseName $pageDir }}


{{ with (index (index $.Site.Data $category) $type) }}
  <!-- Create a table of all recommendations under category/type -->
  <div>
    <table>
      <tr>
        <th>Recommendation</th>
        <th>Category</th>
        <th>Impact</th>
        <th>State</th>
        <th>ARG Query Available</th>
      </tr>
      <!-- Loop through recommendations under category/type -->
      {{ range sort .alerts "recommendation" "asc" }}
        {{ if or (eq .visible true) (eq $.Site.Params.ambaDevMode true) }}
          <tr>
            <td><a href="#{{ anchorize .recommendation }}">{{ .recommendation }}</a></td>
            <td>{{ .category }}</td>
            <td>{{ .impact }}</td>
            <td>{{ .state }}</td>
            <td>{{ .argQueryAvailable }}</td>
          </tr>
        {{ end }}
      {{ end }}
    </table>
  </div>

  <br>

  <h4>Dashboards:</h4>
  {{ partial "templates/dashboard-tabs.html" (dict "type" $type "alerts" .alerts) }}

  <!-- Create a detail entry for each recommendation under category/type -->
  {{ range sort .alerts "recommendation" "asc" }}
    {{ if or (eq .visible true) (eq $.Site.Params.ambaDevMode true) }}
    <br><br>
      <div id="{{ anchorize .recommendation }}">
        <hr style="height: 4px;">
        <h3>{{ .recommendation }} - {{ .category }} Alert</h3>
        <div style="text-indent: 1%;"><i>{{ .description }}</i></div>
        <h4>Recommended Properties:</h4>
        <table>
          {{ range $key, $value := .properties }}
            <tr>
              <td>{{ $key }}</td>
              <td>
                {{ if or (reflect.IsMap $value) (reflect.IsSlice $value) }}
                  {{ transform.Highlight (encoding.Jsonify (dict "indent" "  ")  $value) "json" }}
                {{ else if eq $key "query" }}
                  {{ transform.Highlight $value "plaintext" }}
                {{ else }}
                  {{ $value }}
                {{ end }}
              </td>
            </tr>
          {{ end }}
        </table>
        <h4>References:</h4>
        <table>
          {{ range .references }}
            <tr>
              <td><a href="{{ .url }}" target="_blank">{{ .recommendation }}</a></td>            </tr>
          {{ end }}
        </table>
        <h4>Templates:</h4>
        {{ partial "templates/template-tabs" (dict "category" $category "type" $type "alert" .) }}
      </div>
    {{ end }}
  {{ end }}
{{ end }}
